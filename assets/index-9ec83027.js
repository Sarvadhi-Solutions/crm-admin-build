import{am as C,an as fe,ao as xe,ap as Le,a as L,r as g,j as e,ai as Ce,ar as je}from"./index-a75c2214.js";import{A as ye}from"./AdaptableCard-157123a1.js";import{D as we}from"./DataTable-b1135672.js";import{c as be,d as De,e as ve,f as Se,g as Ne,h as Te,i as Ie,j as ae,k as Ae}from"./CrmService-4f2387c5.js";import{u as te}from"./useThemeClass-37b957ee.js";import{B as H}from"./Button-13333fa1.js";import{D as Fe}from"./Drawer-4be8ac77.js";import{a as R,F as ke}from"./FormItem-e7510cc7.js";import{t as T,N as I}from"./toast-9ba48d0f.js";import{T as se}from"./index-1e228cad.js";import{u as Oe,b as V,F as Ee,a as Re}from"./formik.esm-3c1d58de.js";import{c as ze,a as $,b as Me}from"./index.esm-c3869bde.js";import{I as K}from"./Input-8164dacf.js";import{a6 as qe,a7 as Y,m as Ve,a8 as $e,A as Be,b as He,d as Ge}from"./index.esm-ba9f59e9.js";import{D as Z,A as Ue,t as Ke,c as Pe}from"./AdditionalTag-9ab7e90c.js";/* empty css              */import{T as We}from"./index.esm-f6b05d17.js";import"./Alert-a3186a3f.js";import{A as _e}from"./index-3aa09f20.js";import{B as oe}from"./Badge-03bb3502.js";import"./Calendar-527cd69e.js";import{C as Je}from"./Card-f8be7cf5.js";import"./index-4e44d9bc.js";import"./index-28e44be9.js";import"./Dialog-093c796b.js";import"./index-04ed9e3c.js";import"./toString-a311c7f9.js";import"./index-d65d54e7.js";import"./index-ce1976e4.js";import"./index-24cfecab.js";import"./Pagination-d83ae71e.js";import"./Progress-17d38890.js";import"./index-63ca2c3a.js";import"./RangeCalendar-e6435c7c.js";import"./ScrollBar-da9f6718.js";import"./index-916893a5.js";import{S as re,c as Qe}from"./Select-e3c4e091.js";import"./Skeleton-d2cdaf3e.js";import"./index-191a7578.js";import"./Switcher-5b991065.js";import"./index-00cb4b16.js";import"./Tag-9c9d82f1.js";import"./index-4c7d26f9.js";import"./index-3499d56e.js";import"./Tooltip-b12e8e28.js";import"./Upload-b697435a.js";import{c as z}from"./cloneDeep-88274fc4.js";import{u as P}from"./checkEditUpdate-f9d6d97e.js";import{T as Xe}from"./TagsList-0056b07b.js";import{C as Ye}from"./ConfirmDialog-7121b8e8.js";import{T as G}from"./TextTruncate-4ddafa66.js";import{S as Ze}from"./StatusCapsule-ec8d66eb.js";import{M as ea}from"./MediaSkeleton-a4de8acd.js";import{N as aa}from"./react-number-format.es-b704a7db.js";import{d as ta}from"./debounce-0a9c6838.js";import{g as sa}from"./index-35939218.js";import{s as oa}from"./index-f551d59c.js";import"./TableRowSkeleton-c1e29323.js";import"./index-55fec6a8.js";import"./context-e419e330.js";import"./index-60763994.js";import"./Views-10f1927c.js";import"./CloseButton-aa3449ba.js";import"./index-6d61f856.js";import"./useTimeout-af422490.js";import"./StatusIcon-7df21d38.js";import"./chainedFunction-070f832c.js";import"./useControllableState-974d6e74.js";import"./isNil-92cba2d7.js";import"./get-de137b47.js";import"./_MapCache-876ac592.js";import"./useMergeRef-788c4cb0.js";import"./_Uint8Array-d074a65a.js";import"./_baseIsEqual-e85234c7.js";import"./useRootClose-481198be.js";import"./usePopper-c93af6af.js";import"./TimeInput-a7dbe6f6.js";import"./useUniqueId-88c0f361.js";import"./useDidUpdate-9629db24.js";import"./useUncertainRef-46d98c81.js";import"./slicedToArray-fb2022e5.js";import"./objectWithoutProperties-8e2777d0.js";import"./objectWithoutPropertiesLoose-4f48578a.js";import"./extends-98964cd2.js";import"./toConsumableArray-d3906663.js";import"./floating-ui.dom-bef9cea3.js";import"./mapCloneElement-24483c5b.js";import"./index.esm-6e5dfffa.js";import"./index.esm-d6edb43c.js";import"./index.esm-35d9794d.js";import"./_getPrototype-42ea40f8.js";import"./index-f4901db1.js";import"./index-6b251452.js";const ra="crmLeads",F=C("crmLeads/data/getLeadsStatistic",async()=>(await be()).data),w=C("crmLeads/data/getLeads",async()=>(await De()).data),W=C("crmContact/data/getContact",async()=>(await ve()).data),na=C("crmLeads/data/editLeads",async({leadsId:s,updatedData:a})=>{var t,o;try{return(await Se(s,a)).data}catch(n){throw new Error((o=(t=n==null?void 0:n.response)==null?void 0:t.data)==null?void 0:o.message)}}),ia=C("crmLeads/data/deleteLeads",async s=>{var a,t;try{return await Ne(s)}catch(o){throw new Error((t=(a=o==null?void 0:o.response)==null?void 0:a.data)==null?void 0:t.message)}}),ca=C("crmLeads/data/createLeads",async s=>{var a,t;try{return(await Te(s)).data}catch(o){throw new Error((t=(a=o==null?void 0:o.response)==null?void 0:a.data)==null?void 0:t.message)}}),da=C("crmLeads/data/module",async()=>(await Ie()).data),la=C("tag-category",async({id:s})=>(await ae(s)).data);C("crmLeads/data/fetchTag",async({id:s})=>(await ae(s)).data);C("crmLeads/data/createTag",async({masterId:s,colorName:a,tagName:t,tagCategoryId:o})=>(await Ae({colorName:a,tagName:t,masterId:s,tagCategoryId:o})).data);const ma={total:0,pageIndex:1,pageSize:10,query:"",sort:{order:"",key:""}},pa={status:""},ua={loading:!1,statisticLoading:!1,leadsList:[],displayedLeadsList:[],statisticData:{},tableData:ma,filterData:pa,drawerOpen:!1,selectedLeads:{},contactList:[],deleteConfirmation:!1},ne=fe({name:`${ra}/state`,initialState:ua,reducers:{setTableData:(s,a)=>{s.tableData=a.payload,s.displayedLeadsList=s.leadsList.slice(a.payload.pageSize*(a.payload.pageIndex-1),a.payload.pageSize*a.payload.pageIndex)},setLeadsList:(s,a)=>{s.leadsList=a.payload},setFilterData:(s,a)=>{s.filterData=a.payload},setSelectedLeads:(s,a)=>{s.selectedLeads=a.payload},setDrawerOpen:s=>{s.drawerOpen=!0},setDrawerClose:s=>{s.drawerOpen=!1},toggleDeleteConfirmation:(s,a)=>{s.deleteConfirmation=a.payload}},extraReducers:s=>{s.addCase(w.fulfilled,(a,t)=>{var o;a.leadsList=t.payload.data,a.tableData.total=(o=t.payload.data)==null?void 0:o.length,a.displayedLeadsList=t.payload.data.slice(0,10),a.loading=!1}).addCase(w.pending,a=>{a.loading=!0}).addCase(F.fulfilled,(a,t)=>{a.statisticData=t.payload,a.statisticLoading=!1}).addCase(F.pending,a=>{a.statisticLoading=!0}).addCase(W.fulfilled,(a,t)=>{a.contactList=t.payload.data,a.loading=!1}).addCase(W.pending,a=>{a.loading=!0})}}),{setTableData:B,setLeadsList:Cs,setFilterData:ie,setSelectedLeads:Q,setDrawerOpen:ce,setDrawerClose:_,toggleDeleteConfirmation:J}=ne.actions,ga=ne.reducer,ha=xe({data:ga}),h=Le,A=[],fa=s=>{const{touched:a,errors:t,setFieldValue:o,values:n}=s,r=L(),l=Oe(),[x,c]=g.useState(!1),[m,j]=g.useState(!1),[b,D]=g.useState([]),[M,v]=g.useState([]),S=()=>{c(!x),j(!1)},p=["active","deactive"],i=h(d=>d.crmLeads.data.contactList);A.length=0,i.forEach(d=>{A.push({value:d==null?void 0:d.id,label:d==null?void 0:d.name})});const[f,q]=g.useState("");g.useEffect(()=>{(async()=>{var y,X;try{const{payload:O}=await r(da()),E=(y=O==null?void 0:O.data)==null?void 0:y.find(N=>(N==null?void 0:N.moduleName)==="leads");if(q(E.id),E){const{payload:N}=await r(la({id:(X=E==null?void 0:E.id)==null?void 0:X.toString()})),ge=Ke(N.data),he=Pe(N.data);v(he),D(ge)}}catch(O){console.error("Error fetching module data:",O)}})(),r(W())},[r]);const k=h(d=>d.crmLeads.data.selectedLeads),[u,pe]=g.useState(k?k.tags||[]:[]),ue=d=>{pe(d);const y=[d.value];l.setFieldValue("tagId",y)};return e.jsxs(e.Fragment,{children:[e.jsx(R,{label:"Contact Name",invalid:t.contactsDataId&&a.contactsDataId,errorMessage:t.contactsDataId,children:e.jsx(re,{name:"contactsDataId",placeholder:"Contact Name",options:A,id:"contactsDataId",onChange:d=>{const y=d.value;o("contactsDataId",y)},value:A.find(d=>(d==null?void 0:d.value)===(n==null?void 0:n.contactsDataId))})}),e.jsx(R,{label:"Details",invalid:t.details&&a.details,errorMessage:t.details,children:e.jsx(V,{type:"text",autoComplete:"off",name:"details",placeholder:"Details",component:K,prefix:e.jsx(qe,{className:"text-xl"})})}),e.jsx(R,{label:"Status",invalid:t.status&&a.status,errorMessage:t.status,children:e.jsx(V,{type:"text",autoComplete:"off",name:"status",placeholder:"Status",component:Z,options:p,id:"status",value:l.initialValues.status,prefix:e.jsx(Y,{className:"text-xl"}),onChange:d=>{const y=d.value;l.setFieldValue("status",y)}})}),e.jsx(R,{label:"Notes",invalid:t.notes&&a.notes,errorMessage:t.notes,children:e.jsx(V,{type:"text",autoComplete:"off",name:"notes",placeholder:"Notes",component:K,prefix:e.jsx(Y,{className:"text-xl"})})}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx(R,{label:"Tag",children:e.jsxs("div",{style:{position:"relative"},children:[e.jsx(V,{name:"Tag",component:Z,value:l.initialValues.tagName,options:b,placeholder:"Select a Tag",onChange:ue}),e.jsx(We,{style:{position:"absolute",right:"10px",top:"10px",border:"none",background:"#FFF"},className:"text-xl",onClick:()=>{S(),j(!0)}})]})}),e.jsx(Ue,{isOpen:x,categoryList:M,moduleName:f,onOpenChange:d=>c(d)})]})]})},xa=ze().shape({details:$().required("Details are required"),status:$().required("Status is required"),notes:$(),tagId:Me(),contactsDataId:$().required("This field is required").test("is-valid-contact","Invalid contact selected",s=>!!A.find(a=>a.value===s))});console.log(A,"contactOptions");const{TabNav:La,TabList:Ca,TabContent:ja}=se,de=g.forwardRef((s,a)=>{var r,l,x,c;const t=h(m=>m.crmLeads.data.selectedLeads),o=!!t.id,n=L();return e.jsx(Ee,{innerRef:a,initialValues:{contactsDataId:t.contactsDataId||null,details:(t==null?void 0:t.details)||"",status:(t==null?void 0:t.status)||"",notes:(t==null?void 0:t.notes)||"",tagName:((l=(r=t==null?void 0:t.tags)==null?void 0:r[0])==null?void 0:l.tagName)||"",name:((x=t==null?void 0:t.contactData)==null?void 0:x.name)||"",tagId:((c=t==null?void 0:t.tags)==null?void 0:c.map(m=>m.id))||[]},validationSchema:xa,onSubmit:async(m,{setSubmitting:j})=>{var S,p,i,f,q,k;const{colorName:b,name:D,tagName:M,...v}=m;if(o===!0){const u=await n(na({leadsId:(t==null?void 0:t.id)||"",updatedData:v}));(S=u==null?void 0:u.payload)!=null&&S.success?T.push(e.jsx(I,{title:"Successfully Update",type:"success",duration:2500,children:(p=u==null?void 0:u.payload)==null?void 0:p.message}),{placement:"top-end"}):T.push(e.jsx(I,{title:"Something went wrong !!!",type:"danger",duration:2500,children:(i=u==null?void 0:u.error)==null?void 0:i.message}),{placement:"top-end"}),n(_()),await n(w()),await n(F())}else{const u=await n(ca(v));(f=u==null?void 0:u.payload)!=null&&f.success?T.push(e.jsx(I,{title:"Successfully Added",type:"success",duration:2500,children:(q=u==null?void 0:u.payload)==null?void 0:q.message}),{placement:"top-end"}):T.push(e.jsx(I,{title:"Something went wrong !!!",type:"danger",duration:2500,children:(k=u==null?void 0:u.error)==null?void 0:k.message}),{placement:"top-end"}),n(_()),await n(w()),await n(F())}j(!1)},children:({touched:m,errors:j,values:b,setFieldValue:D})=>e.jsx(Re,{children:e.jsx(ke,{children:e.jsxs(se,{defaultValue:"leadsInfo",children:[e.jsx(Ca,{children:e.jsx(La,{value:"leadsInfo",children:"Leads Detail"})}),e.jsx("div",{className:"p-6",children:e.jsx(ja,{value:"leadsInfo",children:e.jsx(fa,{touched:m,errors:j,setFieldValue:D,values:b})})})]})})})})});de.displayName="LeadsForm";const le=g.forwardRef((s,a)=>{L();const t=h(n=>n.crmLeads.data.selectedLeads);h(n=>n.crmLeads.data.leadsList);const o=async n=>{};return e.jsx(de,{ref:a,leads:t,onFormSubmit:o})});le.displayName="LeadsEditContent";const ya=({onSaveClick:s,onCancel:a})=>e.jsxs("div",{className:"text-right w-full",children:[e.jsx(H,{size:"sm",className:"mr-2",onClick:a,children:"Cancel"}),e.jsx(H,{size:"sm",variant:"solid",onClick:s,children:"Save"})]}),wa=()=>{const s=L(),a=h(r=>r.crmLeads.data.drawerOpen),t=()=>{s(_()),s(Q({}))},o=g.useRef(null),n=()=>{var r;(r=o.current)==null||r.submitForm()};return e.jsx(Fe,{isOpen:a,closable:!1,bodyClass:"p-0",footer:e.jsx(ya,{onCancel:t,onSaveClick:n}),onClose:t,onRequestClose:t,children:e.jsx(le,{ref:o})})},ba=()=>{const s=L(),a=h(r=>r.crmLeads.data.deleteConfirmation),t=h(r=>r.crmLeads.data.selectedLeads),o=()=>{s(J(!1))},n=async()=>{var l,x,c;s(J(!1));const r=await s(ia(t.id));await s(w()),(l=r==null?void 0:r.payload)!=null&&l.success?T.push(e.jsx(I,{title:"Successfuly Deleted",type:"success",duration:2500,children:(x=r==null?void 0:r.payload)==null?void 0:x.message}),{placement:"top-end"}):T.push(e.jsx(I,{title:"Something Went Wrong !!!",type:"danger",duration:2500,children:(c=r==null?void 0:r.error)==null?void 0:c.message}),{placement:"top-end"}),await s(w()),await s(F())};return e.jsx(Ye,{isOpen:a,type:"danger",title:"Delete Lead",confirmButtonColor:"red-600",onClose:o,onRequestClose:o,onCancel:o,onConfirm:n,children:e.jsx("p",{children:"Are you sure you want to delete this Lead? All record related to this lead will be deleted as well. This action cannot be undone."})})},Da=({row:s})=>{const{textTheme:a}=te(),t=L(),o=()=>{t(ce()),t(Q(s))};return e.jsx("div",{className:`${a} cursor-pointer select-none font-semibold`,onClick:o,children:"Edit"})},va=({row:s})=>{const{textTheme:a}=te(),t=L(),o=async()=>{await t(Q(s)),t(J(!0))};return e.jsx("div",{children:e.jsx("div",{className:`${a} cursor-pointer select-none font-semibold text-red-500`,onClick:o,children:"Delete"})})},Sa=()=>{const s=L(),a=h(p=>p.crmLeads.data.displayedLeadsList),t=h(p=>p.crmLeads.data.loading),{pageIndex:o,pageSize:n,sort:r,query:l,total:x}=h(p=>p.crmLeads.data.tableData),c=g.useCallback(()=>{s(w())},[s]);g.useEffect(()=>{c()},[c]);const m=g.useMemo(()=>({pageIndex:o,pageSize:n,sort:r,query:l,total:x}),[o,n,r,l,x]),j=P("Leads","canDelete"),b=P("Leads","canModify"),D=g.useMemo(()=>{const p=[{header:"Details",accessorKey:"details",cell:i=>{const f=i.row.original.details;return e.jsx(G,{text:f,maxLength:20})}},{header:"Contact Name",accessorKey:"contactName",cell:i=>{const f=i.row.original.contactData.name;return e.jsx(G,{text:f,maxLength:20})}},{header:"Status",accessorKey:"status",cell:i=>{const f=i.row.original;return e.jsx(Ze,{status:f.status})}},{header:"Tag Name",accessorKey:"tagName",cell:i=>{const f=i.row.original.tags||[];return e.jsx(Xe,{tags:f})}},{header:"Notes",accessorKey:"notes",cell:i=>{const f=i.row.original.notes;return e.jsx(G,{text:f,maxLength:20})}}];return j&&p.unshift({header:"Delete",id:"action",cell:i=>e.jsx(va,{row:i.row.original})}),b&&p.unshift({header:"Edit",id:"action",cell:i=>e.jsx(Da,{row:i.row.original})}),p},[b,j]),M=p=>{const i=z(m);i.pageIndex=p,s(B(i))},v=p=>{const i=z(m);i.pageSize=Number(p),i.pageIndex=1,s(B(i))},S=p=>{const i=z(m);i.sort=p,s(B(i))};return e.jsxs("div",{children:[e.jsx(we,{columns:D,data:a,skeletonAvatarColumns:[0],skeletonAvatarProps:{width:28,height:28},loading:t,pagingData:{total:m.total,pageIndex:m.pageIndex,pageSize:m.pageSize},onPaginationChange:M,onSelectChange:v,onSort:S}),e.jsx(wa,{}),e.jsx(ba,{})]})},U=s=>{const{icon:a,avatarClass:t,label:o,value:n,loading:r}=s,l=55;return e.jsx(Je,{bordered:!0,children:e.jsx(Ce,{loading:r,customLoader:e.jsx(ea,{avatarProps:{className:"rounded",width:l,height:l}}),children:e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(_e,{className:t,size:l,icon:a}),e.jsxs("div",{children:[e.jsx("span",{children:o}),e.jsx("h3",{children:e.jsx(aa,{thousandSeparator:!0,displayType:"text",value:n})})]})]})})})})},Na=()=>{const s=L(),a=h(o=>o.crmLeads.data.statisticData),t=h(o=>o.crmLeads.data.statisticLoading);return g.useEffect(()=>{s(F())},[]),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4 mb-6",children:[e.jsx(U,{icon:e.jsx(Ve,{}),avatarClass:"!bg-indigo-600",label:"Total Leads",value:a.totalLeads,growthRate:a==null?void 0:a.totalLeads,loading:t}),e.jsx(U,{icon:e.jsx($e,{}),avatarClass:"!bg-blue-500",label:"Active Leads",value:a.activeLeads,growthRate:a.activeLeads,loading:t}),e.jsx(U,{icon:e.jsx(Be,{}),avatarClass:"!bg-emerald-500",label:"This Week's New Leads",value:a==null?void 0:a.newLeads,growthRate:a==null?void 0:a.newLeads,loading:t})]})},me=g.forwardRef((s,a)=>{const{onInputChange:t}=s,o=ta(n,500);function n(l){t==null||t(l)}const r=l=>{o(l.target.value)};return e.jsx(K,{ref:a,className:"max-w-md md:w-52 mb-4",size:"sm",placeholder:"Search",prefix:e.jsx(He,{className:"text-lg"}),onChange:r})});me.displayName="LeadsTableSearch";const{Control:Ta}=Qe,ee=[{value:"",label:"All",color:"bg-gray-500"},{value:"active",label:"Active",color:"bg-emerald-500"},{value:"blocked",label:"Blocked",color:"bg-red-500"}],Ia=({innerProps:s,label:a,data:t,isSelected:o})=>e.jsxs("div",{className:`flex items-center justify-between p-2 cursor-pointer ${o?"bg-gray-100 dark:bg-gray-500":"hover:bg-gray-50 dark:hover:bg-gray-600"}`,...s,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{innerClass:t.color}),e.jsx("span",{children:a})]}),o&&e.jsx(Ge,{className:"text-emerald-500 text-xl"})]}),Aa=({children:s,...a})=>{const t=a.getValue()[0];return e.jsxs(Ta,{...a,children:[t&&e.jsx(oe,{className:"ltr:ml-4 rtl:mr-4",innerClass:t.color}),s]})},Fa=()=>{const s=L(),{status:a}=h(o=>o.crmLeads.data.filterData),t=o=>{s(ie({status:o==null?void 0:o.value}))};return e.jsx(re,{options:ee,size:"sm",className:"mb-4 min-w-[130px]",components:{Option:Ia,Control:Aa},value:ee.filter(o=>o.value===a),onChange:t})},ka=()=>{const s=L(),a=g.useRef(null),t=h(c=>c.crmLeads.data.tableData),o=P("leads","canCreate"),n=c=>{const m=z(t);m.query=c,m.pageIndex=1,typeof c=="string"&&c.length>1&&r(m),typeof c=="string"&&c.length===0&&r(m)},r=c=>{s(B(c)),s(w())},l=()=>{const c=z(t);c.query="",a.current&&(a.current.value=""),s(ie({status:""})),r(c)},x=()=>{s(ce()),s(oa("Add"))};return g.useEffect(()=>{async function c(){await s(sa())}c()},[s]),e.jsxs("div",{className:"md:flex items-center justify-between",children:[e.jsxs("div",{className:"md:flex items-center gap-4",children:[e.jsx(me,{ref:a,onInputChange:n}),e.jsx(Fa,{})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx(H,{size:"sm",className:"me-2",onClick:l,children:"Clear All"}),o&&e.jsx(H,{size:"sm",onClick:x,children:"Add New"})]})]})};je("crmLeads",ha);const Oa=()=>e.jsxs(e.Fragment,{children:[e.jsx(Na,{}),e.jsxs(ye,{bodyClass:"h-full",children:[e.jsx(ka,{}),e.jsx(Sa,{})]})]}),js=Oa;export{js as default};
