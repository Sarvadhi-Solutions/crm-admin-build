import{a as b,r as x,j as e,ar as de}from"./index-f40e4d75.js";import{A as pe}from"./AdaptableCard-37b8494e.js";import{D as ue}from"./DataTable-10580198.js";import{u as h,a as xe,f as ge,b as he,e as fe,s as P,g as $,c as K,d as Ce,h as U,t as Z,i as be,j as V,k as Y,l as ee,r as je}from"./index-fe658d71.js";import{u as te}from"./useThemeClass-faaaa3eb.js";import{B}from"./Button-50d583fa.js";import{D as Ne}from"./Drawer-4f8a2134.js";import{T as ae}from"./index-e9a19be6.js";import{a as j,F as ye}from"./FormItem-e9df506f.js";import{u as we,b as y,F as De,a as ve}from"./formik.esm-a717025a.js";import{c as Se,a as N,b as Te}from"./index.esm-6a659974.js";import{t as k,N as L}from"./toast-a13e90a2.js";import{I as w}from"./Input-a28838c6.js";import{D as Ie,t as Fe,c as Ae}from"./tagAndCategory-9190e9b0.js";/* empty css              */import{A as ke}from"./index.esm-102c4743.js";import{ab as Le,a7 as Q,b as Ee,d as Me}from"./index.esm-0d86f991.js";import{b as H,a as Oe,T as qe}from"./index.esm-d23b2af8.js";import"./Alert-40d5acad.js";import"./index-3d26675f.js";import{B as se}from"./Badge-6fa7c653.js";import"./Calendar-4d5136ed.js";import"./Card-902c739e.js";import"./index-fce80fcb.js";import"./index-a594a10f.js";import"./Dialog-7705a764.js";import"./index-89133a2f.js";import"./toString-1320cce2.js";import"./index-05e52686.js";import"./index-b8391898.js";import"./index-1ec1c1e6.js";import"./Pagination-968bd340.js";import"./Progress-93b8f813.js";import"./index-0b72efdb.js";import"./RangeCalendar-c94320b7.js";import"./ScrollBar-96d4eb77.js";import"./index-e26259ee.js";import{S as oe,c as ze}from"./Select-1c5bed57.js";import"./Skeleton-70df546a.js";import"./index-d5b3e22f.js";import"./Switcher-5c6f9f0a.js";import"./index-a0876546.js";import"./Tag-d736e0a6.js";import"./index-8e701fec.js";import"./index-0051b6ff.js";import"./Tooltip-b58b263b.js";import"./Upload-433277fb.js";import{F as _}from"./FormDesription-a4e44304.js";import{c as R}from"./cloneDeep-599ca6a7.js";import{T as Re}from"./TagsList-50570a10.js";import{u as W}from"./checkEditUpdate-bfc3aaa8.js";import{C as $e}from"./ConfirmDialog-cde3278c.js";import{T as A}from"./TextTruncate-1087102a.js";import{d as Ve}from"./debounce-8b6b031e.js";import"./TableRowSkeleton-bcefa50f.js";import"./index-04a1d3b6.js";import"./CrmService-7c89f71e.js";import"./context-51e9908c.js";import"./index-abc0a377.js";import"./Views-4f4cfc12.js";import"./CloseButton-579d2861.js";import"./useControllableState-a88821e3.js";import"./index-ae89c783.js";import"./useTimeout-e87eb97a.js";import"./StatusIcon-e5b0e9d4.js";import"./chainedFunction-070f832c.js";import"./isNil-867ba5c2.js";import"./get-8208bc30.js";import"./_MapCache-11f94205.js";import"./useMergeRef-788c4cb0.js";import"./_Uint8Array-1aa2dd21.js";import"./_baseIsEqual-6ce30dc4.js";import"./useRootClose-e34f1b82.js";import"./usePopper-65abd083.js";import"./TimeInput-8f1dcb6e.js";import"./useUniqueId-e478c472.js";import"./useDidUpdate-d2d404f7.js";import"./useUncertainRef-8f47aa92.js";import"./slicedToArray-ed1b3644.js";import"./objectWithoutProperties-8e2777d0.js";import"./objectWithoutPropertiesLoose-4f48578a.js";import"./extends-98964cd2.js";import"./toConsumableArray-b6817789.js";import"./floating-ui.dom-bef9cea3.js";import"./mapCloneElement-83eec5b9.js";import"./index.esm-939b12b7.js";import"./index.esm-2a4fc148.js";import"./index.esm-b275af0e.js";import"./_getPrototype-fd20deb2.js";const z=[],Ke=a=>{const{touched:s,errors:t,values:o,setFieldValue:i}=a,n=b(),[m,f]=x.useState(!1),[l,u]=x.useState(!1),[D,C]=x.useState([]),[E,v]=x.useState([]),S=()=>{f(!m),u(!1)},T=h(g=>g.crmContact.data.companyList);z.length=0,T.forEach(g=>{z.push({value:g.id,label:g.companyName})});const[d,r]=x.useState("");x.useEffect(()=>{(async()=>{var I,J;try{const{payload:O}=await n(ge()),q=(I=O==null?void 0:O.data)==null?void 0:I.find(F=>(F==null?void 0:F.moduleName)==="contacts");if(r(q.id),q){const{payload:F}=await n(he({id:(J=q==null?void 0:q.id)==null?void 0:J.toString()})),le=Fe(F.data),me=Ae(F.data);v(me),C(le)}}catch(O){console.error("Error fetching module data:",O)}})(),n(xe())},[n]);const p=h(g=>g.crmContact.data.selectedContact),[M,c]=x.useState(p?p.tags||[]:[]),G=we(),ce=g=>{c(g);const I=[g.value];G.setFieldValue("tagId",I)};return e.jsxs(e.Fragment,{children:[e.jsx(_,{title:"Contact Basic Information",desc:"",className:"mb-2"}),e.jsx(j,{label:"First Name *",invalid:t.firstName&&s.firstName,errorMessage:t.firstName,children:e.jsx(y,{type:"text",autoComplete:"off",name:"firstName",placeholder:"First Name",component:w,prefix:e.jsx(Le,{className:"text-xl"})})}),e.jsx(j,{label:"Last Name *",invalid:t.lastName&&s.lastName,errorMessage:t.lastName,children:e.jsx(y,{type:"text",autoComplete:"off",name:"lastName",placeholder:"Last Name",component:w,prefix:e.jsx(Q,{className:"text-xl"})})}),e.jsx(j,{label:"Title",invalid:t.title&&s.title,errorMessage:t.title,children:e.jsx(y,{type:"text",autoComplete:"off",name:"title",placeholder:"Title",component:w,prefix:e.jsx(Q,{className:"text-xl"})})}),e.jsx(j,{label:"Email *",invalid:t.email&&s.email,errorMessage:t.email,children:e.jsx(y,{type:"text",autoComplete:"off",name:"email",placeholder:"Email",component:w,prefix:e.jsx(H,{className:"text-xl"})})}),e.jsx(j,{label:"Contact Number *",invalid:t.contactNumber&&s.contactNumber,errorMessage:t.contactNumber,children:e.jsx(y,{type:"text",autoComplete:"off",name:"contactNumber",placeholder:"Contact Number",component:w,prefix:e.jsx(ke,{className:"text-xl"})})}),e.jsx(j,{label:"Description",invalid:t.description&&s.description,errorMessage:t.description,children:e.jsx(y,{type:"text",autoComplete:"off",name:"description",placeholder:"Description",component:w,prefix:e.jsx(Oe,{className:"text-xl"})})}),e.jsx(_,{title:"Contact Others Details",desc:"",className:"mb-2"}),e.jsx(j,{label:"Company Name",invalid:t.companiesId&&s.companiesId,errorMessage:t.companiesId,children:e.jsx(oe,{name:"companiesId",placeholder:"Company Name",options:z,id:"companiesId",value:z.find(g=>(g==null?void 0:g.value)==(o==null?void 0:o.companiesId)),onChange:g=>{const I=g.value;i("companiesId",I||"")}})}),e.jsx(j,{label:"Source",invalid:t.source&&s.source,errorMessage:t.source,children:e.jsx(y,{type:"text",autoComplete:"off",name:"source",placeholder:"Source",component:w,prefix:e.jsx(H,{className:"text-xl"})})}),e.jsx(j,{label:"Address",invalid:t.address&&s.address,errorMessage:t.address,children:e.jsx(y,{type:"text",autoComplete:"off",name:"address",placeholder:"Address",component:w,prefix:e.jsx(H,{className:"text-xl"})})}),e.jsx("div",{style:{position:"relative"},children:e.jsx(j,{label:"Tag",children:e.jsxs("div",{style:{position:"relative"},children:[e.jsx(y,{name:"tagId",component:Ie,options:D,placeholder:"Select a Tag",value:G.initialValues.tagName,onChange:ce}),e.jsx(qe,{style:{position:"absolute",right:"10px",top:"10px",border:"none",background:"#FFF"},className:"text-xl",onClick:()=>{S(),u(!0)}})]})})})]})},Be=Se().shape({firstName:N().required("First Name is required"),lastName:N().required("Last Name is required"),title:N(),contactNumber:N().typeError("Contact must be a number").required("Contact is required").test("is-number","Contact must be a number",a=>!isNaN(a)).test("is-ten-digits"," Contact must be exactly 10 digits",a=>{if(a){const s=Number(a);return/^\d{10}$/.test(s.toString())}return!0}).test("is-not-more-than-ten-digits","Contact must not exceed 10 digits",a=>a?Number(a).toString().length<=10:!0),email:N().matches(/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/i,"Invalid email").required("Email is required"),address:N(),companiesId:N().nullable(),companyName:N(),source:N(),description:N(),tagId:Te()});console.log(z,"company optionsssssssss");const{TabNav:He,TabList:Pe,TabContent:Ze}=ae,re=x.forwardRef((a,s)=>{var n,m,f,l;const t=h(u=>u.crmContact.data.selectedContact),o=!!t.id,i=b();return e.jsx(De,{innerRef:s,initialValues:{firstName:(t==null?void 0:t.firstName)||"",lastName:(t==null?void 0:t.lastName)||"",title:(t==null?void 0:t.title)||"",email:(t==null?void 0:t.email)||"",contactNumber:(t==null?void 0:t.contactNumber)||"",description:(t==null?void 0:t.description)||"",companyName:((n=t==null?void 0:t.company)==null?void 0:n.companyName)||"",source:(t==null?void 0:t.source)||"",address:(t==null?void 0:t.address)||"",tagName:((f=(m=t==null?void 0:t.tags)==null?void 0:m[0])==null?void 0:f.tagName)||"",tagId:((l=t==null?void 0:t.tags)==null?void 0:l.map(u=>u.id))||[],companiesId:(t==null?void 0:t.companiesId)||null},validationSchema:Be,onSubmit:async(u,{setSubmitting:D})=>{var S,T,d,r,p,M;const{colorName:C,tagName:E,...v}=u;if(o===!0){const c=await i(fe({contactId:(t==null?void 0:t.id)||"",updatedData:v}));(S=c==null?void 0:c.payload)!=null&&S.success?k.push(e.jsx(L,{title:"Successfully Added",type:"success",duration:2500,children:(T=c==null?void 0:c.payload)==null?void 0:T.message}),{placement:"top-end"}):k.push(e.jsx(L,{title:"Something went wrong !!!",type:"danger",duration:2500,children:(d=c==null?void 0:c.error)==null?void 0:d.message}),{placement:"top-end"}),i(P()),await i($()),await i(K())}else{const c=await i(Ce(v));(r=c==null?void 0:c.payload)!=null&&r.success?k.push(e.jsx(L,{title:"Successfully Added",type:"success",duration:2500,children:(p=c==null?void 0:c.payload)==null?void 0:p.message}),{placement:"top-end"}):k.push(e.jsx(L,{title:"Something went wrong !!!",type:"danger",duration:2500,children:(M=c==null?void 0:c.error)==null?void 0:M.message}),{placement:"top-end"}),i(P()),await i($()),await i(K())}D(!1)},children:({touched:u,errors:D,values:C,setFieldValue:E})=>e.jsx(ve,{children:e.jsx(ye,{children:e.jsxs(ae,{defaultValue:"personalInfo",children:[e.jsx(Pe,{children:e.jsx(He,{value:"personalInfo",children:"Contact Details"})}),e.jsx("div",{className:"p-6",children:e.jsx(Ze,{value:"personalInfo",children:e.jsx(Ke,{touched:u,errors:D,values:C,setFieldValue:E})})})]})})})})});re.displayName="ContactForm";const ne=x.forwardRef((a,s)=>{b();const t=h(i=>i.crmContact.data.selectedContact);h(i=>i.crmContact.data.contactList);const o=async i=>{};return e.jsx(re,{ref:s,contact:t,onFormSubmit:o})});ne.displayName="ContactEditContent";const _e=({onSaveClick:a,onCancel:s})=>e.jsxs("div",{className:"text-right w-full",children:[e.jsx(B,{size:"sm",className:"mr-2",onClick:s,children:"Cancel"}),e.jsx(B,{size:"sm",variant:"solid",onClick:a,children:"Save"})]}),We=()=>{const a=b(),s=h(n=>n.crmContact.data.drawerOpen),t=()=>{a(P()),a(U({}))},o=x.useRef(null),i=()=>{var n,m;console.log("formSubmit function called",(n=o.current)==null?void 0:n.values),(m=o.current)==null||m.submitForm()};return e.jsx(Ne,{isOpen:s,closable:!1,bodyClass:"p-0",footer:e.jsx(_e,{onCancel:t,onSaveClick:i}),onClose:t,onRequestClose:t,children:e.jsx(ne,{ref:o})})},Ue=()=>{const a=b(),s=h(n=>n.crmContact.data.deleteConfirmation),t=h(n=>n.crmContact.data.selectedContact),o=()=>{a(Z(!1))},i=async()=>{var m,f,l;a(Z(!1));const n=await a(be(t==null?void 0:t.id));(m=n==null?void 0:n.payload)!=null&&m.success?k.push(e.jsx(L,{title:"Successfuly Deleted",type:"success",duration:2500,children:(f=n==null?void 0:n.payload)==null?void 0:f.message}),{placement:"top-end"}):k.push(e.jsx(L,{title:"Something Went Wrong !!!",type:"danger",duration:2500,children:(l=n==null?void 0:n.error)==null?void 0:l.message}),{placement:"top-end"}),await a($()),await a(K())};return e.jsx($e,{isOpen:s,type:"danger",title:"Delete Contact",confirmButtonColor:"red-600",onClose:o,onRequestClose:o,onCancel:o,onConfirm:i,children:e.jsx("p",{children:"Are you sure you want to delete this Contact? All record related to this contact will be deleted as well. This action cannot be undone."})})},Ge=({row:a})=>{const{textTheme:s}=te(),t=b(),o=()=>{t(Y()),t(U(a))};return e.jsx("div",{className:`${s} cursor-pointer select-none font-semibold`,onClick:o,children:"Edit"})},Je=({row:a})=>{const{textTheme:s}=te(),t=b(),o=async()=>{t(U(a)),t(Z(!0))};return e.jsx("div",{className:`${s} cursor-pointer select-none font-semibold text-red-500`,onClick:o,children:"Delete"})},Qe=()=>{const a=b(),s=h(d=>d.crmContact.data.displayedContactList),t=W("contacts","canModify"),o=W("contacts","canDelete"),i=h(d=>d.crmContact.data.loading),{pageIndex:n,pageSize:m,sort:f,query:l,total:u}=h(d=>d.crmContact.data.tableData),D=x.useCallback(()=>{a($())},[a]);x.useEffect(()=>{D()},[D]);const C=x.useMemo(()=>({pageIndex:n,pageSize:m,sort:f,query:l,total:u}),[n,m,f,l,u]),E=x.useMemo(()=>{const d=[{header:"Name",accessorKey:"firstName",cell:r=>{const{firstName:p,lastName:M}=r.row.original,c=`${p} ${M}`;return e.jsx(A,{text:c,maxLength:100})}},{header:"email",accessorKey:"email",cell:r=>r.row.original.email},{header:"Number",accessorKey:"contactNumber",cell:r=>r.row.original.contactNumber},{header:"source",accessorKey:"source",cell:r=>{const p=r.row.original.source;return e.jsx(A,{text:p,maxLength:15})}},{header:"Tags",accessorKey:"tagName",cell:r=>{const p=r.row.original.tags||[];return e.jsx(Re,{tags:p})}},{header:"Title",accessorKey:"title",cell:r=>{const p=r.row.original.title;return e.jsx(A,{text:p,maxLength:20})}},{header:"Company",accessorKey:"companyName",cell:r=>{const p=r.row.original.company?r.row.original.company.companyName:"";return e.jsx(A,{text:p,maxLength:25})}},{header:"address",accessorKey:"address",cell:r=>{const p=r.row.original.address;return e.jsx(A,{text:p,maxLength:20})}},{header:"description",accessorKey:"description",cell:r=>{const p=r.row.original.description;return e.jsx(A,{text:p,maxLength:20})}}];return o&&d.unshift({header:"Delete",id:"action",cell:r=>e.jsx(Je,{row:r.row.original})}),t&&d.unshift({header:"Edit",id:"action",cell:r=>e.jsx(Ge,{row:r.row.original})}),d},[t,o]),v=d=>{const r=R(C);r.pageIndex=d,a(V(r))},S=d=>{const r=R(C);r.pageSize=Number(d),r.pageIndex=1,a(V(r))},T=d=>{const r=R(C);r.sort=d,a(V(r))};return e.jsxs("div",{children:[e.jsx(ue,{columns:E,data:s,loading:i,pagingData:{total:C.total,pageIndex:C.pageIndex,pageSize:C.pageSize},onPaginationChange:v,onSelectChange:S,onSort:T}),e.jsx(We,{}),e.jsx(Ue,{})]})},ie=x.forwardRef((a,s)=>{const{onInputChange:t}=a,o=Ve(i,500);function i(m){t==null||t(m)}const n=m=>{o(m.target.value)};return e.jsx(w,{ref:s,className:"max-w-md md:w-52 mb-4",size:"sm",placeholder:"Search",prefix:e.jsx(Ee,{className:"text-lg"}),onChange:n})});ie.displayName="ContactTableSearch";const{Control:Xe}=ze,X=[{value:"",label:"All",color:"bg-gray-500"},{value:"active",label:"Active",color:"bg-emerald-500"},{value:"blocked",label:"Blocked",color:"bg-red-500"}],Ye=({innerProps:a,label:s,data:t,isSelected:o})=>e.jsxs("div",{className:`flex items-center justify-between p-2 cursor-pointer ${o?"bg-gray-100 dark:bg-gray-500":"hover:bg-gray-50 dark:hover:bg-gray-600"}`,...a,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{innerClass:t.color}),e.jsx("span",{children:s})]}),o&&e.jsx(Me,{className:"text-emerald-500 text-xl"})]}),et=({children:a,...s})=>{const t=s.getValue()[0];return e.jsxs(Xe,{...s,children:[t&&e.jsx(se,{className:"ltr:ml-4 rtl:mr-4",innerClass:t.color}),a]})},tt=()=>{const a=b(),{status:s}=h(o=>o.crmContact.data.filterData),t=o=>{a(ee({status:o==null?void 0:o.value}))};return e.jsx(oe,{options:X,size:"sm",className:"mb-4 min-w-[130px]",components:{Option:Ye,Control:et},value:X.filter(o=>o.value===s),onChange:t})},at=()=>{const a=b(),s=x.useRef(null),t=h(l=>l.crmContact.data.tableData),o=W("contacts","canCreate"),i=l=>{const u=R(t);u.query=l,u.pageIndex=1,typeof l=="string"&&l.length>1&&n(u),typeof l=="string"&&l.length===0&&n(u)},n=l=>{a(V(l)),a($())},m=()=>{const l=R(t);l.query="",s.current&&(s.current.value=""),a(ee({status:""})),n(l)},f=()=>{a(Y())};return e.jsxs("div",{className:"md:flex items-center justify-between",children:[e.jsxs("div",{className:"md:flex items-center gap-4",children:[e.jsx(ie,{ref:s,onInputChange:i}),e.jsx(tt,{})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx(B,{size:"sm",className:"me-2",onClick:m,children:"Clear All"}),o&&e.jsx(B,{size:"sm",onClick:f,children:"Add New"})]})]})},st=()=>{const a=b();return h(s=>s.crmContact.data.statisticData),h(s=>s.crmContact.data.statisticLoading),x.useEffect(()=>{a(K())},[]),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4 mb-6"})};de("crmContact",je);const ot=()=>{const a=h(s=>s.crmContact.data.tableData);return e.jsxs(e.Fragment,{children:[e.jsx(st,{}),e.jsxs(pe,{bodyClass:"h-full",children:[e.jsx(_,{title:`Contacts (${a==null?void 0:a.total})`,desc:"",className:"mb-2"}),e.jsx(at,{}),e.jsx(Qe,{})]})]})},Va=ot;export{Va as default};
