import{am as L,an as fe,ao as he,ap as xe,a as C,j as s,r as g,ar as Le}from"./index-b09faefa.js";import{A as Ce}from"./AdaptableCard-9a87f3ff.js";import{D as ye}from"./DataTable-ca158282.js";import{S as De}from"./StatusCapsule-42d6c5a6.js";import{T as we}from"./TagsList-a530de63.js";import{T as K}from"./TextTruncate-222d0204.js";import{u as H}from"./checkEditUpdate-cffc7ae3.js";import{u as ee}from"./useThemeClass-ee0e86a7.js";import{c as R}from"./cloneDeep-de9ec659.js";import{d as je,e as be,f as Se,g as ve,h as Ne,i as Te,j as Ie,k as te,l as Fe}from"./CrmService-5f2f53bd.js";import{t as T,N as I}from"./toast-2c9f9fcf.js";import{C as ke}from"./ConfirmDialog-1096cdd6.js";import{B as G}from"./Button-3bdf4581.js";import{D as Ae}from"./Drawer-1ea16c4a.js";import{a as O,F as Ee}from"./FormItem-cdcc11d5.js";import{T as ae}from"./index-addd5e63.js";import{u as Oe,b as V,F as Re,a as qe}from"./formik.esm-93e44345.js";import{c as ze,a as $,b as Me}from"./index.esm-333232d6.js";import{I as P}from"./Input-8c731b0c.js";import{a6 as Ve,a7 as X,b as $e,d as Be}from"./index.esm-2c67faf2.js";import{D as Y,t as Ge,c as Ke}from"./tagAndCategory-2dd74600.js";/* empty css              */import{A as He}from"./AdditionalTag-ee3a6411.js";import{T as Pe}from"./index.esm-aece8080.js";import"./Alert-a515d81f.js";import"./index-2f1f758f.js";import{B as se}from"./Badge-d1515062.js";import"./Calendar-6959847d.js";import"./Card-33431fc8.js";import"./index-c173cf47.js";import"./index-82bb2b50.js";import"./Dialog-a2bd00be.js";import"./index-96409d01.js";import"./toString-9cef9a7f.js";import"./index-c886a512.js";import"./index-056a1440.js";import"./index-ae319e32.js";import"./Pagination-d71ebe95.js";import"./Progress-a1e68dcb.js";import"./index-bc0f434c.js";import"./RangeCalendar-b4e9e88f.js";import"./ScrollBar-a256ec53.js";import"./index-d106a35e.js";import{S as oe,c as Ue}from"./Select-71db8857.js";import"./Skeleton-5bf82d8e.js";import"./index-975733af.js";import"./Switcher-e643b9c6.js";import"./index-a157bc37.js";import"./Tag-0d544e3b.js";import"./index-ba770d43.js";import"./index-dd0b5a15.js";import"./Tooltip-5b8c5fcd.js";import"./Upload-8f332031.js";import{d as _e}from"./debounce-24a9e0ff.js";import{g as We}from"./index-4cb8bca5.js";import{s as Je}from"./index-1b819069.js";import{F as Qe}from"./FormDesription-3c84f725.js";import"./TableRowSkeleton-a83d3c9d.js";import"./index-e08096fb.js";import"./_Uint8Array-b1a93c95.js";import"./_MapCache-a97510fd.js";import"./Views-57e82c67.js";import"./_getPrototype-3540f1e6.js";import"./useTimeout-68d097ea.js";import"./CloseButton-13cd4a8c.js";import"./StatusIcon-b02f9bab.js";import"./chainedFunction-070f832c.js";import"./context-80e77f1b.js";import"./index-8c214619.js";import"./index-62df96f3.js";import"./useControllableState-5d01e6b9.js";import"./isNil-f81aee01.js";import"./get-263a9377.js";import"./useMergeRef-788c4cb0.js";import"./_baseIsEqual-77ddc906.js";import"./useRootClose-3c97a09c.js";import"./usePopper-29fe3cd5.js";import"./TimeInput-23ce06d7.js";import"./useUniqueId-6d806f5c.js";import"./useDidUpdate-ec3bfb81.js";import"./useUncertainRef-b762bd82.js";import"./slicedToArray-00fbfd7c.js";import"./objectWithoutProperties-8e2777d0.js";import"./objectWithoutPropertiesLoose-4f48578a.js";import"./extends-98964cd2.js";import"./toConsumableArray-f69b773e.js";import"./floating-ui.dom-bef9cea3.js";import"./mapCloneElement-ef910f8e.js";import"./index.esm-dbc068f5.js";import"./index.esm-7a963ea9.js";import"./index.esm-a78f5b32.js";import"./index-36def105.js";import"./index-d9c074cd.js";const Xe="crmLeads",q=L("crmLeads/data/getLeadsStatistic",async()=>(await je()).data),w=L("crmLeads/data/getLeads",async()=>(await be()).data),U=L("crmContact/data/getContact",async()=>(await Se()).data),Ye=L("crmLeads/data/editLeads",async({leadsId:t,updatedData:a})=>{var e,o;try{return(await ve(t,a)).data}catch(n){throw new Error((o=(e=n==null?void 0:n.response)==null?void 0:e.data)==null?void 0:o.message)}}),Ze=L("crmLeads/data/deleteLeads",async t=>{var a,e;try{return await Ne(t)}catch(o){throw new Error((e=(a=o==null?void 0:o.response)==null?void 0:a.data)==null?void 0:e.message)}}),et=L("crmLeads/data/createLeads",async t=>{var a,e;try{return(await Te(t)).data}catch(o){throw new Error((e=(a=o==null?void 0:o.response)==null?void 0:a.data)==null?void 0:e.message)}}),tt=L("crmLeads/data/module",async()=>(await Ie()).data),at=L("tag-category",async({id:t})=>(await te(t)).data);L("crmLeads/data/fetchTag",async({id:t})=>(await te(t)).data);L("crmLeads/data/createTag",async({masterId:t,colorName:a,tagName:e,tagCategoryId:o})=>(await Fe({colorName:a,tagName:e,masterId:t,tagCategoryId:o})).data);const st={total:0,pageIndex:1,pageSize:10,query:"",sort:{order:"",key:""}},ot={status:""},rt={loading:!1,statisticLoading:!1,leadsList:[],displayedLeadsList:[],statisticData:{},tableData:st,filterData:ot,drawerOpen:!1,selectedLeads:{},contactList:[],deleteConfirmation:!1},re=fe({name:`${Xe}/state`,initialState:rt,reducers:{setTableData:(t,a)=>{t.tableData=a.payload;const e=t.leadsList.filter(o=>o.contactData.firstName.toLowerCase().includes(a.payload.query.toLowerCase())||o.contactData.lastName.toLowerCase().includes(a.payload.query.toLowerCase()));t.displayedLeadsList=e.slice(a.payload.pageSize*(a.payload.pageIndex-1),a.payload.pageSize*a.payload.pageIndex)},setLeadsList:(t,a)=>{t.leadsList=a.payload},setFilterData:(t,a)=>{t.filterData=a.payload},setSelectedLeads:(t,a)=>{t.selectedLeads=a.payload},setDrawerOpen:t=>{t.drawerOpen=!0},setDrawerClose:t=>{t.drawerOpen=!1},toggleDeleteConfirmation:(t,a)=>{t.deleteConfirmation=a.payload}},extraReducers:t=>{t.addCase(w.fulfilled,(a,e)=>{var o;a.leadsList=e.payload.data,a.tableData.total=(o=e.payload.data)==null?void 0:o.length,a.displayedLeadsList=e.payload.data.slice(0,10),a.loading=!1}).addCase(w.pending,a=>{a.loading=!0}).addCase(q.fulfilled,(a,e)=>{a.statisticData=e.payload,a.statisticLoading=!1}).addCase(q.pending,a=>{a.statisticLoading=!0}).addCase(U.fulfilled,(a,e)=>{a.contactList=e.payload.data,a.loading=!1}).addCase(U.pending,a=>{a.loading=!0})}}),{setTableData:B,setLeadsList:ds,setFilterData:ne,setSelectedLeads:J,setDrawerOpen:ie,setDrawerClose:_,toggleDeleteConfirmation:W}=re.actions,nt=re.reducer,it=he({data:nt}),h=xe,ct=()=>{const t=C(),a=h(r=>r.crmLeads.data.deleteConfirmation),e=h(r=>r.crmLeads.data.selectedLeads),o=()=>{t(W(!1))},n=async()=>{var u,x,c;t(W(!1));const r=await t(Ze(e.id));await t(w()),(u=r==null?void 0:r.payload)!=null&&u.success?T.push(s.jsx(I,{title:"Successfuly Deleted",type:"success",duration:2500,children:(x=r==null?void 0:r.payload)==null?void 0:x.message}),{placement:"top-end"}):T.push(s.jsx(I,{title:"Something Went Wrong !!!",type:"danger",duration:2500,children:(c=r==null?void 0:r.error)==null?void 0:c.message}),{placement:"top-end"}),await t(w()),await t(q())};return s.jsx(ke,{isOpen:a,type:"danger",title:"Delete Lead",confirmButtonColor:"red-600",onClose:o,onRequestClose:o,onCancel:o,onConfirm:n,children:s.jsx("p",{children:"Are you sure you want to delete this Lead? All record related to this lead will be deleted as well. This action cannot be undone."})})},F=[],lt=t=>{const{touched:a,errors:e,setFieldValue:o,values:n}=t,r=C(),u=Oe(),[x,c]=g.useState(!1),[d,y]=g.useState(!1),[j,b]=g.useState([]),[z,S]=g.useState([]),v=()=>{c(!x),y(!1)},m=["active","deactive"],i=h(l=>l.crmLeads.data.contactList);F.length=0,i.forEach(l=>{F.push({value:l==null?void 0:l.id,label:l==null?void 0:l.name})});const[f,M]=g.useState("");g.useEffect(()=>{(async()=>{var D,Q;try{const{payload:A}=await r(tt()),E=(D=A==null?void 0:A.data)==null?void 0:D.find(N=>(N==null?void 0:N.moduleName)==="leads");if(M(E.id),E){const{payload:N}=await r(at({id:(Q=E==null?void 0:E.id)==null?void 0:Q.toString()})),ue=Ge(N.data),ge=Ke(N.data);S(ge),b(ue)}}catch(A){console.error("Error fetching module data:",A)}})(),r(U())},[r]);const k=h(l=>l.crmLeads.data.selectedLeads),[p,me]=g.useState(k?k.tags||[]:[]),pe=l=>{me(l);const D=[l.value];u.setFieldValue("tagId",D)};return s.jsxs(s.Fragment,{children:[s.jsx(O,{label:"Contact Name",invalid:e.contactsDataId&&a.contactsDataId,errorMessage:e.contactsDataId,children:s.jsx(oe,{name:"contactsDataId",placeholder:"Contact Name",options:F,id:"contactsDataId",onChange:l=>{const D=l.value;o("contactsDataId",D)},value:F.find(l=>(l==null?void 0:l.value)===(n==null?void 0:n.contactsDataId))})}),s.jsx(O,{label:"Details",invalid:e.details&&a.details,errorMessage:e.details,children:s.jsx(V,{type:"text",autoComplete:"off",name:"details",placeholder:"Details",component:P,prefix:s.jsx(Ve,{className:"text-xl"})})}),s.jsx(O,{label:"Status",invalid:e.status&&a.status,errorMessage:e.status,children:s.jsx(V,{type:"text",autoComplete:"off",name:"status",placeholder:"Status",component:Y,options:m,id:"status",value:u.initialValues.status,prefix:s.jsx(X,{className:"text-xl"}),onChange:l=>{const D=l.value;u.setFieldValue("status",D)}})}),s.jsx(O,{label:"Notes",invalid:e.notes&&a.notes,errorMessage:e.notes,children:s.jsx(V,{type:"text",autoComplete:"off",name:"notes",placeholder:"Notes",component:P,prefix:s.jsx(X,{className:"text-xl"})})}),s.jsxs("div",{style:{position:"relative"},children:[s.jsx(O,{label:"Tag",children:s.jsxs("div",{style:{position:"relative"},children:[s.jsx(V,{name:"Tag",component:Y,value:u.initialValues.tagName,options:j,placeholder:"Select a Tag",onChange:pe}),s.jsx(Pe,{style:{position:"absolute",right:"10px",top:"10px",border:"none",background:"#FFF"},className:"text-xl",onClick:()=>{v(),y(!0)}})]})}),s.jsx(He,{isOpen:x,categoryList:z,moduleName:f,onOpenChange:l=>c(l)})]})]})},dt=ze().shape({details:$().required("Details are required"),status:$().required("Status is required"),notes:$(),tagId:Me(),contactsDataId:$().required("This field is required").test("is-valid-contact","Invalid contact selected",t=>!!F.find(a=>a.value===t))});console.log(F,"contactOptions");const{TabNav:mt,TabList:pt,TabContent:ut}=ae,ce=g.forwardRef((t,a)=>{var r,u,x,c;const e=h(d=>d.crmLeads.data.selectedLeads),o=!!e.id,n=C();return s.jsx(Re,{innerRef:a,initialValues:{contactsDataId:e.contactsDataId||null,details:(e==null?void 0:e.details)||"",status:(e==null?void 0:e.status)||"",notes:(e==null?void 0:e.notes)||"",tagName:((u=(r=e==null?void 0:e.tags)==null?void 0:r[0])==null?void 0:u.tagName)||"",name:((x=e==null?void 0:e.contactData)==null?void 0:x.name)||"",tagId:((c=e==null?void 0:e.tags)==null?void 0:c.map(d=>d.id))||[]},validationSchema:dt,onSubmit:async(d,{setSubmitting:y})=>{var v,m,i,f,M,k;const{colorName:j,name:b,tagName:z,...S}=d;if(o===!0){const p=await n(Ye({leadsId:(e==null?void 0:e.id)||"",updatedData:S}));(v=p==null?void 0:p.payload)!=null&&v.success?T.push(s.jsx(I,{title:"Successfully Update",type:"success",duration:2500,children:(m=p==null?void 0:p.payload)==null?void 0:m.message}),{placement:"top-end"}):T.push(s.jsx(I,{title:"Something went wrong !!!",type:"danger",duration:2500,children:(i=p==null?void 0:p.error)==null?void 0:i.message}),{placement:"top-end"}),n(_()),await n(w()),await n(q())}else{const p=await n(et(S));(f=p==null?void 0:p.payload)!=null&&f.success?T.push(s.jsx(I,{title:"Successfully Added",type:"success",duration:2500,children:(M=p==null?void 0:p.payload)==null?void 0:M.message}),{placement:"top-end"}):T.push(s.jsx(I,{title:"Something went wrong !!!",type:"danger",duration:2500,children:(k=p==null?void 0:p.error)==null?void 0:k.message}),{placement:"top-end"}),n(_()),await n(w()),await n(q())}y(!1)},children:({touched:d,errors:y,values:j,setFieldValue:b})=>s.jsx(qe,{children:s.jsx(Ee,{children:s.jsxs(ae,{defaultValue:"leadsInfo",children:[s.jsx(pt,{children:s.jsx(mt,{value:"leadsInfo",children:"Leads Detail"})}),s.jsx("div",{className:"p-6",children:s.jsx(ut,{value:"leadsInfo",children:s.jsx(lt,{touched:d,errors:y,setFieldValue:b,values:j})})})]})})})})});ce.displayName="LeadsForm";const le=g.forwardRef((t,a)=>{C();const e=h(n=>n.crmLeads.data.selectedLeads);h(n=>n.crmLeads.data.leadsList);const o=async n=>{};return s.jsx(ce,{ref:a,leads:e,onFormSubmit:o})});le.displayName="LeadsEditContent";const gt=({onSaveClick:t,onCancel:a})=>s.jsxs("div",{className:"text-right w-full",children:[s.jsx(G,{size:"sm",className:"mr-2",onClick:a,children:"Cancel"}),s.jsx(G,{size:"sm",variant:"solid",onClick:t,children:"Save"})]}),ft=()=>{const t=C(),a=h(r=>r.crmLeads.data.drawerOpen),e=()=>{t(_()),t(J({}))},o=g.useRef(null),n=()=>{var r;(r=o.current)==null||r.submitForm()};return s.jsx(Ae,{isOpen:a,closable:!1,bodyClass:"p-0",footer:s.jsx(gt,{onCancel:e,onSaveClick:n}),onClose:e,onRequestClose:e,children:s.jsx(le,{ref:o})})},ht=({row:t})=>{const{textTheme:a}=ee(),e=C(),o=()=>{e(ie()),e(J(t))};return s.jsx("div",{className:`${a} cursor-pointer select-none font-semibold`,onClick:o,children:"Edit"})},xt=({row:t})=>{const{textTheme:a}=ee(),e=C(),o=async()=>{await e(J(t)),e(W(!0))};return s.jsx("div",{children:s.jsx("div",{className:`${a} cursor-pointer select-none font-semibold text-red-500`,onClick:o,children:"Delete"})})},Lt=()=>{const t=C(),a=h(m=>m.crmLeads.data.displayedLeadsList),e=h(m=>m.crmLeads.data.loading),{pageIndex:o,pageSize:n,sort:r,query:u,total:x}=h(m=>m.crmLeads.data.tableData),c=g.useCallback(()=>{t(w())},[t]);g.useEffect(()=>{c()},[c]);const d=g.useMemo(()=>({pageIndex:o,pageSize:n,sort:r,query:u,total:x}),[o,n,r,u,x]),y=H("Leads","canDelete"),j=H("Leads","canModify"),b=g.useMemo(()=>{const m=[{header:"Details",accessorKey:"details",cell:i=>{const f=i.row.original.details;return s.jsx(K,{text:f,maxLength:20})}},{header:"Contact Name",accessorKey:"contactName",cell:i=>{const f=i.row.original.contactData.firstName+" "+i.row.original.contactData.lastName;return s.jsx(K,{text:f,maxLength:20})}},{header:"Status",accessorKey:"status",cell:i=>{const f=i.row.original;return s.jsx(De,{status:f.status})}},{header:"Tag Name",accessorKey:"tagName",cell:i=>{const f=i.row.original.tags||[];return s.jsx(we,{tags:f})}},{header:"Notes",accessorKey:"notes",cell:i=>{const f=i.row.original.notes;return s.jsx(K,{text:f,maxLength:20})}}];return y&&m.unshift({header:"Delete",id:"action",cell:i=>s.jsx(xt,{row:i.row.original})}),j&&m.unshift({header:"Edit",id:"action",cell:i=>s.jsx(ht,{row:i.row.original})}),m},[j,y]),z=m=>{const i=R(d);i.pageIndex=m,t(B(i))},S=m=>{const i=R(d);i.pageSize=Number(m),i.pageIndex=1,t(B(i))},v=m=>{const i=R(d);i.sort=m,t(B(i))};return s.jsxs("div",{children:[s.jsx(ye,{columns:b,data:a,skeletonAvatarColumns:[0],skeletonAvatarProps:{width:28,height:28},loading:e,pagingData:{total:d.total,pageIndex:d.pageIndex,pageSize:d.pageSize},onPaginationChange:z,onSelectChange:S,onSort:v}),s.jsx(ft,{}),s.jsx(ct,{})]})},de=g.forwardRef((t,a)=>{const{onInputChange:e}=t,o=_e(n,500);function n(u){e==null||e(u)}const r=u=>{o(u.target.value)};return s.jsx(P,{ref:a,className:"max-w-md md:w-52 mb-4",size:"sm",placeholder:"Search",prefix:s.jsx($e,{className:"text-lg"}),onChange:r})});de.displayName="LeadsTableSearch";const{Control:Ct}=Ue,Z=[{value:"",label:"All",color:"bg-gray-500"},{value:"active",label:"Active",color:"bg-emerald-500"},{value:"blocked",label:"Blocked",color:"bg-red-500"}],yt=({innerProps:t,label:a,data:e,isSelected:o})=>s.jsxs("div",{className:`flex items-center justify-between p-2 cursor-pointer ${o?"bg-gray-100 dark:bg-gray-500":"hover:bg-gray-50 dark:hover:bg-gray-600"}`,...t,children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(se,{innerClass:e.color}),s.jsx("span",{children:a})]}),o&&s.jsx(Be,{className:"text-emerald-500 text-xl"})]}),Dt=({children:t,...a})=>{const e=a.getValue()[0];return s.jsxs(Ct,{...a,children:[e&&s.jsx(se,{className:"ltr:ml-4 rtl:mr-4",innerClass:e.color}),t]})},wt=()=>{const t=C(),{status:a}=h(o=>o.crmLeads.data.filterData),e=o=>{t(ne({status:o==null?void 0:o.value}))};return s.jsx(oe,{options:Z,size:"sm",className:"mb-4 min-w-[130px]",components:{Option:yt,Control:Dt},value:Z.filter(o=>o.value===a),onChange:e})},jt=()=>{const t=C(),a=g.useRef(null),e=h(c=>c.crmLeads.data.tableData),o=H("leads","canCreate"),n=c=>{const d=R(e);d.query=c,d.pageIndex=1,typeof c=="string"&&c.length>1&&r(d),typeof c=="string"&&c.length===0&&r(d)},r=c=>{t(c?B(c):w())},u=()=>{const c=R(e);c.query="",a.current&&(a.current.value=""),t(ne({status:""})),r(c)},x=()=>{t(ie()),t(Je("Add"))};return g.useEffect(()=>{async function c(){await t(We())}c()},[t]),s.jsxs("div",{className:"md:flex items-center justify-between",children:[s.jsxs("div",{className:"md:flex items-center gap-4",children:[s.jsx(de,{ref:a,onInputChange:n}),s.jsx(wt,{})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx(G,{size:"sm",className:"me-2",onClick:u,children:"Clear All"}),o&&s.jsx(G,{size:"sm",onClick:x,children:"Add New"})]})]})};Le("crmLeads",it);const bt=()=>{const t=h(a=>a.crmLeads.data.tableData);return console.log(t.total),s.jsx(s.Fragment,{children:s.jsxs(Ce,{bodyClass:"h-full",children:[s.jsx(Qe,{title:`Leads (${t==null?void 0:t.total})`,desc:"",className:"mb-2"}),s.jsx(jt,{}),s.jsx(Lt,{})]})})},ms=bt;export{ms as default};
