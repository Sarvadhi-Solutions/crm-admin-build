import{r as y,a as S,j as e,ah as ge,aq as ue}from"./index-01836369.js";import{u as Q}from"./useThemeClass-ce525309.js";import"./Card-2dc07d7d.js";import"./Views-e7196e20.js";import{B as pe}from"./Badge-a322da11.js";import"./chart.constant-d16ea559.js";import"./GrowShrinkTag-c64d92ad.js";import{aa as he,ab as xe,ac as je,O as Ce,P as X}from"./index.esm-64f3e5ec.js";import"./index-a2edb971.js";import{B as E}from"./Button-a46452f7.js";import{D as Z}from"./Dialog-4fd81af0.js";import{T as fe}from"./DataTable-a7013519.js";import{I as K}from"./Input-de9bab6e.js";import"./Skeleton-743f8ad2.js";import"./react-tooltip.min-9096483d.js";import"./RichTextEditor-6ee29ff1.js";import"./SegmentItemOption-a5df08eb.js";import"./SvgIcon-fb1c74f5.js";import"./Tooltip-2ee5bf6e.js";import{T as $}from"./index-9a90023d.js";import{u as ee,f as R,g as ae,e as ye,d as Te}from"./index-cf0b9425.js";import"./Alert-d402928e.js";import"./RangeCalendar-90d0a69e.js";import"./index-d8fc78ac.js";import"./index-61590567.js";import"./Drawer-b1603852.js";import{a as be}from"./index-3b5b12e0.js";import{F as te,a as k}from"./FormItem-8bd92bc5.js";import"./toString-dfdb4974.js";import"./index-d1a1662d.js";import"./index-035dac1c.js";import"./index-0ef1a83d.js";import{t as w,N as F}from"./toast-923c10a7.js";import{P as Ne}from"./Pagination-c8e6fde5.js";import"./Progress-5c62251c.js";import"./index-4a72f1ca.js";import"./ScrollBar-cc8c4864.js";import"./index-5c080796.js";import{S as se}from"./Select-c320d599.js";import"./index-d83ef631.js";import"./Switcher-3a0c2c62.js";import"./index-bf1aff49.js";import"./Tag-b2e6ee28.js";import"./index-c396e082.js";import"./index-9bafd396.js";import"./Upload-f2b9b624.js";import{F as oe,a as re,b as B,c as Se,g as V}from"./formik.esm-0b8089c1.js";import{c as H,a as v,e as we}from"./index.esm-e4a4a14e.js";import{u as b,e as ie,t as W,g as M,T as Fe,a as O,d as De,m as I,c as ve,b as A,f as Ie,s as L,h as U,i as _,j as P,k as Me,l as ke,r as Ee}from"./TagCategoryDetailsForm-0451c5d1.js";import{C as ne}from"./ConfirmDialog-bbf84914.js";import{c as Y}from"./cloneDeep-2911bc06.js";import{u as Re}from"./checkEditUpdate-a0ee37f3.js";const Ae=H().shape({categoryName:v().required("Field is required")}),le=y.forwardRef((r,m)=>{var g;const l=S(),n=b(a=>a.crmTagCategories.data.formToggle),f=()=>{l(W(!1))},t=b(a=>a.crmTagCategories.data.selectedTagCategory);return e.jsx(Z,{isOpen:n,onClose:f,children:e.jsx(oe,{innerRef:m,initialValues:{categoryName:(t==null?void 0:t.categoryName)||"",master:((g=t==null?void 0:t.master)==null?void 0:g.id)||"",tags:(t==null?void 0:t.tags)||[]},validationSchema:Ae,onSubmit:async(a,{setSubmitting:s})=>{var j,N,h,T;s(!1);const c={...a,masterId:a==null?void 0:a.master,tagId:((j=a==null?void 0:a.tags)==null?void 0:j.map(C=>C==null?void 0:C.id))||[]};delete c.master,delete c.tags;const d=await l(ie({tagCategoryId:(t==null?void 0:t.id)||"",updatedData:c}));let p="",i="",x="";(N=d==null?void 0:d.payload)!=null&&N.success?(p="Successfully Update",i=(h=d==null?void 0:d.payload)==null?void 0:h.message,x="success"):(p="Something went wrong !!!",i=(T=d==null?void 0:d.error)==null?void 0:T.message,x="danger"),w.push(e.jsx(F,{title:p,type:x,duration:2500,children:i}),{placement:"top-end"}),l(W(!1)),await l(M())},children:({touched:a,errors:s,values:c,setFieldValue:d})=>e.jsx(re,{children:e.jsx(te,{children:e.jsx(Fe,{touched:a,errors:s,values:c,setFieldValue:d})})})})})});le.displayName="TagCategoryForm";const $e=()=>{const r=S(),m=b(t=>t.crmTagCategories.data.deleteConfirmation),l=b(t=>t.crmTagCategories.data.selectedTagCategory),n=()=>{r(O(!1))},f=async()=>{var g,a,s;r(O(!1));const t=await r(De(l.id));(g=t==null?void 0:t.payload)!=null&&g.success?w.push(e.jsx(F,{title:"Successfuly Deleted",type:"success",duration:2500,children:(a=t==null?void 0:t.payload)==null?void 0:a.message}),{placement:"top-end"}):w.push(e.jsx(F,{title:"Something Went Wrong !!!",type:"danger",duration:2500,children:(s=t==null?void 0:t.error)==null?void 0:s.message}),{placement:"top-end"}),await r(M())};return e.jsx(ne,{isOpen:m,type:"danger",title:"Delete Tag Category",confirmButtonColor:"red-600",onClose:n,onRequestClose:n,onCancel:n,onConfirm:f,children:e.jsx("p",{children:"Are you sure you want to delete this Tag Category? All record related to this tag category will be deleted as well. This action cannot be undone."})})},Be=({field:r})=>{const m=["#FF5733","#33FF57","#5733FF","#FFFF33","#33FFFF","#FF33FF","#FF3366","#FF6666","#6699FF"],l="#FF5733",[n,f]=y.useState(r.value||l),[t,g]=y.useState(!1),a=()=>{g(!t)},s=c=>{const d={target:{name:r.name,value:c}};r.onChange(d),f(c),g(!1)};return e.jsxs("div",{style:{position:"relative",display:"inline-block",top:"9px"},children:[e.jsx("div",{style:{width:"30px",height:"30px",backgroundColor:n,border:"1px solid #000",borderRadius:"50%"},onClick:a}),t&&e.jsx("div",{className:"absolute",children:e.jsx(be,{className:"grid grid-cols-3 gap-1 hover mt-1 custom-scrollbar",children:m.map((c,d)=>e.jsx("div",{style:{width:"30px",height:"30px",backgroundColor:c,margin:"5px",cursor:"pointer",borderRadius:"50%",transition:"background 0.3s ease",border:n===c?"1px solid #000":"none"},onClick:()=>s(c)},d))})})]})};const qe=H({categoryName:v().required("Category Name is required"),masterId:v().required("This field is required").test("is-valid-module","Invalid module selected",r=>!!I.find(m=>m.value==r)),tags:we().of(H().shape({tagName:v().required("Name required"),colorName:v().required("Color required")}))}),G=(r,m)=>{const l=V(r.errors,m),n=V(r.touched,m);return{errorMessage:l||"",invalid:typeof n>"u"?!1:l&&n}},He=()=>{const r=S(),[m,l]=y.useState([]),n=b(a=>a.crmTagCategories.data.selectedTagCategory);y.useEffect(()=>{(async()=>{var c;const s=await r(Ie());l((c=s==null?void 0:s.payload)==null?void 0:c.data)})()},[r]),I.length=0,m==null||m.forEach(a=>{I.push({value:a.id,label:a.moduleName})});const f=b(a=>a.crmTagCategories.data.addForm),t=b(a=>a.crmTagCategories.data.dialogMode),g=()=>{r(A(!1))};return e.jsx("div",{children:e.jsx(Z,{isOpen:f,onClose:g,children:e.jsx(oe,{validationSchema:qe,initialValues:{tags:t==="Edit"?((n==null?void 0:n.tags)||[]).map(a=>({tagName:a.tagName,colorName:a.colorName,tagId:a.id})):[{tagName:"",colorName:"",tagId:""}],categoryName:t==="Edit"?n==null?void 0:n.categoryName:"",masterId:t==="Edit"?n==null?void 0:n.masterId:""},onSubmit:async a=>{var x,j,N,h,T,C;const s={...a,masterId:a==null?void 0:a.masterId};let c="",d="",p="",i;t==="Add"?(i=await r(ve(a)),(x=i==null?void 0:i.payload)!=null&&x.success?(c="Successfully Added",d=(j=i==null?void 0:i.payload)==null?void 0:j.message,p="success"):(c="Something went wrong !!!",d=(N=i==null?void 0:i.error)==null?void 0:N.message,p="danger")):(i=await r(ie({tagCategoryId:(n==null?void 0:n.id)||"",updatedData:s})),(h=i==null?void 0:i.payload)!=null&&h.success?(c="Successfully Update",d=(T=i==null?void 0:i.payload)==null?void 0:T.message,p="success"):(c="Something went wrong !!!",d=(C=i==null?void 0:i.error)==null?void 0:C.message,p="danger")),w.push(e.jsx(F,{title:c,type:p,duration:2500,children:d}),{placement:"top-end"}),r(A(!1)),await r(M())},children:({touched:a,errors:s,values:c,setFieldValue:d})=>{const p=c.tags;return e.jsx(re,{children:e.jsx(te,{layout:"inline",children:e.jsxs("div",{className:"w-full custom-scrollbar",style:{maxHeight:"75vh",overflowY:"auto"},children:[e.jsxs("div",{className:"mb-10",children:[e.jsx("h5",{className:"mb-4",children:t==="Edit"?"Edit Tag Category":"Add Tag Category"}),e.jsx(k,{layout:"vertical",label:"Category Name",invalid:s.categoryName&&a.categoryName,errorMessage:s.categoryName,children:e.jsx(B,{placeholder:"Category Name",name:"categoryName",component:K})}),e.jsx(k,{layout:"vertical",label:"Module Name",invalid:s.masterId&&a.masterId,errorMessage:s.masterId,children:e.jsx(se,{name:"masterId",placeholder:"Module Name",options:I,id:"masterId",value:I.find(i=>(i==null?void 0:i.value)==(c==null?void 0:c.masterId)),isDisabled:t==="Edit",onChange:i=>{const x=i.value;d("masterId",x||"")}})})]}),e.jsx(Se,{name:"tags",children:({form:i,remove:x,push:j})=>e.jsxs("div",{children:[p&&p.length>0?p.map((N,h)=>{const T=G(i,`tags[${h}].tagName`),C=G(i,`tags[${h}].colorName`);return e.jsxs("div",{children:[e.jsx(k,{label:"Name",invalid:T.invalid,errorMessage:T.errorMessage,children:e.jsx(B,{invalid:T.invalid,placeholder:"Tag Name",name:`tags[${h}].tagName`,type:"text",component:K})}),e.jsx(k,{invalid:C.invalid,children:e.jsx(B,{invalid:C.invalid,placeholder:"Color",name:`tags[${h}].colorName`,render:({field:D})=>e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:0},children:[e.jsx(Be,{field:D}),C.invalid&&e.jsx("div",{style:{marginTop:15,marginLeft:5,color:"red"},children:C.errorMessage})]})})}),e.jsx(E,{shape:"circle",size:"sm",icon:e.jsx(he,{}),onClick:()=>x(h)})]},h)}):null,e.jsxs("div",{children:[e.jsx(E,{type:"button",className:"ltr:mr-2 rtl:ml-2",onClick:()=>{j({tagName:"",colorName:"",tagId:""})},children:"Add tags"}),e.jsx(E,{type:"submit",variant:"solid",children:"Submit"})]})]})})]})})})}})})})},{Tr:q,Th:Oe,Td:Pe,THead:ze,TBody:Ke}=$,Ve=({renderRowSubComponent:r,getRowCanExpand:m})=>{const l=S(),n=({row:o})=>{Q();const u=()=>{l(A(!0)),l(U(o)),l(L("Edit"))},z=async()=>{await l(U(o)),l(O(!0))};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex text-base items-center",children:[e.jsx("button",{className:"circle items-center",onClick:u,children:e.jsx(Ce,{})}),e.jsx("span",{className:"cursor-pointer hover:text-red-500 mx-1 circle items-center",onClick:z,children:e.jsx(X,{})})]})})},f=[10,25,50,100],t=b(o=>o.crmTagCategories.data.displayedTagCategoriesList),g=b(o=>o.crmTagCategories.data.loading),{pageIndex:a,pageSize:s,sort:c,query:d,total:p}=b(o=>o.crmTagCategories.data.tableData),i=y.useMemo(()=>({pageIndex:a,pageSize:s,sort:c,query:d,total:p}),[a,s,c,d,p]),x=y.useMemo(()=>[{header:()=>null,id:"expander",cell:({row:o})=>e.jsx(e.Fragment,{children:o.getCanExpand()?e.jsx("button",{className:"text-lg",onClick:o.getToggleExpandedHandler(),children:o.getIsExpanded()?e.jsx(xe,{}):e.jsx(je,{})}):null}),subCell:()=>null},{header:"Actions",id:"action",cell:o=>e.jsx(n,{row:o.row.original})},{header:"Category Name",accessorKey:"categoryName"},{header:"Module Name",accessorKey:"master.moduleName"},{header:"Created By",accessorKey:"createdBy"}],[]),[j,N]=y.useState(t),h=y.useMemo(()=>f.map(o=>({value:o,label:`${o} / page`})),[f]);y.useEffect(()=>{const o=t==null?void 0:t.map(u=>({...u,subRows:u.tags}));N(o)},[t]);const T=ee({data:j,columns:x,getRowCanExpand:m,getCoreRowModel:ae(),getExpandedRowModel:ye(),manualPagination:!0,manualSorting:!0}),C=o=>{const u=Y(i);u.pageIndex=o,l(_(u))},D=o=>{const u=Y(i);u.pageSize=Number(o),u.pageIndex=1,l(_(u))},ce=o=>{g||D==null||D(Number(o))},de=o=>{g||C==null||C(o)};Re("tagcategory","canCreate");const me=()=>{l(L("Add")),l(A(!0))};return e.jsxs(e.Fragment,{children:[e.jsxs(ge,{loading:g&&(j==null?void 0:j.length)!==0,type:"cover",children:[e.jsx("div",{className:"md:flex items-center justify-end",children:e.jsx("div",{className:"mb-4",children:e.jsx(E,{size:"sm",onClick:me,children:"Add New"})})}),e.jsxs($,{children:[e.jsx(ze,{children:T.getHeaderGroups().map(o=>e.jsx(q,{children:o.headers.map(u=>e.jsx(Oe,{colSpan:u.colSpan,children:R(u.column.columnDef.header,u.getContext())},u.id))},o.id))}),g&&(j==null?void 0:j.length)===0?e.jsx(fe,{columns:x==null?void 0:x.length,avatarInColumns:[0],avatarProps:{width:28,height:28}}):e.jsx(Ke,{children:T.getRowModel().rows.map(o=>e.jsxs(y.Fragment,{children:[e.jsx(q,{children:o.getVisibleCells().map(u=>e.jsx("td",{children:R(u.column.columnDef.cell,u.getContext())},u.id))}),o.getIsExpanded()&&e.jsx(q,{children:e.jsx(Pe,{colSpan:o.getVisibleCells().length,children:r({row:o})})})]},o.id))})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx(Ne,{pageSize:s,currentPage:a,total:p,onChange:de}),e.jsx("div",{style:{minWidth:130},children:e.jsx(se,{size:"sm",menuPlacement:"top",isSearchable:!1,value:h==null?void 0:h.filter(o=>o.value===s),options:h,onChange:o=>ce(o==null?void 0:o.value)})})]})]}),e.jsx($e,{}),e.jsx(le,{}),e.jsx(He,{})]})},We=()=>{const r=S(),m=b(t=>t.crmTagCategories.data.deleteSubTagConfirmation),l=b(t=>t.crmTagCategories.data.selectedTag),n=()=>{r(P(!1))},f=async()=>{var g,a,s;r(P(!1));const t=await r(Me(l.id));(g=t==null?void 0:t.payload)!=null&&g.success?w.push(e.jsx(F,{title:"Successfuly Deleted",type:"success",duration:2500,children:(a=t==null?void 0:t.payload)==null?void 0:a.message}),{placement:"top-end"}):w.push(e.jsx(F,{title:"Something Went Wrong !!!",type:"danger",duration:2500,children:(s=t==null?void 0:t.error)==null?void 0:s.message}),{placement:"top-end"}),await r(M())};return e.jsx(ne,{isOpen:m,type:"danger",title:"Delete Tag",confirmButtonColor:"red-600",onClose:n,onRequestClose:n,onCancel:n,onConfirm:f,children:e.jsx("p",{children:"Are you sure you want to delete this Tag? All record related to this tag will be deleted as well. This action cannot be undone."})})},{Tr:J,Th:Le,Td:Ue,THead:_e,TBody:Ye,Sorter:Ge}=$,Je=({row:r})=>{Q();const m=S(),l=async()=>{await m(ke(r)),await m(P(!0))};return e.jsx("div",{className:"flex text-base items-center",children:e.jsx("span",{className:"cursor-pointer hover:text-red-500 mx-1 circle items-center",onClick:l,children:e.jsx(X,{})})})},Qe=r=>{const{tableData:m}=r,[l,n]=y.useState([]),[f]=y.useState(m),g=ee({data:f,columns:[{header:"Actions",id:"action",cell:a=>e.jsx(Je,{row:a.row.original})},{header:"Tag Name",accessorKey:"tagName"},{header:"Color",accessorKey:"colorName",cell:a=>{const s=a.row.original;return e.jsxs("div",{className:"flex items-center",children:[e.jsx(pe,{style:{backgroundColor:`${s.colorName}`}}),e.jsx("span",{className:"ml-2 rtl:mr-2 capitalize",children:s.colorName})]})}}],state:{sorting:l},onSortingChange:n,getCoreRowModel:ae(),getSortedRowModel:Te()});return e.jsxs(e.Fragment,{children:[e.jsxs($,{children:[e.jsx(_e,{children:g.getHeaderGroups().map(a=>e.jsx(J,{children:a.headers.map(s=>e.jsx(Le,{colSpan:s.colSpan,children:s.isPlaceholder?null:e.jsxs("div",{className:s.column.getCanSort()?"cursor-pointer select-none":"",onClick:s.column.getToggleSortingHandler(),children:[R(s.column.columnDef.header,s.getContext()),e.jsx(Ge,{sort:s.column.getIsSorted()})]})},s.id))},a.id))}),e.jsx(Ye,{children:g.getRowModel().rows.slice(0,10).map(a=>e.jsx(J,{children:a.getVisibleCells().map(s=>e.jsx(Ue,{children:R(s.column.columnDef.cell,s.getContext())},s.id))},a.id))})]}),e.jsx(We,{})]})},Xe=({row:r})=>e.jsx("pre",{style:{fontSize:"10px"},children:e.jsx(Qe,{tableData:r.original.tags})});ue("crmTagCategories",Ee);const Ze=()=>{const r=S(),m=async()=>{await r(M())};return y.useEffect(()=>{m()},[r]),e.jsxs(e.Fragment,{children:[e.jsx("h5",{className:"mb-2",children:"Manage Tags"}),e.jsx(Ve,{renderRowSubComponent:Xe,getRowCanExpand:()=>!0})]})},Xa=Ze;export{Xa as T};
