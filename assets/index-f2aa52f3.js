import{al as P,am as ee,an as te,ao as se,a as j,r as h,j as e,p as S,ap as ae,c as re,aq as oe,as as ie,ah as le}from"./index-3e880d58.js";import{A as ne}from"./AdaptableCard-c2187b0f.js";import{C as ce,i as E}from"./Views-075eae35.js";import{D as de}from"./DoubleSidedImage-e8faa5b2.js";import{C as Y}from"./Card-229ace64.js";import{A as q}from"./index-4d380cc3.js";import{B as p}from"./Button-2946c768.js";import{t as me,N as pe}from"./toast-b78f7559.js";import{C as z}from"./ConfirmDialog-90e160ad.js";import{F as ue,a as xe,b as he,c as ge}from"./index.esm-9d327cb5.js";import{P as je,R as O,S as fe}from"./index.esm-72033000.js";import{p as Ce,q as De,r as ye}from"./CrmService-a38b0f72.js";import{D as be}from"./Drawer-9836140f.js";import{C as Ne}from"./CustomerForm-4992981a.js";import{c as w}from"./cloneDeep-3c6952f1.js";import{T as V}from"./index-2e6e3f8b.js";import{B as ve}from"./Badge-dfca28fd.js";import{c as Me,u as Pe,f as F,g as Se,a as we}from"./index-de567301.js";import{N as $}from"./react-number-format.es-21a90780.js";import{T as B}from"./Tag-baf7a322.js";import{I as ke}from"./Input-cc5b259f.js";import{D as Ee}from"./Dialog-a9e6c446.js";import{F as Fe,a as f}from"./FormItem-2c1e6567.js";import{F as Ie,a as He,b as y}from"./formik.esm-b6fc01f9.js";import{F as I,a as Re}from"./FormPatternInput-745bcb3f.js";import{c as Te,a as b}from"./index.esm-ef8817a5.js";import{i as Ae}from"./isLastChild-83eb4c23.js";import"./useMergeRef-788c4cb0.js";import"./Tooltip-e9d0a24c.js";import"./usePopper-5fe449ce.js";import"./index.esm-33df2266.js";import"./index-f502ce4c.js";import"./useTimeout-eadd7d3b.js";import"./CloseButton-4efc1add.js";import"./StatusIcon-ff12f8c4.js";import"./chainedFunction-070f832c.js";import"./index-9c0cabce.js";import"./index-3c7f8823.js";import"./useControllableState-f10b9480.js";import"./AdditionalTag-f57a652c.js";import"./Alert-f6d23cba.js";import"./RangeCalendar-76b3d14c.js";import"./index-f0b859a7.js";import"./_baseIsEqual-785b16ba.js";import"./_MapCache-7f2c37e9.js";import"./get-4c4ae8d7.js";import"./toString-5649af70.js";import"./index-3e1bfc83.js";import"./useRootClose-0ff11c2b.js";import"./TimeInput-6b863084.js";import"./useUniqueId-e46a3a66.js";import"./useDidUpdate-4d89c820.js";import"./index-9d9ccba3.js";import"./useUncertainRef-48982c60.js";import"./isNil-4c059865.js";import"./index-78df0a35.js";import"./index-0199cfe3.js";import"./index-989e0cf5.js";import"./Pagination-65d73c7a.js";import"./Progress-ae30664a.js";import"./index-e719384e.js";import"./ScrollBar-71fa1417.js";import"./index-ab165616.js";import"./Select-76acedff.js";import"./slicedToArray-a34215eb.js";import"./objectWithoutProperties-8809bfcf.js";import"./toConsumableArray-4b935cb5.js";import"./floating-ui.dom-bef9cea3.js";import"./Skeleton-6f0cf5d7.js";import"./index-6b09464f.js";import"./mapCloneElement-024d59c7.js";import"./Switcher-15616a0a.js";import"./index-2f9ef4f4.js";import"./index-95cf3345.js";import"./Upload-2e16c5c2.js";import"./index.esm-4e597ee1.js";import"./index.esm-218c3d6f.js";import"./index.esm-a2d32bb5.js";import"./tagAndCategory-beef627f.js";/* empty css              */import"./_getPrototype-484592c8.js";const N="crmCustomerDetails",M=P(N+"/getCustomer",async t=>(await Ce(t)).data),Ye=P(N+"/deleteCustomer",async t=>(await De(t)).data),qe=P(N+"/putCustomer",async t=>(await ye(t)).data),ze={loading:!0,profileData:{},subscriptionData:[],paymentHistoryData:[],paymentMethodData:[],deletePaymentMethodDialog:!1,editPaymentMethodDialog:!1,editCustomerDetailDialog:!1,selectedCard:{}},L=ee({name:`${N}/state`,initialState:ze,reducers:{updatePaymentMethodData:(t,s)=>{t.paymentMethodData=s.payload},updateProfileData:(t,s)=>{t.profileData=s.payload},openDeletePaymentMethodDialog:t=>{t.deletePaymentMethodDialog=!0},closeDeletePaymentMethodDialog:t=>{t.deletePaymentMethodDialog=!1},openEditPaymentMethodDialog:t=>{t.editPaymentMethodDialog=!0},closeEditPaymentMethodDialog:t=>{t.editPaymentMethodDialog=!1},openEditCustomerDetailDialog:t=>{t.editCustomerDetailDialog=!0},closeEditCustomerDetailDialog:t=>{t.editCustomerDetailDialog=!1},updateSelectedCard:(t,s)=>{t.selectedCard=s.payload}},extraReducers:t=>{t.addCase(M.fulfilled,(s,i)=>{var l,a,r;s.loading=!1,s.profileData=i.payload,s.subscriptionData=((l=i.payload)==null?void 0:l.subscription)||[],s.paymentHistoryData=((a=i.payload)==null?void 0:a.orderHistory)||[],s.paymentMethodData=((r=i.payload)==null?void 0:r.paymentMethod)||[]}).addCase(M.pending,s=>{s.loading=!0})}}),{updatePaymentMethodData:J,updateProfileData:Oe,openDeletePaymentMethodDialog:Ve,closeDeletePaymentMethodDialog:H,openEditPaymentMethodDialog:$e,closeEditPaymentMethodDialog:Be,openEditCustomerDetailDialog:Le,closeEditCustomerDetailDialog:Je,updateSelectedCard:R}=L.actions,Ue=L.reducer,Ge=te({data:Ue}),m=se,Qe=({onSaveClick:t,onCancel:s})=>e.jsxs("div",{className:"text-right w-full",children:[e.jsx(p,{size:"sm",className:"mr-2",onClick:s,children:"Cancel"}),e.jsx(p,{size:"sm",variant:"solid",onClick:t,children:"Save"})]}),_e=()=>{const t=j(),s=h.useRef(null),i=m(o=>o.crmCustomerDetails.data.editCustomerDetailDialog),l=m(o=>o.crmCustomerDetails.data.profileData),a=()=>{t(Je())},r=()=>{var o;(o=s.current)==null||o.submitForm()},c=o=>{const n=w(l),{name:u,birthday:d,email:x,img:v,location:g,title:U,phoneNumber:G,facebook:Q,twitter:_,pinterest:K,linkedIn:W}=o,X={name:u,email:x,img:v},Z={location:g,title:U,birthday:S(d).format("DD/MM/YYYY"),phoneNumber:G,facebook:Q,twitter:_,pinterest:K,linkedIn:W};n.personalInfo={...n.personalInfo,...Z};const k={...n,...X};t(Oe(k)),t(qe(k)),a()};return e.jsx(be,{isOpen:i,closable:!1,bodyClass:"p-0",footer:e.jsx(Qe,{onCancel:a,onSaveClick:r}),onClose:a,onRequestClose:a,children:e.jsx(Ne,{ref:s,customer:l,onFormSubmit:c})})},C=({title:t,value:s})=>e.jsxs("div",{children:[e.jsx("span",{children:t}),e.jsx("p",{className:"text-gray-700 dark:text-gray-200 font-semibold",children:s})]}),Ke=({id:t})=>{const s=j(),[i,l]=h.useState(!1),a=ae(),r=()=>{l(!1)},c=()=>{l(!0)},o=()=>{l(!1),t&&s(Ye({id:t})),a("/app/crm/customers"),me.push(e.jsx(pe,{title:"Successfuly Deleted",type:"success",children:"Customer successfuly deleted"}))},n=()=>{s(Le())};return e.jsxs(e.Fragment,{children:[e.jsx(p,{block:!0,icon:e.jsx(je,{}),onClick:c,children:"Delete"}),e.jsx(p,{block:!0,icon:e.jsx(O,{}),variant:"solid",onClick:n,children:"Edit"}),e.jsx(z,{isOpen:i,type:"danger",title:"Delete customer",confirmButtonColor:"red-600",onClose:r,onRequestClose:r,onCancel:r,onConfirm:o,children:e.jsx("p",{children:"Are you sure you want to delete this customer? All record related to this customer will be deleted as well. This action cannot be undone."})}),e.jsx(_e,{})]})},We=({data:t={}})=>{var s,i,l,a;return e.jsx(Y,{children:e.jsxs("div",{className:"flex flex-col xl:justify-between h-full 2xl:min-w-[360px] mx-auto",children:[e.jsxs("div",{className:"flex xl:flex-col items-center gap-4",children:[e.jsx(q,{size:90,shape:"circle",src:t.img}),e.jsx("h4",{className:"font-bold",children:t.name})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-1 gap-y-7 gap-x-4 mt-8",children:[e.jsx(C,{title:"Email",value:t.email}),e.jsx(C,{title:"Phone",value:(s=t.personalInfo)==null?void 0:s.phoneNumber}),e.jsx(C,{title:"Location",value:(i=t.personalInfo)==null?void 0:i.location}),e.jsx(C,{title:"Date of birth",value:(l=t.personalInfo)==null?void 0:l.birthday}),e.jsx(C,{title:"Title",value:(a=t.personalInfo)==null?void 0:a.title}),e.jsxs("div",{className:"mb-7",children:[e.jsx("span",{children:"Social"}),e.jsxs("div",{className:"flex mt-4",children:[e.jsx(p,{className:"mr-2",shape:"circle",size:"sm",icon:e.jsx(ue,{className:"text-[#1773ea]"})}),e.jsx(p,{className:"mr-2",shape:"circle",size:"sm",icon:e.jsx(xe,{className:"text-[#1da1f3]"})}),e.jsx(p,{className:"mr-2",shape:"circle",size:"sm",icon:e.jsx(he,{className:"text-[#0077b5]"})}),e.jsx(p,{className:"mr-2",shape:"circle",size:"sm",icon:e.jsx(ge,{className:"text-[#df0018]"})})]})]})]}),e.jsx("div",{className:"mt-4 flex flex-col xl:flex-row gap-2",children:e.jsx(Ke,{id:t.id})})]})})},{Tr:T,Th:Xe,Td:Ze,THead:et,TBody:tt,Sorter:st}=V,at={paid:"bg-emerald-500",pending:"bg-amber-400"},D=Me(),rt=[D.accessor("id",{header:"Reference",cell:t=>{const s=t.row.original;return e.jsx("div",{children:e.jsx("span",{className:"cursor-pointer",children:s.id})})}}),D.accessor("item",{header:"Product"}),D.accessor("status",{header:"Status",cell:t=>{const s=t.row.original;return e.jsxs("div",{className:"flex items-center",children:[e.jsx(ve,{className:at[s.status]}),e.jsx("span",{className:"ml-2 rtl:mr-2 capitalize",children:s.status})]})}}),D.accessor("date",{header:"Date",cell:t=>{const s=t.row.original;return e.jsx("div",{className:"flex items-center",children:S.unix(s.date).format("MM/DD/YYYY")})}}),D.accessor("amount",{header:"Amount",cell:t=>{const s=t.row.original;return e.jsx("div",{className:"flex items-center",children:e.jsx($,{displayType:"text",value:(Math.round(s.amount*100)/100).toFixed(2),prefix:"$",thousandSeparator:!0})})}})],ot=()=>{const t=m(a=>a.crmCustomerDetails.data.paymentHistoryData),[s,i]=h.useState([]),l=Pe({data:t,columns:rt,state:{sorting:s},onSortingChange:i,getCoreRowModel:Se(),getSortedRowModel:we()});return e.jsxs("div",{className:"mb-8",children:[e.jsx("h6",{className:"mb-4",children:"Payment History"}),e.jsxs(V,{children:[e.jsx(et,{children:l.getHeaderGroups().map(a=>e.jsx(T,{children:a.headers.map(r=>e.jsx(Xe,{colSpan:r.colSpan,children:r.isPlaceholder?null:e.jsxs("div",{className:r.column.getCanSort()?"cursor-pointer select-none":"",onClick:r.column.getToggleSortingHandler(),children:[F(r.column.columnDef.header,r.getContext()),e.jsx(st,{sort:r.column.getIsSorted()})]})},r.id))},a.id))}),e.jsx(tt,{children:l.getRowModel().rows.slice(0,10).map(a=>e.jsx(T,{children:a.getVisibleCells().map(r=>e.jsx(Ze,{children:F(r.column.columnDef.cell,r.getContext())},r.id))},a.id))})]})]})},it=()=>{const[t,s]=h.useState(!0),i=m(r=>r.crmCustomerDetails.data.subscriptionData),l=h.useCallback(()=>{s(!1)},[]),a=h.useCallback(()=>{s(!0)},[]);return e.jsxs("div",{className:"mb-8",children:[e.jsx("h6",{className:"mb-4",children:"Subscription"}),i.map(r=>e.jsx(Y,{bordered:!0,className:"mb-4",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{children:e.jsx(q,{className:"bg-emerald-500",shape:"circle",icon:e.jsx(fe,{})})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("h6",{children:r.plan}),e.jsx(B,{className:"bg-emerald-100 text-emerald-600 dark:bg-emerald-500/20 dark:text-emerald-100 rounded-md border-0 mx-2",children:e.jsx("span",{className:"capitalize",children:r.status})})]}),e.jsxs("div",{children:[e.jsxs("span",{children:["Billing ",r.billing]}),e.jsx("span",{children:" | "}),e.jsxs("span",{children:["Next payment on"," ",S.unix(r.nextPaymentDate).format("MM/DD/YYYY")]}),e.jsxs("span",{children:[e.jsx("span",{className:"mx-1",children:"for"}),e.jsx($,{className:"font-semibold text-gray-900 dark:text-gray-100",displayType:"text",value:(Math.round(r.amount*100)/100).toFixed(2),prefix:"$",thousandSeparator:!0})]})]})]})]}),e.jsxs("div",{className:"flex",children:[t&&e.jsx(p,{size:"sm",variant:"plain",onClick:l,children:"Cancel plan"}),e.jsxs(p,{size:"sm",className:"ml-2 rtl:mr-2",onClick:a,children:[t?"Update":"Subscribe"," Plan"]})]})]})},r.plan))]})},lt=Te().shape({cardHolderName:b().required("Card holder name required"),ccNumber:b().required("Credit card number required").matches(/^(?:4[0-9]{12}(?:[0-9]{3})?|[25][1-7][0-9]{14}|6(?:011|5[0-9][0-9])[0-9]{12}|3[47][0-9]{13}|3(?:0[0-5]|[68][0-9])[0-9]{11}|(?:2131|1800|35\d{3})\d{11})$/,"Invalid credit card number"),cardExpiry:b().required("Card holder name required").matches(/^(0[1-9]|1[0-2])\/?([0-9]{4}|[0-9]{2})$/,"Invalid Date"),code:b().required().matches(/^[0-9]{3}$/,"Invalid CVV")});function A(t,s){return t.length===1&&t[0]>s[0]&&(t="0"+t),t.length===2&&(Number(t)===0?t="01":t>s&&(t=s)),t}function nt(t){const s=A(t.substring(0,2),"12"),i=A(t.substring(2,4),"31");return s+(i.length?"/"+i:"")}const ct=()=>{const t=j(),s=m(o=>o.crmCustomerDetails.data.selectedCard),i=m(o=>o.crmCustomerDetails.data.paymentMethodData),l=m(o=>o.crmCustomerDetails.data.editPaymentMethodDialog),a=m(o=>o.crmCustomerDetails.data.selectedCard),r=o=>{let n=w(i)||[];const{cardHolderName:u,ccNumber:d,cardExpiry:x}=o,v={cardHolderName:u,last4Number:d.substr(d.length-4),expYear:x.substr(x.length-2),expMonth:x.substring(0,2)};n=n.map(g=>(g.last4Number===a.last4Number&&(g={...g,...v}),g)),c(),t(J(n))},c=()=>{t(Be())};return e.jsxs(Ee,{isOpen:l,onClose:c,onRequestClose:c,children:[e.jsx("h4",{children:"Edit Credit Card"}),e.jsx("div",{className:"mt-6",children:e.jsx(Ie,{initialValues:{cardHolderName:s.cardHolderName||"",ccNumber:"",cardExpiry:(s==null?void 0:s.expMonth)+s.expYear||"",code:""},validationSchema:lt,onSubmit:(o,{setSubmitting:n})=>{r(o),n(!1)},children:({touched:o,errors:n})=>e.jsx(He,{children:e.jsxs(Fe,{children:[e.jsx(f,{label:"Card holder name",invalid:n.cardHolderName&&o.cardHolderName,errorMessage:n.cardHolderName,children:e.jsx(y,{type:"text",autoComplete:"off",name:"cardHolderName",component:ke})}),e.jsx(f,{label:"Credit Card Number",invalid:n.ccNumber&&o.ccNumber,errorMessage:n.ccNumber,children:e.jsx(y,{name:"ccNumber",children:({field:u,form:d})=>e.jsx(I,{form:d,field:u,placeholder:"•••• •••• •••• ••••",format:"#### #### #### ####",onValueChange:x=>{d.setFieldValue(u.name,x.value)}})})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(f,{label:"Expiration date",invalid:n.cardExpiry&&o.cardExpiry,errorMessage:n.cardExpiry,children:e.jsx(y,{name:"cardExpiry",children:({field:u,form:d})=>e.jsx(Re,{form:d,field:u,placeholder:"••/••",format:nt,defaultValue:d.values.cardExpiry,onValueChange:x=>{d.setFieldValue(u.name,x.value)}})})}),e.jsx(f,{label:"CVV",invalid:n.code&&o.code,errorMessage:n.code,children:e.jsx(y,{name:"code",children:({field:u,form:d})=>e.jsx(I,{form:d,field:u,placeholder:"•••",format:"###",onValueChange:x=>{d.setFieldValue(u.name,x.value)}})})})]}),e.jsx(f,{className:"mb-0 text-right",children:e.jsx(p,{block:!0,variant:"solid",type:"submit",children:"Update"})})]})})})})]})},dt=()=>{const t=j(),s=m(c=>c.crmCustomerDetails.data.paymentMethodData),i=m(c=>c.crmCustomerDetails.data.deletePaymentMethodDialog),l=m(c=>c.crmCustomerDetails.data.selectedCard),a=()=>{let c=w(s)||[];c=c.filter(o=>o.last4Number!==l.last4Number),t(H()),t(J(c))},r=()=>{t(H())};return e.jsx(z,{isOpen:i,type:"danger",title:"Remove payment method",confirmButtonColor:"red-600",onClose:r,onRequestClose:r,onCancel:r,onConfirm:a,children:e.jsx("p",{children:" Are you sure you want to remove this payment method? "})})},mt=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],pt=()=>{const t=j(),s=m(a=>a.crmCustomerDetails.data.paymentMethodData),i=a=>{t(R(a)),t($e())},l=a=>{t(R(a)),t(Ve())};return e.jsxs(e.Fragment,{children:[s.length>0&&e.jsxs("div",{children:[e.jsx("h6",{className:"mb-4",children:"Payment Methods"}),e.jsx("div",{className:"rounded-lg border border-gray-200 dark:border-gray-600",children:s.map((a,r)=>e.jsxs("div",{className:re("flex flex-col lg:flex-row lg:items-center justify-between gap-3 p-4",!Ae(s,r)&&"border-b border-gray-200 dark:border-gray-600"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[a.cardType==="VISA"&&e.jsx("img",{src:"/img/others/img-8.png",alt:"visa"}),a.cardType==="MASTER"&&e.jsx("img",{src:"/img/others/img-9.png",alt:"master"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"text-gray-900 dark:text-gray-100 font-semibold",children:[a.cardHolderName," ••••"," ",a.last4Number]}),a.primary&&e.jsx(B,{className:"bg-sky-100 text-sky-600 dark:bg-sky-500/20 dark:text-sky-100 rounded-md border-0 mx-2",children:e.jsxs("span",{className:"capitalize",children:[" ","Primary"," "]})})]}),e.jsxs("span",{children:["Expired"," ",mt[parseInt(a.expMonth)-1]," ","20",a.expYear]})]})]}),e.jsxs("div",{className:"flex",children:[e.jsx(p,{className:"mr-2 rtl:ml-2",variant:"plain",size:"sm",onClick:()=>l(a),children:"Delete"}),e.jsx(p,{icon:e.jsx(O,{}),size:"sm",onClick:()=>i(a),children:"Edit"})]})]},a.last4Number))})]}),e.jsx(ct,{}),e.jsx(dt,{})]})};oe("crmCustomerDetails",Ge);const ut=()=>{const t=j(),s=ie(),i=m(r=>r.crmCustomerDetails.data.profileData),l=m(r=>r.crmCustomerDetails.data.loading);h.useEffect(()=>{a()},[]);const a=()=>{const r=s.get("id");r&&t(M({id:r}))};return e.jsxs(ce,{className:"h-full",children:[e.jsx(le,{loading:l,children:!E(i)&&e.jsxs("div",{className:"flex flex-col xl:flex-row gap-4",children:[e.jsx("div",{children:e.jsx(We,{data:i})}),e.jsx("div",{className:"w-full",children:e.jsxs(ne,{children:[e.jsx(it,{}),e.jsx(ot,{}),e.jsx(pt,{})]})})]})}),!l&&E(i)&&e.jsxs("div",{className:"h-full flex flex-col items-center justify-center",children:[e.jsx(de,{src:"/img/others/img-2.png",darkModeSrc:"/img/others/img-2-dark.png",alt:"No user found!"}),e.jsx("h3",{className:"mt-8",children:"No user found!"})]})]})},Vs=ut;export{Vs as default};
