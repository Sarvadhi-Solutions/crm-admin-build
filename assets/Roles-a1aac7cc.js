import{a as R,r as j,j as e,u as O,B as ae,ar as oe}from"./index-6767ac81.js";import{A as re}from"./AdaptableCard-1cecc9da.js";import{D as ne}from"./DataTable-7c33a6e6.js";import{u as H}from"./useThemeClass-a62e85dc.js";import{c as v}from"./cloneDeep-028f7085.js";import{f as ie,u as b,p as U,s as T,a as le,b as V,c as ce,g as k,d as A,e as J,h as K,i as me,j as _,r as de}from"./index-9a89468f.js";import{B as E}from"./Button-edcd26d9.js";import{D as pe}from"./Drawer-95c21b15.js";import{i as he}from"./Views-e5205a91.js";import{u as fe,c as q,d as B,F as ue,a as xe,b as ge}from"./formik.esm-35003a33.js";import{T as W}from"./index-149a53e8.js";import{c as G,a as Q}from"./index.esm-a1939a1a.js";import"./Alert-c9b22c70.js";import"./index-688b9e70.js";import{B as X}from"./Badge-1f68c9c2.js";import"./Calendar-defcfa74.js";import"./Card-da872ceb.js";import{C as S}from"./index-5c02b9f9.js";import"./index-6bf19af2.js";import"./Dialog-b04dbbb3.js";import"./index-787c9736.js";import"./toString-5f976032.js";import{I as Z}from"./Input-736c9e0d.js";import"./index-5e02ae30.js";import"./index-375da5f6.js";import"./index-9fee79d2.js";import"./toast-33e99923.js";import"./Pagination-3af44538.js";import"./Progress-b13c43d8.js";import"./index-18c6d586.js";import"./RangeCalendar-2da4f4e1.js";import"./ScrollBar-e8750282.js";import"./index-bf30d0ca.js";import{S as je,c as be}from"./Select-3d321c37.js";import"./Skeleton-f6501194.js";import"./index-8c6f1de1.js";import"./Switcher-becc3d78.js";import"./index-d5eb49a4.js";import"./Tag-28e3c136.js";import"./index-d9614e75.js";import"./index-70261eaf.js";import"./Tooltip-777f9f9c.js";import"./Upload-1c01a3b3.js";/* empty css              */import{a6 as L,B as Ce,z as we}from"./index.esm-107f547f.js";import{d as Re}from"./debounce-7fa991f6.js";import"./TableRowSkeleton-6125f39f.js";import"./index-43da21b1.js";import"./_Uint8Array-81109713.js";import"./_MapCache-5db605d8.js";import"./_getPrototype-48c0ebaa.js";import"./CrmService-e70a4be4.js";import"./context-cdfa92ed.js";import"./index-1bb56c96.js";import"./CloseButton-5ef937e0.js";import"./index-fb02f18d.js";import"./useControllableState-dba48cec.js";import"./useTimeout-395cc71e.js";import"./StatusIcon-33312305.js";import"./useMergeRef-788c4cb0.js";import"./_baseIsEqual-98c979d7.js";import"./get-582c28e3.js";import"./useRootClose-6563c421.js";import"./usePopper-ba5004dc.js";import"./TimeInput-030e16c6.js";import"./useUniqueId-1387b982.js";import"./useDidUpdate-c5cefb65.js";import"./useUncertainRef-e1544d29.js";import"./isNil-1a1387e3.js";import"./chainedFunction-070f832c.js";import"./toConsumableArray-af8bf1ee.js";import"./objectWithoutPropertiesLoose-df62547b.js";import"./floating-ui.dom-bef9cea3.js";import"./mapCloneElement-3589bfd8.js";import"./index.esm-ad20eb15.js";import"./index.esm-52ddd804.js";import"./index.esm-3da06225.js";const De=s=>{const{roles:n,drawerMode:a}=s,i=R(),[r,p]=j.useState([]),[m,t]=j.useState([]),d=fe();j.useEffect(()=>{async function l(){var c;try{const h=await i(ie()),f=(c=h==null?void 0:h.payload)==null?void 0:c.data.map(x=>({masterId:x.id,canCreate:!1,canModify:!1,canView:!1,canDelete:!1,canManage:!1}));a==="Edit"&&n&&Array.isArray(n.rolePermissions)&&[...n.rolePermissions].sort((o,u)=>o.masterId-u.masterId).forEach(o=>{const u=f.findIndex(D=>D.masterId===o.masterId);u!==-1&&(f[u]=o)}),d.setFieldValue("modules",f),t(f),p(h.payload.data)}catch(h){console.error("Error fetching modules:",h)}}l()},[i]),G().shape({rolename:Q().required("Role Name is required")});const g=(l,c,h,f)=>{const x=JSON.parse(JSON.stringify(d.values.modules));if(c!=="canManage")x[f][c]=h,x[f].canManage=x[f].canCreate&&x[f].canModify&&x[f].canView&&x[f].canDelete;else{const o={canManage:h,canCreate:h,canModify:h,canView:h,canDelete:h,masterId:l};x[f]=o}d.setFieldValue("modules",x)};return e.jsxs(e.Fragment,{children:[e.jsx(q,{label:"Role Name",children:e.jsx(B,{type:"text",autoComplete:"off",name:"roleName",placeholder:"Role Name",component:Z,prefix:e.jsx(L,{className:"text-xl"})})}),e.jsx(q,{label:"System",children:e.jsx(B,{autoComplete:"off",name:"isSystem",placeholder:"System",component:S,checked:d.values.isSystem,prefix:e.jsx(L,{className:"text-xl"})})}),e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{}),e.jsx("th",{children:"All"}),e.jsx("th",{children:"Read"}),e.jsx("th",{children:"Write"}),e.jsx("th",{children:"Update"}),e.jsx("th",{children:"Delete"})]})}),e.jsx("tbody",{children:r==null?void 0:r.map((l,c)=>{var h,f,x,o,u,D,I,M,F,y,N,C,z,$,P;return e.jsxs("tr",{children:[e.jsx("td",{children:l==null?void 0:l.moduleName.toUpperCase()}),e.jsx("td",{align:"center",children:e.jsx(S,{name:`permissions[${l.id}].canManage`,checked:((x=(f=(h=d.values)==null?void 0:h.modules)==null?void 0:f[c])==null?void 0:x.canManage)??!1,onChange:w=>{g(l.id,"canManage",w,c)}})}),e.jsx("td",{align:"center",children:e.jsx(S,{name:`permissions[${l.id}].canView`,checked:((D=(u=(o=d.values)==null?void 0:o.modules)==null?void 0:u[c])==null?void 0:D.canView)??!1,onChange:w=>{g(l.id,"canView",w,c)}})}),e.jsx("td",{align:"center",children:e.jsx(S,{name:`permissions[${l.id}].canCreate`,checked:((F=(M=(I=d.values)==null?void 0:I.modules)==null?void 0:M[c])==null?void 0:F.canCreate)??!1,onChange:w=>g(l.id,"canCreate",w,c)})}),e.jsx("td",{align:"center",children:e.jsx(S,{name:`permissions[${l.id}].canModify`,checked:((C=(N=(y=d.values)==null?void 0:y.modules)==null?void 0:N[c])==null?void 0:C.canModify)??!1,onChange:w=>g(l.id,"canModify",w,c)})}),e.jsx("td",{align:"center",children:e.jsx(S,{name:`permissions[${l.id}].canDelete`,checked:((P=($=(z=d.values)==null?void 0:z.modules)==null?void 0:$[c])==null?void 0:P.canDelete)??!1,onChange:w=>g(l.id,"canDelete",w,c)})})]},c)})})]})]})},ye=G().shape({rolename:Q().required("Role Name is required")}),{TabNav:Ne,TabList:Se,TabContent:ve}=W,ee=j.forwardRef((s,n)=>{const[a,i]=j.useState([]);R();const r=O(m=>m.crmRoles.data.selectedRole),p=O(m=>m.crmRoles.data.drawerMode);return e.jsx(ue,{innerRef:n,initialValues:{roleName:p==="Edit"&&(r==null?void 0:r.roleName)||"",isSystem:p==="Edit"&&(r==null?void 0:r.isSystem)||!1,isDefault:(r==null?void 0:r.isDefault)||!1,modules:a},validationSchema:ye,onSubmit:(m,{setSubmitting:t})=>{console.log("on submit called "),t(!1)},children:({touched:m,errors:t})=>e.jsx(xe,{children:e.jsx(ge,{children:e.jsxs(W,{defaultValue:"roles",children:[e.jsx(Se,{children:e.jsx(Ne,{value:"roles",children:"Role Form"})}),e.jsx("div",{className:"p-6",children:e.jsx(ve,{value:"roles",children:e.jsx(De,{touched:m,errors:t,roles:r,drawerMode:p})})})]})})})})});ee.displayName="RolesForm";const se=j.forwardRef((s,n)=>{const a=R(),i=b(t=>t.crmRoles.data.selectedRole),r=b(t=>t.crmRoles.data.rolesList),{id:p}=i,m=t=>{const{name:d,birthday:g,email:l,img:c,location:h,title:f,phoneNumber:x,facebook:o,twitter:u,pinterest:D,linkedIn:I}=t,M={name:d,email:l,img:c},F={location:h,title:f,birthday:ae(g).format("DD/MM/YYYY"),phoneNumber:x,facebook:o,twitter:u,pinterest:D,linkedIn:I};let y=v(r),N={};y=y.map(C=>(C.id===p&&(C={...C,...M},C.personalInfo={...C.personalInfo,...F},N=C),C)),he(N)||a(U(N)),a(T()),a(le(y))};return e.jsx(ee,{ref:n,roles:i,onFormSubmit:m})});se.displayName="RolesEditContent";const ke=({onSaveClick:s,onCancel:n})=>e.jsxs("div",{className:"text-right w-full",children:[e.jsx(E,{size:"sm",className:"mr-2",onClick:n,children:"Cancel"}),e.jsx(E,{size:"sm",variant:"solid",onClick:s,children:"Save"})]}),Ie=()=>{const s=R(),n=b(t=>t.crmRoles.data.drawerOpen),a=b(t=>t.crmRoles.data.drawerMode),i=b(t=>t.crmRoles.data.selectedRole),r=()=>{s(T()),s(V({}))},p=j.useRef(null),m=async()=>{var d,g;const t=(d=p.current)==null?void 0:d.values;if(a==="ADD"){const l=await s(ce(t));console.log(l,"response"),await s(T()),await s(k())}else{const l=i.id,c=await s(U({id:l,data:t}));console.log(c,"response"),await s(T()),await s(k())}(g=p.current)==null||g.submitForm()};return e.jsx(pe,{isOpen:n,closable:!1,bodyClass:"p-0",footer:e.jsx(ke,{onCancel:r,onSaveClick:m}),onClose:r,onRequestClose:r,children:e.jsx(se,{ref:p})})},Me=({row:s})=>{const{textTheme:n}=H(),a=R(),i=()=>{a(J()),a(V(s)),a(K("Edit"))};return e.jsx("div",{className:`${n} cursor-pointer select-none font-semibold`,onClick:i,children:"Edit"})},Fe=({row:s})=>{const{textTheme:n}=H(),a=R(),i=async()=>{await a(V(s)),await a(me(s.id)),await a(k())};return e.jsx("div",{className:`${n} cursor-pointer select-none font-semibold text-red-500`,onClick:i,children:"Delete"})},Te=()=>{const s=R(),n=b(o=>o.crmRoles.data.rolesList),a=b(o=>o.crmRoles.data.loading),i=b(o=>o.crmRoles.data.filterData),{pageIndex:r,pageSize:p,sort:m,query:t,total:d}=b(o=>o.crmRoles.data.tableData),g=j.useCallback(()=>{s(k())},[r,p,m,t,i,s]);j.useEffect(()=>{g()},[g,r,p,m,i]);const l=j.useMemo(()=>({pageIndex:r,pageSize:p,sort:m,query:t,total:d}),[r,p,m,t,d]),c=j.useMemo(()=>[{header:"Role Name",accessorKey:"tasksName",cell:o=>o.row.original.roleName,width:200},{header:"System",accessorKey:"isSystem",cell:o=>o.row.original.isSystem.toString(),width:200},{header:"Edit",id:"action",cell:o=>e.jsx(Me,{row:o.row.original})},{header:"Delete",id:"delete",cell:o=>e.jsx(Fe,{row:o.row.original})}],[]),h=o=>{const u=v(l);u.pageIndex=o,s(A(u))},f=o=>{const u=v(l);u.pageSize=Number(o),u.pageIndex=1,s(A(u))},x=o=>{const u=v(l);u.sort=o,s(A(u))};return e.jsxs("div",{children:[e.jsx(ne,{columns:c,data:n,skeletonAvatarColumns:[0],skeletonAvatarProps:{width:28,height:28},loading:a,pagingData:{total:l.total,pageIndex:l.pageIndex,pageSize:l.pageSize},onPaginationChange:h,onSelectChange:f,onSort:x}),e.jsx(Ie,{})]})},{Control:Ae}=be,Y=[{value:"",label:"All",color:"bg-gray-500"},{value:"active",label:"Active",color:"bg-emerald-500"},{value:"blocked",label:"Blocked",color:"bg-red-500"}],Ee=({innerProps:s,label:n,data:a,isSelected:i})=>e.jsxs("div",{className:`flex items-center justify-between p-2 cursor-pointer ${i?"bg-gray-100 dark:bg-gray-500":"hover:bg-gray-50 dark:hover:bg-gray-600"}`,...s,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{innerClass:a.color}),e.jsx("span",{children:n})]}),i&&e.jsx(Ce,{className:"text-emerald-500 text-xl"})]}),Ve=({children:s,...n})=>{const a=n.getValue()[0];return e.jsxs(Ae,{...n,children:[a&&e.jsx(X,{className:"ltr:ml-4 rtl:mr-4",innerClass:a.color}),s]})},ze=()=>{const s=R(),{status:n}=b(i=>i.crmRoles.data.filterData),a=i=>{s(_({status:i==null?void 0:i.value}))};return e.jsx(je,{options:Y,size:"sm",className:"mb-4 min-w-[130px]",components:{Option:Ee,Control:Ve},value:Y.filter(i=>i.value===n),onChange:a})},te=j.forwardRef((s,n)=>{const{onInputChange:a}=s,i=Re(r,500);function r(m){a==null||a(m)}const p=m=>{i(m.target.value)};return e.jsx(Z,{ref:n,className:"max-w-md md:w-52 mb-4",size:"sm",placeholder:"Search",prefix:e.jsx(we,{className:"text-lg"}),onChange:p})});te.displayName="RolesTableSearch";const $e=()=>{const s=R(),n=j.useRef(null),a=b(t=>t.crmRoles.data.tableData),i=t=>{const d=v(a);d.query=t,d.pageIndex=1,typeof t=="string"&&t.length>1&&r(d),typeof t=="string"&&t.length===0&&r(d)},r=t=>{s(A(t)),s(k(t))},p=()=>{const t=v(a);t.query="",n.current&&(n.current.value=""),s(_({status:""})),r(t)},m=()=>{s(J()),s(K("ADD"))};return e.jsxs("div",{className:"md:flex items-center justify-between",children:[e.jsxs("div",{className:"md:flex items-center gap-4",children:[e.jsx(te,{ref:n,onInputChange:i}),e.jsx(ze,{})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx(E,{size:"sm",className:"me-2",onClick:p,children:"Clear All"}),e.jsx(E,{size:"sm",onClick:m,children:"Add New"})]})]})};oe("crmRoles",de);const it=()=>e.jsx(e.Fragment,{children:e.jsxs(re,{bodyClass:"h-full",children:[e.jsx($e,{}),e.jsx(Te,{})]})});export{it as default};
