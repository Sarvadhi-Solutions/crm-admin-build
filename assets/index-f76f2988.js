import{a as f,r as p,j as e,ah as oe,aq as re}from"./index-ba91c0fd.js";import{A as ne}from"./AdaptableCard-3bfc48fe.js";import{D as ie}from"./DataTable-e5657712.js";import{u as h,D as le,A as ce,f as me,a as de,e as ue,s as $,g as O,b as B,c as pe,d as V,t as K,h as ge,i as z,j as G,k as Q,r as he}from"./AdditionalTag-6cce442e.js";import{u as J}from"./useThemeClass-06f59d25.js";import{B as H}from"./Button-4d442f63.js";import{D as xe}from"./Drawer-f1cc950e.js";import{T as X}from"./index-af9b375a.js";import{a as y,F as fe}from"./FormItem-01999f29.js";import{u as Ce,b as w,F as je,a as be}from"./formik.esm-e5286689.js";import{c as ye,a as M,d as we,e as Ne}from"./index.esm-34e21a5e.js";import{t as A,N as k}from"./toast-b9105828.js";import{I as N}from"./Input-529114bc.js";import{Q as De,R as ve,S as Se,b as Te,d as Ie,o as Ae,C as ke}from"./index.esm-55e99400.js";import{b as Fe}from"./index.esm-7ccba11f.js";import{b as Le,c as Me,T as Re}from"./index.esm-d714fba5.js";/* empty css              */import{a as Ee,c as Oe}from"./tagAndCategory-228f57e7.js";import{c as E}from"./cloneDeep-641ee2c7.js";import{T as qe}from"./TagsList-93c3b92a.js";import{u as P}from"./checkEditUpdate-c80a1265.js";import{C as ze}from"./ConfirmDialog-22f316d7.js";import{T as R}from"./TextTruncate-c2f805d1.js";import{d as Be}from"./debounce-97eb29be.js";import{S as He,c as $e}from"./Select-73b9b11b.js";import{B as Y}from"./Badge-ff5c7dc3.js";import{C as Ke}from"./Card-b0a5a7d6.js";import{A as Pe}from"./index-e15db965.js";import{M as Ve}from"./MediaSkeleton-86854a39.js";import{N as Ue}from"./react-number-format.es-b5c5e730.js";import"./index-fe0659a6.js";import"./index.esm-1fe268c9.js";import"./Pagination-f4c26df7.js";import"./index-170572b2.js";import"./_baseIsEqual-ea007e01.js";import"./_MapCache-52b86039.js";import"./Views-e9280400.js";import"./get-86e63167.js";import"./toString-727d28b4.js";import"./Skeleton-83cb992f.js";import"./index-31253325.js";import"./Alert-5d4fd2a9.js";import"./useTimeout-80ea9231.js";import"./CloseButton-7e3ca34d.js";import"./StatusIcon-721e0795.js";import"./RangeCalendar-d6aa435b.js";import"./useControllableState-f5082273.js";import"./index-68178362.js";import"./useMergeRef-788c4cb0.js";import"./useRootClose-8f322f83.js";import"./usePopper-549b69fd.js";import"./TimeInput-6aa1e7b6.js";import"./useUniqueId-018c2565.js";import"./useDidUpdate-855f950c.js";import"./Dialog-c161d2fe.js";import"./index-9a9b01aa.js";import"./index-b648c4d1.js";import"./useUncertainRef-41d92c6b.js";import"./isNil-5f65db87.js";import"./index-8ea85167.js";import"./chainedFunction-070f832c.js";import"./index-ccd97808.js";import"./index-1c2b060b.js";import"./index-0bf35a02.js";import"./Progress-ab444eaf.js";import"./index-75ffb2be.js";import"./ScrollBar-1f3fb77b.js";import"./index-d176cad0.js";import"./index-2c4fd68d.js";import"./mapCloneElement-db46c91a.js";import"./Switcher-49168a68.js";import"./Tag-b9db9ffe.js";import"./index-60bed537.js";import"./index-a469d783.js";import"./Tooltip-d4e69970.js";import"./index.esm-5fbbd29b.js";import"./Upload-bbbb3749.js";import"./index.esm-e7d17c5f.js";import"./CrmService-46d16590.js";import"./_getPrototype-17f2df3f.js";import"./slicedToArray-558a0a0c.js";import"./objectWithoutProperties-8809bfcf.js";import"./toConsumableArray-5585411f.js";import"./floating-ui.dom-bef9cea3.js";const We=a=>{const{touched:s,errors:t}=a,o=f(),[i,n]=p.useState(!1);p.useState("#808080");const[m,d]=p.useState(!1),[c,x]=p.useState([]),[F,C]=p.useState([]),D=()=>{n(!i),d(!1)},[v,S]=p.useState("");p.useEffect(()=>{(async()=>{var q,U;try{const{payload:T}=await o(me());console.log(T,"send Me The Id And The Payload");const L=(q=T==null?void 0:T.data)==null?void 0:q.find(I=>(I==null?void 0:I.moduleName)==="clients");if(S(L.id),L){const{payload:I}=await o(de({id:(U=L==null?void 0:L.id)==null?void 0:U.toString()})),se=Ee(I.data),ae=Oe(I.data);C(ae),x(se)}}catch(T){console.error("Error fetching module data:",T)}})()},[o]);const b=h(j=>j.crmCustomers.data.selectedCustomer),[u,l]=p.useState(b?b.tags||[]:[]),g=Ce(),r=j=>{console.log(j),l(j);const q=[j.value];g.setFieldValue("tagId",q)};return e.jsxs(e.Fragment,{children:[e.jsx(y,{label:"Client Name",invalid:t.clientName&&s.clientName,errorMessage:t.clientName,children:e.jsx(w,{type:"text",autoComplete:"off",name:"clientName",placeholder:"Client Name",component:N,prefix:e.jsx(De,{className:"text-xl"})})}),e.jsx(y,{label:"Contact Number",invalid:t.contactInfo&&s.contactInfo,errorMessage:t.contactInfo,children:e.jsx(w,{type:"text",autoComplete:"off",name:"contactInfo",placeholder:"Contact Number",component:N,prefix:e.jsx(ve,{className:"text-xl"})})}),e.jsx(y,{label:"Address",invalid:t.address&&s.address,errorMessage:t.address,children:e.jsx(w,{type:"text",autoComplete:"off",name:"address",placeholder:"Address",component:N,prefix:e.jsx(Se,{className:"text-xl"})})}),e.jsx(y,{label:"Billing Details",invalid:t.billingDetails&&s.billingDetails,errorMessage:t.billingDetails,children:e.jsx(w,{type:"text",autoComplete:"off",name:"billingDetails",placeholder:"Billing Details",component:N,prefix:e.jsx(Le,{className:"text-xl"})})}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx(y,{label:"Tags",invalid:t.history&&s.history,errorMessage:t.history,children:e.jsxs("div",{style:{position:"relative"},children:[e.jsx(w,{name:"Tag",component:le,options:c,placeholder:"Select a Tag",value:g.initialValues.tagName,onChange:r}),e.jsx(Me,{style:{position:"absolute",right:"10px",top:"10px",border:"none",background:"#FFF"},className:"text-xl",onClick:()=>{D(),d(!0)}})]})}),e.jsx(ce,{isOpen:i,moduleName:v,categoryList:F,onOpenChange:j=>n(j)})]}),e.jsx(y,{label:"History",invalid:t.history&&s.history,errorMessage:t.history,children:e.jsx(w,{type:"text",autoComplete:"off",name:"history",placeholder:"History",component:N,prefix:e.jsx(Fe,{className:"text-xl"})})}),e.jsx(y,{label:"Notes",invalid:t.notes&&s.notes,errorMessage:t.notes,children:e.jsx(w,{textArea:!0,type:"text",autoComplete:"off",name:"notes",placeholder:"Notes",component:N,prefix:e.jsx(Re,{className:"text-xl"})})})]})},_e=ye().shape({clientName:M().required("Customer Name is required"),contactInfo:we().typeError("Contact must be a number").required("Contact is required").test("is-number","Contact must be a number",a=>!isNaN(a)).test("is-ten-digits","Contact must be exactly 10 digits",a=>/^\d{10}$/.test(a)),address:M().required("Address is required"),billingDetails:M().required("Billing Details is required"),history:M(),notes:M(),tagId:Ne()}),{TabNav:Ge,TabList:Qe,TabContent:Je}=X,Z=p.forwardRef((a,s)=>{var n,m,d;const t=h(c=>c.crmCustomers.data.selectedCustomer),o=!!t.id,i=f();return e.jsx(je,{innerRef:s,initialValues:{clientName:(t==null?void 0:t.clientName)||"",contactInfo:(t==null?void 0:t.contactInfo)||"",address:(t==null?void 0:t.address)||"",billingDetails:(t==null?void 0:t.billingDetails)||"",history:(t==null?void 0:t.history)||"",notes:(t==null?void 0:t.notes)||"",tagName:((m=(n=t==null?void 0:t.tags)==null?void 0:n[0])==null?void 0:m.tagName)||"",tagId:((d=t==null?void 0:t.tags)==null?void 0:d.map(c=>c.id))||[],colorName:t!=null&&t.tags&&(t==null?void 0:t.tags.length)>0?t==null?void 0:t.tags[0].colorName:""},validationSchema:_e,onSubmit:async(c,{setSubmitting:x})=>{var v,S,b,u,l,g;const{colorName:F,tagName:C,...D}=c;if(o){const r=await i(ue({customerId:(t==null?void 0:t.id)||"",updatedData:D}));(v=r==null?void 0:r.payload)!=null&&v.success?A.push(e.jsx(k,{title:"Successfully Added",type:"success",duration:2500,children:(S=r==null?void 0:r.payload)==null?void 0:S.message}),{placement:"top-end"}):A.push(e.jsx(k,{title:"Something went wrong !!!",type:"danger",duration:2500,children:(b=r==null?void 0:r.error)==null?void 0:b.message}),{placement:"top-end"}),i($()),await i(O()),await i(B())}else{const r=await i(pe(D));(u=r==null?void 0:r.payload)!=null&&u.success?A.push(e.jsx(k,{title:"Successfully Added",type:"success",duration:2500,children:(l=r==null?void 0:r.payload)==null?void 0:l.message}),{placement:"top-end"}):A.push(e.jsx(k,{title:"Something went wrong !!!",type:"danger",duration:2500,children:(g=r==null?void 0:r.error)==null?void 0:g.message}),{placement:"top-end"}),await i(O()),await i($()),await i(B())}x(!1)},children:({touched:c,errors:x})=>e.jsx(be,{children:e.jsx(fe,{children:e.jsxs(X,{defaultValue:"customerInfo",children:[e.jsx(Qe,{children:e.jsx(Ge,{value:"customerInfo",children:"Client Details"})}),e.jsx("div",{className:"p-6",children:e.jsx(Je,{value:"customerInfo",children:e.jsx(We,{touched:c,errors:x})})})]})})})})});Z.displayName="CustomerForm";const ee=p.forwardRef((a,s)=>{f();const t=h(i=>i.crmCustomers.data.selectedCustomer);h(i=>i.crmCustomers.data.customerList);const o=async i=>{};return e.jsx(Z,{ref:s,customer:t,onFormSubmit:o})});ee.displayName="CustomerEditContent";const Xe=({onSaveClick:a,onCancel:s})=>e.jsxs("div",{className:"text-right w-full",children:[e.jsx(H,{size:"sm",className:"mr-2",onClick:s,children:"Cancel"}),e.jsx(H,{size:"sm",variant:"solid",onClick:a,children:"Save"})]}),Ye=()=>{const a=f(),s=h(n=>n.crmCustomers.data.drawerOpen),t=()=>{a($()),a(V({}))},o=p.useRef(null),i=()=>{var n,m;console.log("formSubmit function called",(n=o.current)==null?void 0:n.values),(m=o.current)==null||m.submitForm()};return e.jsx(xe,{isOpen:s,closable:!1,bodyClass:"p-0",footer:e.jsx(Xe,{onCancel:t,onSaveClick:i}),onClose:t,onRequestClose:t,children:e.jsx(ee,{ref:o})})},Ze=()=>{const a=f(),s=h(n=>n.crmCustomers.data.deleteConfirmation),t=h(n=>n.crmCustomers.data.selectedCustomer),o=()=>{a(K(!1))},i=async()=>{var m,d,c;a(K(!1));const n=await a(ge(t.id));(m=n==null?void 0:n.payload)!=null&&m.success?A.push(e.jsx(k,{title:"Successfuly Deleted",type:"success",duration:2500,children:(d=n==null?void 0:n.payload)==null?void 0:d.message}),{placement:"top-end"}):A.push(e.jsx(k,{title:"Something Went Wrong !!!",type:"danger",duration:2500,children:(c=n==null?void 0:n.error)==null?void 0:c.message}),{placement:"top-end"}),await a(O()),await a(B())};return e.jsx(ze,{isOpen:s,type:"danger",title:"Delete Client",confirmButtonColor:"red-600",onClose:o,onRequestClose:o,onCancel:o,onConfirm:i,children:e.jsx("p",{children:"Are you sure you want to delete this client? All record related to this client will be deleted as well. This action cannot be undone."})})},et=({row:a})=>{const{textTheme:s}=J(),t=f(),o=()=>{t(G()),t(V(a))};return e.jsx("div",{className:`${s} cursor-pointer select-none font-semibold`,onClick:o,children:"Edit"})},tt=({row:a})=>{const{textTheme:s}=J(),t=f(),o=async()=>{await t(V(a)),t(K(!0))};return e.jsx("div",{className:`${s} cursor-pointer select-none font-semibold text-red-500`,onClick:o,children:"Delete"})},st=()=>{const a=f(),s=h(u=>u.crmCustomers.data.displayedCustomersList),t=h(u=>u.crmCustomers.data.loading),o=P("clients","canModify"),i=P("clients","canDelete");h(u=>u.crmCustomers.data.filterData);const{pageIndex:n,pageSize:m,sort:d,query:c,total:x}=h(u=>u.crmCustomers.data.tableData),F=p.useCallback(()=>{a(O())},[a]);p.useEffect(()=>{F()},[F]);const C=p.useMemo(()=>({pageIndex:n,pageSize:m,sort:d,query:c,total:x}),[n,m,d,c,x]),D=p.useMemo(()=>{const u=[{header:"Clients Name",accessorKey:"clientName",cell:l=>{var r;const g=(r=l.row.original)==null?void 0:r.clientName;return e.jsx(R,{text:g,maxLength:20})}},{header:"Clients Number",accessorKey:"contactInfo",cell:l=>l.row.original.contactInfo},{header:"Address",accessorKey:"address",cell:l=>{var r;const g=(r=l.row.original)==null?void 0:r.address;return e.jsx(R,{text:g,maxLength:20})}},{header:"Billing Details",accessorKey:"billingDetails",cell:l=>{var r;const g=(r=l.row.original)==null?void 0:r.billingDetails;return e.jsx(R,{text:g,maxLength:20})}},{header:"History",accessorKey:"history",cell:l=>{var r;const g=(r=l.row.original)==null?void 0:r.history;return e.jsx(R,{text:g,maxLength:20})}},{header:"Notes",accessorKey:"notes",cell:l=>{var r;const g=(r=l.row.original)==null?void 0:r.notes;return e.jsx(R,{text:g,maxLength:20})}},{header:"Tag Name",accessorKey:"tagName",cell:l=>{var r;const g=((r=l.row.original)==null?void 0:r.tags)||[];return e.jsx(qe,{tags:g})}}];return i&&u.unshift({header:"Delete",id:"action",cell:l=>e.jsx(tt,{row:l.row.original})}),o&&u.unshift({header:"Edit",id:"action",cell:l=>e.jsx(et,{row:l.row.original})}),u},[o,i]),v=u=>{const l=E(C);l.pageIndex=u,a(z(l))},S=u=>{const l=E(C);l.pageSize=Number(u),l.pageIndex=1,a(z(l))},b=u=>{const l=E(C);l.sort=u,a(z(l))};return e.jsxs("div",{children:[e.jsx(ie,{columns:D,data:s,skeletonAvatarColumns:[0],skeletonAvatarProps:{width:28,height:28},loading:t,pagingData:{total:C.total,pageIndex:C.pageIndex,pageSize:C.pageSize},onPaginationChange:v,onSelectChange:S,onSort:b}),e.jsx(Ye,{}),e.jsx(Ze,{})]})},te=p.forwardRef((a,s)=>{const{onInputChange:t}=a,o=Be(i,500);function i(m){t==null||t(m)}const n=m=>{o(m.target.value)};return e.jsx(N,{ref:s,className:"max-w-md md:w-52 mb-4",size:"sm",placeholder:"Search",prefix:e.jsx(Te,{className:"text-lg"}),onChange:n})});te.displayName="CustomerTableSearch";const{Control:at}=$e,W=[{value:"",label:"All",color:"bg-gray-500"},{value:"active",label:"Active",color:"bg-emerald-500"},{value:"blocked",label:"Blocked",color:"bg-red-500"}],ot=({innerProps:a,label:s,data:t,isSelected:o})=>e.jsxs("div",{className:`flex items-center justify-between p-2 cursor-pointer ${o?"bg-gray-100 dark:bg-gray-500":"hover:bg-gray-50 dark:hover:bg-gray-600"}`,...a,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{innerClass:t.color}),e.jsx("span",{children:s})]}),o&&e.jsx(Ie,{className:"text-emerald-500 text-xl"})]}),rt=({children:a,...s})=>{const t=s.getValue()[0];return e.jsxs(at,{...s,children:[t&&e.jsx(Y,{className:"ltr:ml-4 rtl:mr-4",innerClass:t.color}),a]})},nt=()=>{const a=f(),{status:s}=h(o=>o.crmCustomers.data.filterData),t=o=>{a(Q({status:o==null?void 0:o.value}))};return e.jsx(He,{options:W,size:"sm",className:"mb-4 min-w-[130px]",components:{Option:ot,Control:rt},value:W.filter(o=>o.value===s),onChange:t})},it=()=>{const a=f(),s=p.useRef(null),t=h(c=>c.crmCustomers.data.tableData),o=P("clients","canCreate"),i=c=>{const x=E(t);x.query=c,x.pageIndex=1,typeof c=="string"&&c.length>1&&n(x),typeof c=="string"&&c.length===0&&n(x)},n=c=>{a(z(c)),a(O())},m=()=>{const c=E(t);c.query="",s.current&&(s.current.value=""),a(Q({status:""})),n(c)},d=()=>{a(G())};return e.jsxs("div",{className:"md:flex items-center justify-between",children:[e.jsxs("div",{className:"md:flex items-center gap-4",children:[e.jsx(te,{ref:s,onInputChange:i}),e.jsx(nt,{})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx(H,{size:"sm",className:"me-2",onClick:m,children:"Clear All"}),o&&e.jsx(H,{size:"sm",onClick:d,children:"Add New"})]})]})},_=a=>{const{icon:s,avatarClass:t,label:o,value:i,growthRate:n,loading:m}=a,d=55;return e.jsx(Ke,{bordered:!0,children:e.jsx(oe,{loading:m,customLoader:e.jsx(Ve,{avatarProps:{className:"rounded",width:d,height:d}}),children:e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Pe,{className:t,size:d,icon:s}),e.jsxs("div",{children:[e.jsx("span",{children:o}),e.jsx("h3",{children:e.jsx(Ue,{thousandSeparator:!0,displayType:"text",value:i})})]})]})})})})},lt=()=>{var o,i,n,m;const a=f(),s=h(d=>d.crmCustomers.data.statisticData);console.log(s,"statisticData");const t=h(d=>d.crmCustomers.data.statisticLoading);return p.useEffect(()=>{a(B())},[]),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4 mb-6",children:[e.jsx(_,{icon:e.jsx(Ae,{}),avatarClass:"!bg-indigo-600",label:"Total Clients",value:(o=s==null?void 0:s.totalCustomers)==null?void 0:o.value,growthRate:(i=s==null?void 0:s.totalCustomers)==null?void 0:i.growShrink,loading:t}),e.jsx(_,{icon:e.jsx(ke,{}),avatarClass:"!bg-emerald-500",label:"This Week's New Clients",value:(n=s==null?void 0:s.newCustomers)==null?void 0:n.value,growthRate:(m=s==null?void 0:s.newCustomers)==null?void 0:m.growShrink,loading:t})]})};re("crmCustomers",he);const ct=()=>e.jsxs(e.Fragment,{children:[e.jsx(lt,{}),e.jsxs(ne,{bodyClass:"h-full",children:[e.jsx(it,{}),e.jsx(st,{})]})]}),Hs=ct;export{Hs as default};
