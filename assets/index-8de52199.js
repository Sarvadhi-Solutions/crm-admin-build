import{r as p,i as O,j as e,am as T,an as P,ao as _,ap as $,al as M,ah as K,aq as Y,a as G}from"./index-dd430329.js";import{a as V,b as q,c as F}from"./CrmService-01e274f6.js";import{C as v}from"./Card-7303f1d6.js";import{B}from"./Badge-81ec6aad.js";import{_ as J,C as g}from"./chart.constant-b89d4d9a.js";import{a as A,b as H,c as Q,d as U,e as X}from"./GrowShrinkTag-7614f549.js";import"./Alert-40c008c9.js";import"./index-1bec26b5.js";import{B as I}from"./Button-477f78d2.js";import"./RangeCalendar-c7dd44b3.js";import"./index-4953df19.js";import"./index-e8664bdc.js";import"./Dialog-4e683d85.js";import"./Drawer-851dfb0e.js";import"./index-273b73f2.js";import"./FormItem-c5d9f12d.js";import"./toString-45c45754.js";import"./Input-2ae5f21f.js";import"./index-ad4d109a.js";import"./index-1e6ea035.js";import"./index-5ad45768.js";import"./toast-7520b143.js";import"./Pagination-a183170a.js";import"./Progress-65bff4d5.js";import"./index-9685374c.js";import"./ScrollBar-efe95462.js";import{S as u}from"./index-a7fee107.js";import"./Select-a638e837.js";import"./Skeleton-0435d2db.js";import"./index-0bd5fcc8.js";import"./Switcher-46a64a8e.js";import"./index-03531cf7.js";import"./index-f4b545fd.js";import"./Tag-a01d1848.js";import"./index-c88fea13.js";import"./index-f57ef06e.js";import{T as Z}from"./Tooltip-4f6c910c.js";import"./Upload-79efa750.js";import{i as ee}from"./Views-969b82ff.js";import{D as E}from"./DataTable-b28d1e98.js";import"./react-tooltip.min-90b0da4a.js";import"./RichTextEditor-ab8d719f.js";import"./SegmentItemOption-4eb9f4d2.js";import"./SvgIcon-0e5d590b.js";import{S as w}from"./StatusCapsule-688bd207.js";import{T as y}from"./TextTruncate-104140ac.js";import{h as se}from"./moment-fbc5633a.js";import"./index.esm-8a75a52d.js";import"./useTimeout-8cc7d1d0.js";import"./CloseButton-be129446.js";import"./StatusIcon-1c9455ce.js";import"./useMergeRef-788c4cb0.js";import"./useControllableState-3d893585.js";import"./cloneDeep-7dd50aa7.js";import"./_MapCache-787d0444.js";import"./_getPrototype-a234e5e0.js";import"./_baseIsEqual-da2ece8d.js";import"./get-f4ce3646.js";import"./useRootClose-c59d452a.js";import"./usePopper-ad874619.js";import"./TimeInput-d81057f6.js";import"./useUniqueId-abd97dae.js";import"./useDidUpdate-0f1ffc2f.js";import"./index-ab79e894.js";import"./useUncertainRef-b3ab91cc.js";import"./isNil-ba5dd027.js";import"./index-59261ffa.js";import"./chainedFunction-070f832c.js";import"./slicedToArray-2ef3e469.js";import"./objectWithoutProperties-8809bfcf.js";import"./toConsumableArray-7a029c07.js";import"./floating-ui.dom-4bc0055b.js";import"./mapCloneElement-c4c40043.js";import"./index.esm-cdf5a269.js";import"./index.esm-075cf0f7.js";import"./index.esm-7dc546a5.js";import"./index-387d3e60.js";import"./useThemeClass-c67d9527.js";const R=["line","bar","area"],z=o=>{const{series:a=[],width:l="100%",height:s=300,xAxis:n,customOptions:d,type:i="line",direction:r,donutTitle:t,donutText:c,className:m,...x}=o,D=p.useRef(null),W=p.useMemo(()=>{switch(i){case"line":return A;case"bar":return X;case"area":return U;case"donut":return Q;case"radialBar":return H;default:return A}},[i]);let f=JSON.parse(JSON.stringify(W));const L=window.innerWidth<768,S=p.useCallback(()=>{if(D.current){const b=D.current.querySelectorAll("div.apexcharts-legend")[0];r===O&&(b.style.right="auto",b.style.left="0"),L&&(b.style.position="relative",b.style.top="0",b.style.justifyContent="start",b.style.padding="0")}},[r,L]);return p.useEffect(()=>{R.includes(i)&&S()},[i,S]),R.includes(i)&&(f.xaxis.categories=n),d&&(f={...f,...d}),i==="donut"&&(t&&(f.plotOptions.pie.donut.labels.total.label=t),c&&(f.plotOptions.pie.donut.labels.total.formatter=()=>c)),e.jsx("div",{ref:D,style:r===O?{direction:"ltr"}:{},className:"chartRef",children:e.jsx(J,{options:f,type:i,series:a,width:l,height:s,className:m,...x})})},te={totalLeads:0,leadsCreated:{day:0,week:0,month:0},convertedInDeal:{day:0,week:0,month:0},convertedPercentage:{day:"0.00 %",week:"00.00 %",month:"00.00 %"}},ae="crmDashboard",C=T("crmDashboard/data/dashboard",async()=>(await V()).data),k=T("crmDashboard/data/dashboard/tasks",async()=>(await q()).data),N=T("crmDashboard/data/getLeadsAndDealChart",async()=>(await F()).data),re={loading:!0,dashboardData:{},tasksChartData:{},convertedLeadDeal:te},oe=P({name:`${ae}/state`,initialState:re,reducers:{},extraReducers:o=>{o.addCase(C.fulfilled,(a,l)=>{a.dashboardData=l.payload.crmDashboardData,a.loading=!1}).addCase(C.pending,a=>{a.loading=!0}).addCase(k.fulfilled,(a,l)=>{a.loading=!1,a.tasksChartData.chart=l.payload.data}).addCase(k.pending,a=>{a.loading=!0}).addCase(N.fulfilled,(a,l)=>{a.convertedLeadDeal=l.payload.data,a.loading=!1}).addCase(N.pending,(a,l)=>{a.loading=!0})}}),ie=oe.reducer,ne=_({data:ie}),h=$,le=({data:o={leadsCreated:{},convertedInDeal:{}}})=>{var n,d;const[a,l]=p.useState("week"),s=p.useMemo(()=>{if(o!=null&&o.leadsCreated)return{series:[o==null?void 0:o.leadsCreated[a],o==null?void 0:o.convertedInDeal[a]],labels:["Leads","Converted Deal"]}},[o,a]);return e.jsxs(v,{children:[e.jsxs("div",{className:"flex sm:flex-row flex-col md:items-center justify-between mb-6 gap-4",children:[e.jsx("h4",{children:"Leads Overview"}),e.jsxs(u,{value:a,size:"sm",onChange:i=>l(i),children:[e.jsx(u.Item,{value:"month",children:"Monthly"}),e.jsx(u.Item,{value:"week",children:"Weekly"}),e.jsx(u.Item,{value:"day",children:"Daily"})]})]}),e.jsx("div",{className:"mt-6",children:(s==null?void 0:s.series)&&e.jsxs(e.Fragment,{children:[e.jsx(z,{donutTitle:`${s==null?void 0:s.series.reduce((i,r)=>i+r,0)}`,donutText:"Leads",series:s==null?void 0:s.series,customOptions:{labels:s==null?void 0:s.labels,colors:g,stroke:{lineCap:"round"},plotOptions:{radialBar:{dataLabels:{name:{show:!0,fontSize:"12px",fontWeight:600,color:g[0]},value:{show:!0,fontSize:"12px",fontWeight:400,color:g[0],formatter:function(i){return i+""}},total:{show:!0,label:"Total",formatter:function(i){var r;return((r=i==null?void 0:i.globals)==null?void 0:r.seriesTotals[0])||0}}}}}},type:"radialBar"}),((n=s==null?void 0:s.series)==null?void 0:n.length)===((d=s==null?void 0:s.labels)==null?void 0:d.length)&&e.jsx("div",{className:"mt-6 grid grid-cols-2 gap-4 w-[70%] mx-auto",children:s.labels.map((i,r)=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(B,{badgeStyle:{backgroundColor:g[r]}}),e.jsx("span",{className:"font-medium whitespace-nowrap",children:i})]},i))})]})})]})},ce=({data:o=[],className:a})=>{const l=M(),s=()=>{l("/app/crm/leads")},n=h(i=>{i.crmDashboard.data.loading}),d=p.useMemo(()=>[{header:"Associated Contact",accessorKey:"associatedContact",cell:r=>{var m;const t=(m=r.row.original)==null?void 0:m.contactData;return t?t.firstName+" "+t.lastName:"-"}},{header:"Title",accessorKey:"title",cell:r=>{const t=r.row.original;return e.jsx(y,{text:t.title,maxLength:30})}},{header:"Budget",accessorKey:"budget",cell:r=>r.row.original.budget},{header:"status",accessorKey:"status",cell:r=>{const t=r.row.original;return e.jsx(w,{status:t.status})}}],[]);return console.log({data:o}),e.jsxs(v,{className:a,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{children:"Leads"}),e.jsx(I,{size:"sm",onClick:s,children:"View All Leads"})]}),e.jsx(E,{columns:d,data:o,skeletonAvatarColumns:[0],skeletonAvatarProps:{width:28,height:28},loading:n,isPagination:!1})]})},j=({label:o,value:a,badgeClass:l,showBadge:s=!0})=>e.jsxs("div",{className:"flex gap-2",children:[s&&e.jsx(B,{className:"mt-2.5",innerClass:l}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-bold",children:a}),e.jsx("p",{children:o})]})]}),de=({className:o})=>{var r,t,c;const[a,l]=p.useState(["weekly"]),s=h(m=>m.crmDashboard.data.tasksChartData),[n,d]=p.useState(!1),i=h(m=>m.theme.layout.sideNavCollapse);return p.useEffect(()=>{d(!0);const m=setTimeout(()=>d(!1),300);return()=>{clearTimeout(m)}},[s,i]),e.jsxs(v,{className:o,children:[e.jsxs("div",{className:"flex sm:flex-row flex-col md:items-center justify-between mb-6 gap-4",children:[e.jsx("h4",{children:"Tasks Overview"}),e.jsxs(u,{value:a,size:"sm",onChange:m=>l(m),children:[e.jsx(u.Item,{value:"monthly",children:"Monthly"}),e.jsx(u.Item,{value:"weekly",children:"Weekly"}),e.jsx(u.Item,{value:"daily",children:"Daily"})]})]}),!ee(s)&&!n&&(s==null?void 0:s.chart)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{children:e.jsx(j,{showBadge:!1,label:"Total Tasks",value:s==null?void 0:s.chart[a[0]].total})}),e.jsxs("div",{className:"flex gap-x-6",children:[e.jsx(j,{badgeClass:"bg-emerald-500",label:(r=s==null?void 0:s.chart[a[0]].series[0])==null?void 0:r.name,value:s==null?void 0:s.chart[a[0]].completed}),e.jsx(j,{badgeClass:"bg-indigo-600",label:(t=s==null?void 0:s.chart[a[0]].series[1])==null?void 0:t.name,value:s==null?void 0:s.chart[a[0]].pending}),e.jsx(j,{badgeClass:"bg-amber-500",label:(c=s==null?void 0:s.chart[a[0]].series[2])==null?void 0:c.name,value:s==null?void 0:s.chart[a[0]].inProgress})]})]}),e.jsxs("div",{children:[e.jsx(z,{series:s==null?void 0:s.chart[a[0]].series,xAxis:s==null?void 0:s.chart[a[0]].range,type:"bar",customOptions:{colors:[g[2],g[0],g[3]],legend:{show:!1},plotOptions:{bar:{horizontal:!1,columnWidth:a[0]==="monthly"?"15px":"30px",borderRadius:2}}}}),e.jsx("div",{className:""})]})]}),e.jsx(K,{loading:n,type:"cover",children:n&&e.jsx("div",{className:"h-[300px]"})})]})},me=({data:o=[],className:a})=>{const l=M(),s=()=>{l("/app/crm/tasks")},n=h(i=>{i.crmDashboard.data.loading}),d=p.useMemo(()=>[{header:"Title",accessorKey:"title",cell:r=>{const t=r.row.original.title;return e.jsx(Z,{title:t,children:e.jsx(y,{text:t,maxLength:20})},t)}},{header:"Due Date",accessorKey:"dueDate",cell:r=>{var t;return se((t=r.row.original)==null?void 0:t.dueDate).format("DD MMMM YYYY")}},{header:"priority",accessorKey:"priority",cell:r=>{const t=r.row.original.priority;return e.jsx(w,{status:t})}},{header:"module",accessorKey:"module",cell:r=>{var c;const t=(c=r.row.original)==null?void 0:c.module;return t?e.jsx(y,{text:t,maxLength:20}):"-"}},{header:"type",accessorKey:"type",cell:r=>{var c;const t=(c=r.row.original)==null?void 0:c.type;return t?e.jsx(y,{text:t,maxLength:20}):"-"}},{header:"Assigned to",accessorKey:"assignedTo",cell:r=>{const{firstName:t,lastName:c}=r.row.original.assignedToData||{};return t&&c?`${t} ${c}`:"-"}},{header:"Connected lead",accessorKey:"connectedLead",cell:r=>{var c;const t=r.row.original||{};return t!=null&&t.leadModel?`${(c=t==null?void 0:t.leadModel)==null?void 0:c.title}`:"-"}},{header:"Status",accessorKey:"completionStatus",cell:r=>{const t=r.row.original.completionStatus;return e.jsx(w,{status:t})}}],[]);return e.jsxs(v,{className:a,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{children:"Today's Tasks"}),e.jsx(I,{size:"sm",onClick:s,children:"View All Tasks"})]}),e.jsx(E,{columns:d,data:o,skeletonAvatarColumns:[0],skeletonAvatarProps:{width:28,height:28},loading:n,isPagination:!1})]})};Y("crmDashboard",ne);const pe=()=>{const o=G(),{statisticData:a,recentLeadsData:l,todayTask:s}=h(t=>t.crmDashboard.data.dashboardData),n=h(t=>t.crmDashboard.data.leadsList),d=h(t=>t.crmDashboard.data.convertedLeadDeal),i=h(t=>t.crmDashboard.data.loading);p.useEffect(()=>{r()},[o]);const r=()=>{o(C()),o(k()),o(N())};return p.useMemo(()=>{const t=(n==null?void 0:n.filter(x=>x.status==="open").length)||0,c=(n==null?void 0:n.filter(x=>x.status==="closed_lost").length)||0,m=(n==null?void 0:n.filter(x=>x.status==="closed_won").length)||0;return{labels:["Open","Lost","Won"],data:[t,c,m]}},[n]),e.jsx("div",{className:"flex flex-col gap-4 h-full",children:e.jsxs(K,{loading:i,children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsx(de,{className:"col-span-2"}),e.jsx(le,{data:d})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsx(me,{data:s}),e.jsx(ce,{data:l})]})]})})},Es=pe;export{Es as default};
