import{a as v,r as w,j as e,u as ce,p as Se,ar as Ie}from"./index-7c10d2a3.js";import{D as Me}from"./DataTable-9505e436.js";import{u as fe}from"./useThemeClass-44058c3e.js";import{c as F}from"./cloneDeep-b9fa1e05.js";import{f as ke,u as R,p as he,s as V,a as Fe,b as B,c as Te,g as S,t as z,d as Ae,e as O,h as xe,i as ge,j as je,r as Ee}from"./index-0562906d.js";import{B as q}from"./Button-208b5861.js";import{D as Pe}from"./Drawer-f62ae817.js";import{i as Ve}from"./Views-5cb69e9a.js";import{a as ie,F as Oe}from"./FormItem-dcfd8ab9.js";import{T as ye}from"./index-5aafa10e.js";import{u as qe,b as me,F as ze,a as $e}from"./formik.esm-9efe14ff.js";import{c as be,a as Ce}from"./index.esm-a61d5a6d.js";import{I as we}from"./Input-81114df0.js";/* empty css              */import{a6 as Be,d as Le,b as Ue}from"./index.esm-d9298b40.js";import{S as Ye}from"./Switcher-08c2e9d8.js";import{p as T,q as A}from"./index.esm-8bc236a5.js";import{t as de,N as pe}from"./toast-1b1e93c9.js";import{C as He}from"./ConfirmDialog-cb7325f0.js";import{u as $}from"./checkEditUpdate-58567b5b.js";import{S as We,c as Je}from"./Select-013d671c.js";import{B as Re}from"./Badge-96f53043.js";import{d as Ke}from"./debounce-1dc8077b.js";import"./index-db1f8ae2.js";import"./Pagination-16369f4c.js";import"./index-7ee2fb06.js";import"./_Uint8Array-be229bd0.js";import"./_MapCache-e75dc2ce.js";import"./_baseIsEqual-47871e7b.js";import"./get-5a481960.js";import"./toString-18e1007d.js";import"./TableRowSkeleton-9a6a577f.js";import"./Skeleton-f2ce5fc2.js";import"./index-92fee75d.js";import"./_getPrototype-2f204ca7.js";import"./CrmService-d5e8e120.js";import"./context-0e2e9d1c.js";import"./index-72e63a8f.js";import"./CloseButton-7345a4c9.js";import"./index-be56d80d.js";import"./useControllableState-8172e3e5.js";import"./isNil-d3ca72b8.js";import"./useTimeout-6476564d.js";import"./StatusIcon-8f517345.js";import"./chainedFunction-070f832c.js";import"./index-e31e1427.js";import"./useMergeRef-788c4cb0.js";import"./Tooltip-6aa5489c.js";import"./usePopper-80f33697.js";import"./index.esm-db0614cf.js";import"./Dialog-ab50fc44.js";import"./slicedToArray-afe06b21.js";import"./objectWithoutProperties-8e2777d0.js";import"./objectWithoutPropertiesLoose-4f48578a.js";import"./extends-98964cd2.js";import"./toConsumableArray-2133173c.js";import"./floating-ui.dom-bef9cea3.js";const E=({value:s,onClick:r,greenIcon:a,grayIcon:t,canPermission:n})=>e.jsx("td",{className:"px-4 py-2 text-center",children:e.jsx("div",{className:`${n?" border-blue-600":" border-red-300"} rounded-full p-2 cursor-pointer flex justify-center items-center`,onClick:r,children:n?a:t})}),_e=s=>{const{roles:r,drawerMode:a,errors:t,touched:n}=s,o=v(),[m,c]=w.useState([]),[u,j]=w.useState([]),d=qe();w.useEffect(()=>{async function f(){var l;try{const h=await o(ke()),x=(l=h==null?void 0:h.payload)==null?void 0:l.data.map(g=>({masterId:g.id,canCreate:!1,canModify:!1,canView:!1,canDelete:!1,canManage:!1}));a==="Edit"&&r&&Array.isArray(r.rolePermissions)&&[...r.rolePermissions].sort((i,p)=>i.masterId-p.masterId).forEach(i=>{const p=x.findIndex(I=>I.masterId===i.masterId);p!==-1&&(x[p]=i)}),d.setFieldValue("modules",x),j(x),c(h.payload.data)}catch(h){console.error("Error fetching modules:",h)}}f()},[o]),be().shape({rolename:Ce().required("Role Name is required")});const N=(f,l,h,x)=>{const g=JSON.parse(JSON.stringify(d.values.modules));if(l!=="canManage")g[x][l]=h,g[x].canManage=g[x].canCreate&&g[x].canModify&&g[x].canView&&g[x].canDelete;else{const i={canManage:h,canCreate:h,canModify:h,canView:h,canDelete:h,masterId:f};g[x]=i}d.setFieldValue("modules",g)};return e.jsxs(e.Fragment,{children:[e.jsx(ie,{label:"Role Name",invalid:t.roleName&&n.roleName,errorMessage:t.roleName,children:e.jsx(me,{type:"text",autoComplete:"off",name:"roleName",placeholder:"Role Name",component:we,prefix:e.jsx(Be,{className:"text-xl"})})}),e.jsx(ie,{children:e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx("label",{className:"form-label",style:{marginRight:"10px"},children:"System Role"}),e.jsx(me,{autoComplete:"off",name:"isSystem",component:Ye,checked:d.values.isSystem})]})}),e.jsxs("table",{className:"w-full border-collapse ",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-200",children:[e.jsx("th",{className:"px-4 py-2 text-center",children:"Module"}),e.jsx("th",{className:"px-4 py-2 w-1/6 text-center",children:"All"}),e.jsx("th",{className:"px-4 py-2 w-1/6 text-center",children:"Read"}),e.jsx("th",{className:"px-4 py-2 w-1/6 text-center",children:"Write"}),e.jsx("th",{className:"px-4 py-2 w-1/6 text-center",children:"Update"}),e.jsx("th",{className:"px-4 py-2 w-1/6 text-center",children:"Delete"})]})}),e.jsx("tbody",{children:m==null?void 0:m.map((f,l)=>{var h,x,g,i,p,I,P,M,k,D,L,U,Y,H,W,J,K,_,G,Q,X,Z,ee,se,ae,te,oe,re,le,ne;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2 text-center",children:f==null?void 0:f.moduleName.toUpperCase()}),e.jsx(E,{value:(g=(x=(h=d.values)==null?void 0:h.modules)==null?void 0:x[l])==null?void 0:g.canManage,greenIcon:e.jsx(T,{className:"text-blue-600"}),grayIcon:e.jsx(A,{className:"text-red-500"}),canPermission:(I=(p=(i=d.values)==null?void 0:i.modules)==null?void 0:p[l])==null?void 0:I.canManage,onClick:()=>{var y,b,C;return N(f.id,"canManage",!((C=(b=(y=d.values)==null?void 0:y.modules)==null?void 0:b[l])!=null&&C.canManage),l)}}),e.jsx(E,{value:(k=(M=(P=d.values)==null?void 0:P.modules)==null?void 0:M[l])==null?void 0:k.canView,greenIcon:e.jsx(T,{className:"text-blue-600"}),grayIcon:e.jsx(A,{className:"text-red-500"}),canPermission:(U=(L=(D=d.values)==null?void 0:D.modules)==null?void 0:L[l])==null?void 0:U.canView,onClick:()=>{var y,b,C;return N(f.id,"canView",!((C=(b=(y=d.values)==null?void 0:y.modules)==null?void 0:b[l])!=null&&C.canView),l)}}),e.jsx(E,{value:(W=(H=(Y=d.values)==null?void 0:Y.modules)==null?void 0:H[l])==null?void 0:W.canCreate,greenIcon:e.jsx(T,{className:"text-blue-600"}),grayIcon:e.jsx(A,{className:"text-red-500"}),canPermission:(_=(K=(J=d.values)==null?void 0:J.modules)==null?void 0:K[l])==null?void 0:_.canCreate,onClick:()=>{var y,b,C;return N(f.id,"canCreate",!((C=(b=(y=d.values)==null?void 0:y.modules)==null?void 0:b[l])!=null&&C.canCreate),l)}}),e.jsx(E,{value:(X=(Q=(G=d.values)==null?void 0:G.modules)==null?void 0:Q[l])==null?void 0:X.canModify,greenIcon:e.jsx(T,{className:"text-blue-600"}),grayIcon:e.jsx(A,{className:"text-red-500"}),canPermission:(se=(ee=(Z=d.values)==null?void 0:Z.modules)==null?void 0:ee[l])==null?void 0:se.canModify,onClick:()=>{var y,b,C;return N(f.id,"canModify",!((C=(b=(y=d.values)==null?void 0:y.modules)==null?void 0:b[l])!=null&&C.canModify),l)}}),e.jsx(E,{value:(oe=(te=(ae=d.values)==null?void 0:ae.modules)==null?void 0:te[l])==null?void 0:oe.canDelete,greenIcon:e.jsx(T,{className:"text-blue-600"}),grayIcon:e.jsx(A,{className:"text-red-500"}),canPermission:(ne=(le=(re=d.values)==null?void 0:re.modules)==null?void 0:le[l])==null?void 0:ne.canDelete,onClick:()=>{var y,b,C;return N(f.id,"canDelete",!((C=(b=(y=d.values)==null?void 0:y.modules)==null?void 0:b[l])!=null&&C.canDelete),l)}})]},l)})})]})]})},Ge=be().shape({rolename:Ce().required("Role Name is required")}),{TabNav:Qe,TabList:Xe,TabContent:Ze}=ye,Ne=w.forwardRef((s,r)=>{const[a,t]=w.useState([]);v();const n=ce(m=>m.crmRoles.data.selectedRole),o=ce(m=>m.crmRoles.data.drawerMode);return e.jsx(ze,{innerRef:r,initialValues:{roleName:o==="Edit"&&(n==null?void 0:n.roleName)||"",isSystem:o==="Edit"&&(n==null?void 0:n.isSystem)||!1,isDefault:(n==null?void 0:n.isDefault)||!1,modules:a},validationSchema:Ge,onSubmit:(m,{setSubmitting:c})=>{console.log("on submit called "),c(!1)},children:({touched:m,errors:c})=>e.jsx($e,{children:e.jsx(Oe,{children:e.jsxs(ye,{defaultValue:"roles",children:[e.jsx(Xe,{children:e.jsx(Qe,{value:"roles",children:"Role Form"})}),e.jsx("div",{className:"p-6",children:e.jsx(Ze,{value:"roles",children:e.jsx(_e,{touched:m,errors:c,roles:n,drawerMode:o})})})]})})})})});Ne.displayName="RolesForm";const De=w.forwardRef((s,r)=>{const a=v(),t=R(c=>c.crmRoles.data.selectedRole),n=R(c=>c.crmRoles.data.rolesList),{id:o}=t,m=c=>{const{name:u,birthday:j,email:d,img:N,location:f,title:l,phoneNumber:h,facebook:x,twitter:g,pinterest:i,linkedIn:p}=c,I={name:u,email:d,img:N},P={location:f,title:l,birthday:Se(j).format("DD/MM/YYYY"),phoneNumber:h,facebook:x,twitter:g,pinterest:i,linkedIn:p};let M=F(n),k={};M=M.map(D=>(D.id===o&&(D={...D,...I},D.personalInfo={...D.personalInfo,...P},k=D),D)),Ve(k)||a(he(k)),a(V()),a(Fe(M))};return e.jsx(Ne,{ref:r,roles:t,onFormSubmit:m})});De.displayName="RolesEditContent";const es=({onSaveClick:s,onCancel:r})=>e.jsxs("div",{className:"text-right w-full",children:[e.jsx(q,{size:"sm",className:"mr-2",onClick:r,children:"Cancel"}),e.jsx(q,{size:"sm",variant:"solid",onClick:s,children:"Save"})]}),ss=()=>{const s=v(),r=R(c=>c.crmRoles.data.drawerOpen),a=R(c=>c.crmRoles.data.drawerMode),t=R(c=>c.crmRoles.data.selectedRole),n=()=>{s(V()),s(B({}))},o=w.useRef(null),m=async()=>{var u,j;const c=(u=o.current)==null?void 0:u.values;if(a==="ADD"){const d=await s(Te(c));console.log(d,"response"),await s(V()),await s(S())}else{const d=t.id,N=await s(he({id:d,data:c}));console.log(N,"response"),await s(V()),await s(S())}(j=o.current)==null||j.submitForm()};return e.jsx(Pe,{isOpen:r,closable:!1,bodyClass:"p-0",footer:e.jsx(es,{onCancel:n,onSaveClick:m}),width:600,onClose:n,onRequestClose:n,children:e.jsx(De,{ref:o})})},as=()=>{const s=v(),r=R(o=>o.crmRoles.data.deleteConfirmation),a=R(o=>o.crmRoles.data.selectedRole),t=()=>{s(z(!1))},n=async()=>{var m,c,u;s(z(!1)),console.log(a,"selectedRole");const o=await s(Ae(a.id));await s(S()),(m=o==null?void 0:o.payload)!=null&&m.success?(de.push(e.jsx(pe,{title:"Successfuly Deleted",type:"success",duration:2500,children:(c=o==null?void 0:o.payload)==null?void 0:c.message}),{placement:"top-center"}),await s(S())):(de.push(e.jsx(pe,{title:"Something Went Wrong !!!",type:"danger",duration:2500,children:(u=o==null?void 0:o.payload)==null?void 0:u.message}),{placement:"top-center"}),await s(S()))};return e.jsx(He,{isOpen:r,type:"danger",title:"Delete Role",confirmButtonColor:"red-600",onClose:t,onRequestClose:t,onCancel:t,onConfirm:n,children:e.jsx("p",{children:"Are you sure you want to delete this role? All record related to this role will be deleted as well. This action cannot be undone."})})},ts=({row:s})=>{const{textTheme:r}=fe(),a=v(),t=()=>{a(xe()),a(B(s)),a(ge("Edit"))};return e.jsx("div",{className:`${r} cursor-pointer select-none font-semibold`,onClick:t,children:"Edit"})},os=({row:s})=>{const{textTheme:r}=fe(),a=v(),t=async()=>{await a(B(s)),a(z(!0))};return e.jsx("div",{className:`${r} cursor-pointer select-none font-semibold text-red-500`,onClick:t,children:"Delete"})},rs=()=>{const s=v(),r=R(i=>i.crmRoles.data.rolesList),a=R(i=>i.crmRoles.data.loading),t=R(i=>i.crmRoles.data.filterData),n=$("roles","canModify"),o=$("roles","canDelete"),{pageIndex:m,pageSize:c,sort:u,query:j,total:d}=R(i=>i.crmRoles.data.tableData),N=w.useCallback(()=>{s(S())},[m,c,u,j,t,s]);w.useEffect(()=>{N()},[N,m,c,u,t]);const f=w.useMemo(()=>({pageIndex:m,pageSize:c,sort:u,query:j,total:d}),[m,c,u,j,d]),l=w.useMemo(()=>{const i=[{header:"Role Name",accessorKey:"roleName",cell:p=>p.row.original.roleName},{header:"System",accessorKey:"isSystem",cell:p=>p.row.original.isSystem.toString()}];return o&&i.unshift({header:"Delete",id:"delete",cell:p=>e.jsx(os,{row:p.row.original})}),n&&i.unshift({header:"Edit",id:"action",cell:p=>e.jsx(ts,{row:p.row.original})}),i},[n,o]),h=i=>{const p=F(f);p.pageIndex=i,s(O(p))},x=i=>{const p=F(f);p.pageSize=Number(i),p.pageIndex=1,s(O(p))},g=i=>{const p=F(f);p.sort=i,s(O(p))};return e.jsxs("div",{children:[e.jsx(Me,{columns:l,data:r,skeletonAvatarColumns:[0],skeletonAvatarProps:{width:28,height:28},loading:a,pagingData:{total:f.total,pageIndex:f.pageIndex,pageSize:f.pageSize},onPaginationChange:h,onSelectChange:x,onSort:g}),e.jsx(ss,{}),e.jsx(as,{})]})},{Control:ls}=Je,ue=[{value:"",label:"All",color:"bg-gray-500"},{value:"active",label:"Active",color:"bg-emerald-500"},{value:"blocked",label:"Blocked",color:"bg-red-500"}],ns=({innerProps:s,label:r,data:a,isSelected:t})=>e.jsxs("div",{className:`flex items-center justify-between p-2 cursor-pointer ${t?"bg-gray-100 dark:bg-gray-500":"hover:bg-gray-50 dark:hover:bg-gray-600"}`,...s,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{innerClass:a.color}),e.jsx("span",{children:r})]}),t&&e.jsx(Le,{className:"text-emerald-500 text-xl"})]}),cs=({children:s,...r})=>{const a=r.getValue()[0];return e.jsxs(ls,{...r,children:[a&&e.jsx(Re,{className:"ltr:ml-4 rtl:mr-4",innerClass:a.color}),s]})},is=()=>{const s=v(),{status:r}=R(t=>t.crmRoles.data.filterData),a=t=>{s(je({status:t==null?void 0:t.value}))};return e.jsx(We,{options:ue,size:"sm",className:"mb-4 min-w-[130px]",components:{Option:ns,Control:cs},value:ue.filter(t=>t.value===r),onChange:a})},ve=w.forwardRef((s,r)=>{const{onInputChange:a}=s,t=Ke(n,500);function n(m){a==null||a(m)}const o=m=>{t(m.target.value)};return e.jsx(we,{ref:r,className:"max-w-md md:w-52 mb-4",size:"sm",placeholder:"Search",prefix:e.jsx(Ue,{className:"text-lg"}),onChange:o})});ve.displayName="RolesTableSearch";const ms=()=>{const s=v(),r=w.useRef(null),a=R(u=>u.crmRoles.data.tableData),t=$("roles","canCreate"),n=u=>{const j=F(a);j.query=u,j.pageIndex=1,typeof u=="string"&&u.length>1&&o(j),typeof u=="string"&&u.length===0&&o(j)},o=u=>{s(O(u)),s(S())},m=()=>{const u=F(a);u.query="",r.current&&(r.current.value=""),s(je({status:""})),o(u)},c=()=>{s(xe()),s(ge("ADD"))};return e.jsxs("div",{className:"md:flex items-center justify-between",children:[e.jsxs("div",{className:"md:flex items-center gap-4",children:[e.jsx(ve,{ref:r,onInputChange:n}),e.jsx(is,{})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx(q,{size:"sm",className:"me-2",onClick:m,children:"Clear All"}),t&&e.jsx(q,{size:"sm",onClick:c,children:"Add New"})]})]})};Ie("crmRoles",Ee);const fa=()=>e.jsxs(e.Fragment,{children:[e.jsx(ms,{}),e.jsx(rs,{})]});export{fa as default};
