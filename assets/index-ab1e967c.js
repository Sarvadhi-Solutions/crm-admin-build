import{r as u,i as O,j as e,am as S,an as $,ao as P,ap as Y,al as B,ah as I,aq as G,a as V}from"./index-01b42c77.js";import{a as q,b as F,c as J}from"./CrmService-fb54ad5b.js";import{C}from"./Card-039a9ed6.js";import{B as E}from"./Badge-6cc907e6.js";import{_ as H,C as v}from"./chart.constant-8991471a.js";import{a as R,b as Q,c as U,d as X,e as Z}from"./GrowShrinkTag-a3ea01ed.js";import"./Alert-ba84ad42.js";import"./index-b609fa7a.js";import{B as z}from"./Button-a5544b15.js";import"./RangeCalendar-7e850f6c.js";import"./index-dab07eaf.js";import"./index-a9a60eee.js";import"./Dialog-b7c1600d.js";import"./Drawer-a351bd90.js";import"./index-71de6292.js";import"./FormItem-4a386e6f.js";import"./toString-228d794c.js";import"./Input-b0748b3e.js";import"./index-2bfb9d4e.js";import"./index-ca28e0d9.js";import"./index-a6a0da8c.js";import"./toast-9d39500f.js";import"./Pagination-d57e7c83.js";import"./Progress-613f4d7f.js";import"./index-8ad179bb.js";import"./ScrollBar-349c0130.js";import{S as f}from"./index-92468997.js";import"./Select-2cf95561.js";import"./Skeleton-cf28f7d5.js";import"./index-b9cef8bb.js";import"./Switcher-cf39306f.js";import"./index-f7318691.js";import"./index-0fe1020b.js";import"./Tag-989e3abd.js";import"./index-8359d520.js";import"./index-3b362267.js";import{T as ee}from"./Tooltip-06c83e8f.js";import"./Upload-b982e753.js";import{i as se}from"./Views-0a1f8861.js";import{D as W}from"./DataTable-2544ad05.js";import"./react-tooltip.min-cd40762f.js";import"./RichTextEditor-d17e3214.js";import"./SegmentItemOption-b31b5145.js";import"./SvgIcon-dc305fe7.js";import{S as k}from"./StatusCapsule-eac63b6c.js";import{T as w}from"./TextTruncate-93f99085.js";import{h as te}from"./moment-fbc5633a.js";import"./index.esm-587e89d5.js";import"./useTimeout-459c0c98.js";import"./CloseButton-f0093569.js";import"./StatusIcon-f4c9b6a3.js";import"./useMergeRef-788c4cb0.js";import"./useControllableState-6df01025.js";import"./cloneDeep-29f2aae8.js";import"./_MapCache-466adbaa.js";import"./_getPrototype-583e3aad.js";import"./_baseIsEqual-e4dc226f.js";import"./get-4bda1c07.js";import"./useRootClose-25e3e193.js";import"./usePopper-f47dd5aa.js";import"./TimeInput-1e7df44b.js";import"./useUniqueId-3c39e5d6.js";import"./useDidUpdate-172f95a0.js";import"./index-07bde89e.js";import"./useUncertainRef-9e1ddaf5.js";import"./isNil-93830b79.js";import"./index-5bdc2e1d.js";import"./chainedFunction-070f832c.js";import"./slicedToArray-0eb2b673.js";import"./objectWithoutProperties-8809bfcf.js";import"./toConsumableArray-f54b4040.js";import"./floating-ui.dom-4bc0055b.js";import"./mapCloneElement-830eb65c.js";import"./index.esm-30f67dfd.js";import"./index.esm-b7456581.js";import"./index.esm-68702517.js";import"./index-ffd8f14d.js";import"./useThemeClass-42da9995.js";const M=["line","bar","area"],_=o=>{const{series:r=[],width:c="100%",height:s=300,xAxis:i,customOptions:m,type:n="line",direction:a,donutTitle:t,donutText:d,className:g,...h}=o,y=u.useRef(null),D=u.useMemo(()=>{switch(n){case"line":return R;case"bar":return Z;case"area":return X;case"donut":return U;case"radialBar":return Q;default:return R}},[n]);let l=JSON.parse(JSON.stringify(D));const p=window.innerWidth<768,x=u.useCallback(()=>{if(y.current){const b=y.current.querySelectorAll("div.apexcharts-legend")[0];a===O&&(b.style.right="auto",b.style.left="0"),p&&(b.style.position="relative",b.style.top="0",b.style.justifyContent="start",b.style.padding="0")}},[a,p]);return u.useEffect(()=>{M.includes(n)&&x()},[n,x]),M.includes(n)&&(l.xaxis.categories=i),m&&(l={...l,...m}),n==="donut"&&(t&&(l.plotOptions.pie.donut.labels.total.label=t),d&&(l.plotOptions.pie.donut.labels.total.formatter=()=>d)),e.jsx("div",{ref:y,style:a===O?{direction:"ltr"}:{},className:"chartRef",children:e.jsx(H,{options:l,type:n,series:r,width:c,height:s,className:g,...h})})},ae={totalLeads:0,leadsCreated:{day:0,week:0,month:0},convertedInDeal:{day:0,week:0,month:0},convertedPercentage:{day:"0.00 %",week:"00.00 %",month:"00.00 %"}},re="crmDashboard",N=S("crmDashboard/data/dashboard",async()=>(await q()).data),T=S("crmDashboard/data/dashboard/tasks",async()=>(await F()).data),L=S("crmDashboard/data/getLeadsAndDealChart",async()=>(await J()).data),oe={loading:!0,dashboardData:{},tasksChartData:{},convertedLeadDeal:ae},ne=$({name:`${re}/state`,initialState:oe,reducers:{},extraReducers:o=>{o.addCase(N.fulfilled,(r,c)=>{r.dashboardData=c.payload.crmDashboardData,r.loading=!1}).addCase(N.pending,r=>{r.loading=!0}).addCase(T.fulfilled,(r,c)=>{r.loading=!1,r.tasksChartData.chart=c.payload.data}).addCase(T.pending,r=>{r.loading=!0}).addCase(L.fulfilled,(r,c)=>{r.convertedLeadDeal=c.payload.data,r.loading=!1}).addCase(L.pending,(r,c)=>{r.loading=!0})}}),ie=ne.reducer,le=P({data:ie}),j=Y,ce=({data:o={leadsCreated:{},convertedInDeal:{}}})=>{var i,m;const[r,c]=u.useState("week"),s=u.useMemo(()=>{if(o!=null&&o.leadsCreated)return{series:[o==null?void 0:o.leadsCreated[r],o==null?void 0:o.convertedInDeal[r]],labels:["Leads","Converted Deal"]}},[o,r]);return e.jsxs(C,{children:[e.jsxs("div",{className:"flex sm:flex-row flex-col md:items-center justify-between mb-6 gap-4",children:[e.jsx("h4",{children:"Leads Overview"}),e.jsxs(f,{value:r,size:"sm",onChange:n=>c(n),children:[e.jsx(f.Item,{value:"month",children:"Monthly"}),e.jsx(f.Item,{value:"week",children:"Weekly"}),e.jsx(f.Item,{value:"day",children:"Daily"})]})]}),e.jsx("div",{className:"mt-6",children:(s==null?void 0:s.series)&&e.jsxs(e.Fragment,{children:[e.jsx(_,{donutTitle:`${s==null?void 0:s.series.reduce((n,a)=>n+a,0)}`,donutText:"Leads",series:s==null?void 0:s.series,customOptions:{labels:s==null?void 0:s.labels,colors:v,stroke:{lineCap:"round"},plotOptions:{radialBar:{dataLabels:{name:{show:!0,fontSize:"12px",fontWeight:600,color:v[0]},value:{show:!0,fontSize:"12px",fontWeight:400,color:v[0],formatter:function(n){return n+""}},total:{show:!0,label:"Total",formatter:function(n){var a;return((a=n==null?void 0:n.globals)==null?void 0:a.seriesTotals[0])||0}}}}}},type:"radialBar"}),((i=s==null?void 0:s.series)==null?void 0:i.length)===((m=s==null?void 0:s.labels)==null?void 0:m.length)&&e.jsx("div",{className:"mt-6 grid grid-cols-2 gap-4 w-[70%] mx-auto",children:s.labels.map((n,a)=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(E,{badgeStyle:{backgroundColor:v[a]}}),e.jsx("span",{className:"font-medium whitespace-nowrap",children:n})]},n))})]})})]})},de=({data:o=[],className:r})=>{const c=B(),s=()=>{c("/app/crm/leads")},i=j(n=>{n.crmDashboard.data.loading}),m=u.useMemo(()=>[{header:"Associated Contact",accessorKey:"associatedContact",cell:a=>{var g;const t=(g=a.row.original)==null?void 0:g.contactData;return t?t.firstName+" "+t.lastName:"-"}},{header:"Title",accessorKey:"title",cell:a=>{const t=a.row.original;return e.jsx(w,{text:t.title,maxLength:30})}},{header:"Budget",accessorKey:"budget",cell:a=>a.row.original.budget},{header:"status",accessorKey:"status",cell:a=>{const t=a.row.original;return e.jsx(k,{status:t.status})}}],[]);return console.log({data:o}),e.jsxs(C,{className:r,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{children:"Leads"}),e.jsx(z,{size:"sm",onClick:s,children:"View All Leads"})]}),e.jsx(W,{columns:m,data:o,skeletonAvatarColumns:[0],skeletonAvatarProps:{width:28,height:28},loading:i,isPagination:!1})]})},K=({label:o,value:r,badgeClass:c,showBadge:s=!0,color:i})=>e.jsxs("div",{className:"flex gap-2 align-middle",children:[s&&e.jsx(E,{className:"mt-2.5",innerClass:c,style:{background:i}}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("h5",{className:"font-semibold",children:r}),e.jsx("p",{className:"mt-1",children:o})]})]}),me=({className:o})=>{var g,h,y,D;const[r,c]=u.useState(["weekly"]),s=j(l=>{var p,x;return(x=(p=l==null?void 0:l.crmDashboard)==null?void 0:p.data)==null?void 0:x.tasksChartData}),[i,m]=u.useState(!1),n=j(l=>{var p,x;return(x=(p=l==null?void 0:l.theme)==null?void 0:p.layout)==null?void 0:x.sideNavCollapse});u.useEffect(()=>{m(!0);const l=setTimeout(()=>m(!1),300);return()=>{clearTimeout(l)}},[s,n]);const a=s!=null&&s.chart?s!=null&&s.chart[r[0]]?((g=s==null?void 0:s.chart[r[0]])==null?void 0:g.series)||[]:[]:[],t=a==null?void 0:a.map((l,p)=>{const x=l==null?void 0:l.name,A=(s==null?void 0:s.chart[r[0]][x])||0;return A?e.jsx(K,{badgeClass:"",label:l.name,color:v[p],value:A},p):""}),d=a==null?void 0:a.map((l,p)=>v[p]);return e.jsxs(C,{className:o,children:[e.jsxs("div",{className:"flex sm:flex-row flex-col md:items-center justify-between mb-6 gap-4",children:[e.jsx("h4",{children:"Tasks Overview"}),e.jsxs(f,{value:r,size:"sm",onChange:l=>c(l),children:[e.jsx(f.Item,{value:"monthly",children:"Monthly"}),e.jsx(f.Item,{value:"weekly",children:"Weekly"}),e.jsx(f.Item,{value:"daily",children:"Daily"})]})]}),!se(s)&&!i&&(s==null?void 0:s.chart)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{children:e.jsx(K,{showBadge:!1,label:"Total Tasks",value:(h=s==null?void 0:s.chart[r[0]])==null?void 0:h.total})}),e.jsx("div",{className:"flex gap-x-6",children:t})]}),e.jsxs("div",{children:[e.jsx(_,{series:(y=s==null?void 0:s.chart[r[0]])==null?void 0:y.series,xAxis:(D=s==null?void 0:s.chart[r[0]])==null?void 0:D.range,type:"bar",customOptions:{colors:d,legend:{show:!1},plotOptions:{bar:{horizontal:!1,columnWidth:r[0]==="monthly"?"15px":"30px",borderRadius:2}}}}),e.jsx("div",{className:""})]})]}),e.jsx(I,{loading:i,type:"cover",children:i&&e.jsx("div",{className:"h-[300px]"})})]})},pe=({data:o=[],className:r})=>{const c=B(),s=()=>{c("/app/crm/tasks")},i=j(n=>{n.crmDashboard.data.loading}),m=u.useMemo(()=>[{header:"Title",accessorKey:"title",cell:a=>{const t=a.row.original.title;return e.jsx(ee,{title:t,children:e.jsx(w,{text:t,maxLength:20})},t)}},{header:"Due Date",accessorKey:"dueDate",cell:a=>{var t;return te((t=a.row.original)==null?void 0:t.dueDate).format("DD MMMM YYYY")}},{header:"priority",accessorKey:"priority",cell:a=>{const t=a.row.original.priority;return e.jsx(k,{status:t})}},{header:"module",accessorKey:"module",cell:a=>{var d;const t=(d=a.row.original)==null?void 0:d.module;return t?e.jsx(w,{text:t,maxLength:20}):"-"}},{header:"type",accessorKey:"type",cell:a=>{var d;const t=(d=a.row.original)==null?void 0:d.type;return t?e.jsx(w,{text:t,maxLength:20}):"-"}},{header:"Assigned to",accessorKey:"assignedTo",cell:a=>{const{firstName:t,lastName:d}=a.row.original.assignedToData||{};return t&&d?`${t} ${d}`:"-"}},{header:"Connected lead",accessorKey:"connectedLead",cell:a=>{var d;const t=a.row.original||{};return t!=null&&t.leadModel?`${(d=t==null?void 0:t.leadModel)==null?void 0:d.title}`:"-"}},{header:"Status",accessorKey:"completionStatus",cell:a=>{const t=a.row.original.completionStatus;return e.jsx(k,{status:t})}}],[]);return e.jsxs(C,{className:r,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{children:"Today's Tasks"}),e.jsx(z,{size:"sm",onClick:s,children:"View All Tasks"})]}),e.jsx(W,{columns:m,data:o,skeletonAvatarColumns:[0],skeletonAvatarProps:{width:28,height:28},loading:i,isPagination:!1})]})};G("crmDashboard",le);const ue=()=>{const o=V(),{statisticData:r,recentLeadsData:c,todayTask:s}=j(t=>t.crmDashboard.data.dashboardData),i=j(t=>t.crmDashboard.data.leadsList),m=j(t=>t.crmDashboard.data.convertedLeadDeal),n=j(t=>t.crmDashboard.data.loading);u.useEffect(()=>{a()},[o]);const a=()=>{o(N()),o(T()),o(L())};return u.useMemo(()=>{const t=(i==null?void 0:i.filter(h=>h.status==="open").length)||0,d=(i==null?void 0:i.filter(h=>h.status==="closed_lost").length)||0,g=(i==null?void 0:i.filter(h=>h.status==="closed_won").length)||0;return{labels:["Open","Lost","Won"],data:[t,d,g]}},[i]),e.jsx("div",{className:"flex flex-col gap-4 h-full",children:e.jsxs(I,{loading:n,children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsx(me,{className:"col-span-2"}),e.jsx(ce,{data:m})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsx(pe,{data:s}),e.jsx(de,{data:c})]})]})})},zs=ue;export{zs as default};
