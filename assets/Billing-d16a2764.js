import{j as e,B as U,r as M,c as v}from"./index-04de45f1.js";import{T as z}from"./Tag-b89b8728.js";import{B as j}from"./Button-c014eb4a.js";import{t as J,N as O}from"./toast-5c5a7d02.js";import{F as A,a as q,b as P,c as g,d as f}from"./formik.esm-21613a47.js";import{D as W}from"./Dialog-94528cff.js";import{F as H,a as w}from"./FormRow-5a47c7ec.js";import{I as L}from"./Input-177911dc.js";import{T as _}from"./Tooltip-8263a1ca.js";import{C as G}from"./index-746fa18b.js";import{h as K}from"./index-942d8076.js";import{bo as Q,a5 as X,at as Z,a$ as ee}from"./index.esm-dece01db.js";import{F as re}from"./FormCustomFormatInput-dc6c320d.js";import{F as D}from"./FormPatternInput-a239d739.js";import{c as te,a as T,d as se}from"./index.esm-7ed3d02a.js";import{T as Y}from"./index-f4f40370.js";import{B as ae}from"./Badge-fd219ce7.js";import{c as ie,u as oe,f as S,g as ne}from"./index-57d63c42.js";import{N as de}from"./react-number-format.es-042f37c4.js";import{i as V}from"./isLastChild-83eb4c23.js";import{f as le}from"./AccountServices-cd01543c.js";import"./context-3f43d22b.js";import"./useTimeout-352435f8.js";import"./CloseButton-c81f3a7a.js";import"./StatusIcon-43cda077.js";import"./chainedFunction-070f832c.js";import"./Views-9d427d6f.js";import"./index-5206a52a.js";import"./index-ce7a2c9a.js";import"./isNil-2d09164b.js";import"./get-e02c019e.js";import"./toString-85ae3482.js";import"./_MapCache-593c8f28.js";import"./usePopper-301f1b7b.js";import"./index.esm-86efb1ff.js";import"./cloneDeep-9e3b0d5b.js";import"./_Uint8Array-51fedccd.js";import"./_getPrototype-c53c6c29.js";import"./_baseIsEqual-aab3701d.js";import"./useControllableState-517757cf.js";import"./useDidUpdate-be24419c.js";import"./useMergeRef-788c4cb0.js";import"./useRootClose-9c807e39.js";import"./useUncertainRef-83c88a9e.js";import"./useUniqueId-d1553e7a.js";import"./index.esm-bec52084.js";const{useUniqueId:me}=K,ce=te().shape({cardHolderName:T().required("Card holder name required"),ccNumber:T().required("Credit card number required").matches(/^(?:4[0-9]{12}(?:[0-9]{3})?|[25][1-7][0-9]{14}|6(?:011|5[0-9][0-9])[0-9]{12}|3[47][0-9]{13}|3(?:0[0-5]|[68][0-9])[0-9]{11}|(?:2131|1800|35\d{3})\d{11})$/,"Invalid credit card number"),cardExpiry:T().required("Card holder name required").matches(/^(0[1-9]|1[0-2])\/?([0-9]{4}|[0-9]{2})$/,"Invalid Date"),code:T().required().matches(/^[0-9]{3}$/,"Invalid CVV"),primary:se()});function R(r,s){return r.length===1&&r[0]>s[0]&&(r="0"+r),r.length===2&&(Number(r)===0?r="01":r>s&&(r=s)),r}function pe(r){const s=R(r.substring(0,2),"12"),h=R(r.substring(2,4),"31");return s+(h.length?"/"+h:"")}const xe=({card:r,type:s,onUpdate:h})=>{const x=me("cc-"),d=p=>{const{cardHolderName:l,ccNumber:m,cardExpiry:a,primary:u}=p;if(r){const{cardType:E,cardId:I}=r;let t={cardId:"",cardType:"",last4Number:m.substr(m.length-4),expYear:a.substr(a.length-2),expMonth:a.substring(0,2),cardHolderName:l,primary:u};s==="EDIT"&&(t={...t,cardId:I,cardType:E}),s==="NEW"&&(t={...t,cardId:x,cardType:"VISA"}),console.log("updatedCard",t),h(t)}};return e.jsx(A,{initialValues:{cardHolderName:(r==null?void 0:r.cardHolderName)||"",ccNumber:"",cardExpiry:(r==null?void 0:r.expMonth)+(r==null?void 0:r.expYear)||"",code:"",primary:(r==null?void 0:r.primary)||!1},validationSchema:ce,onSubmit:(p,{setSubmitting:l})=>{d(p),l(!1)},children:({touched:p,errors:l})=>e.jsx(q,{children:e.jsxs(P,{children:[e.jsx(g,{label:"Card holder name",invalid:l.cardHolderName&&p.cardHolderName,errorMessage:l.cardHolderName,children:e.jsx(f,{type:"text",autoComplete:"off",name:"cardHolderName",component:L})}),e.jsx(g,{label:"Credit Card Number",invalid:l.ccNumber&&p.ccNumber,errorMessage:l.ccNumber,children:e.jsx(f,{name:"ccNumber",children:({field:m,form:a})=>e.jsx(D,{form:a,field:m,placeholder:"•••• •••• •••• ••••",format:"#### #### #### ####",inputSuffix:e.jsx(Q,{className:"text-lg"}),onValueChange:u=>{a.setFieldValue(m.name,u.value)}})})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(g,{label:"Expiration date",invalid:l.cardExpiry&&p.cardExpiry,errorMessage:l.cardExpiry,children:e.jsx(f,{name:"cardExpiry",children:({field:m,form:a})=>e.jsx(re,{form:a,field:m,placeholder:"••/••",inputSuffix:e.jsx(X,{className:"text-lg"}),format:pe,defaultValue:a.values.cardExpiry,onValueChange:u=>{a.setFieldValue(m.name,u.value)}})})}),e.jsx(g,{label:"CVV",invalid:l.code&&p.code,errorMessage:l.code,children:e.jsx(f,{name:"code",children:({field:m,form:a})=>e.jsx(D,{form:a,field:m,placeholder:"•••",format:"###",inputPrefix:e.jsx(_,{title:"The CVV/CVC code is located on the back of your credit/debit card on the right side of the white signature strip",children:e.jsx(Z,{className:"cursor-pointer text-lg"})}),onValueChange:u=>{a.setFieldValue(m.name,u.value)}})})})]}),e.jsx(g,{children:e.jsx(f,{name:"primary",component:G,children:"Set this card as primary"})}),e.jsx(g,{className:"mb-0 text-right",children:e.jsx(j,{block:!0,variant:"solid",type:"submit",children:"Update"})})]})})})},{Tr:B,Th:ue,Td:he,THead:ge,TBody:je}=Y,fe={paid:"bg-emerald-500",pending:"bg-amber-400"},y=ie(),be=[y.accessor("id",{header:"Reference",cell:r=>{const s=r.row.original;return e.jsx("div",{children:e.jsx("span",{className:"cursor-pointer",children:s.id})})}}),y.accessor("item",{header:"Product"}),y.accessor("status",{header:"Status",cell:r=>{const s=r.row.original;return e.jsxs("div",{className:"flex items-center",children:[e.jsx(ae,{className:fe[s.status]}),e.jsx("span",{className:"ml-2 rtl:mr-2 capitalize",children:s.status})]})}}),y.accessor("date",{header:"Date",cell:r=>{const s=r.row.original;return e.jsx("div",{className:"flex items-center",children:U.unix(s.date).format("MM/DD/YYYY")})}}),y.accessor("amount",{header:"Amount",cell:r=>{const s=r.row.original;return e.jsx("div",{className:"flex items-center",children:e.jsx(de,{displayType:"text",value:(Math.round(s.amount*100)/100).toFixed(2),prefix:"$",thousandSeparator:!0})})}})],ye=({data:r=[],...s})=>{const h=oe({data:r,columns:be,getCoreRowModel:ne()});return e.jsx("div",{...s,children:e.jsxs(Y,{children:[e.jsx(ge,{className:"!bg-transparent",children:h.getHeaderGroups().map(x=>e.jsx(B,{children:x.headers.map(d=>e.jsx(ue,{colSpan:d.colSpan,children:S(d.column.columnDef.header,d.getContext())},d.id))},x.id))}),e.jsx(je,{children:h.getRowModel().rows.map(x=>e.jsx(B,{children:x.getVisibleCells().map(d=>e.jsx(he,{children:S(d.column.columnDef.cell,d.getContext())},d.id))},x.id))})]})})},Ne=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],ur=()=>{const[r,s]=M.useState({paymentMethods:[],otherMethod:[],billingHistory:[]}),[h,x]=M.useState({}),[d,p]=M.useState(""),l=async()=>{const t=await le();s(t.data)},m=(t,o)=>{J.push(e.jsx(O,{title:"Billing information updated",type:"success"}),{placement:"top-center"}),o(!1)},a=()=>{p(""),x({})},u=(t,o)=>{p(o),x(t)},E=(t,o,N)=>{let c=o.values[N.name];t.primary&&c.forEach(n=>{n.primary=!1}),c.some(n=>n.cardId===t.cardId)||c.push(t),c=c.map(n=>(n.cardId===t.cardId&&(n={...n,...t}),n));let C={};c=c.filter(n=>(n.primary&&(C=n),!n.primary)),c=[C,...c],o.setFieldValue(N.name,c),a()},I=t=>{const o=window.open(t,"_blank");o==null||o.focus()};return M.useEffect(()=>{l()},[]),e.jsx(A,{enableReinitialize:!0,initialValues:r,onSubmit:(t,{setSubmitting:o})=>{o(!0),setTimeout(()=>{m(t,o)},1e3)},children:({values:t,touched:o,errors:N,isSubmitting:c,resetForm:C})=>{var F,k;const n={touched:o,errors:N};return e.jsx(q,{children:e.jsxs(P,{children:[e.jsx(H,{title:"Payment Method",desc:"You can update your cards information here"}),e.jsxs(w,{name:"paymentMethods",alignCenter:!1,label:"Credit Cards",...n,children:[e.jsx("div",{className:"rounded-lg border border-gray-200 dark:border-gray-600",children:(F=t==null?void 0:t.paymentMethods)==null?void 0:F.map((i,b)=>e.jsxs("div",{className:v("flex items-center justify-between p-4",!V(t.paymentMethods,b)&&"border-b border-gray-200 dark:border-gray-600"),children:[e.jsxs("div",{className:"flex items-center",children:[i.cardType==="VISA"&&e.jsx("img",{src:"/img/others/img-8.png",alt:"visa"}),i.cardType==="MASTER"&&e.jsx("img",{src:"/img/others/img-9.png",alt:"master"}),e.jsxs("div",{className:"ml-3 rtl:mr-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"text-gray-900 dark:text-gray-100 font-semibold",children:[i.cardHolderName," ","••••"," ",i.last4Number]}),i.primary&&e.jsx(z,{className:"bg-sky-100 text-sky-600 dark:bg-sky-500/20 dark:text-sky-100 rounded-md border-0 mx-2",children:e.jsxs("span",{className:"capitalize",children:[" ","Primary"," "]})})]}),e.jsxs("span",{children:["Expired"," ",Ne[parseInt(i.expMonth)-1]," ","20",i.expYear]})]})]}),e.jsx("div",{className:"flex",children:e.jsx(j,{size:"sm",type:"button",onClick:()=>u(i,"EDIT"),children:"Edit"})})]},i.cardId))}),e.jsx("div",{className:"mt-2",children:e.jsx(j,{type:"button",variant:"plain",size:"sm",icon:e.jsx(ee,{className:"text-lg"}),onClick:()=>u({},"NEW"),children:e.jsx("span",{className:"font-semibold",children:"Add new card"})})})]}),e.jsx(w,{border:!1,name:"otherMethod",alignCenter:!1,label:"Other payment methods",...n,children:e.jsx("div",{className:"rounded-lg border border-gray-200 dark:border-gray-600",children:(k=t==null?void 0:t.otherMethod)==null?void 0:k.map((i,b)=>e.jsxs("div",{className:v("flex items-center justify-between p-4",!V(t.otherMethod,b)&&"border-b border-gray-200 dark:border-gray-600"),children:[e.jsxs("div",{className:"flex items-center",children:[i.type==="PAYPAL"&&e.jsx("img",{src:"/img/others/img-10.png",alt:"visa"}),e.jsx("div",{className:"ml-3 rtl:mr-3 font-semibold",children:i.identifier})]}),e.jsx("div",{className:"flex",children:e.jsx(j,{size:"sm",type:"button",onClick:()=>I(i.redirect),children:"Edit"})})]},i.id))})}),e.jsxs(W,{isOpen:d==="NEW"||d==="EDIT",onClose:a,onRequestClose:a,children:[e.jsx("h5",{className:"mb-4",children:"Edit Credit Card"}),e.jsx(f,{name:"paymentMethods",children:({field:i,form:b})=>e.jsx(xe,{type:d,card:h,onUpdate:$=>E($,b,i)})})]}),e.jsxs("div",{className:"mt-4 ltr:text-right",children:[e.jsx(j,{className:"ltr:mr-2 rtl:ml-2",type:"button",onClick:()=>C(),children:"Reset"}),e.jsx(j,{variant:"solid",loading:c,type:"submit",children:c?"Updating":"Update"})]}),e.jsx(H,{className:"mt-6",title:"Billing History",desc:"View your previos billing"}),e.jsx(ye,{className:"mt-4 rounded-lg border border-gray-200 dark:border-gray-600",data:r.billingHistory})]})})}})};export{ur as default};
