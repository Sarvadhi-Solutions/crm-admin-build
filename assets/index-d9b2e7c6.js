import{a as T,j as e,r as x,ap as me,aq as pe}from"./index-c6cd2f1f.js";import{A as ue}from"./AdaptableCard-4dcc119d.js";import{F as B}from"./FormDesription-c03a7ef2.js";import{D as xe}from"./DataTable-95078a43.js";import{D as ge,t as he,c as fe,T as Ce}from"./tagAndCategory-ffbdaced.js";import{T as E}from"./TextTruncate-179b37eb.js";import{u as P}from"./checkEditUpdate-c212ab25.js";import{u as je}from"./useThemeClass-98e32100.js";import{c as V}from"./cloneDeep-d7dc419b.js";import{U as Ne,O as ye,P as be,b as ve}from"./index.esm-49d30af8.js";import{u as C,t as U,d as we,g as Z,a as te,b as De,f as Ie,c as Se,e as Te,h as ae,i as Fe,j as Ae,s as se,k as _,l as W,m as oe,r as Me}from"./index-5d8f5178.js";import{t as J,N as Q}from"./toast-0cbca45a.js";import{C as Le}from"./ConfirmDialog-91c6533e.js";import{B as X}from"./Button-6fab1b0a.js";import{D as ke}from"./Drawer-8d2ecfc1.js";import{T as re}from"./index-3df4cf26.js";import{a as y,F as Ee}from"./FormItem-6dd4daa4.js";import{u as Oe,b as v,F as ze,a as Re}from"./formik.esm-d0f2dcaf.js";import{c as qe,a as b,e as $e}from"./index.esm-1205adb2.js";import{I as w}from"./Input-6c0ef453.js";/* empty css              */import{b as Ke,d as Be,a as Pe}from"./index.esm-e7634202.js";import"./Alert-b89c58d4.js";import"./index-1e47d26e.js";import"./Badge-968b10fa.js";import"./RangeCalendar-add8d5cb.js";import"./Card-03716fe8.js";import"./index-bfed9162.js";import"./index-be2f9055.js";import"./Dialog-356e415b.js";import"./index-da9c94d2.js";import"./toString-6bf941ba.js";import"./index-e0bde191.js";import"./index-6e6a042a.js";import"./index-351c77b4.js";import"./Pagination-5c5893fe.js";import"./Progress-fc260c38.js";import"./index-11e44a33.js";import"./ScrollBar-ef1f3246.js";import"./index-7471c744.js";import{S as Y}from"./Select-37a7ed4a.js";import"./Skeleton-eaea8848.js";import"./index-79163cb0.js";import"./Switcher-12da8b3c.js";import"./index-eb606d8f.js";import"./Tag-0a427cd3.js";import"./index-5959fb30.js";import"./index-59001c9c.js";import"./Tooltip-72e1f60a.js";import"./Upload-15601b0e.js";import{a as ee}from"./index.esm-223f4829.js";import{M as Ve}from"./index.esm-a9a0b252.js";import{a as We}from"./index.esm-560e89f9.js";import{I as Ze,G as He,a as Ge}from"./index.esm-5a8aaf9a.js";import{F as Ue}from"./index.esm-99e22812.js";import{C as _e}from"./react-select-creatable.esm-855e335f.js";import{A as Je}from"./index.esm-85311354.js";import{d as Qe}from"./debounce-787a4427.js";import"./index-c8b58d8a.js";import"./_MapCache-30a78bfb.js";import"./Views-992fbea4.js";import"./_getPrototype-d1c09d00.js";import"./CrmService-a103153a.js";import"./useTimeout-3d3d6c88.js";import"./CloseButton-44d73194.js";import"./StatusIcon-f4e52d54.js";import"./chainedFunction-070f832c.js";import"./index-d8ab7d59.js";import"./useControllableState-9f86c150.js";import"./index-358db617.js";import"./isNil-24fefb90.js";import"./get-18fc4c0e.js";import"./useMergeRef-788c4cb0.js";import"./_baseIsEqual-d4fafef7.js";import"./useRootClose-5f665e08.js";import"./usePopper-a5bd9612.js";import"./TimeInput-44c66253.js";import"./useUniqueId-6baa9703.js";import"./useDidUpdate-101fe096.js";import"./useUncertainRef-f22fbccf.js";import"./slicedToArray-b94aca29.js";import"./objectWithoutProperties-8809bfcf.js";import"./toConsumableArray-6967a90f.js";import"./floating-ui.dom-bef9cea3.js";import"./mapCloneElement-00216167.js";import"./index.esm-ac18b130.js";const Xe=()=>{const s=T(),o=C(r=>r.crmContact.data.deleteConfirmation),t=C(r=>r.crmContact.data.selectedContact),l=()=>{s(U(!1))},d=async()=>{var u,i,g;s(U(!1));const r=await s(we(t==null?void 0:t.id));(u=r==null?void 0:r.payload)!=null&&u.success?J.push(e.jsx(Q,{title:"Successfuly Deleted",type:"success",duration:2500,children:(i=r==null?void 0:r.payload)==null?void 0:i.message}),{placement:"top-end"}):J.push(e.jsx(Q,{title:"Something Went Wrong !!!",type:"danger",duration:2500,children:(g=r==null?void 0:r.error)==null?void 0:g.message}),{placement:"top-end"}),await s(Z()),await s(te())};return e.jsx(Le,{isOpen:o,type:"danger",title:"Delete Contact",confirmButtonColor:"red-600",onClose:l,onRequestClose:l,onCancel:l,onConfirm:d,children:e.jsx("p",{children:"Are you sure you want to delete this Contact? All record related to this contact will be deleted as well. This action cannot be undone."})})},K=[],Ye=s=>{const{touched:o,errors:t,values:l,setFieldValue:d}=s,r=T(),[u,i]=x.useState(!1),[g,I]=x.useState(!1),[F,h]=x.useState([]),[D,N]=x.useState([]),S=()=>{i(!u),I(!1)},M=C(n=>n.crmContact.data.companyList),A=C(n=>n.crmContact.data.sources);K.length=0,M.forEach(n=>{K.push({value:n.id,label:n.companyName})});const L=x.useMemo(()=>A.map(j=>({label:j.sources,value:j.id})),[A]),[O,m]=x.useState("");x.useEffect(()=>{(async()=>{var j,$;try{const{payload:R}=await r(Ie()),q=(j=R==null?void 0:R.data)==null?void 0:j.find(k=>(k==null?void 0:k.moduleName)==="contacts");if(m(q.id),q){const{payload:k}=await r(Se({id:($=q==null?void 0:q.id)==null?void 0:$.toString()})),le=he(k.data),de=fe(k.data);N(de),h(le)}}catch(R){console.error("Error fetching module data:",R)}})(),r(De())},[r]);const a=C(n=>n.crmContact.data.selectedContact),[p,f]=x.useState(a?a.tags||[]:[]),c=Oe(),z=n=>{f(n);const j=[n.value];c.setFieldValue("tagId",j)},H=async(n,j)=>{const $={sources:n==null?void 0:n.label};switch(j.action){case"create-option":await r(Te($)),await r(ae());break;case"select-option":d("sourceId",n);break}console.group("Value Changed"),console.log(n),console.log(`action: ${j.action}`),console.groupEnd()},G=(n,j)=>{console.group("Input Changed"),console.log(n),console.log(`action: ${j.action}`),console.groupEnd()};return e.jsxs(e.Fragment,{children:[e.jsx(B,{title:"Contact Basic Information",desc:"",className:"mb-2"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"col-span-1",children:e.jsx(y,{label:"First Name *",invalid:t.firstName&&o.firstName,errorMessage:t.firstName,children:e.jsx(v,{type:"text",autoComplete:"off",name:"firstName",placeholder:"First Name",component:w,prefix:e.jsx(ee,{className:"text-xl"})})})}),e.jsx("div",{className:"col-span-1",children:e.jsx(y,{label:"Last Name *",invalid:t.lastName&&o.lastName,errorMessage:t.lastName,children:e.jsx(v,{type:"text",autoComplete:"off",name:"lastName",placeholder:"Last Name",component:w,prefix:e.jsx(ee,{className:"text-xl"})})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"col-span-1",children:e.jsx(y,{label:"Email *",invalid:t.email&&o.email,errorMessage:t.email,children:e.jsx(v,{type:"text",autoComplete:"off",name:"email",placeholder:"Email",component:w,prefix:e.jsx(Ne,{className:"text-xl"})})})}),e.jsx("div",{className:"col-span-1",children:e.jsx(y,{label:"Contact Number *",invalid:t.contactNumber&&o.contactNumber,errorMessage:t.contactNumber,children:e.jsx(v,{type:"text",autoComplete:"off",name:"contactNumber",placeholder:"Contact Number",component:w,prefix:e.jsx(We,{className:"text-xl"})})})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsx("div",{className:"col-span-1",children:e.jsx(y,{label:"Title",invalid:t.title&&o.title,errorMessage:t.title,children:e.jsx(v,{type:"text",autoComplete:"off",name:"title",placeholder:"Title",component:w,prefix:e.jsx(Ve,{className:"text-xl"})})})})}),e.jsx(y,{label:"Notes",invalid:t.description&&o.description,errorMessage:t.description,children:e.jsx(v,{textArea:!0,type:"text",autoComplete:"off",name:"description",placeholder:"Notes",component:w,prefix:e.jsx(Ke,{className:"text-xl"})})}),e.jsx(B,{title:"Address",desc:"",className:"mb-2"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"col-span-1",children:e.jsx(y,{label:"Address",invalid:t.address&&o.address,errorMessage:t.address,children:e.jsx(v,{type:"text",autoComplete:"off",name:"address",placeholder:"Address",component:w,prefix:e.jsx(Ue,{className:"text-xl"})})})}),e.jsx("div",{className:"col-span-1",children:e.jsx("div",{className:"col-span-1",children:e.jsx(y,{label:"State",invalid:t.state&&o.state,errorMessage:t.state,children:e.jsx(v,{type:"text",autoComplete:"off",name:"state",placeholder:"State",component:w,prefix:e.jsx(Ze,{className:"text-xl"})})})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"col-span-1",children:e.jsx("div",{className:"col-span-1",children:e.jsx(y,{label:"City",invalid:t.city&&o.city,errorMessage:t.city,children:e.jsx(v,{type:"text",autoComplete:"off",name:"city",placeholder:"City",component:w,prefix:e.jsx(He,{className:"text-xl"})})})})}),e.jsx("div",{className:"col-span-1",children:e.jsx("div",{style:{position:"relative"},children:e.jsx("div",{className:"col-span-1",children:e.jsx(y,{label:"ZipCode",invalid:t.zipcode&&o.zipcode,errorMessage:t.zipcode,children:e.jsx(v,{type:"text",autoComplete:"off",name:"zipcode",placeholder:"ZipCode",component:w,prefix:e.jsx(Be,{className:"text-xl"})})})})})})]}),e.jsx(B,{title:"Contact Others Details",desc:"",className:"mb-2"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"col-span-1",children:e.jsx(y,{label:"Company Name",invalid:t.companiesId&&o.companiesId,errorMessage:t.companiesId,children:e.jsx(Y,{name:"companiesId",placeholder:"Company Name",options:K,id:"companiesId",value:K.find(n=>(n==null?void 0:n.value)==(l==null?void 0:l.companiesId)),onChange:n=>{const j=n.value;d("companiesId",j||"")}})})}),e.jsx("div",{className:"col-span-1",children:e.jsx(y,{label:"Source",invalid:t.source&&o.source,errorMessage:t.source,children:e.jsx(v,{isClearable:!0,type:"text",autoComplete:"off",name:"sourceId",placeholder:"Source",component:Y,componentAs:_e,options:L,prefix:e.jsx(Ge,{className:"text-xl"}),onChange:H,onInputChange:G})})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsx("div",{className:"col-span-1",children:e.jsx("div",{style:{position:"relative"},children:e.jsx(y,{label:"Tag",children:e.jsxs("div",{style:{position:"relative"},children:[e.jsx(v,{name:"tagId",component:ge,options:F,placeholder:"Select a Tag",value:c.initialValues.tagName,onChange:z}),e.jsx(Pe,{style:{position:"absolute",right:"10px",top:"10px",border:"none",background:"#FFF"},className:"text-xl",onClick:()=>{S(),I(!0)}})]})})})})})]})},et=qe().shape({firstName:b().required("First Name is required"),lastName:b().required("Last Name is required"),title:b(),contactNumber:b().typeError("Contact must be a number").required("Contact is required").test("is-number","Contact must be a number",s=>!isNaN(s)).test("is-ten-digits"," Contact must be exactly 10 digits",s=>{if(s){const o=Number(s);return/^\d{10}$/.test(o.toString())}return!0}).test("is-not-more-than-ten-digits","Contact must not exceed 10 digits",s=>s?Number(s).toString().length<=10:!0),email:b().matches(/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/i,"Invalid email").required("Email is required"),address:b(),state:b(),city:b(),zipcode:b(),companiesId:b().nullable(),companyName:b(),source:b().nullable(),description:b(),tagId:$e()}),{TabNav:tt,TabList:at,TabContent:st}=re,ne=x.forwardRef((s,o)=>{var i,g,I,F;const t=C(h=>h.crmContact.data.selectedContact),l=C(h=>h.crmContact.data.sources),d=x.useMemo(()=>l.map(D=>({label:D.sources,value:D.id})),[l]),r=!!t.id,u=T();return console.log({contact:t}),e.jsx(ze,{innerRef:o,initialValues:{firstName:(t==null?void 0:t.firstName)||"",lastName:(t==null?void 0:t.lastName)||"",title:(t==null?void 0:t.title)||"",email:(t==null?void 0:t.email)||"",contactNumber:(t==null?void 0:t.contactNumber)||"",description:(t==null?void 0:t.description)||"",companyName:((i=t==null?void 0:t.company)==null?void 0:i.companyName)||"",sourceId:t!=null&&t.sourceId?d.find(h=>h.value===(t==null?void 0:t.sourceId)):"",address:(t==null?void 0:t.address)||"",state:(t==null?void 0:t.state)||"",city:(t==null?void 0:t.city)||"",zipcode:(t==null?void 0:t.zipcode)||"",tagName:((I=(g=t==null?void 0:t.tags)==null?void 0:g[0])==null?void 0:I.tagName)||"",tagId:((F=t==null?void 0:t.tags)==null?void 0:F.map(h=>h.id))||[],companiesId:(t==null?void 0:t.companiesId)||""},validationSchema:et,onSubmit:async(h,{setSubmitting:D})=>{var N,S,M,A,L,O;try{const{colorName:m,tagName:a,...p}=h,f={...p,sourceId:(N=p==null?void 0:p.sourceId)==null?void 0:N.value};console.log(f);const c=r?await u(Fe({contactId:(t==null?void 0:t.id)||"",updatedData:f})):await u(Ae(f)),z=(S=c==null?void 0:c.payload)!=null&&S.success?"Successfully Added":"Something went wrong !!!",H=(M=c==null?void 0:c.payload)!=null&&M.success?"success":"danger",G=(A=c==null?void 0:c.payload)!=null&&A.success?(L=c==null?void 0:c.payload)==null?void 0:L.message:(O=c==null?void 0:c.error)==null?void 0:O.message;J.push(e.jsx(Q,{title:z,type:H,duration:2500,children:G}),{placement:"top-end"}),u(se()),await u(Z()),await u(te())}catch(m){console.error(m)}finally{D(!1)}},children:({touched:h,errors:D,values:N,setFieldValue:S})=>e.jsx(Re,{children:e.jsx(Ee,{children:e.jsxs(re,{defaultValue:"personalInfo",children:[e.jsx(at,{children:e.jsx(tt,{value:"personalInfo",children:"Contact Details"})}),e.jsx("div",{className:"p-6",children:e.jsx(st,{value:"personalInfo",children:e.jsx(Ye,{touched:h,errors:D,values:N,setFieldValue:S})})})]})})})})});ne.displayName="ContactForm";const ie=x.forwardRef((s,o)=>{T();const t=C(d=>d.crmContact.data.selectedContact);C(d=>d.crmContact.data.contactList);const l=async d=>{};return e.jsx(ne,{ref:o,contact:t,onFormSubmit:l})});ie.displayName="ContactEditContent";const ot=({onSaveClick:s,onCancel:o})=>e.jsxs("div",{className:"text-right w-full",children:[e.jsx(X,{size:"sm",className:"mr-2",onClick:o,children:"Cancel"}),e.jsx(X,{size:"sm",variant:"solid",onClick:s,children:"Save"})]}),rt=()=>{const s=T(),[o,t]=x.useState(window.innerWidth/2),l=C(i=>i.crmContact.data.drawerOpen),d=()=>{s(se()),s(_({}))},r=x.useRef(null),u=()=>{var i,g;console.log("formSubmit function called",(i=r.current)==null?void 0:i.values),(g=r.current)==null||g.submitForm()};return e.jsx(ke,{isOpen:l,closable:!1,bodyClass:"p-0",width:o,footer:e.jsx(ot,{onCancel:d,onSaveClick:u}),onClose:d,onRequestClose:d,children:e.jsx(ie,{ref:r})})},nt=()=>{const s=T(),o=C(m=>m.crmContact.data.displayedContactList),t=P("contacts","canModify"),l=P("contacts","canDelete"),d=P("contacts","canView"),r=C(m=>m.crmContact.data.loading),u=me(),{pageIndex:i,pageSize:g,sort:I,query:F,total:h}=C(m=>m.crmContact.data.tableData),D=x.useCallback(()=>{s(Z()),s(ae())},[s]);x.useEffect(()=>{D()},[D]);const N=x.useMemo(()=>({pageIndex:i,pageSize:g,sort:I,query:F,total:h}),[i,g,I,F,h]),S=({row:m})=>{const a=T();je();const p=()=>{a(oe()),a(_(m))},f=async()=>{a(_(m)),a(U(!0))},c=()=>{const z=`/app/crm/contact-details/${m.id}`;u(z)};return e.jsxs("div",{className:"flex text-base items-center",children:[t&&e.jsx("span",{className:"cursor-pointer hover:text-indigo-500 circle items-center",onClick:p,children:e.jsx(ye,{})}),d&&e.jsx("span",{className:"cursor-pointer  hover:text-green-500 circle mx-1 items-center text-lg",onClick:c,children:e.jsx(Je,{})}),l&&e.jsx("span",{className:"cursor-pointer hover:text-red-500 circle items-center",onClick:f,children:e.jsx(be,{})})]})},M=x.useMemo(()=>[{header:"Action",id:"action",cell:a=>e.jsx(S,{row:a.row.original})},{header:"Name",accessorKey:"firstName",cell:a=>{const{firstName:p,lastName:f}=a.row.original,c=`${p} ${f}`;return e.jsx(E,{text:c,maxLength:20})}},{header:"email",accessorKey:"email",cell:a=>a.row.original.email},{header:"Number",accessorKey:"contactNumber",cell:a=>a.row.original.contactNumber},{header:"source",accessorKey:"sourceId",cell:a=>{var f,c;const p=(c=(f=a.row.original)==null?void 0:f.source)==null?void 0:c.sources;return e.jsx(E,{text:p,maxLength:15})}},{header:"Tags",accessorKey:"tagName",cell:a=>{const p=a.row.original.tags||[];return e.jsx(Ce,{tags:p})}},{header:"Title",accessorKey:"title",cell:a=>{const p=a.row.original.title;return e.jsx(E,{text:p,maxLength:15})}},{header:"Company",accessorKey:"companyName",cell:a=>{const p=a.row.original.company?a.row.original.company.companyName:"";return e.jsx(E,{text:p,maxLength:15})}},{header:"address",accessorKey:"address",cell:a=>{const p=[a.row.original.address,a.row.original.city,a.row.original.state,a.row.original.pincode].filter(f=>f!=null).join(" ");return e.jsx(E,{text:p,maxLength:20})}},{header:"Notes",accessorKey:"description",cell:a=>{const p=a.row.original.description;return e.jsx(E,{text:p,maxLength:20})}}],[t,l]),A=m=>{const a=V(N);a.pageIndex=m,s(W(a))},L=m=>{const a=V(N);a.pageSize=Number(m),a.pageIndex=1,s(W(a))},O=m=>{const a=V(N);a.sort=m,s(W(a))};return e.jsxs("div",{children:[e.jsx(xe,{columns:M,data:o,loading:r,pagingData:{total:N.total,pageIndex:N.pageIndex,pageSize:N.pageSize},onPaginationChange:A,onSelectChange:L,onSort:O}),e.jsx(rt,{}),e.jsx(Xe,{})]})},ce=x.forwardRef((s,o)=>{const{onInputChange:t}=s,l=Qe(d,500);function d(u){t==null||t(u)}const r=u=>{l(u.target.value)};return e.jsx(w,{ref:o,className:"max-w-md md:w-52 mb-4",size:"sm",placeholder:"Search",prefix:e.jsx(ve,{className:"text-lg"}),onChange:r})});ce.displayName="ContactTableSearch";const it=()=>{const s=T(),o=x.useRef(null),t=C(i=>i.crmContact.data.tableData),l=P("contacts","canCreate"),d=i=>{const g=V(t);g.query=i,g.pageIndex=1,typeof i=="string"&&i.length>1&&r(g),typeof i=="string"&&i.length===0&&r(g)},r=i=>{s(i?W(i):Z())},u=()=>{s(oe())};return e.jsxs("div",{className:"md:flex items-center justify-between",children:[e.jsx("div",{className:"md:flex items-center gap-4",children:e.jsx(ce,{ref:o,onInputChange:d})}),e.jsx("div",{className:"mb-4",children:l&&e.jsx(X,{size:"sm",onClick:u,children:"Add New"})})]})};pe("crmContact",Me);const ct=()=>{const s=C(o=>o.crmContact.data.tableData);return e.jsx(e.Fragment,{children:e.jsxs(ue,{bodyClass:"h-full",children:[e.jsx(B,{title:`Contacts (${s==null?void 0:s.total})`,desc:"",className:"mb-2"}),e.jsx(it,{}),e.jsx(nt,{})]})})},Ba=ct;export{Ba as default};
