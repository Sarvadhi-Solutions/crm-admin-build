import{a as F,j as e,r as h,ap as re,aq as ie}from"./index-94b34292.js";import{A as ne}from"./AdaptableCard-c182e7e7.js";import{F as q}from"./FormDesription-656c62fa.js";import{D as ce}from"./DataTable-900992cf.js";import{T as le}from"./TagsList-61871f99.js";import{T as O}from"./TextTruncate-0936aa5d.js";import{u as $}from"./checkEditUpdate-6b0c8556.js";import{u as de}from"./useThemeClass-67552e9c.js";import{c as K}from"./cloneDeep-9ce65ca1.js";import{U as me,N as pe,O as ue,b as xe}from"./index.esm-782de75a.js";import{u as f,t as H,d as he,g as Z,a as Q,b as ge,c as fe,e as Ce,f as je,h as Ne,i as be,j as V,k as ye,l as ve,m as X,s as R,n as W,o as Y,r as Ie}from"./index-892bfaa2.js";import{t as P,N as U}from"./toast-b11869d4.js";import{C as we}from"./ConfirmDialog-c6b5ec1f.js";import{B as _}from"./Button-f4db3022.js";import{D as Se}from"./Drawer-d2616c17.js";import{a as y,F as De}from"./FormItem-df2b63b0.js";import{T as ee}from"./index-61178f9b.js";import{u as Te,b as w,F as Fe,a as Me}from"./formik.esm-56dac9f6.js";import{c as Ae,a as v,e as Le}from"./index.esm-617cbf31.js";import{I as D}from"./Input-491bb23c.js";/* empty css              */import{T as ze,d as Ee}from"./index.esm-52a7305d.js";import"./Alert-e9f9cdcc.js";import"./index-08dd991c.js";import"./Badge-c7bdde2a.js";import"./RangeCalendar-79637ebf.js";import"./Card-d6f50812.js";import"./index-4c98a578.js";import"./index-e1dac674.js";import"./Dialog-ab93e4a9.js";import"./index-34beb30e.js";import"./toString-47802c78.js";import"./index-0ab29618.js";import"./index-798e70b5.js";import"./index-3085a00b.js";import"./Pagination-3cfac0ee.js";import"./Progress-5b3fa8c4.js";import"./index-5fcbc489.js";import"./ScrollBar-b79a2923.js";import"./index-4bde5563.js";import{S as k}from"./Select-b869f907.js";import"./Skeleton-231b2f52.js";import"./index-46117007.js";import"./Switcher-9ed86151.js";import"./index-fae7cee7.js";import"./Tag-2875bb96.js";import"./index-01156bc8.js";import"./index-489c1bd3.js";import{T as B}from"./Tooltip-19d421b7.js";import"./Upload-2f90bc6f.js";import{t as Oe}from"./tagAndCategory-0975d9d9.js";import{a as ke}from"./index.esm-39aa8af5.js";import{F as Re}from"./index.esm-b797afb7.js";import{a as G}from"./index.esm-df09a668.js";import{G as J}from"./index.esm-841a07fb.js";import{M as qe}from"./index.esm-e0980dfb.js";import{C as $e}from"./react-select-creatable.esm-f3195c02.js";import{a as Ke}from"./index.esm-90db3fc2.js";import{d as We}from"./debounce-bd2586be.js";import"./index-2a44d335.js";import"./_MapCache-4a7692d4.js";import"./Views-fb5a8bd1.js";import"./_getPrototype-9297296f.js";import"./CrmService-6dcb2527.js";import"./useTimeout-cb45d6dc.js";import"./CloseButton-ad08b636.js";import"./StatusIcon-24504981.js";import"./chainedFunction-070f832c.js";import"./index-4621c1d2.js";import"./index-6d87b72d.js";import"./useControllableState-ddc1f839.js";import"./isNil-dc3379e0.js";import"./get-3061b6cb.js";import"./useMergeRef-788c4cb0.js";import"./_baseIsEqual-09386f4e.js";import"./useRootClose-2ad79677.js";import"./usePopper-bc958b31.js";import"./TimeInput-47b0fec6.js";import"./useUniqueId-ed6d8ed2.js";import"./useDidUpdate-68d00a04.js";import"./useUncertainRef-c08b9939.js";import"./slicedToArray-9d1e6790.js";import"./objectWithoutProperties-8809bfcf.js";import"./toConsumableArray-9b4d83b8.js";import"./floating-ui.dom-bef9cea3.js";import"./mapCloneElement-d942a20b.js";import"./index.esm-a91bd531.js";const Ze=()=>{const o=F(),n=f(r=>r.crmContact.data.deleteConfirmation),t=f(r=>r.crmContact.data.selectedContact),c=()=>{o(H(!1))},l=async()=>{var p,d,u;o(H(!1));const r=await o(he(t==null?void 0:t.id));(p=r==null?void 0:r.payload)!=null&&p.success?P.push(e.jsx(U,{title:"Successfuly Deleted",type:"success",duration:2500,children:(d=r==null?void 0:r.payload)==null?void 0:d.message}),{placement:"top-end"}):P.push(e.jsx(U,{title:"Something Went Wrong !!!",type:"danger",duration:2500,children:(u=r==null?void 0:r.error)==null?void 0:u.message}),{placement:"top-end"}),await o(Z()),await o(Q())};return e.jsx(we,{isOpen:n,type:"danger",title:"Delete Contact",confirmButtonColor:"red-600",onClose:c,onRequestClose:c,onCancel:c,onConfirm:l,children:e.jsx("p",{children:"Are you sure you want to delete this Contact? All record related to this contact will be deleted as well. This action cannot be undone."})})},Be=o=>{const{touched:n,errors:t,values:c,setFieldValue:l}=o,r=F(),[p,d]=h.useState([]),[u,I]=h.useState(null),T=f(a=>a.crmContact.data.companyList),x=f(a=>a.crmContact.data.sources),C=f(a=>a.crmContact.data.states);f(a=>a.crmContact.data.cities);const j=h.useMemo(()=>T.map(a=>({value:a.id,label:a.companyName})),[T]),S=h.useMemo(()=>C.map(a=>({value:a.id,label:a.stateName})),[C]),M=h.useMemo(()=>{const a=C.find(s=>s.id===c.stateId);return(a==null?void 0:a.cities.map(s=>({value:s.id,label:s.cityName})))||[]},[C,u]),A=h.useMemo(()=>x.map(s=>({label:s.sources,value:s.id})),[x]);h.useEffect(()=>{(async()=>{var s,g;try{const{payload:i}=await r(je()),b=(s=i==null?void 0:i.data)==null?void 0:s.find(N=>(N==null?void 0:N.moduleName)==="contacts");if(b){const{payload:N}=await r(Ne({id:(g=b==null?void 0:b.id)==null?void 0:g.toString()})),E=Oe(N.data);d(E)}}catch(i){console.error("Error fetching module data:",i)}})(),r(ge()),r(fe()),r(Ce())},[r]);const L=Te(),z=a=>{L.setFieldValue("tagId",a)},m=async(a,s)=>{const g={sources:a==null?void 0:a.label};switch(s.action){case"create-option":await r(be(g)),await r(V());break;case"select-option":l("sourceId",a);break;case"clear":l("sourceId",null);break}};return e.jsxs(e.Fragment,{children:[e.jsx(q,{title:"Contact Basic Information",desc:"",className:"mb-2"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"col-span-1",children:e.jsx(y,{label:"First Name *",invalid:t.firstName&&n.firstName,errorMessage:t.firstName,children:e.jsx(w,{type:"text",autoComplete:"off",name:"firstName",placeholder:"First Name",component:D,prefix:e.jsx(G,{className:"text-xl"})})})}),e.jsx("div",{className:"col-span-1",children:e.jsx(y,{label:"Last Name *",invalid:t.lastName&&n.lastName,errorMessage:t.lastName,children:e.jsx(w,{type:"text",autoComplete:"off",name:"lastName",placeholder:"Last Name",component:D,prefix:e.jsx(G,{className:"text-xl"})})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"col-span-1",children:e.jsx(y,{label:"Email *",invalid:t.email&&n.email,errorMessage:t.email,children:e.jsx(w,{type:"text",autoComplete:"off",name:"email",placeholder:"Email",component:D,prefix:e.jsx(me,{className:"text-xl"})})})}),e.jsx("div",{className:"col-span-1",children:e.jsx(y,{label:"Contact Number *",invalid:t.contactNumber&&n.contactNumber,errorMessage:t.contactNumber,children:e.jsx(w,{type:"tel",autoComplete:"off",name:"contactNumber",placeholder:"Contact Number",component:D,prefix:e.jsx(ke,{className:"text-xl"})})})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsx("div",{className:"col-span-1",children:e.jsx(y,{label:"Title",invalid:t.title&&n.title,errorMessage:t.title,children:e.jsx(w,{type:"text",autoComplete:"off",name:"title",placeholder:"Title",component:D,prefix:e.jsx(qe,{className:"text-xl"})})})})}),e.jsx(y,{label:"Notes",invalid:t.description&&n.description,errorMessage:t.description,children:e.jsx(w,{textArea:!0,type:"text",autoComplete:"off",name:"description",placeholder:"Notes",component:D,prefix:e.jsx(ze,{className:"text-xl"})})}),e.jsx(q,{title:"Address",desc:"",className:"mb-2"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"col-span-1",children:e.jsx(y,{label:"Address",invalid:t.address&&n.address,errorMessage:t.address,children:e.jsx(w,{type:"text",autoComplete:"off",name:"address",placeholder:"Address",component:D,prefix:e.jsx(Re,{className:"text-xl"})})})}),e.jsx("div",{className:"col-span-1",children:e.jsx("div",{className:"col-span-1",children:e.jsx(y,{label:"State",invalid:t.stateId&&n.stateId,errorMessage:t.stateId,children:e.jsx(k,{name:"stateId",placeholder:"Select State",options:S,id:"stateId",value:S.find(a=>(a==null?void 0:a.value)==(c==null?void 0:c.stateId)),onChange:a=>{const s=a.value;c.stateId!==s&&l("cityId",""),l("stateId",s||""),I(s)}})})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"col-span-1",children:e.jsx("div",{className:"col-span-1",children:e.jsx(y,{label:"City",invalid:t.cityId&&n.cityId,errorMessage:t.cityId,children:e.jsx(k,{name:"cityId",placeholder:"Select City",options:M,id:"cityId",value:M.find(a=>(a==null?void 0:a.value)===(c==null?void 0:c.cityId))||{value:"",label:"Select City"},onChange:a=>{const s=a.value;s!==c.cityId&&l("cityId",s||"")}})})})}),e.jsx("div",{className:"col-span-1",children:e.jsx("div",{style:{position:"relative"},children:e.jsx("div",{className:"col-span-1",children:e.jsx(y,{label:"ZipCode",invalid:t.zipcode&&n.zipcode,errorMessage:t.zipcode,children:e.jsx(w,{type:"text",autoComplete:"off",name:"zipcode",placeholder:"ZipCode",component:D,prefix:e.jsx(Ee,{className:"text-xl"})})})})})})]}),e.jsx(q,{title:"Contact Others Details",desc:"",className:"mb-2"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"col-span-1",children:e.jsx(y,{label:"Company Name",invalid:t.companiesId&&n.companiesId,errorMessage:t.companiesId,children:e.jsx(k,{name:"companiesId",placeholder:"Company Name",options:j,id:"companiesId",value:j.find(a=>(a==null?void 0:a.value)==(c==null?void 0:c.companiesId)),onChange:a=>{const s=a.value;l("companiesId",s||"")}})})}),e.jsx("div",{className:"col-span-1",children:e.jsx(y,{label:"Source",invalid:t.source&&n.source,errorMessage:t.source,children:e.jsx(w,{isClearable:!0,type:"text",autoComplete:"off",name:"sourceId",placeholder:"Source",component:k,componentAs:$e,options:A,prefix:e.jsx(J,{className:"text-xl"}),onChange:m})})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsx("div",{className:"col-span-1",children:e.jsx(y,{label:"Tag",children:e.jsx(w,{isClearable:!0,isMulti:!0,type:"text",autoComplete:"off",name:"tagId",placeholder:"Select tags",component:k,options:p,prefix:e.jsx(J,{className:"text-xl"}),closeMenuOnSelect:!1,onChange:z})})})})]})},He=Ae().shape({firstName:v().required("First Name is required"),lastName:v().required("Last Name is required"),title:v(),contactNumber:v().typeError("Contact must be a number").required("Contact is required").test("is-number","Contact must be a number",o=>!isNaN(o)).test("is-ten-digits","Contact must be exactly 10 digits",o=>{if(o){const n=Number(o);return/^\d{10}$/.test(n.toString())}return!0}).test("is-ten-digits","Contact number cannot start with 0",o=>o?!o.startsWith("0"):!0),email:v().matches(/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/i,"Invalid email").required("Email is required"),address:v(),stateId:v(),cityId:v(),zipcode:v().test("is-number","ZipCode must be a number",o=>!(o&&isNaN(Number(o)))).test("is-six-digits","ZipCode must be exactly 6 digits",o=>!(o&&o.length!==6)),companiesId:v().nullable(),companyName:v(),source:v().nullable(),description:v(),tagId:Le()}),{TabNav:Pe,TabList:Ue,TabContent:_e}=ee,te=h.forwardRef((o,n)=>{var d,u,I,T;const t=f(x=>x.crmContact.data.selectedContact),c=f(x=>x.crmContact.data.sources),l=h.useMemo(()=>c.map(C=>({label:C.sources,value:C.id})),[c]),r=!!t.id,p=F();return e.jsx(Fe,{innerRef:n,initialValues:{firstName:(t==null?void 0:t.firstName)||"",lastName:(t==null?void 0:t.lastName)||"",title:(t==null?void 0:t.title)||"",email:(t==null?void 0:t.email)||"",contactNumber:(t==null?void 0:t.contactNumber)||"",description:(t==null?void 0:t.description)||"",companyName:((d=t==null?void 0:t.company)==null?void 0:d.companyName)||"",sourceId:t!=null&&t.sourceId?l.find(x=>x.value===(t==null?void 0:t.sourceId)):null,address:(t==null?void 0:t.address)||"",stateId:(t==null?void 0:t.stateId)||"",cityId:(t==null?void 0:t.cityId)||"",zipcode:(t==null?void 0:t.zipcode)||"",tagName:((I=(u=t==null?void 0:t.tags)==null?void 0:u[0])==null?void 0:I.tagName)||"",tagId:((T=t==null?void 0:t.tags)==null?void 0:T.map(x=>({label:x.tagName,value:x.id})))||[],companiesId:(t==null?void 0:t.companiesId)||""},validationSchema:He,onSubmit:async(x,{setSubmitting:C})=>{var j,S,M,A,L,z,m;try{const{tagName:a,...s}=x,g={...s,sourceId:(j=s==null?void 0:s.sourceId)==null?void 0:j.value,tagId:s==null?void 0:s.tagId.map(oe=>oe.value)},i=r?await p(ye({contactId:(t==null?void 0:t.id)||"",updatedData:g})):await p(ve(g)),b=(S=i==null?void 0:i.payload)!=null&&S.success?"Successfully Added":"Something went wrong !!!",N=(M=i==null?void 0:i.payload)!=null&&M.success?"success":"danger",E=(A=i==null?void 0:i.payload)!=null&&A.success?(L=i==null?void 0:i.payload)==null?void 0:L.message:(z=i==null?void 0:i.error)==null?void 0:z.message;P.push(e.jsx(U,{title:b,type:N,duration:2500,children:E}),{placement:"top-end"}),(m=i==null?void 0:i.payload)!=null&&m.success&&p(X()),await p(Z()),await p(Q())}catch(a){console.error(a)}finally{C(!1)}},children:({touched:x,errors:C,values:j,setFieldValue:S})=>e.jsx(Me,{children:e.jsx(De,{children:e.jsxs(ee,{defaultValue:"personalInfo",children:[e.jsx(Ue,{children:e.jsx(Pe,{value:"personalInfo",children:"Contact Details"})}),e.jsx("div",{className:"p-6",children:e.jsx(_e,{value:"personalInfo",children:e.jsx(Be,{touched:x,errors:C,values:j,setFieldValue:S})})})]})})})})});te.displayName="ContactForm";const ae=h.forwardRef((o,n)=>{F();const t=f(l=>l.crmContact.data.selectedContact);f(l=>l.crmContact.data.contactList);const c=async l=>{};return e.jsx(te,{ref:n,contact:t,onFormSubmit:c})});ae.displayName="ContactEditContent";const Ge=({onSaveClick:o,onCancel:n})=>e.jsxs("div",{className:"text-right w-full",children:[e.jsx(_,{size:"sm",className:"mr-2",onClick:n,children:"Cancel"}),e.jsx(_,{size:"sm",variant:"solid",onClick:o,children:"Save"})]}),Je=()=>{const o=F(),[n,t]=h.useState(window.innerWidth/2),c=f(u=>u.crmContact.data.drawerOpen),l=()=>{o(X()),o(R({}))},r=h.useRef(null),p=()=>{var u,I;console.log("formSubmit function called",(u=r.current)==null?void 0:u.values),(I=r.current)==null||I.submitForm()},d=()=>{t(window.innerWidth/2)};return h.useEffect(()=>(window.addEventListener("resize",d),()=>{window.removeEventListener("resize",d)}),[]),e.jsx(Se,{isOpen:c,closable:!1,bodyClass:"p-0",width:n,footer:e.jsx(Ge,{onCancel:l,onSaveClick:p}),onClose:l,onRequestClose:l,children:e.jsx(ae,{ref:r})})},Qe=()=>{const o=F(),n=f(m=>m.crmContact.data.displayedContactList),t=$("contacts","canModify"),c=$("contacts","canDelete"),l=$("contacts","canView"),r=f(m=>m.crmContact.data.loading),p=re(),{pageIndex:d,pageSize:u,sort:I,query:T,total:x}=f(m=>m.crmContact.data.tableData),C=h.useCallback(()=>{o(Z()),o(V())},[o]);h.useEffect(()=>{C()},[C]);const j=h.useMemo(()=>({pageIndex:d,pageSize:u,sort:I,query:T,total:x}),[d,u,I,T,x]),S=({row:m})=>{const a=F();de();const s=()=>{a(Y()),a(R(m))},g=async()=>{a(R(m)),a(H(!0))},i=()=>{a(R(m));const b=`/app/crm/contact-details/${m.id}`;p(b)};return e.jsxs("div",{className:"flex text-base items-center",children:[t&&e.jsx("span",{className:"cursor-pointer hover:text-indigo-500 circle items-center",onClick:s,children:e.jsx(pe,{})}),c&&e.jsx("span",{className:"cursor-pointer hover:text-red-500 circle mx-1 items-center",onClick:g,children:e.jsx(ue,{})}),l&&e.jsx("span",{className:"cursor-pointer hover:text-green-500 circle items-center text-lg",onClick:i,children:e.jsx(Ke,{})})]})},M=h.useMemo(()=>[{header:"Action",id:"action",cell:a=>e.jsx(S,{row:a.row.original})},{header:"Name",accessorKey:"firstName",cell:a=>{const{firstName:s,lastName:g}=a.row.original,i=`${s} ${g}`;return e.jsx(O,{text:i,maxLength:20})}},{header:"email",accessorKey:"email",cell:a=>a.row.original.email},{header:"Number",accessorKey:"contactNumber",cell:a=>a.row.original.contactNumber},{header:"source",accessorKey:"sourceId",cell:a=>{var g,i,b,N;const s=(i=(g=a.row.original)==null?void 0:g.source)!=null&&i.sources?(N=(b=a.row.original)==null?void 0:b.source)==null?void 0:N.sources:"-";return e.jsx(O,{text:s,maxLength:15})}},{header:"Tags",accessorKey:"tagName",cell:a=>{const s=a.row.original.tags;return s!=null&&s.length>0?e.jsx(le,{tags:s}):"-"}},{header:"Title",accessorKey:"title",cell:a=>{const s=a.row.original.title?a.row.original.title:"-";return e.jsx(B,{title:s,children:e.jsx(O,{text:s,maxLength:15})},s)}},{header:"Company",accessorKey:"companyName",cell:a=>{const s=a.row.original.company?a.row.original.company.companyName:"-";return e.jsx(O,{text:s,maxLength:15})}},{header:"Address",accessorKey:"address",cell:a=>{const{address:s,cityData:g,stateData:i,zipcode:b}=a.row.original,N=[s,g==null?void 0:g.cityName,i==null?void 0:i.stateName,b].filter(E=>E!=null).join(" ");return e.jsx(B,{title:N||"-",children:e.jsx(O,{text:N||"-",maxLength:20})},N)}},{header:"Notes",accessorKey:"description",cell:a=>{const s=a.row.original.description?a.row.original.description:"-";return e.jsx(B,{title:s,children:e.jsx(O,{text:s,maxLength:20})},s)}}],[t,c]),A=m=>{const a=K(j);a.pageIndex=m,o(W(a))},L=m=>{const a=K(j);a.pageSize=Number(m),a.pageIndex=1,o(W(a))},z=m=>{const a=K(j);a.sort=m,o(W(a))};return e.jsxs("div",{children:[e.jsx(ce,{columns:M,data:n,loading:r,pagingData:{total:j.total,pageIndex:j.pageIndex,pageSize:j.pageSize},onPaginationChange:A,onSelectChange:L,onSort:z}),e.jsx(Je,{}),e.jsx(Ze,{})]})},se=h.forwardRef((o,n)=>{const{onInputChange:t}=o,c=We(l,500);function l(p){t==null||t(p)}const r=p=>{c(p.target.value)};return e.jsx(D,{ref:n,className:"max-w-md md:w-52 mb-4",size:"sm",placeholder:"Search",prefix:e.jsx(xe,{className:"text-lg"}),onChange:r})});se.displayName="ContactTableSearch";const Ve=()=>{const o=F(),n=h.useRef(null),t=f(d=>d.crmContact.data.tableData),c=$("contacts","canCreate"),l=d=>{const u=K(t);u.query=d,u.pageIndex=1,typeof d=="string"&&d.length>1&&r(u),typeof d=="string"&&d.length===0&&r(u)},r=d=>{o(d?W(d):Z())},p=()=>{o(Y()),o(R({}))};return e.jsxs("div",{className:"md:flex items-center justify-between",children:[e.jsx("div",{className:"md:flex items-center gap-4",children:e.jsx(se,{ref:n,onInputChange:l})}),e.jsx("div",{className:"mb-4",children:c&&e.jsx(_,{size:"sm",onClick:p,children:"Add New"})})]})};ie("crmContact",Ie);const Xe=()=>{const o=f(n=>n.crmContact.data.tableData);return e.jsx(e.Fragment,{children:e.jsxs(ne,{bodyClass:"h-full",children:[e.jsx(q,{title:`Contacts (${o==null?void 0:o.total})`,desc:"",className:"mb-2"}),e.jsx(Ve,{}),e.jsx(Qe,{})]})})},La=Xe;export{La as default};
