import{a as w,j as e,r as p,ap as ae,ah as se,aq as oe}from"./index-dc23d4d5.js";import{A as re}from"./AdaptableCard-4ed8675a.js";import{D as ne}from"./DataTable-62cc384e.js";import{S as ie}from"./StatusCapsule-60c004a4.js";import{D as ce,t as le,c as de,T as me}from"./tagAndCategory-3c73301d.js";import{T as O}from"./TextTruncate-456c51f4.js";import{u as M}from"./checkEditUpdate-10f36879.js";import{u as pe}from"./useThemeClass-8c0084d6.js";import{c as B}from"./cloneDeep-9e6994f4.js";import{u as g,t as P,d as ue,g as k,a as _,b as ge,f as he,c as xe,e as fe,h as je,s as J,i as be,j as H,k as z,l as Q,r as Le}from"./index-ae0d6448.js";import{t as K,N as W}from"./toast-f63a7bff.js";import{C as we}from"./ConfirmDialog-2751076f.js";import{B as U}from"./Button-2503e753.js";import{D as Ce}from"./Drawer-c45873b3.js";import{a as A,F as De}from"./FormItem-83714e3c.js";import{T as X}from"./index-3642908f.js";import{u as Ne,b as E,F as ye,a as ve}from"./formik.esm-4cdcb068.js";import{c as Se,a as V,d as Te,e as Ie}from"./index.esm-be4aa8b1.js";import{I as q}from"./Input-6df97c26.js";/* empty css              */import"./Alert-69392695.js";import{A as Ae}from"./index-cd4f30c5.js";import"./Badge-54fd55ab.js";import"./RangeCalendar-4a1aa7d0.js";import{C as Fe}from"./Card-53030d97.js";import"./index-7387e6a3.js";import"./index-523d8345.js";import"./Dialog-cf49f15b.js";import"./index-470259c7.js";import"./toString-812aacee.js";import"./index-b2d1bd5e.js";import"./index-fbcc6caf.js";import"./index-07f71a80.js";import"./Pagination-b6c8442e.js";import"./Progress-4fa29660.js";import"./index-18933ced.js";import"./ScrollBar-12696a62.js";import"./index-060d41dd.js";import{S as ke}from"./Select-d8ee6a0d.js";import"./Skeleton-0ded8fec.js";import"./index-96415184.js";import"./Switcher-7ee0d497.js";import"./index-40cae662.js";import"./Tag-83d01dc5.js";import"./index-d224eaaa.js";import"./index-ad0d3fa9.js";import{T as G}from"./Tooltip-3f2f3d9e.js";import"./Upload-c9737ebf.js";import{T as Re,a as Oe}from"./index.esm-7ae7550b.js";import{M as Ee}from"./index.esm-99b45bad.js";import{B as Me}from"./index.esm-4e1e8bcb.js";import{N as Be,O as ze,b as qe,o as Ve,P as $e,C as Pe}from"./index.esm-915a2267.js";import{A as He}from"./index.esm-c3cfea61.js";import{d as Ke}from"./debounce-7ddc5206.js";import{g as We}from"./index-6e813161.js";import{s as Ue}from"./index-e9adcb0a.js";import{F as _e}from"./FormDesription-aa76249a.js";import{M as Ge}from"./MediaSkeleton-4bd10150.js";import{N as Je}from"./react-number-format.es-31d9259c.js";import"./index-3303c2d0.js";import"./_MapCache-2a76a3cc.js";import"./Views-6bb03ba3.js";import"./_getPrototype-4696ace3.js";import"./CrmService-252ce793.js";import"./useTimeout-5d92632c.js";import"./CloseButton-0edfd0bd.js";import"./StatusIcon-2a070c6b.js";import"./chainedFunction-070f832c.js";import"./index-45967eae.js";import"./index-67754ed7.js";import"./useControllableState-a8bdd918.js";import"./isNil-756b33df.js";import"./get-a9e0dd90.js";import"./useMergeRef-788c4cb0.js";import"./_baseIsEqual-431566fb.js";import"./useRootClose-3755829d.js";import"./usePopper-72f5cea7.js";import"./TimeInput-25918e5d.js";import"./useUniqueId-15ed374c.js";import"./useDidUpdate-c9908ab3.js";import"./useUncertainRef-5aee75c6.js";import"./slicedToArray-dc1d019d.js";import"./objectWithoutProperties-8809bfcf.js";import"./toConsumableArray-81fff5a8.js";import"./floating-ui.dom-bef9cea3.js";import"./mapCloneElement-3eab167e.js";import"./index.esm-ad4339c6.js";import"./index.esm-3ef0d6ad.js";import"./index-7871773f.js";import"./index-0380bf86.js";const Qe=()=>{const a=w(),o=g(r=>r.crmLeads.data.deleteConfirmation),t=g(r=>r.crmLeads.data.selectedLeads),d=()=>{a(P(!1))},c=async()=>{var m,l,h;a(P(!1));const r=await a(ue(t.id));await a(k()),(m=r==null?void 0:r.payload)!=null&&m.success?K.push(e.jsx(W,{title:"Successfuly Deleted",type:"success",duration:2500,children:(l=r==null?void 0:r.payload)==null?void 0:l.message}),{placement:"top-end"}):K.push(e.jsx(W,{title:"Something Went Wrong !!!",type:"danger",duration:2500,children:(h=r==null?void 0:r.error)==null?void 0:h.message}),{placement:"top-end"}),await a(k()),await a(_())};return e.jsx(we,{isOpen:o,type:"danger",title:"Delete Lead",confirmButtonColor:"red-600",onClose:d,onRequestClose:d,onCancel:d,onConfirm:c,children:e.jsx("p",{children:"Are you sure you want to delete this Lead? All record related to this lead will be deleted as well. This action cannot be undone."})})},F=[],Xe=a=>{const{touched:o,errors:t,setFieldValue:d,values:c}=a,r=w(),m=Ne(),[l,h]=p.useState(!1),[i,f]=p.useState(!1),[x,C]=p.useState([]),T=()=>{h(!l),f(!1)},v=g(s=>s.crmLeads.data.contactList);F.length=0,v.forEach(s=>{F.push({value:s==null?void 0:s.id,label:`${s==null?void 0:s.firstName} ${s==null?void 0:s.lastName}`})});const[I,D]=p.useState("");p.useEffect(()=>{(async()=>{var j,S;try{const{payload:b}=await r(he()),y=(j=b==null?void 0:b.data)==null?void 0:j.find(L=>(L==null?void 0:L.moduleName)==="leads");if(D(y.id),y){const{payload:L}=await r(xe({id:(S=y==null?void 0:y.id)==null?void 0:S.toString()})),te=le(L.data),ct=de(L.data);C(te)}}catch(b){console.error("Error fetching module data:",b)}})(),r(ge())},[r]);const N=g(s=>s.crmLeads.data.selectedLeads);g(s=>s.crmLeads.data.productList);const[R,u]=p.useState(N?N.tags||[]:[]),n=s=>{u(s);const j=[s.value];m.setFieldValue("tagId",j)};return console.log("hd",R),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"col-span-1",children:e.jsx(A,{label:"Contact Name",invalid:t.contactsDataId&&o.contactsDataId,errorMessage:t.contactsDataId,children:e.jsx(ke,{name:"contactsDataId",placeholder:"Contact Name",options:F,id:"contactsDataId",value:F.find(s=>(s==null?void 0:s.value)===(c==null?void 0:c.contactsDataId)),onChange:s=>{const j=s.value;d("contactsDataId",j)}})})}),e.jsx("div",{className:"col-span-1",children:e.jsx(A,{label:"Title",invalid:t.title&&o.title,errorMessage:t.title,children:e.jsx(E,{type:"text",autoComplete:"off",name:"title",placeholder:"Title",component:q,prefix:e.jsx(Ee,{className:"text-xl"})})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"col-span-1",children:e.jsx(A,{label:"Budget",invalid:t.budget&&o.budget,errorMessage:t.budget,children:e.jsx(E,{type:"number",autoComplete:"off",name:"budget",placeholder:"Budget",component:q,prefix:e.jsx(Me,{className:"text-xl"})})})}),e.jsx("div",{className:"col-span-1",children:e.jsx(A,{label:"Tag",children:e.jsxs("div",{style:{position:"relative"},children:[e.jsx(E,{name:"tagId",component:ce,value:m.initialValues.tagName,options:x,placeholder:"Select a Tag",onChange:n}),e.jsx(Re,{style:{position:"absolute",right:"10px",top:"10px",border:"none",background:"#FFF"},className:"text-xl",onClick:()=>{T(),f(!0)}})]})})})]}),e.jsx(A,{label:"Notes",invalid:t.notes&&o.notes,errorMessage:t.notes,children:e.jsx(E,{textArea:!0,type:"text",autoComplete:"off",name:"notes",placeholder:"Notes",component:q,prefix:e.jsx(Oe,{className:"text-xl"})})})]})},Ye=Se().shape({title:V().required("Title is required"),notes:V(),budget:Te().test("greaterThanOne","Budget must be greater than 1",a=>a>0).required("Budget is required"),tagId:Ie(),contactsDataId:V().test("is-valid-contact","Invalid contact selected",function(a){return this.parent.contactsDataId&&this.parent.contactsDataId.length>0?!!F.find(o=>o.value===a):!0})}),{TabNav:Ze,TabList:et,TabContent:tt}=X,Y=p.forwardRef((a,o)=>{var l,h;const t=g(i=>i.crmLeads.data.selectedLeads),d=!!t.id,c=w(),r=async(i,f,x)=>{var v,I,D,N;const C=(v=i==null?void 0:i.payload)!=null&&v.success?f:"Something went wrong !!!",T=(I=i==null?void 0:i.payload)!=null&&I.success?(D=i==null?void 0:i.payload)==null?void 0:D.message:x;K.push(e.jsx(W,{title:C,type:(N=i==null?void 0:i.payload)!=null&&N.success?"success":"danger",duration:2500,children:T}),{placement:"top-end"})},m=async(i,{setSubmitting:f})=>{try{const x={title:i.title,contactsDataId:i.contactsDataId,budget:i.budget.toString(),description:i.notes,tagId:[]},{colorName:C,name:T,tagName:v,...I}=i,D=d?await c(fe({leadsId:(t==null?void 0:t.id)||"",updatedData:x})):await c(je(x));await r(D,d?"Successfully Updated":"Successfully Added","An error occurred."),c(J()),await Promise.all([c(k()),c(_())])}catch(x){console.error("An error occurred:",x)}finally{f(!1)}};return e.jsx(ye,{innerRef:o,initialValues:{contactsDataId:t.contactsDataId||"",title:(t==null?void 0:t.title)||"",notes:(t==null?void 0:t.description)||"",tagName:((h=(l=t==null?void 0:t.tags)==null?void 0:l[0])==null?void 0:h.tagName)||"",budget:(t==null?void 0:t.budget)||""},validationSchema:Ye,onSubmit:m,children:({touched:i,errors:f,values:x,setFieldValue:C})=>e.jsx(ve,{children:e.jsx(De,{children:e.jsxs(X,{defaultValue:"leadsInfo",children:[e.jsx(et,{children:e.jsx(Ze,{value:"leadsInfo",children:"Leads Detail"})}),e.jsx("div",{className:"p-6",children:e.jsx(tt,{value:"leadsInfo",children:e.jsx(Xe,{touched:i,errors:f,setFieldValue:C,values:x})})})]})})})})});Y.displayName="LeadsForm";const Z=p.forwardRef((a,o)=>{w();const t=g(c=>c.crmLeads.data.selectedLeads);g(c=>c.crmLeads.data.leadsList);const d=async c=>{};return e.jsx(Y,{ref:o,leads:t,onFormSubmit:d})});Z.displayName="LeadsEditContent";const at=({onSaveClick:a,onCancel:o})=>e.jsxs("div",{className:"text-right w-full",children:[e.jsx(U,{size:"sm",className:"mr-2",onClick:o,children:"Cancel"}),e.jsx(U,{size:"sm",variant:"solid",onClick:a,children:"Save"})]}),st=()=>{const a=w(),o=g(l=>l.crmLeads.data.drawerOpen),[t,d]=p.useState(window.innerWidth/2),c=()=>{a(J()),a(H({}))},r=p.useRef(null),m=()=>{var l;(l=r.current)==null||l.submitForm()};return p.useEffect(()=>{a(be())},[]),e.jsx(Ce,{isOpen:o,closable:!1,bodyClass:"p-0",width:t,footer:e.jsx(at,{onCancel:c,onSaveClick:m}),onClose:c,onRequestClose:c,children:e.jsx(Z,{ref:r})})},ot=()=>{const a=w(),o=g(u=>u.crmLeads.data.displayedLeadsList),t=g(u=>u.crmLeads.data.loading),{pageIndex:d,pageSize:c,sort:r,query:m,total:l}=g(u=>u.crmLeads.data.tableData),h=p.useCallback(()=>{a(k())},[a]);p.useEffect(()=>{h()},[h]);const i=p.useMemo(()=>({pageIndex:d,pageSize:c,sort:r,query:m,total:l}),[d,c,r,m,l]),f=M("leads","canDelete"),x=M("leads","canModify"),C=M("leads","canView"),T=ae(),v=({row:u})=>{const n=w();pe();const s=()=>{n(Q()),n(H(u))},j=async()=>{await n(H(u)),n(P(!0))},S=()=>{const b=`/app/crm/lead-details/${u.id}`;T(b)};return e.jsxs("div",{className:"flex text-base items-center",children:[x&&e.jsx("span",{className:"cursor-pointer hover:text-indigo-500 circle items-center",onClick:s,children:e.jsx(Be,{})}),C&&e.jsx("span",{className:"cursor-pointer  hover:text-green-500 circle mx-1 items-center text-lg",onClick:S,children:e.jsx(He,{})}),f&&e.jsx("span",{className:"cursor-pointer hover:text-red-500 circle items-center",onClick:j,children:e.jsx(ze,{})})]})},I=p.useMemo(()=>[{header:"Action",id:"action",cell:n=>e.jsx(v,{row:n.row.original})},{header:"Contact Name",accessorKey:"contactName",cell:n=>{var j,S,b,y,L;const s=(j=n.row.original)!=null&&j.contactData?((b=(S=n.row.original)==null?void 0:S.contactData)==null?void 0:b.firstName)+" "+((L=(y=n.row.original)==null?void 0:y.contactData)==null?void 0:L.lastName):null;return e.jsx(O,{text:s,maxLength:20})}},{header:"Title",accessorKey:"title",cell:n=>{const s=n.row.original.title;return e.jsx(G,{title:s,children:e.jsx(O,{text:s,maxLength:20})},s)}},{header:"Budget",accessorKey:"budget",cell:n=>{const s=n.row.original;return e.jsx(O,{text:s.budget,maxLength:20})}},{header:"Status",accessorKey:"status",cell:n=>{const s=n.row.original;return e.jsx(ie,{status:s.status})}},{header:"Tag Name",accessorKey:"tagName",cell:n=>{const s=n.row.original.tags||[];return e.jsx(me,{tags:s})}},{header:"Notes",accessorKey:"description",cell:n=>{const s=n.row.original.description;return e.jsx(G,{title:s,children:e.jsx(O,{text:s,maxLength:20})},s)}}],[x,f]),D=u=>{const n=B(i);n.pageIndex=u,a(z(n))},N=u=>{const n=B(i);n.pageSize=Number(u),n.pageIndex=1,a(z(n))},R=u=>{const n=B(i);n.sort=u,a(z(n))};return e.jsxs("div",{children:[e.jsx(ne,{columns:I,data:o,skeletonAvatarColumns:[0],skeletonAvatarProps:{width:28,height:28},loading:t,pagingData:{total:i.total,pageIndex:i.pageIndex,pageSize:i.pageSize},onPaginationChange:D,onSelectChange:N,onSort:R}),e.jsx(st,{}),e.jsx(Qe,{})]})},ee=p.forwardRef((a,o)=>{const{onInputChange:t}=a,d=Ke(c,500);function c(m){t==null||t(m)}const r=m=>{d(m.target.value)};return e.jsx(q,{ref:o,className:"max-w-md md:w-52 mb-4",size:"sm",placeholder:"Search",prefix:e.jsx(qe,{className:"text-lg"}),onChange:r})});ee.displayName="LeadsTableSearch";const rt=()=>{const a=w(),o=p.useRef(null),t=g(l=>l.crmLeads.data.tableData),d=M("leads","canCreate"),c=l=>{const h=B(t);h.query=l,h.pageIndex=1,typeof l=="string"&&l.length>1&&r(h),typeof l=="string"&&l.length===0&&r(h)},r=l=>{a(l?z(l):k())},m=()=>{a(Q()),a(Ue("Add"))};return p.useEffect(()=>{async function l(){await a(We())}l()},[a]),e.jsxs("div",{className:"md:flex items-center justify-between",children:[e.jsx("div",{className:"md:flex items-center gap-4",children:e.jsx(ee,{ref:o,onInputChange:c})}),e.jsx("div",{className:"mb-4",children:d&&e.jsx(U,{size:"sm",onClick:m,children:"Add New"})})]})},$=a=>{const{icon:o,avatarClass:t,label:d,value:c,loading:r}=a,m=55;return e.jsx(Fe,{bordered:!0,children:e.jsx(se,{loading:r,customLoader:e.jsx(Ge,{avatarProps:{className:"rounded",width:m,height:m}}),children:e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Ae,{className:t,size:m,icon:o}),e.jsxs("div",{children:[e.jsx("span",{children:d}),e.jsx("h3",{children:e.jsx(Je,{thousandSeparator:!0,displayType:"text",value:c})})]})]})})})})},nt=()=>{const a=w(),o=g(d=>d.crmLeads.data.statisticData),t=g(d=>d.crmLeads.data.statisticLoading);return p.useEffect(()=>{a(_())},[]),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4 mb-6",children:[e.jsx($,{icon:e.jsx(Ve,{}),avatarClass:"!bg-indigo-600",label:"Total Leads",value:o.totalLeads,growthRate:o==null?void 0:o.totalLeads,loading:t}),e.jsx($,{icon:e.jsx($e,{}),avatarClass:"!bg-blue-500",label:"Active Leads",value:o.activeLeads,growthRate:o.activeLeads,loading:t}),e.jsx($,{icon:e.jsx(Pe,{}),avatarClass:"!bg-emerald-500",label:"This Week's New Leads",value:o==null?void 0:o.newLeads,growthRate:o==null?void 0:o.newLeads,loading:t})]})};oe("crmLeads",Le);const it=()=>{const a=g(o=>o.crmLeads.data.tableData);return e.jsxs(e.Fragment,{children:[e.jsx(nt,{}),e.jsxs(re,{bodyClass:"h-full",children:[e.jsx(_e,{title:`Leads (${a==null?void 0:a.total})`,desc:"",className:"mb-2"}),e.jsx(rt,{}),e.jsx(ot,{})]})]})},Wa=it;export{Wa as default};
