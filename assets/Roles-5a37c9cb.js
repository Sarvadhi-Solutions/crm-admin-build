import{am as F,an as Se,ao as Me,ap as ve,a as v,j as e,r as C,u as me,p as Ie,aq as ke}from"./index-4675262e.js";import{D as Fe}from"./DataTable-1574da48.js";import{u as V}from"./checkEditUpdate-13f2672a.js";import{c as L}from"./cloneDeep-477b9741.js";import{Q as Te,O as Ae,P as Ee,b as Le}from"./index.esm-ff144046.js";import{aQ as Pe,M as Oe,aR as Ve,aS as qe,aT as ze,t as Ue}from"./CrmService-ac08cdaf.js";import{t as q,N as z}from"./toast-3dd25308.js";import{C as $e}from"./ConfirmDialog-4eaa7b26.js";import{B as U}from"./Button-0b68e0a2.js";import{D as He}from"./Drawer-4463e2fa.js";import{i as Ye}from"./Views-96bf4241.js";import{a as pe,F as Be}from"./FormItem-f0a568d5.js";import{T as he}from"./index-aa614f08.js";import{u as Ge,b as ue,F as We,a as _e}from"./formik.esm-be6a51d3.js";import{c as xe,a as ye}from"./index.esm-b46f51f2.js";import{I as ge}from"./Input-b6f85393.js";/* empty css              */import{S as Je}from"./Switcher-abd8f95e.js";import{n as T,o as A}from"./index.esm-c132f852.js";import"./Alert-e71f6da7.js";import"./index-32f51c8f.js";import"./Badge-8de88fc8.js";import"./RangeCalendar-7055646c.js";import"./Card-1a4ea392.js";import"./index-b0ec1b4c.js";import"./index-40ee1fcd.js";import"./Dialog-2674822d.js";import"./index-395f0e43.js";import"./toString-5a26993f.js";import"./index-799960ed.js";import"./index-567c5b37.js";import"./index-29fb88aa.js";import"./Pagination-2e203a3f.js";import"./Progress-163e7627.js";import"./index-ac935edf.js";import"./ScrollBar-c918a49a.js";import"./index-befed326.js";import"./Select-ecee390b.js";import"./Skeleton-5516a2a7.js";import"./index-819658e8.js";import"./index-dc5daab9.js";import"./Tag-613d51b1.js";import"./index-bcfe7745.js";import"./index-9a848025.js";import"./Tooltip-2d93a4c5.js";import"./Upload-e8a604f5.js";import{d as Ke}from"./debounce-7228e5e1.js";import"./index-6e5c150b.js";import"./moment-fbc5633a.js";import"./_MapCache-594565d2.js";import"./_getPrototype-5d191e98.js";import"./useTimeout-d031dca4.js";import"./CloseButton-f37e3705.js";import"./StatusIcon-69b21449.js";import"./chainedFunction-070f832c.js";import"./index-cd7de78e.js";import"./index-99abface.js";import"./useControllableState-048d3f43.js";import"./isNil-7c9d5aca.js";import"./get-59654049.js";import"./useMergeRef-788c4cb0.js";import"./_baseIsEqual-b207db6b.js";import"./useRootClose-bb6a1813.js";import"./usePopper-e9b5a625.js";import"./TimeInput-e183a601.js";import"./useUniqueId-f4a3bad2.js";import"./useDidUpdate-3fa7b336.js";import"./useUncertainRef-9680db51.js";import"./slicedToArray-24f82e16.js";import"./objectWithoutProperties-8809bfcf.js";import"./toConsumableArray-92a33187.js";import"./floating-ui.dom-4bc0055b.js";import"./mapCloneElement-20d9df92.js";import"./index.esm-2d8103e0.js";import"./index.esm-3440a998.js";const Qe="crmRoles",fe=F("crmRoles/data/getRolesStatistic",async()=>(await Pe()).data),M=F("crmRoles/data/getRoles",async()=>(await Oe()).data),Re=F("crmRoles/data/putRoles",async({id:a,data:s})=>{var t,o;try{return(await Ve(a,s)).data}catch(l){throw new Error((o=(t=l==null?void 0:l.response)==null?void 0:t.data)==null?void 0:o.message)}}),Xe=F("crmRoles/data/deleteRoles",async a=>{var s,t;try{return(await qe(a)).data}catch(o){throw new Error((t=(s=o==null?void 0:o.response)==null?void 0:s.data)==null?void 0:t.message)}}),Ze=F("crmRoles/data/createRoles",async a=>{var s,t;try{return(await ze(a)).data}catch(o){throw new Error((t=(s=o==null?void 0:o.response)==null?void 0:s.data)==null?void 0:t.message)}}),ea=F("crmRoles/data/module",async()=>(await Ue()).data),aa={total:0,pageIndex:1,pageSize:10,query:"",sort:{order:"",key:""}},sa={status:""},ta={loading:!1,statisticLoading:!1,deleteConfirmation:!1,rolesList:[],displayedRolesList:[],statisticData:{},tableData:aa,filterData:sa,drawerOpen:!1,selectedRole:{},drawerMode:"Add"},je=Se({name:`${Qe}/state`,initialState:ta,reducers:{setTableData:(a,s)=>{a.tableData=s.payload;const t=a.rolesList.filter(o=>o.roleName.toLowerCase().includes(s.payload.query.toLowerCase()));a.tableData.total=t.length,a.displayedRolesList=t==null?void 0:t.slice(s.payload.pageSize*(s.payload.pageIndex-1),s.payload.pageSize*s.payload.pageIndex)},setRolesList:(a,s)=>{a.rolesList=s.payload},setFilterData:(a,s)=>{a.filterData=s.payload},setSelectedRole:(a,s)=>{a.selectedRole=s.payload},setDrawerOpen:a=>{a.drawerOpen=!0},setDrawerClose:a=>{a.drawerOpen=!1},setDrawerMode:(a,s)=>{a.drawerMode=s.payload},toggleDeleteConfirmation:(a,s)=>{a.deleteConfirmation=s.payload}},extraReducers:a=>{a.addCase(M.fulfilled,(s,t)=>{var o;s.rolesList=t.payload.data,s.tableData.total=(o=t.payload.data)==null?void 0:o.length,s.displayedRolesList=t.payload.data.slice(0,10),s.loading=!1}).addCase(M.pending,s=>{s.loading=!0}).addCase(fe.fulfilled,(s,t)=>{s.statisticData=t.payload,s.statisticLoading=!1}).addCase(fe.pending,s=>{s.statisticLoading=!0})}}),{setTableData:O,setRolesList:oa,setFilterData:Vs,setSelectedRole:$,toggleDeleteConfirmation:H,setDrawerOpen:we,setDrawerClose:Y,setDrawerMode:Ce}=je.actions,ra=je.reducer,la=Me({data:ra}),D=ve,na=()=>{const a=v(),s=D(n=>n.crmRoles.data.deleteConfirmation),t=D(n=>n.crmRoles.data.selectedRole),o=()=>{a(H(!1))},l=async()=>{var u,r,g;a(H(!1));const n=await a(Xe(t.id));await a(M()),(u=n==null?void 0:n.payload)!=null&&u.success?(q.push(e.jsx(z,{title:"Successfuly Deleted",type:"success",duration:2500,children:(r=n==null?void 0:n.payload)==null?void 0:r.message}),{placement:"top-end"}),await a(M())):(q.push(e.jsx(z,{title:"Something Went Wrong !!!",type:"danger",duration:2500,children:(g=n==null?void 0:n.error)==null?void 0:g.message}),{placement:"top-end"}),await a(M()))};return e.jsx($e,{isOpen:s,type:"danger",title:"Delete Role",confirmButtonColor:"red-600",onClose:o,onRequestClose:o,onCancel:o,onConfirm:l,children:e.jsx("p",{children:"Are you sure you want to delete this role? All record related to this role will be deleted as well. This action cannot be undone."})})},E=({value:a,onClick:s,greenIcon:t,grayIcon:o,canPermission:l})=>e.jsx("td",{className:"px-4 py-2 text-center",children:e.jsx("div",{className:`${l?" border-blue-600":" border-red-300"} rounded-full p-2 cursor-pointer flex justify-center items-center`,onClick:s,children:l?t:o})}),ca=a=>{const{roles:s,drawerMode:t,errors:o,touched:l}=a,n=v(),[u,r]=C.useState([]),[g,N]=C.useState([]),p=Ge();C.useEffect(()=>{async function x(){var c;try{const f=await n(ea()),i=(c=f==null?void 0:f.payload)==null?void 0:c.data.map(h=>({masterId:h.id,canCreate:!1,canModify:!1,canView:!1,canDelete:!1,canManage:!1}));t==="Edit"&&s&&Array.isArray(s.rolePermissions)&&[...s.rolePermissions].sort((d,m)=>d.masterId-m.masterId).forEach(d=>{const m=i.findIndex(S=>S.masterId===d.masterId);m!==-1&&(i[m]=d)}),p.setFieldValue("modules",i),N(i),r(f.payload.data)}catch(f){console.error("Error fetching modules:",f)}}x()},[n]),xe().shape({rolename:ye().required("Role Name is required")});const y=(x,c,f,i)=>{const h=JSON.parse(JSON.stringify(p.values.modules));if(c!=="canManage")h[i][c]=f,h[i].canManage=h[i].canCreate&&h[i].canModify&&h[i].canView&&h[i].canDelete;else{const d={canManage:f,canCreate:f,canModify:f,canView:f,canDelete:f,masterId:x};h[i]=d}p.setFieldValue("modules",h)};return e.jsxs(e.Fragment,{children:[e.jsx(pe,{label:"Role Name",invalid:o.roleName&&l.roleName,errorMessage:o.roleName,children:e.jsx(ue,{type:"text",autoComplete:"off",name:"roleName",placeholder:"Role Name",component:ge,prefix:e.jsx(Te,{className:"text-xl"})})}),e.jsx(pe,{children:e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx("label",{className:"form-label",style:{marginRight:"10px"},children:"System Role"}),e.jsx(ue,{autoComplete:"off",name:"isSystem",component:Je,checked:p.values.isSystem})]})}),e.jsxs("table",{className:"w-full border-collapse ",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-200",children:[e.jsx("th",{className:"px-4 py-2 text-center",children:"Module"}),e.jsx("th",{className:"px-4 py-2 w-1/6 text-center",children:"All"}),e.jsx("th",{className:"px-4 py-2 w-1/6 text-center",children:"Read"}),e.jsx("th",{className:"px-4 py-2 w-1/6 text-center",children:"Write"}),e.jsx("th",{className:"px-4 py-2 w-1/6 text-center",children:"Update"}),e.jsx("th",{className:"px-4 py-2 w-1/6 text-center",children:"Delete"})]})}),e.jsx("tbody",{children:u==null?void 0:u.map((x,c)=>{var f,i,h,d,m,S,P,I,k,b,B,G,W,_,J,K,Q,X,Z,ee,ae,se,te,oe,re,le,ne,ce,ie,de;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2 text-center",children:x==null?void 0:x.moduleName.toUpperCase()}),e.jsx(E,{value:(h=(i=(f=p.values)==null?void 0:f.modules)==null?void 0:i[c])==null?void 0:h.canManage,greenIcon:e.jsx(T,{className:"text-blue-600"}),grayIcon:e.jsx(A,{className:"text-red-500"}),canPermission:(S=(m=(d=p.values)==null?void 0:d.modules)==null?void 0:m[c])==null?void 0:S.canManage,onClick:()=>{var R,j,w;return y(x.id,"canManage",!((w=(j=(R=p.values)==null?void 0:R.modules)==null?void 0:j[c])!=null&&w.canManage),c)}}),e.jsx(E,{value:(k=(I=(P=p.values)==null?void 0:P.modules)==null?void 0:I[c])==null?void 0:k.canView,greenIcon:e.jsx(T,{className:"text-blue-600"}),grayIcon:e.jsx(A,{className:"text-red-500"}),canPermission:(G=(B=(b=p.values)==null?void 0:b.modules)==null?void 0:B[c])==null?void 0:G.canView,onClick:()=>{var R,j,w;return y(x.id,"canView",!((w=(j=(R=p.values)==null?void 0:R.modules)==null?void 0:j[c])!=null&&w.canView),c)}}),e.jsx(E,{value:(J=(_=(W=p.values)==null?void 0:W.modules)==null?void 0:_[c])==null?void 0:J.canCreate,greenIcon:e.jsx(T,{className:"text-blue-600"}),grayIcon:e.jsx(A,{className:"text-red-500"}),canPermission:(X=(Q=(K=p.values)==null?void 0:K.modules)==null?void 0:Q[c])==null?void 0:X.canCreate,onClick:()=>{var R,j,w;return y(x.id,"canCreate",!((w=(j=(R=p.values)==null?void 0:R.modules)==null?void 0:j[c])!=null&&w.canCreate),c)}}),e.jsx(E,{value:(ae=(ee=(Z=p.values)==null?void 0:Z.modules)==null?void 0:ee[c])==null?void 0:ae.canModify,greenIcon:e.jsx(T,{className:"text-blue-600"}),grayIcon:e.jsx(A,{className:"text-red-500"}),canPermission:(oe=(te=(se=p.values)==null?void 0:se.modules)==null?void 0:te[c])==null?void 0:oe.canModify,onClick:()=>{var R,j,w;return y(x.id,"canModify",!((w=(j=(R=p.values)==null?void 0:R.modules)==null?void 0:j[c])!=null&&w.canModify),c)}}),e.jsx(E,{value:(ne=(le=(re=p.values)==null?void 0:re.modules)==null?void 0:le[c])==null?void 0:ne.canDelete,greenIcon:e.jsx(T,{className:"text-blue-600"}),grayIcon:e.jsx(A,{className:"text-red-500"}),canPermission:(de=(ie=(ce=p.values)==null?void 0:ce.modules)==null?void 0:ie[c])==null?void 0:de.canDelete,onClick:()=>{var R,j,w;return y(x.id,"canDelete",!((w=(j=(R=p.values)==null?void 0:R.modules)==null?void 0:j[c])!=null&&w.canDelete),c)}})]},c)})})]})]})},ia=xe().shape({roleName:ye().required("Role Name is required")}),{TabNav:da,TabList:ma,TabContent:pa}=he,De=C.forwardRef((a,s)=>{const[t,o]=C.useState([]);v();const l=me(u=>u.crmRoles.data.selectedRole),n=me(u=>u.crmRoles.data.drawerMode);return e.jsx(We,{innerRef:s,initialValues:{roleName:n==="Edit"&&(l==null?void 0:l.roleName)||"",isSystem:n==="Edit"&&(l==null?void 0:l.isSystem)||!1,isDefault:(l==null?void 0:l.isDefault)||!1,modules:t},validationSchema:ia,onSubmit:(u,{setSubmitting:r})=>{r(!1)},children:({touched:u,errors:r})=>e.jsx(_e,{children:e.jsx(Be,{children:e.jsxs(he,{defaultValue:"roles",children:[e.jsx(ma,{children:e.jsx(da,{value:"roles",children:"Role Form"})}),e.jsx("div",{className:"p-6",children:e.jsx(pa,{value:"roles",children:e.jsx(ca,{touched:u,errors:r,roles:l,drawerMode:n})})})]})})})})});De.displayName="RolesForm";const be=C.forwardRef((a,s)=>{const t=v(),o=D(r=>r.crmRoles.data.selectedRole),l=D(r=>r.crmRoles.data.rolesList),{id:n}=o,u=r=>{const{name:g,birthday:N,email:p,img:y,location:x,title:c,phoneNumber:f,facebook:i,twitter:h,pinterest:d,linkedIn:m}=r,S={name:g,email:p,img:y},P={location:x,title:c,birthday:Ie(N).format("DD/MM/YYYY"),phoneNumber:f,facebook:i,twitter:h,pinterest:d,linkedIn:m};let I=L(l),k={};I=I.map(b=>(b.id===n&&(b={...b,...S},b.personalInfo={...b.personalInfo,...P},k=b),b)),Ye(k)||t(Re(k)),t(Y()),t(oa(I))};return e.jsx(De,{ref:s,roles:o,onFormSubmit:u})});be.displayName="RolesEditContent";const ua=({onSaveClick:a,onCancel:s})=>e.jsxs("div",{className:"text-right w-full",children:[e.jsx(U,{size:"sm",className:"mr-2",onClick:s,children:"Cancel"}),e.jsx(U,{size:"sm",variant:"solid",onClick:a,children:"Save"})]}),fa=()=>{const a=v(),s=D(r=>r.crmRoles.data.drawerOpen),t=D(r=>r.crmRoles.data.drawerMode),o=D(r=>r.crmRoles.data.selectedRole),l=()=>{a(Y()),a($({}))},n=C.useRef(null),u=async()=>{var r,g,N,p,y,x;if((r=n.current)==null||r.submitForm(),Object.keys(n.current.errors).length===0){const c=(g=n.current)==null?void 0:g.values,f=t==="ADD",i=f?await a(Ze(c)):await a(Re({id:o.id,data:c})),h=(N=i==null?void 0:i.payload)!=null&&N.success?f?"Successfully Added":"Successfully Updated":"Something went wrong !!!",d=(p=i==null?void 0:i.payload)!=null&&p.success?"success":"danger",m=((y=i==null?void 0:i.payload)==null?void 0:y.message)||((x=i==null?void 0:i.error)==null?void 0:x.message);q.push(e.jsx(z,{title:h,type:d,duration:2500,children:m}),{placement:"top-end"}),a(Y()),await a(M())}};return e.jsx(He,{isOpen:s,closable:!1,bodyClass:"p-0",footer:e.jsx(ua,{onCancel:l,onSaveClick:u}),width:600,onClose:l,onRequestClose:l,children:e.jsx(be,{ref:n})})},ha=()=>{const a=v(),s=D(d=>d.crmRoles.data.displayedRolesList),t=D(d=>d.crmRoles.data.loading),o=V("roles","canModify"),l=V("roles","canDelete"),{pageIndex:n,pageSize:u,sort:r,query:g,total:N}=D(d=>d.crmRoles.data.tableData),p=C.useCallback(()=>{a(M())},[a]);C.useEffect(()=>{p()},[p]);const y=C.useMemo(()=>({pageIndex:n,pageSize:u,sort:r,query:g,total:N}),[n,u,r,g,N]),x=({row:d})=>{const m=()=>{a(we()),a($(d)),a(Ce("Edit"))},S=async()=>{await a($(d)),a(H(!0))};return e.jsxs("div",{className:"flex text-base items-center",children:[o&&e.jsx("button",{className:"circle items-center  cursor-pointer hover:text-indigo-500",onClick:m,children:e.jsx(Ae,{})}),l&&e.jsx("span",{className:"cursor-pointer hover:text-red-500 mx-1 circle items-center",onClick:S,children:e.jsx(Ee,{})})]})},c=C.useMemo(()=>[{header:"Action",id:"action",cell:m=>e.jsx(x,{row:m.row.original})},{header:"Role Name",accessorKey:"roleName",cell:m=>m.row.original.roleName},{header:"System",accessorKey:"isSystem",cell:m=>m.row.original.isSystem.toString()}],[o,l]),f=d=>{const m=L(y);m.pageIndex=d,a(O(m))},i=d=>{const m=L(y);m.pageSize=Number(d),m.pageIndex=1,a(O(m))},h=d=>{const m=L(y);m.sort=d,a(O(m))};return e.jsxs("div",{children:[e.jsx(Fe,{columns:c,data:s,skeletonAvatarColumns:[0],skeletonAvatarProps:{width:28,height:28},loading:t,pagingData:{total:y.total,pageIndex:y.pageIndex,pageSize:y.pageSize},onPaginationChange:f,onSelectChange:i,onSort:h}),e.jsx(fa,{}),e.jsx(na,{})]})},Ne=C.forwardRef((a,s)=>{const{onInputChange:t}=a,o=Ke(l,500);function l(u){t==null||t(u)}const n=u=>{o(u.target.value)};return e.jsx(ge,{ref:s,className:"max-w-md md:w-52 mb-4",size:"sm",placeholder:"Search",prefix:e.jsx(Le,{className:"text-lg"}),onChange:n})});Ne.displayName="RolesTableSearch";const xa=()=>{const a=v(),s=C.useRef(null),t=D(r=>r.crmRoles.data.tableData),o=V("roles","canCreate"),l=r=>{const g=L(t);g.query=r,g.pageIndex=1,typeof r=="string"&&r.length>1&&n(g),typeof r=="string"&&r.length===0&&n(g)},n=r=>{a(O(r))},u=()=>{a(we()),a(Ce("ADD"))};return e.jsxs("div",{className:"md:flex items-center justify-between",children:[e.jsx("div",{className:"md:flex items-center gap-4",children:e.jsx(Ne,{ref:s,onInputChange:l})}),e.jsx("div",{className:"mb-4",children:o&&e.jsx(U,{size:"sm",onClick:u,children:"Add New"})})]})};ke("crmRoles",la);const qs=()=>e.jsxs(e.Fragment,{children:[e.jsx(xa,{}),e.jsx(ha,{})]});export{qs as default};
