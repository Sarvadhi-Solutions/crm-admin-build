import{a as M,j as e,r as g,ap as re,aq as ie}from"./index-212e59d9.js";import{A as ne}from"./AdaptableCard-7132adf3.js";import{F as O}from"./FormDesription-00159a58.js";import{D as ce}from"./DataTable-c955301a.js";import{T as le}from"./TagsList-fd9127a6.js";import{T as L}from"./TextTruncate-2138ab38.js";import{u as $}from"./checkEditUpdate-27de746a.js";import{u as de}from"./useThemeClass-27ed393b.js";import{c as K}from"./cloneDeep-ab34220c.js";import{U as me,N as pe,O as ue,b as xe}from"./index.esm-479f1ca8.js";import{u as N,t as H,d as he,g as Z,a as Q,b as ge,c as fe,e as Ce,f as je,h as Ne,i as be,j as V,k as ye,l as ve,m as X,s as q,n as W,o as Y,r as Ie}from"./index-6c0150d6.js";import{t as P,N as U}from"./toast-b0ba240d.js";import{C as we}from"./ConfirmDialog-d9ed0e74.js";import{B as _}from"./Button-5108a1e9.js";import{D as Se}from"./Drawer-17d3b1a4.js";import{a as y,F as De}from"./FormItem-a926e6de.js";import{T as ee}from"./index-669f1295.js";import{u as Te,b as D,F as Fe,a as Me}from"./formik.esm-4fba5feb.js";import{c as Ae,a as v,e as ze}from"./index.esm-9e853d59.js";import{I as F}from"./Input-34e936b1.js";/* empty css              */import{T as Ee,d as ke}from"./index.esm-476e8f48.js";import"./Alert-5e3bd2c1.js";import"./index-8c729f40.js";import"./Badge-3f18ce6d.js";import"./RangeCalendar-0895addf.js";import"./Card-19ccdde4.js";import"./index-bf1b9c91.js";import"./index-0f6bf549.js";import"./Dialog-e71f3caf.js";import"./index-55739320.js";import"./toString-772abf6a.js";import"./index-2ac45c4d.js";import"./index-68fd43c8.js";import"./index-73f43143.js";import"./Pagination-dcbb77ac.js";import"./Progress-3d61e81c.js";import"./index-04c21f2b.js";import"./ScrollBar-265d1f72.js";import"./index-98d785c8.js";import{S as R}from"./Select-0a00ed0b.js";import"./Skeleton-5bbb4668.js";import"./index-13100f2f.js";import"./Switcher-d7824352.js";import"./index-d86c5414.js";import"./Tag-52bd158f.js";import"./index-476eb339.js";import"./index-4f0614be.js";import{T as B}from"./Tooltip-97f8dea2.js";import"./Upload-c11e28b6.js";import{t as Le}from"./tagAndCategory-71f2dbbd.js";import{a as Re}from"./index.esm-179a66ff.js";import{F as qe}from"./index.esm-c089df14.js";import{a as G}from"./index.esm-ca384cba.js";import{G as J}from"./index.esm-463bf3cc.js";import{M as Oe}from"./index.esm-82e050da.js";import{C as $e}from"./react-select-creatable.esm-43851f53.js";import{a as Ke}from"./index.esm-cd80b45e.js";import{d as We}from"./debounce-74ff89d0.js";import"./index-c71cad45.js";import"./_MapCache-16007607.js";import"./Views-148dac6a.js";import"./_getPrototype-2834de0b.js";import"./CrmService-3b04f7f1.js";import"./useTimeout-25f63a1e.js";import"./CloseButton-13563c79.js";import"./StatusIcon-54b06855.js";import"./chainedFunction-070f832c.js";import"./index-5fb703df.js";import"./index-fa5e85bc.js";import"./useControllableState-eb3e3b7e.js";import"./isNil-fdf5aed7.js";import"./get-6ac9f60c.js";import"./useMergeRef-788c4cb0.js";import"./_baseIsEqual-575720af.js";import"./useRootClose-c9c002ff.js";import"./usePopper-35198492.js";import"./TimeInput-19e71c5c.js";import"./useUniqueId-3ef42274.js";import"./useDidUpdate-d264bf70.js";import"./useUncertainRef-c52be0c4.js";import"./slicedToArray-098c0090.js";import"./objectWithoutProperties-8809bfcf.js";import"./toConsumableArray-f891a5c4.js";import"./floating-ui.dom-bef9cea3.js";import"./mapCloneElement-866113ac.js";import"./index.esm-59862d7f.js";const Ze=()=>{const o=M(),n=N(r=>r.crmContact.data.deleteConfirmation),t=N(r=>r.crmContact.data.selectedContact),c=()=>{o(H(!1))},l=async()=>{var x,d,h;o(H(!1));const r=await o(he(t==null?void 0:t.id));(x=r==null?void 0:r.payload)!=null&&x.success?P.push(e.jsx(U,{title:"Successfuly Deleted",type:"success",duration:2500,children:(d=r==null?void 0:r.payload)==null?void 0:d.message}),{placement:"top-end"}):P.push(e.jsx(U,{title:"Something Went Wrong !!!",type:"danger",duration:2500,children:(h=r==null?void 0:r.error)==null?void 0:h.message}),{placement:"top-end"}),await o(Z()),await o(Q())};return e.jsx(we,{isOpen:n,type:"danger",title:"Delete Contact",confirmButtonColor:"red-600",onClose:c,onRequestClose:c,onCancel:c,onConfirm:l,children:e.jsx("p",{children:"Are you sure you want to delete this Contact? All record related to this contact will be deleted as well. This action cannot be undone."})})},Be=o=>{const{touched:n,errors:t,values:c,setFieldValue:l}=o,r=M(),[x,d]=g.useState([]),[h,w]=g.useState(null),S=N(a=>a.crmContact.data.companyList),u=N(a=>a.crmContact.data.sources),f=N(a=>a.crmContact.data.states);N(a=>a.crmContact.data.cities);const C=g.useMemo(()=>S==null?void 0:S.map(a=>({value:a.id,label:a.companyName})),[S]),I=g.useMemo(()=>f==null?void 0:f.map(a=>({value:a.id,label:a.stateName})),[f]),T=g.useMemo(()=>{var s;const a=f==null?void 0:f.find(m=>m.id===c.stateId);return((s=a==null?void 0:a.cities)==null?void 0:s.map(m=>({value:m.id,label:m.cityName})))||[]},[f,h]),A=g.useMemo(()=>u==null?void 0:u.map(s=>({label:s.sources,value:s.id})),[u]);g.useEffect(()=>{(async()=>{var s,m;try{const{payload:i}=await r(je()),b=(s=i==null?void 0:i.data)==null?void 0:s.find(j=>(j==null?void 0:j.moduleName)==="contacts");if(b){const{payload:j}=await r(Ne({id:(m=b==null?void 0:b.id)==null?void 0:m.toString()})),k=Le(j==null?void 0:j.data);d(k)}}catch(i){console.error("Error fetching module data:",i)}})(),r(ge()),r(fe()),r(Ce())},[r]);const z=Te(),E=a=>{z.setFieldValue("tagId",a)},p=async(a,s)=>{const m={sources:a==null?void 0:a.label};switch(s.action){case"create-option":await r(be(m)),await r(V());break;case"select-option":l("sourceId",a);break;case"clear":l("sourceId",null);break}};return e.jsxs(e.Fragment,{children:[e.jsx(O,{title:"Contact Basic Information",desc:"",className:"mb-2"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"col-span-1",children:e.jsx(y,{label:"First Name *",invalid:t.firstName&&n.firstName,errorMessage:t.firstName,children:e.jsx(D,{type:"text",autoComplete:"off",name:"firstName",placeholder:"First Name",component:F,prefix:e.jsx(G,{className:"text-xl"})})})}),e.jsx("div",{className:"col-span-1",children:e.jsx(y,{label:"Last Name *",invalid:t.lastName&&n.lastName,errorMessage:t.lastName,children:e.jsx(D,{type:"text",autoComplete:"off",name:"lastName",placeholder:"Last Name",component:F,prefix:e.jsx(G,{className:"text-xl"})})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"col-span-1",children:e.jsx(y,{label:"Email *",invalid:t.email&&n.email,errorMessage:t.email,children:e.jsx(D,{type:"text",autoComplete:"off",name:"email",placeholder:"Email",component:F,prefix:e.jsx(me,{className:"text-xl"})})})}),e.jsx("div",{className:"col-span-1",children:e.jsx(y,{label:"Contact Number *",invalid:t.contactNumber&&n.contactNumber,errorMessage:t.contactNumber,children:e.jsx(D,{type:"tel",autoComplete:"off",name:"contactNumber",placeholder:"Contact Number",component:F,prefix:e.jsx(Re,{className:"text-xl"})})})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsx("div",{className:"col-span-1",children:e.jsx(y,{label:"Title",invalid:t.title&&n.title,errorMessage:t.title,children:e.jsx(D,{type:"text",autoComplete:"off",name:"title",placeholder:"Title",component:F,prefix:e.jsx(Oe,{className:"text-xl"})})})})}),e.jsx(y,{label:"Notes",invalid:t.description&&n.description,errorMessage:t.description,children:e.jsx(D,{textArea:!0,type:"text",autoComplete:"off",name:"description",placeholder:"Notes",component:F,prefix:e.jsx(Ee,{className:"text-xl"})})}),e.jsx(O,{title:"Address",desc:"",className:"mb-2"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"col-span-1",children:e.jsx(y,{label:"Address",invalid:t.address&&n.address,errorMessage:t.address,children:e.jsx(D,{type:"text",autoComplete:"off",name:"address",placeholder:"Address",component:F,prefix:e.jsx(qe,{className:"text-xl"})})})}),e.jsx("div",{className:"col-span-1",children:e.jsx("div",{className:"col-span-1",children:e.jsx(y,{label:"State",invalid:t.stateId&&n.stateId,errorMessage:t.stateId,children:e.jsx(R,{name:"stateId",placeholder:"Select State",options:I,id:"stateId",value:I==null?void 0:I.find(a=>(a==null?void 0:a.value)==(c==null?void 0:c.stateId)),onChange:a=>{const s=a.value;c.stateId!==s&&l("cityId",""),l("stateId",s||""),w(s)}})})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"col-span-1",children:e.jsx("div",{className:"col-span-1",children:e.jsx(y,{label:"City",invalid:t.cityId&&n.cityId,errorMessage:t.cityId,children:e.jsx(R,{name:"cityId",placeholder:"Select City",options:T,id:"cityId",value:(T==null?void 0:T.find(a=>(a==null?void 0:a.value)===(c==null?void 0:c.cityId)))||{value:"",label:"Select City"},onChange:a=>{const s=a.value;s!==c.cityId&&l("cityId",s||"")}})})})}),e.jsx("div",{className:"col-span-1",children:e.jsx("div",{style:{position:"relative"},children:e.jsx("div",{className:"col-span-1",children:e.jsx(y,{label:"ZipCode",invalid:t.zipcode&&n.zipcode,errorMessage:t.zipcode,children:e.jsx(D,{type:"text",autoComplete:"off",name:"zipcode",placeholder:"ZipCode",component:F,prefix:e.jsx(ke,{className:"text-xl"})})})})})})]}),e.jsx(O,{title:"Contact Others Details",desc:"",className:"mb-2"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"col-span-1",children:e.jsx(y,{label:"Company Name",invalid:t.companiesId&&n.companiesId,errorMessage:t.companiesId,children:e.jsx(R,{name:"companiesId",placeholder:"Company Name",options:C,id:"companiesId",value:C==null?void 0:C.find(a=>(a==null?void 0:a.value)==(c==null?void 0:c.companiesId)),onChange:a=>{const s=a.value;l("companiesId",s||"")}})})}),e.jsx("div",{className:"col-span-1",children:e.jsx(y,{label:"Source",invalid:t.source&&n.source,errorMessage:t.source,children:e.jsx(D,{isClearable:!0,type:"text",autoComplete:"off",name:"sourceId",placeholder:"Source",component:R,componentAs:$e,options:A,prefix:e.jsx(J,{className:"text-xl"}),onChange:p})})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsx("div",{className:"col-span-1",children:e.jsx(y,{label:"Tag",children:e.jsx(D,{isClearable:!0,isMulti:!0,type:"text",autoComplete:"off",name:"tagId",placeholder:"Select tags",component:R,options:x,prefix:e.jsx(J,{className:"text-xl"}),closeMenuOnSelect:!1,onChange:E})})})})]})},He=Ae().shape({firstName:v().required("First Name is required"),lastName:v().required("Last Name is required"),title:v(),contactNumber:v().typeError("Contact must be a number").required("Contact is required").test("is-number","Contact must be a number",o=>!isNaN(o)).test("is-ten-digits","Contact must be exactly 10 digits",o=>{if(o){const n=Number(o);return/^\d{10}$/.test(n.toString())}return!0}).test("is-ten-digits","Contact number cannot start with 0",o=>o?!o.startsWith("0"):!0),email:v().matches(/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/i,"Invalid email").required("Email is required"),address:v(),stateId:v(),cityId:v(),zipcode:v().test("is-number","ZipCode must be a number",o=>!(o&&isNaN(Number(o)))).test("is-six-digits","ZipCode must be exactly 6 digits",o=>!(o&&o.length!==6)),companiesId:v().nullable(),companyName:v(),source:v().nullable(),description:v(),tagId:ze()}),{TabNav:Pe,TabList:Ue,TabContent:_e}=ee,te=g.forwardRef((o,n)=>{var d,h,w,S;const t=N(u=>u.crmContact.data.selectedContact),c=N(u=>u.crmContact.data.sources),l=g.useMemo(()=>c.map(f=>({label:f.sources,value:f.id})),[c]),r=!!t.id,x=M();return e.jsx(Fe,{innerRef:n,initialValues:{firstName:(t==null?void 0:t.firstName)||"",lastName:(t==null?void 0:t.lastName)||"",title:(t==null?void 0:t.title)||"",email:(t==null?void 0:t.email)||"",contactNumber:(t==null?void 0:t.contactNumber)||"",description:(t==null?void 0:t.description)||"",companyName:((d=t==null?void 0:t.company)==null?void 0:d.companyName)||"",sourceId:t!=null&&t.sourceId?l.find(u=>u.value===(t==null?void 0:t.sourceId)):null,address:(t==null?void 0:t.address)||"",stateId:(t==null?void 0:t.stateId)||"",cityId:(t==null?void 0:t.cityId)||"",zipcode:(t==null?void 0:t.zipcode)||"",tagName:((w=(h=t==null?void 0:t.tags)==null?void 0:h[0])==null?void 0:w.tagName)||"",tagId:((S=t==null?void 0:t.tags)==null?void 0:S.map(u=>({label:u.tagName,value:u.id})))||[],companiesId:(t==null?void 0:t.companiesId)||""},validationSchema:He,onSubmit:async(u,{setSubmitting:f})=>{var C,I,T,A,z,E,p;try{const{tagName:a,...s}=u,m={...s,sourceId:(C=s==null?void 0:s.sourceId)==null?void 0:C.value,tagId:s==null?void 0:s.tagId.map(oe=>oe.value)},i=r?await x(ye({contactId:(t==null?void 0:t.id)||"",updatedData:m})):await x(ve(m)),b=(I=i==null?void 0:i.payload)!=null&&I.success?"Successfully Added":"Something went wrong !!!",j=(T=i==null?void 0:i.payload)!=null&&T.success?"success":"danger",k=(A=i==null?void 0:i.payload)!=null&&A.success?(z=i==null?void 0:i.payload)==null?void 0:z.message:(E=i==null?void 0:i.error)==null?void 0:E.message;P.push(e.jsx(U,{title:b,type:j,duration:2500,children:k}),{placement:"top-end"}),(p=i==null?void 0:i.payload)!=null&&p.success&&x(X()),await x(Z()),await x(Q())}catch(a){console.error(a)}finally{f(!1)}},children:({touched:u,errors:f,values:C,setFieldValue:I})=>e.jsx(Me,{children:e.jsx(De,{children:e.jsxs(ee,{defaultValue:"personalInfo",children:[e.jsx(Ue,{children:e.jsx(Pe,{value:"personalInfo",children:"Contact Details"})}),e.jsx("div",{className:"p-6",children:e.jsx(_e,{value:"personalInfo",children:e.jsx(Be,{touched:u,errors:f,values:C,setFieldValue:I})})})]})})})})});te.displayName="ContactForm";const ae=g.forwardRef((o,n)=>{M();const t=N(l=>l.crmContact.data.selectedContact);N(l=>l.crmContact.data.contactList);const c=async l=>{};return e.jsx(te,{ref:n,contact:t,onFormSubmit:c})});ae.displayName="ContactEditContent";const Ge=({onSaveClick:o,onCancel:n})=>e.jsxs("div",{className:"text-right w-full",children:[e.jsx(_,{size:"sm",className:"mr-2",onClick:n,children:"Cancel"}),e.jsx(_,{size:"sm",variant:"solid",onClick:o,children:"Save"})]}),Je=()=>{const o=M(),[n,t]=g.useState(window.innerWidth/2),c=N(h=>h.crmContact.data.drawerOpen),l=()=>{o(X()),o(q({}))},r=g.useRef(null),x=()=>{var h,w;console.log("formSubmit function called",(h=r.current)==null?void 0:h.values),(w=r.current)==null||w.submitForm()},d=()=>{t(window.innerWidth/2)};return g.useEffect(()=>(window.addEventListener("resize",d),()=>{window.removeEventListener("resize",d)}),[]),e.jsx(Se,{isOpen:c,closable:!1,bodyClass:"p-0",width:n,footer:e.jsx(Ge,{onCancel:l,onSaveClick:x}),onClose:l,onRequestClose:l,children:e.jsx(ae,{ref:r})})},Qe=()=>{const o=M(),n=N(p=>p.crmContact.data.displayedContactList),t=$("contacts","canModify"),c=$("contacts","canDelete"),l=$("contacts","canView"),r=N(p=>p.crmContact.data.loading),x=re(),{pageIndex:d,pageSize:h,sort:w,query:S,total:u}=N(p=>p.crmContact.data.tableData),f=g.useCallback(()=>{o(Z()),o(V())},[o]);g.useEffect(()=>{f()},[f]);const C=g.useMemo(()=>({pageIndex:d,pageSize:h,sort:w,query:S,total:u}),[d,h,w,S,u]),I=({row:p})=>{const a=M();de();const s=()=>{a(Y()),a(q(p))},m=async()=>{a(q(p)),a(H(!0))},i=()=>{a(q(p));const b=`/app/crm/contact-details/${p.id}`;x(b)};return e.jsxs("div",{className:"flex text-base items-center",children:[t&&e.jsx("span",{className:"cursor-pointer hover:text-indigo-500 circle items-center",onClick:s,children:e.jsx(pe,{})}),c&&e.jsx("span",{className:"cursor-pointer hover:text-red-500 circle mx-1 items-center",onClick:m,children:e.jsx(ue,{})}),l&&e.jsx("span",{className:"cursor-pointer hover:text-green-500 circle items-center text-lg",onClick:i,children:e.jsx(Ke,{})})]})},T=g.useMemo(()=>[{header:"Action",id:"action",cell:a=>e.jsx(I,{row:a.row.original})},{header:"Name",accessorKey:"firstName",cell:a=>{const{firstName:s,lastName:m}=a.row.original,i=`${s} ${m}`;return e.jsx(L,{text:i,maxLength:20})}},{header:"email",accessorKey:"email",cell:a=>a.row.original.email},{header:"Number",accessorKey:"contactNumber",cell:a=>a.row.original.contactNumber},{header:"source",accessorKey:"sourceId",cell:a=>{var m,i,b,j;const s=(i=(m=a.row.original)==null?void 0:m.source)!=null&&i.sources?(j=(b=a.row.original)==null?void 0:b.source)==null?void 0:j.sources:"-";return e.jsx(L,{text:s,maxLength:15})}},{header:"Tags",accessorKey:"tagName",cell:a=>{const s=a.row.original.tags;return s!=null&&s.length>0?e.jsx(le,{tags:s}):"-"}},{header:"Title",accessorKey:"title",cell:a=>{const s=a.row.original.title?a.row.original.title:"-";return e.jsx(B,{title:s,children:e.jsx(L,{text:s,maxLength:15})},s)}},{header:"Company",accessorKey:"companyName",cell:a=>{const s=a.row.original.company?a.row.original.company.companyName:"-";return e.jsx(L,{text:s,maxLength:15})}},{header:"Address",accessorKey:"address",cell:a=>{const{address:s,cityData:m,stateData:i,zipcode:b}=a.row.original,j=[s,m==null?void 0:m.cityName,i==null?void 0:i.stateName,b].filter(k=>k!=null).join(" ");return e.jsx(B,{title:j||"-",children:e.jsx(L,{text:j||"-",maxLength:20})},j)}},{header:"Notes",accessorKey:"description",cell:a=>{const s=a.row.original.description?a.row.original.description:"-";return e.jsx(B,{title:s,children:e.jsx(L,{text:s,maxLength:20})},s)}}],[t,c]),A=p=>{const a=K(C);a.pageIndex=p,o(W(a))},z=p=>{const a=K(C);a.pageSize=Number(p),a.pageIndex=1,o(W(a))},E=p=>{const a=K(C);a.sort=p,o(W(a))};return e.jsxs("div",{children:[e.jsx(ce,{columns:T,data:n,loading:r,pagingData:{total:C.total,pageIndex:C.pageIndex,pageSize:C.pageSize},onPaginationChange:A,onSelectChange:z,onSort:E}),e.jsx(Je,{}),e.jsx(Ze,{})]})},se=g.forwardRef((o,n)=>{const{onInputChange:t}=o,c=We(l,500);function l(x){t==null||t(x)}const r=x=>{c(x.target.value)};return e.jsx(F,{ref:n,className:"max-w-md md:w-52 mb-4",size:"sm",placeholder:"Search",prefix:e.jsx(xe,{className:"text-lg"}),onChange:r})});se.displayName="ContactTableSearch";const Ve=()=>{const o=M(),n=g.useRef(null),t=N(d=>d.crmContact.data.tableData),c=$("contacts","canCreate"),l=d=>{const h=K(t);h.query=d,h.pageIndex=1,typeof d=="string"&&d.length>1&&r(h),typeof d=="string"&&d.length===0&&r(h)},r=d=>{o(d?W(d):Z())},x=()=>{o(Y()),o(q({}))};return e.jsxs("div",{className:"md:flex items-center justify-between",children:[e.jsx("div",{className:"md:flex items-center gap-4",children:e.jsx(se,{ref:n,onInputChange:l})}),e.jsx("div",{className:"mb-4",children:c&&e.jsx(_,{size:"sm",onClick:x,children:"Add New"})})]})};ie("crmContact",Ie);const Xe=()=>{const o=N(n=>n.crmContact.data.tableData);return e.jsx(e.Fragment,{children:e.jsxs(ne,{bodyClass:"h-full",children:[e.jsx(O,{title:`Contacts (${(o==null?void 0:o.total)||0})`,desc:"",className:"mb-2"}),e.jsx(Ve,{}),e.jsx(Qe,{})]})})},za=Xe;export{za as default};
