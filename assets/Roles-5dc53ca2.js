import{a as S,r as C,j as e,u as me,p as Ne,aq as De}from"./index-fbeb73e8.js";import{D as Se}from"./DataTable-2ef1b7c2.js";import{u as ue}from"./useThemeClass-33f9a415.js";import{c as A}from"./cloneDeep-2449545a.js";import{f as ve,u as b,p as fe,s as q,a as Ie,b as Y,c as Me,g as k,t as $,d as ke,e as z,h as he,i as xe,r as Fe}from"./index-cc478339.js";import{B as U}from"./Button-fa703339.js";import{D as Te}from"./Drawer-383b2f06.js";import{i as Ee}from"./Views-e8d5fb02.js";import{a as de,F as Ae}from"./FormItem-be8e2cb8.js";import{T as ge}from"./index-b84a5e6c.js";import{u as Pe,b as pe,F as Ve,a as Oe}from"./formik.esm-23ee2cb1.js";import{c as je,a as ye}from"./index.esm-3c9a3967.js";import{I as Re}from"./Input-ea43c704.js";/* empty css              */import{Q as qe,b as ze}from"./index.esm-966eae5b.js";import{S as $e}from"./Switcher-0771dd88.js";import{n as F,o as T}from"./index.esm-033a5667.js";import"./Alert-9eeb3e1b.js";import"./index-193266b4.js";import"./Badge-67aa5111.js";import"./RangeCalendar-07e95539.js";import"./Card-2611bbf0.js";import"./index-fa7b3b75.js";import"./index-197628eb.js";import"./Dialog-04fb7b63.js";import"./index-91e30e73.js";import"./toString-e7e32846.js";import"./index-2090c75d.js";import"./index-e5cf4612.js";import"./index-9afb8437.js";import{t as P,N as V}from"./toast-8910f630.js";import"./Pagination-70a157e9.js";import"./Progress-d00a7ee9.js";import"./index-5fefc1aa.js";import"./ScrollBar-f7d5b71e.js";import"./index-4aafab9b.js";import"./Select-d04732be.js";import"./Skeleton-e59059fb.js";import"./index-dcf21671.js";import"./index-af747e82.js";import"./Tag-a8ec6a60.js";import"./index-f04e83aa.js";import"./index-df93595f.js";import"./Tooltip-56eb9eeb.js";import"./Upload-e917b755.js";import{C as Ue}from"./ConfirmDialog-081bd52e.js";import{u as L}from"./checkEditUpdate-a819791f.js";import{d as Le}from"./debounce-6e955f87.js";import"./index-0df708a1.js";import"./_MapCache-1a6e7e5d.js";import"./_getPrototype-d70ea966.js";import"./CrmService-0260fe15.js";import"./index-c9deba3f.js";import"./CloseButton-b1b46c4f.js";import"./index-18a42b76.js";import"./useControllableState-2f7f72e9.js";import"./isNil-3e369377.js";import"./get-b03197f1.js";import"./useTimeout-7f68915d.js";import"./StatusIcon-c2e1b9b5.js";import"./useMergeRef-788c4cb0.js";import"./_baseIsEqual-c8746f9d.js";import"./useRootClose-97cd3002.js";import"./usePopper-fdc6d8d1.js";import"./TimeInput-409b41c6.js";import"./useUniqueId-2e15deca.js";import"./useDidUpdate-6e166d72.js";import"./useUncertainRef-558dbe5b.js";import"./chainedFunction-070f832c.js";import"./slicedToArray-318d0ae0.js";import"./objectWithoutProperties-8809bfcf.js";import"./toConsumableArray-93a37066.js";import"./floating-ui.dom-bef9cea3.js";import"./mapCloneElement-4a372efe.js";import"./index.esm-00218edb.js";import"./index.esm-d08d587a.js";const E=({value:a,onClick:d,greenIcon:c,grayIcon:p,canPermission:n})=>e.jsx("td",{className:"px-4 py-2 text-center",children:e.jsx("div",{className:`${n?" border-blue-600":" border-red-300"} rounded-full p-2 cursor-pointer flex justify-center items-center`,onClick:d,children:n?c:p})}),Ye=a=>{const{roles:d,drawerMode:c,errors:p,touched:n}=a,r=S(),[m,o]=C.useState([]),[g,D]=C.useState([]),i=Pe();C.useEffect(()=>{async function h(){var l;try{const u=await r(ve()),f=(l=u==null?void 0:u.payload)==null?void 0:l.data.map(t=>({masterId:t.id,canCreate:!1,canModify:!1,canView:!1,canDelete:!1,canManage:!1}));c==="Edit"&&d&&Array.isArray(d.rolePermissions)&&[...d.rolePermissions].sort((s,w)=>s.masterId-w.masterId).forEach(s=>{const w=f.findIndex(v=>v.masterId===s.masterId);w!==-1&&(f[w]=s)}),i.setFieldValue("modules",f),D(f),o(u.payload.data)}catch(u){console.error("Error fetching modules:",u)}}h()},[r]),je().shape({rolename:ye().required("Role Name is required")});const x=(h,l,u,f)=>{const t=JSON.parse(JSON.stringify(i.values.modules));if(l!=="canManage")t[f][l]=u,t[f].canManage=t[f].canCreate&&t[f].canModify&&t[f].canView&&t[f].canDelete;else{const s={canManage:u,canCreate:u,canModify:u,canView:u,canDelete:u,masterId:h};t[f]=s}i.setFieldValue("modules",t)};return e.jsxs(e.Fragment,{children:[e.jsx(de,{label:"Role Name",invalid:p.roleName&&n.roleName,errorMessage:p.roleName,children:e.jsx(pe,{type:"text",autoComplete:"off",name:"roleName",placeholder:"Role Name",component:Re,prefix:e.jsx(qe,{className:"text-xl"})})}),e.jsx(de,{children:e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx("label",{className:"form-label",style:{marginRight:"10px"},children:"System Role"}),e.jsx(pe,{autoComplete:"off",name:"isSystem",component:$e,checked:i.values.isSystem})]})}),e.jsxs("table",{className:"w-full border-collapse ",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-200",children:[e.jsx("th",{className:"px-4 py-2 text-center",children:"Module"}),e.jsx("th",{className:"px-4 py-2 w-1/6 text-center",children:"All"}),e.jsx("th",{className:"px-4 py-2 w-1/6 text-center",children:"Read"}),e.jsx("th",{className:"px-4 py-2 w-1/6 text-center",children:"Write"}),e.jsx("th",{className:"px-4 py-2 w-1/6 text-center",children:"Update"}),e.jsx("th",{className:"px-4 py-2 w-1/6 text-center",children:"Delete"})]})}),e.jsx("tbody",{children:m==null?void 0:m.map((h,l)=>{var u,f,t,s,w,v,O,I,M,N,B,W,H,J,K,_,Q,G,X,Z,ee,te,se,ae,oe,re,le,ne,ce,ie;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2 text-center",children:h==null?void 0:h.moduleName.toUpperCase()}),e.jsx(E,{value:(t=(f=(u=i.values)==null?void 0:u.modules)==null?void 0:f[l])==null?void 0:t.canManage,greenIcon:e.jsx(F,{className:"text-blue-600"}),grayIcon:e.jsx(T,{className:"text-red-500"}),canPermission:(v=(w=(s=i.values)==null?void 0:s.modules)==null?void 0:w[l])==null?void 0:v.canManage,onClick:()=>{var j,y,R;return x(h.id,"canManage",!((R=(y=(j=i.values)==null?void 0:j.modules)==null?void 0:y[l])!=null&&R.canManage),l)}}),e.jsx(E,{value:(M=(I=(O=i.values)==null?void 0:O.modules)==null?void 0:I[l])==null?void 0:M.canView,greenIcon:e.jsx(F,{className:"text-blue-600"}),grayIcon:e.jsx(T,{className:"text-red-500"}),canPermission:(W=(B=(N=i.values)==null?void 0:N.modules)==null?void 0:B[l])==null?void 0:W.canView,onClick:()=>{var j,y,R;return x(h.id,"canView",!((R=(y=(j=i.values)==null?void 0:j.modules)==null?void 0:y[l])!=null&&R.canView),l)}}),e.jsx(E,{value:(K=(J=(H=i.values)==null?void 0:H.modules)==null?void 0:J[l])==null?void 0:K.canCreate,greenIcon:e.jsx(F,{className:"text-blue-600"}),grayIcon:e.jsx(T,{className:"text-red-500"}),canPermission:(G=(Q=(_=i.values)==null?void 0:_.modules)==null?void 0:Q[l])==null?void 0:G.canCreate,onClick:()=>{var j,y,R;return x(h.id,"canCreate",!((R=(y=(j=i.values)==null?void 0:j.modules)==null?void 0:y[l])!=null&&R.canCreate),l)}}),e.jsx(E,{value:(ee=(Z=(X=i.values)==null?void 0:X.modules)==null?void 0:Z[l])==null?void 0:ee.canModify,greenIcon:e.jsx(F,{className:"text-blue-600"}),grayIcon:e.jsx(T,{className:"text-red-500"}),canPermission:(ae=(se=(te=i.values)==null?void 0:te.modules)==null?void 0:se[l])==null?void 0:ae.canModify,onClick:()=>{var j,y,R;return x(h.id,"canModify",!((R=(y=(j=i.values)==null?void 0:j.modules)==null?void 0:y[l])!=null&&R.canModify),l)}}),e.jsx(E,{value:(le=(re=(oe=i.values)==null?void 0:oe.modules)==null?void 0:re[l])==null?void 0:le.canDelete,greenIcon:e.jsx(F,{className:"text-blue-600"}),grayIcon:e.jsx(T,{className:"text-red-500"}),canPermission:(ie=(ce=(ne=i.values)==null?void 0:ne.modules)==null?void 0:ce[l])==null?void 0:ie.canDelete,onClick:()=>{var j,y,R;return x(h.id,"canDelete",!((R=(y=(j=i.values)==null?void 0:j.modules)==null?void 0:y[l])!=null&&R.canDelete),l)}})]},l)})})]})]})},Be=je().shape({roleName:ye().required("Role Name is required")}),{TabNav:We,TabList:He,TabContent:Je}=ge,we=C.forwardRef((a,d)=>{const[c,p]=C.useState([]);S();const n=me(m=>m.crmRoles.data.selectedRole),r=me(m=>m.crmRoles.data.drawerMode);return e.jsx(Ve,{innerRef:d,initialValues:{roleName:r==="Edit"&&(n==null?void 0:n.roleName)||"",isSystem:r==="Edit"&&(n==null?void 0:n.isSystem)||!1,isDefault:(n==null?void 0:n.isDefault)||!1,modules:c},validationSchema:Be,onSubmit:(m,{setSubmitting:o})=>{o(!1)},children:({touched:m,errors:o})=>e.jsx(Oe,{children:e.jsx(Ae,{children:e.jsxs(ge,{defaultValue:"roles",children:[e.jsx(He,{children:e.jsx(We,{value:"roles",children:"Role Form"})}),e.jsx("div",{className:"p-6",children:e.jsx(Je,{value:"roles",children:e.jsx(Ye,{touched:m,errors:o,roles:n,drawerMode:r})})})]})})})})});we.displayName="RolesForm";const Ce=C.forwardRef((a,d)=>{const c=S(),p=b(o=>o.crmRoles.data.selectedRole),n=b(o=>o.crmRoles.data.rolesList),{id:r}=p,m=o=>{const{name:g,birthday:D,email:i,img:x,location:h,title:l,phoneNumber:u,facebook:f,twitter:t,pinterest:s,linkedIn:w}=o,v={name:g,email:i,img:x},O={location:h,title:l,birthday:Ne(D).format("DD/MM/YYYY"),phoneNumber:u,facebook:f,twitter:t,pinterest:s,linkedIn:w};let I=A(n),M={};I=I.map(N=>(N.id===r&&(N={...N,...v},N.personalInfo={...N.personalInfo,...O},M=N),N)),Ee(M)||c(fe(M)),c(q()),c(Ie(I))};return e.jsx(we,{ref:d,roles:p,onFormSubmit:m})});Ce.displayName="RolesEditContent";const Ke=({onSaveClick:a,onCancel:d})=>e.jsxs("div",{className:"text-right w-full",children:[e.jsx(U,{size:"sm",className:"mr-2",onClick:d,children:"Cancel"}),e.jsx(U,{size:"sm",variant:"solid",onClick:a,children:"Save"})]}),_e=()=>{const a=S(),d=b(o=>o.crmRoles.data.drawerOpen),c=b(o=>o.crmRoles.data.drawerMode),p=b(o=>o.crmRoles.data.selectedRole),n=()=>{a(q()),a(Y({}))},r=C.useRef(null),m=async()=>{var g,D,i,x,h,l,u,f;const o=(g=r.current)==null?void 0:g.values;if((D=r.current)==null||D.submitForm(),Object.keys(r.current.errors).length===0)if(console.log(c),c==="ADD"){const t=await a(Me(o));console.log(t,"response");let s="",w="";((i=t==null?void 0:t.payload)==null?void 0:i.success)===!0?(s=(x=t==null?void 0:t.payload)==null?void 0:x.message,w="success"):(s=(h=t==null?void 0:t.error)==null?void 0:h.message,w="danger"),P.push(e.jsx(V,{title:"title",type:w,duration:2500,children:s}),{placement:"top-end"}),a(q()),await a(k())}else{const t=p.id,s=await a(fe({id:t,data:o}));(l=s==null?void 0:s.payload)!=null&&l.success?P.push(e.jsx(V,{title:"Successfully Update",type:"success",duration:2500,children:(u=s==null?void 0:s.payload)==null?void 0:u.message}),{placement:"top-end"}):P.push(e.jsx(V,{title:"Something went wrong !!!",type:"danger",duration:2500,children:(f=s==null?void 0:s.error)==null?void 0:f.message}),{placement:"top-end"}),a(q()),await a(k())}};return e.jsx(Te,{isOpen:d,closable:!1,bodyClass:"p-0",footer:e.jsx(Ke,{onCancel:n,onSaveClick:m}),width:600,onClose:n,onRequestClose:n,children:e.jsx(Ce,{ref:r})})},Qe=()=>{const a=S(),d=b(r=>r.crmRoles.data.deleteConfirmation),c=b(r=>r.crmRoles.data.selectedRole),p=()=>{a($(!1))},n=async()=>{var m,o,g;a($(!1));const r=await a(ke(c.id));await a(k()),(m=r==null?void 0:r.payload)!=null&&m.success?(P.push(e.jsx(V,{title:"Successfuly Deleted",type:"success",duration:2500,children:(o=r==null?void 0:r.payload)==null?void 0:o.message}),{placement:"top-end"}),await a(k())):(P.push(e.jsx(V,{title:"Something Went Wrong !!!",type:"danger",duration:2500,children:(g=r==null?void 0:r.error)==null?void 0:g.message}),{placement:"top-end"}),await a(k()))};return e.jsx(Ue,{isOpen:d,type:"danger",title:"Delete Role",confirmButtonColor:"red-600",onClose:p,onRequestClose:p,onCancel:p,onConfirm:n,children:e.jsx("p",{children:"Are you sure you want to delete this role? All record related to this role will be deleted as well. This action cannot be undone."})})},Ge=({row:a})=>{const{textTheme:d}=ue(),c=S(),p=()=>{c(he()),c(Y(a)),c(xe("Edit"))};return e.jsx("div",{className:`${d} cursor-pointer select-none font-semibold`,onClick:p,children:"Edit"})},Xe=({row:a})=>{const{textTheme:d}=ue(),c=S(),p=async()=>{await c(Y(a)),c($(!0))};return e.jsx("div",{className:`${d} cursor-pointer select-none font-semibold text-red-500`,onClick:p,children:"Delete"})},Ze=()=>{const a=S(),d=b(t=>t.crmRoles.data.displayedRolesList),c=b(t=>t.crmRoles.data.loading);b(t=>t.crmRoles.data.filterData);const p=L("roles","canModify"),n=L("roles","canDelete"),{pageIndex:r,pageSize:m,sort:o,query:g,total:D}=b(t=>t.crmRoles.data.tableData),i=C.useCallback(()=>{a(k())},[a]);C.useEffect(()=>{i()},[i]);const x=C.useMemo(()=>({pageIndex:r,pageSize:m,sort:o,query:g,total:D}),[r,m,o,g,D]),h=C.useMemo(()=>{const t=[{header:"Role Name",accessorKey:"roleName",cell:s=>s.row.original.roleName},{header:"System",accessorKey:"isSystem",cell:s=>s.row.original.isSystem.toString()}];return n&&t.unshift({header:"Delete",id:"delete",cell:s=>e.jsx(Xe,{row:s.row.original})}),p&&t.unshift({header:"Edit",id:"action",cell:s=>e.jsx(Ge,{row:s.row.original})}),t},[p,n]),l=t=>{const s=A(x);s.pageIndex=t,a(z(s))},u=t=>{const s=A(x);s.pageSize=Number(t),s.pageIndex=1,a(z(s))},f=t=>{const s=A(x);s.sort=t,a(z(s))};return e.jsxs("div",{children:[e.jsx(Se,{columns:h,data:d,skeletonAvatarColumns:[0],skeletonAvatarProps:{width:28,height:28},loading:c,pagingData:{total:x.total,pageIndex:x.pageIndex,pageSize:x.pageSize},onPaginationChange:l,onSelectChange:u,onSort:f}),e.jsx(_e,{}),e.jsx(Qe,{})]})},be=C.forwardRef((a,d)=>{const{onInputChange:c}=a,p=Le(n,500);function n(m){c==null||c(m)}const r=m=>{p(m.target.value)};return e.jsx(Re,{ref:d,className:"max-w-md md:w-52 mb-4",size:"sm",placeholder:"Search",prefix:e.jsx(ze,{className:"text-lg"}),onChange:r})});be.displayName="RolesTableSearch";const et=()=>{const a=S(),d=C.useRef(null),c=b(o=>o.crmRoles.data.tableData),p=L("roles","canCreate"),n=o=>{const g=A(c);g.query=o,g.pageIndex=1,typeof o=="string"&&o.length>1&&r(g),typeof o=="string"&&o.length===0&&r(g)},r=o=>{a(z(o))},m=()=>{a(he()),a(xe("ADD"))};return e.jsxs("div",{className:"md:flex items-center justify-between",children:[e.jsx("div",{className:"md:flex items-center gap-4",children:e.jsx(be,{ref:d,onInputChange:n})}),e.jsx("div",{className:"mb-4",children:p&&e.jsx(U,{size:"sm",onClick:m,children:"Add New"})})]})};De("crmRoles",Fe);const bs=()=>e.jsxs(e.Fragment,{children:[e.jsx(et,{}),e.jsx(Ze,{})]});export{bs as default};
