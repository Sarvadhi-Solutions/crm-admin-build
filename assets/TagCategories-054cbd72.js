import{r as j,a as b,j as e,ah as me,aq as ge}from"./index-03c04ff8.js";import{u as E}from"./useThemeClass-701da38c.js";import"./Card-ac72e1c3.js";import"./Views-6cf30eea.js";import{B as ue}from"./Badge-9e03359a.js";import"./chart.constant-b84e8d83.js";import"./GrowShrinkTag-0021728a.js";import{aa as pe,ab as he,ac as xe}from"./index.esm-0ab06d90.js";import"./index-b28ee968.js";import{B as R}from"./Button-43b0b556.js";import{D as X}from"./Dialog-bdcf65b5.js";import{T as je}from"./DataTable-9d817024.js";import{I as L}from"./Input-a694346c.js";import"./Skeleton-6f5440b9.js";import"./react-tooltip.min-8141b696.js";import"./RichTextEditor-95b64ad3.js";import"./SegmentItemOption-35337f78.js";import"./SvgIcon-44fe3b92.js";import"./Tooltip-d932d71c.js";import{T as A}from"./index-0c00bbc6.js";import{u as Z,f as $,g as ee,e as Ce,d as ye}from"./index-e5a76227.js";import"./Alert-150a77d9.js";import"./RangeCalendar-fd86ac0e.js";import"./index-65a265b2.js";import"./index-564117fd.js";import"./Drawer-4f1dc3e9.js";import{a as fe}from"./index-b8f5d3a3.js";import{F as te,a as I}from"./FormItem-e51bc525.js";import"./toString-6216203c.js";import"./index-e73ce215.js";import"./index-f63d6955.js";import"./index-b7b7180a.js";import{t as D,N as S}from"./toast-5fc5fe7c.js";import{P as Te}from"./Pagination-2b3f9c70.js";import"./Progress-e8ec294d.js";import"./index-dafa1633.js";import"./ScrollBar-5778a435.js";import"./index-4125dbd0.js";import{S as ae}from"./Select-f865911a.js";import"./index-2aace800.js";import"./Switcher-3f72cb43.js";import"./index-de17390b.js";import"./Tag-5499707e.js";import"./index-81144042.js";import"./index-e3eb4615.js";import"./Upload-d3b407d2.js";import{F as oe,a as se,b as H,c as be,g as U}from"./formik.esm-7069ec7e.js";import{c as P,a as v,e as Ne}from"./index.esm-22b7b6b8.js";import{u as y,e as we,t as z,g as k,T as De,a as K,d as Se,m as F,c as ve,b as V,f as Fe,s as _,h as Y,i as W,j as ke,k as re,r as Me}from"./TagCategoryDetailsForm-b15fd778.js";import{C as ne}from"./ConfirmDialog-f0f4366f.js";import{c as G}from"./cloneDeep-057bcc25.js";import{u as Ie}from"./checkEditUpdate-e2f0b2aa.js";const Re=P().shape({categoryName:v().required("Field is required")}),ie=j.forwardRef((s,l)=>{var r;const i=b(),d=y(a=>a.crmTagCategories.data.formToggle),h=()=>{i(z(!1))},t=y(a=>a.crmTagCategories.data.selectedTagCategory);return e.jsx(X,{isOpen:d,onClose:h,children:e.jsx(oe,{innerRef:l,initialValues:{categoryName:(t==null?void 0:t.categoryName)||"",master:((r=t==null?void 0:t.master)==null?void 0:r.id)||"",tags:(t==null?void 0:t.tags)||[]},validationSchema:Re,onSubmit:async(a,{setSubmitting:n})=>{var u,p,f,T;n(!1);const m={...a,masterId:a==null?void 0:a.master,tagId:((u=a==null?void 0:a.tags)==null?void 0:u.map(w=>w==null?void 0:w.id))||[]};delete m.master,delete m.tags;const c=await i(we({tagCategoryId:(t==null?void 0:t.id)||"",updatedData:m}));let x="",C="",N="";(p=c==null?void 0:c.payload)!=null&&p.success?(x="Successfully Update",C=(f=c==null?void 0:c.payload)==null?void 0:f.message,N="success"):(x="Something went wrong !!!",C=(T=c==null?void 0:c.error)==null?void 0:T.message,N="danger"),D.push(e.jsx(S,{title:x,type:N,duration:2500,children:C}),{placement:"top-end"}),i(z(!1)),await i(k())},children:({touched:a,errors:n,values:m,setFieldValue:c})=>e.jsx(se,{children:e.jsx(te,{children:e.jsx(De,{touched:a,errors:n,values:m,setFieldValue:c})})})})})});ie.displayName="TagCategoryForm";const Ee=()=>{const s=b(),l=y(t=>t.crmTagCategories.data.deleteConfirmation),i=y(t=>t.crmTagCategories.data.selectedTagCategory),d=()=>{s(K(!1))},h=async()=>{var r,a,n;s(K(!1));const t=await s(Se(i.id));(r=t==null?void 0:t.payload)!=null&&r.success?D.push(e.jsx(S,{title:"Successfuly Deleted",type:"success",duration:2500,children:(a=t==null?void 0:t.payload)==null?void 0:a.message}),{placement:"top-end"}):D.push(e.jsx(S,{title:"Something Went Wrong !!!",type:"danger",duration:2500,children:(n=t==null?void 0:t.error)==null?void 0:n.message}),{placement:"top-end"}),await s(k())};return e.jsx(ne,{isOpen:l,type:"danger",title:"Delete Tag Category",confirmButtonColor:"red-600",onClose:d,onRequestClose:d,onCancel:d,onConfirm:h,children:e.jsx("p",{children:"Are you sure you want to delete this Tag Category? All record related to this tag category will be deleted as well. This action cannot be undone."})})},$e=({field:s})=>{const l=["#FF5733","#33FF57","#5733FF","#FFFF33","#33FFFF","#FF33FF","#FF3366","#FF6666","#6699FF"],[i,d]=j.useState(!1),h=()=>{d(!i)},t=r=>{const a={target:{name:s.name,value:r}};s.onChange(a),d(!1)};return e.jsxs("div",{style:{position:"relative",display:"inline-block",top:"15px"},children:[e.jsx("div",{style:{width:"30px",height:"30px",backgroundColor:s.value,border:"1px solid #000",borderRadius:"50%"},onClick:h}),i&&e.jsx("div",{className:"absolute",children:e.jsx(fe,{className:"grid grid-cols-3 gap-1 hover mt-1 custom-scrollbar",children:l.map((r,a)=>e.jsx("div",{style:{width:"30px",height:"30px",backgroundColor:r,margin:"5px",cursor:"pointer",borderRadius:"50%",transition:"background 0.3s ease",border:s.value===r?"1px solid #000":"none"},onClick:()=>t(r)},a))})})]})};const Ae=P({categoryName:v().required("Category Name is required"),masterId:v().required("This field is required").test("is-valid-module","Invalid module selected",s=>!!F.find(l=>l.value==s)),tags:Ne().of(P().shape({tagName:v().required("Name required"),colorName:v().required("Color required")}))}),J=(s,l)=>{const i=U(s.errors,l),d=U(s.touched,l);return{errorMessage:i||"",invalid:typeof d>"u"?!1:i&&d}},Be=()=>{const s=b(),[l,i]=j.useState([]);j.useEffect(()=>{(async()=>{var a;const r=await s(Fe());i((a=r==null?void 0:r.payload)==null?void 0:a.data)})()},[s]),F.length=0,l==null||l.forEach(t=>{F.push({value:t.id,label:t.moduleName})});const d=y(t=>t.crmTagCategories.data.addForm),h=()=>{s(V(!1))};return e.jsx("div",{children:e.jsx(X,{isOpen:d,onClose:h,children:e.jsx(oe,{validationSchema:Ae,initialValues:{tags:[{tagName:"",colorName:""}],categoryName:"",masterId:""},onSubmit:async t=>{var c,x,C;let r="",a="",n="";const m=await s(ve(t));(c=m==null?void 0:m.payload)!=null&&c.success?(r="Successfully Added",a=(x=m==null?void 0:m.payload)==null?void 0:x.message,n="success"):(r="Something went wrong !!!",a=(C=m==null?void 0:m.error)==null?void 0:C.message,n="danger"),D.push(e.jsx(S,{title:r,type:n,duration:2500,children:a}),{placement:"top-end"}),s(V(!1)),await s(k())},children:({touched:t,errors:r,values:a,setFieldValue:n})=>{const m=a.tags;return e.jsx(se,{children:e.jsx(te,{layout:"inline",children:e.jsxs("div",{className:"w-full custom-scrollbar",style:{maxHeight:"75vh",overflowY:"auto"},children:[e.jsxs("div",{className:"mb-10",children:[e.jsx("h5",{className:"mb-4",children:"Add Tag Category"}),e.jsx(I,{layout:"vertical",label:"Category Name",invalid:r.categoryName&&t.categoryName,errorMessage:r.categoryName,children:e.jsx(H,{placeholder:"Category Name",name:"categoryName",component:L})}),e.jsx(I,{layout:"vertical",label:"Module Name",invalid:r.masterId&&t.masterId,errorMessage:r.masterId,children:e.jsx(ae,{name:"masterId",placeholder:"Module Name",options:F,id:"masterId",value:F.find(c=>(c==null?void 0:c.value)==(a==null?void 0:a.masterId)),onChange:c=>{const x=c.value;n("masterId",x||"")}})})]}),e.jsx(be,{name:"tags",children:({form:c,remove:x,push:C})=>e.jsxs("div",{children:[m&&m.length>0?m.map((N,u)=>{const p=J(c,`tags[${u}].tagName`),f=J(c,`tags[${u}].colorName`);return e.jsxs("div",{children:[e.jsx(I,{label:"Name",invalid:p.invalid,errorMessage:p.errorMessage,children:e.jsx(H,{invalid:p.invalid,placeholder:"Tag Name",name:`tags[${u}].tagName`,type:"text",component:L})}),e.jsx(I,{invalid:f.invalid,children:e.jsx(H,{invalid:f.invalid,placeholder:"Color",name:`tags[${u}].colorName`,render:({field:T})=>e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:0},children:[e.jsx($e,{field:T}),f.invalid&&e.jsx("div",{style:{marginTop:28,marginLeft:5,color:"red"},children:f.errorMessage})]})})}),e.jsx(R,{shape:"circle",size:"sm",icon:e.jsx(pe,{}),onClick:()=>x(u)})]},u)}):null,e.jsxs("div",{children:[e.jsx(R,{type:"button",className:"ltr:mr-2 rtl:ml-2",onClick:()=>{C({tagName:"",colorName:""})},children:"Add tags"}),e.jsx(R,{type:"submit",variant:"solid",children:"Submit"})]})]})})]})})})}})})})},{Tr:O,Th:qe,Td:He,THead:Oe,TBody:Pe}=A,ze=({renderRowSubComponent:s,getRowCanExpand:l})=>{const i=b(),d=({row:o})=>{const{textTheme:g}=E(),M=()=>{i(z(!0)),i(_(o))};return e.jsx("div",{className:`${g} cursor-pointer select-none font-semibold`,onClick:M,children:"Edit"})},h=({row:o})=>{const{textTheme:g}=E(),M=async()=>{await i(_(o)),i(K(!0))};return e.jsx("div",{className:`${g} cursor-pointer select-none font-semibold text-red-500`,onClick:M,children:"Delete"})},t=[10,25,50,100],r=y(o=>o.crmTagCategories.data.displayedTagCategoriesList),a=y(o=>o.crmTagCategories.data.loading),{pageIndex:n,pageSize:m,sort:c,query:x,total:C}=y(o=>o.crmTagCategories.data.tableData),N=j.useMemo(()=>({pageIndex:n,pageSize:m,sort:c,query:x,total:C}),[n,m,c,x,C]),u=j.useMemo(()=>[{header:()=>null,id:"expander",cell:({row:o})=>e.jsx(e.Fragment,{children:o.getCanExpand()?e.jsx("button",{className:"text-lg",onClick:o.getToggleExpandedHandler(),children:o.getIsExpanded()?e.jsx(he,{}):e.jsx(xe,{})}):null}),subCell:()=>null},{header:"Edit",id:"action",cell:o=>e.jsx(d,{row:o.row.original})},{header:"Delete",id:"action",cell:o=>e.jsx(h,{row:o.row.original})},{header:"Category Name",accessorKey:"categoryName"},{header:"Module Name",accessorKey:"master.moduleName"},{header:"Created By",accessorKey:"createdBy"}],[]),[p,f]=j.useState(r),T=j.useMemo(()=>t.map(o=>({value:o,label:`${o} / page`})),[t]);j.useEffect(()=>{const o=r==null?void 0:r.map(g=>({...g,subRows:g.tags}));f(o)},[r]);const w=Z({data:p,columns:u,getRowCanExpand:l,getCoreRowModel:ee(),getExpandedRowModel:Ce(),manualPagination:!0,manualSorting:!0}),B=o=>{const g=G(N);g.pageIndex=o,i(Y(g))},q=o=>{const g=G(N);g.pageSize=Number(o),g.pageIndex=1,i(Y(g))},le=o=>{a||q==null||q(Number(o))},ce=o=>{a||B==null||B(o)};Ie("tagcategory","canCreate");const de=()=>{i(V(!0))};return e.jsxs(e.Fragment,{children:[e.jsxs(me,{loading:a&&(p==null?void 0:p.length)!==0,type:"cover",children:[e.jsx("div",{className:"md:flex items-center justify-end",children:e.jsx("div",{className:"mb-4",children:e.jsx(R,{size:"sm",onClick:de,children:"Add New"})})}),e.jsxs(A,{children:[e.jsx(Oe,{children:w.getHeaderGroups().map(o=>e.jsx(O,{children:o.headers.map(g=>e.jsx(qe,{colSpan:g.colSpan,children:$(g.column.columnDef.header,g.getContext())},g.id))},o.id))}),a&&(p==null?void 0:p.length)===0?e.jsx(je,{columns:u==null?void 0:u.length,avatarInColumns:[0],avatarProps:{width:28,height:28}}):e.jsx(Pe,{children:w.getRowModel().rows.map(o=>e.jsxs(j.Fragment,{children:[e.jsx(O,{children:o.getVisibleCells().map(g=>e.jsx("td",{children:$(g.column.columnDef.cell,g.getContext())},g.id))}),o.getIsExpanded()&&e.jsx(O,{children:e.jsx(He,{colSpan:o.getVisibleCells().length,children:s({row:o})})})]},o.id))})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx(Te,{pageSize:m,currentPage:n,total:C,onChange:ce}),e.jsx("div",{style:{minWidth:130},children:e.jsx(ae,{size:"sm",menuPlacement:"top",isSearchable:!1,value:T==null?void 0:T.filter(o=>o.value===m),options:T,onChange:o=>le(o==null?void 0:o.value)})})]})]}),e.jsx(Ee,{}),e.jsx(ie,{}),e.jsx(Be,{})]})},Ke=()=>{const s=b(),l=y(t=>t.crmTagCategories.data.deleteSubTagConfirmation),i=y(t=>t.crmTagCategories.data.selectedTag),d=()=>{s(W(!1))},h=async()=>{var r,a,n;s(W(!1));const t=await s(ke(i.id));(r=t==null?void 0:t.payload)!=null&&r.success?D.push(e.jsx(S,{title:"Successfuly Deleted",type:"success",duration:2500,children:(a=t==null?void 0:t.payload)==null?void 0:a.message}),{placement:"top-end"}):D.push(e.jsx(S,{title:"Something Went Wrong !!!",type:"danger",duration:2500,children:(n=t==null?void 0:t.error)==null?void 0:n.message}),{placement:"top-end"}),await s(k())};return e.jsx(ne,{isOpen:l,type:"danger",title:"Delete Tag",confirmButtonColor:"red-600",onClose:d,onRequestClose:d,onCancel:d,onConfirm:h,children:e.jsx("p",{children:"Are you sure you want to delete this Tag? All record related to this tag will be deleted as well. This action cannot be undone."})})},{Tr:Q,Th:Ve,Td:We,THead:Le,TBody:Ue,Sorter:_e}=A,Ye=({row:s})=>{const l=b(),{textTheme:i}=E(),d=()=>{l(re(s))};return e.jsx("div",{className:`${i} cursor-pointer select-none font-semibold`,onClick:d,children:"Edit"})},Ge=({row:s})=>{const{textTheme:l}=E(),i=b(),d=async()=>{await i(re(s)),await i(W(!0))};return e.jsx("div",{className:`${l} cursor-pointer select-none font-semibold text-red-500`,onClick:d,children:"Delete"})},Je=s=>{const{tableData:l}=s,[i,d]=j.useState([]),[h]=j.useState(l),r=Z({data:h,columns:[{header:"Edit",id:"action",cell:a=>e.jsx(Ye,{row:a.row.original})},{header:"Delete",id:"action",cell:a=>e.jsx(Ge,{row:a.row.original})},{header:"Tag Name",accessorKey:"tagName"},{header:"Color",accessorKey:"colorName",cell:a=>{const n=a.row.original;return e.jsxs("div",{className:"flex items-center",children:[e.jsx(ue,{style:{backgroundColor:`${n.colorName}`}}),e.jsx("span",{className:"ml-2 rtl:mr-2 capitalize",children:n.colorName})]})}}],state:{sorting:i},onSortingChange:d,getCoreRowModel:ee(),getSortedRowModel:ye()});return e.jsxs(e.Fragment,{children:[e.jsxs(A,{children:[e.jsx(Le,{children:r.getHeaderGroups().map(a=>e.jsx(Q,{children:a.headers.map(n=>e.jsx(Ve,{colSpan:n.colSpan,children:n.isPlaceholder?null:e.jsxs("div",{className:n.column.getCanSort()?"cursor-pointer select-none":"",onClick:n.column.getToggleSortingHandler(),children:[$(n.column.columnDef.header,n.getContext()),e.jsx(_e,{sort:n.column.getIsSorted()})]})},n.id))},a.id))}),e.jsx(Ue,{children:r.getRowModel().rows.slice(0,10).map(a=>e.jsx(Q,{children:a.getVisibleCells().map(n=>e.jsx(We,{children:$(n.column.columnDef.cell,n.getContext())},n.id))},a.id))})]}),e.jsx(Ke,{})]})},Qe=({row:s})=>e.jsx("pre",{style:{fontSize:"10px"},children:e.jsx(Je,{tableData:s.original.tags})});ge("crmTagCategories",Me);const Xe=()=>{const s=b(),l=async()=>{await s(k())};return j.useEffect(()=>{l()},[s]),e.jsxs(e.Fragment,{children:[e.jsx("h5",{className:"mb-2",children:"Manage Tags"}),e.jsx(ze,{renderRowSubComponent:Qe,getRowCanExpand:()=>!0})]})},Qt=Xe;export{Qt as T};
