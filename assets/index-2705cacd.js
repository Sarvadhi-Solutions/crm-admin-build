import{a as f,r as p,j as e,ah as oe,aq as re}from"./index-7b0349c6.js";import{A as ne}from"./AdaptableCard-d9b587b8.js";import{D as ie}from"./DataTable-e83a4ee2.js";import{u as h,A as le,f as ce,a as me,e as de,s as $,g as O,b as B,c as ue,d as V,t as K,h as pe,i as z,j as G,k as J,r as ge}from"./AdditionalTag-b40562ba.js";import{u as Q}from"./useThemeClass-3c06ce00.js";import{B as H}from"./Button-9fa3d2fc.js";import{D as he}from"./Drawer-464b2899.js";import{T as X}from"./index-77e8bdc2.js";import{a as y,F as xe}from"./FormItem-26ad5e8d.js";import{u as fe,b as w,F as Ce,a as je}from"./formik.esm-1e90a8e9.js";import{c as be,a as M,d as ye,e as we}from"./index.esm-3fef8ee5.js";import{t as A,N as k}from"./toast-184c7e0a.js";import{I as N}from"./Input-5106ef66.js";import{R as Ne,S as De,N as ve,b as Se,d as Te,o as Ie,C as Ae}from"./index.esm-70dc7df8.js";import{a as ke}from"./index.esm-14571ecb.js";import{c as Fe,a as Le,b as Me}from"./index.esm-1ab6dd83.js";import{D as Re,t as Ee,c as Oe,T as qe}from"./tagAndCategory-2992959b.js";/* empty css              */import{c as E}from"./cloneDeep-43c01ed5.js";import{u as P}from"./checkEditUpdate-d3cb05ce.js";import{C as ze}from"./ConfirmDialog-916d697a.js";import{T as R}from"./TextTruncate-3a55f54a.js";import{d as Be}from"./debounce-11c7fdc6.js";import{S as He,c as $e}from"./Select-1f2320ab.js";import{B as Y}from"./Badge-50330686.js";import{C as Ke}from"./Card-a848a8eb.js";import{A as Pe}from"./index-2cc854d3.js";import{M as Ve}from"./MediaSkeleton-e45b822d.js";import{N as Ue}from"./react-number-format.es-d0678920.js";import"./index-0df82d35.js";import"./index.esm-b503a71c.js";import"./Pagination-2aca965e.js";import"./index-f606ec14.js";import"./_baseIsEqual-0ec018e0.js";import"./_MapCache-a209650f.js";import"./Views-c6671a9d.js";import"./get-3f8daa47.js";import"./toString-a66e4ffc.js";import"./Skeleton-8e99ae89.js";import"./index-cec25fe7.js";import"./Alert-ebb58074.js";import"./useTimeout-187593ce.js";import"./CloseButton-68e6949e.js";import"./StatusIcon-11c7c844.js";import"./RangeCalendar-8f0006dc.js";import"./useControllableState-ca2883fa.js";import"./index-e01b641f.js";import"./useMergeRef-788c4cb0.js";import"./useRootClose-f96499f9.js";import"./usePopper-ea1a26c2.js";import"./TimeInput-0d554281.js";import"./useUniqueId-ab09df2f.js";import"./useDidUpdate-eb06a65d.js";import"./Dialog-9d79d85c.js";import"./index-39084392.js";import"./index-d98edc99.js";import"./useUncertainRef-81a90e74.js";import"./isNil-2a409f2e.js";import"./index-ba238736.js";import"./chainedFunction-070f832c.js";import"./index-24734fba.js";import"./index-10cbcf37.js";import"./index-89cb79e5.js";import"./Progress-10ad9a7b.js";import"./index-9b4971f3.js";import"./ScrollBar-e6e4e948.js";import"./index-c97a424b.js";import"./index-2cd79135.js";import"./mapCloneElement-0f96c84d.js";import"./Switcher-e923ff00.js";import"./Tag-a0bc44e6.js";import"./index-aa85e3d4.js";import"./index-df8f9f26.js";import"./Tooltip-a61fe545.js";import"./index.esm-8b94bd99.js";import"./Upload-4b7aa6b8.js";import"./index.esm-c96a5b5f.js";import"./CrmService-d23a3034.js";import"./_getPrototype-57ad14e0.js";import"./slicedToArray-a6cb1158.js";import"./objectWithoutProperties-8809bfcf.js";import"./toConsumableArray-6439c76e.js";import"./floating-ui.dom-bef9cea3.js";const We=a=>{const{touched:s,errors:t}=a,o=f(),[i,n]=p.useState(!1);p.useState("#808080");const[m,d]=p.useState(!1),[c,x]=p.useState([]),[F,C]=p.useState([]),D=()=>{n(!i),d(!1)},[v,S]=p.useState("");p.useEffect(()=>{(async()=>{var q,U;try{const{payload:T}=await o(ce());console.log(T,"send Me The Id And The Payload");const L=(q=T==null?void 0:T.data)==null?void 0:q.find(I=>(I==null?void 0:I.moduleName)==="clients");if(S(L.id),L){const{payload:I}=await o(me({id:(U=L==null?void 0:L.id)==null?void 0:U.toString()})),se=Ee(I.data),ae=Oe(I.data);C(ae),x(se)}}catch(T){console.error("Error fetching module data:",T)}})()},[o]);const b=h(j=>j.crmCustomers.data.selectedCustomer),[u,l]=p.useState(b?b.tags||[]:[]),g=fe(),r=j=>{console.log(j),l(j);const q=[j.value];g.setFieldValue("tagId",q)};return e.jsxs(e.Fragment,{children:[e.jsx(y,{label:"Client Name",invalid:t.clientName&&s.clientName,errorMessage:t.clientName,children:e.jsx(w,{type:"text",autoComplete:"off",name:"clientName",placeholder:"Client Name",component:N,prefix:e.jsx(Ne,{className:"text-xl"})})}),e.jsx(y,{label:"Contact Number",invalid:t.contactInfo&&s.contactInfo,errorMessage:t.contactInfo,children:e.jsx(w,{type:"text",autoComplete:"off",name:"contactInfo",placeholder:"Contact Number",component:N,prefix:e.jsx(De,{className:"text-xl"})})}),e.jsx(y,{label:"Address",invalid:t.address&&s.address,errorMessage:t.address,children:e.jsx(w,{type:"text",autoComplete:"off",name:"address",placeholder:"Address",component:N,prefix:e.jsx(ve,{className:"text-xl"})})}),e.jsx(y,{label:"Billing Details",invalid:t.billingDetails&&s.billingDetails,errorMessage:t.billingDetails,children:e.jsx(w,{type:"text",autoComplete:"off",name:"billingDetails",placeholder:"Billing Details",component:N,prefix:e.jsx(Fe,{className:"text-xl"})})}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx(y,{label:"Tags",invalid:t.history&&s.history,errorMessage:t.history,children:e.jsxs("div",{style:{position:"relative"},children:[e.jsx(w,{name:"Tag",component:Re,options:c,placeholder:"Select a Tag",value:g.initialValues.tagName,onChange:r}),e.jsx(Le,{style:{position:"absolute",right:"10px",top:"10px",border:"none",background:"#FFF"},className:"text-xl",onClick:()=>{D(),d(!0)}})]})}),e.jsx(le,{isOpen:i,moduleName:v,categoryList:F,onOpenChange:j=>n(j)})]}),e.jsx(y,{label:"History",invalid:t.history&&s.history,errorMessage:t.history,children:e.jsx(w,{type:"text",autoComplete:"off",name:"history",placeholder:"History",component:N,prefix:e.jsx(ke,{className:"text-xl"})})}),e.jsx(y,{label:"Notes",invalid:t.notes&&s.notes,errorMessage:t.notes,children:e.jsx(w,{type:"text",autoComplete:"off",name:"notes",placeholder:"Notes",component:N,prefix:e.jsx(Me,{className:"text-xl"})})})]})},_e=be().shape({clientName:M().required("Customer Name is required"),contactInfo:ye().typeError("Contact must be a number").required("Contact is required").test("is-number","Contact must be a number",a=>!isNaN(a)).test("is-ten-digits","Contact must be exactly 10 digits",a=>/^\d{10}$/.test(a)),address:M().required("Address is required"),billingDetails:M().required("Billing Details is required"),history:M(),notes:M(),tagId:we()}),{TabNav:Ge,TabList:Je,TabContent:Qe}=X,Z=p.forwardRef((a,s)=>{var n,m,d;const t=h(c=>c.crmCustomers.data.selectedCustomer),o=!!t.id,i=f();return e.jsx(Ce,{innerRef:s,initialValues:{clientName:(t==null?void 0:t.clientName)||"",contactInfo:(t==null?void 0:t.contactInfo)||"",address:(t==null?void 0:t.address)||"",billingDetails:(t==null?void 0:t.billingDetails)||"",history:(t==null?void 0:t.history)||"",notes:(t==null?void 0:t.notes)||"",tagName:((m=(n=t==null?void 0:t.tags)==null?void 0:n[0])==null?void 0:m.tagName)||"",tagId:((d=t==null?void 0:t.tags)==null?void 0:d.map(c=>c.id))||[],colorName:t!=null&&t.tags&&(t==null?void 0:t.tags.length)>0?t==null?void 0:t.tags[0].colorName:""},validationSchema:_e,onSubmit:async(c,{setSubmitting:x})=>{var v,S,b,u,l,g;const{colorName:F,tagName:C,...D}=c;if(o){const r=await i(de({customerId:(t==null?void 0:t.id)||"",updatedData:D}));(v=r==null?void 0:r.payload)!=null&&v.success?A.push(e.jsx(k,{title:"Successfully Added",type:"success",duration:2500,children:(S=r==null?void 0:r.payload)==null?void 0:S.message}),{placement:"top-end"}):A.push(e.jsx(k,{title:"Something went wrong !!!",type:"danger",duration:2500,children:(b=r==null?void 0:r.error)==null?void 0:b.message}),{placement:"top-end"}),i($()),await i(O()),await i(B())}else{const r=await i(ue(D));(u=r==null?void 0:r.payload)!=null&&u.success?A.push(e.jsx(k,{title:"Successfully Added",type:"success",duration:2500,children:(l=r==null?void 0:r.payload)==null?void 0:l.message}),{placement:"top-end"}):A.push(e.jsx(k,{title:"Something went wrong !!!",type:"danger",duration:2500,children:(g=r==null?void 0:r.error)==null?void 0:g.message}),{placement:"top-end"}),await i(O()),await i($()),await i(B())}x(!1)},children:({touched:c,errors:x})=>e.jsx(je,{children:e.jsx(xe,{children:e.jsxs(X,{defaultValue:"customerInfo",children:[e.jsx(Je,{children:e.jsx(Ge,{value:"customerInfo",children:"Client Details"})}),e.jsx("div",{className:"p-6",children:e.jsx(Qe,{value:"customerInfo",children:e.jsx(We,{touched:c,errors:x})})})]})})})})});Z.displayName="CustomerForm";const ee=p.forwardRef((a,s)=>{f();const t=h(i=>i.crmCustomers.data.selectedCustomer);h(i=>i.crmCustomers.data.customerList);const o=async i=>{};return e.jsx(Z,{ref:s,customer:t,onFormSubmit:o})});ee.displayName="CustomerEditContent";const Xe=({onSaveClick:a,onCancel:s})=>e.jsxs("div",{className:"text-right w-full",children:[e.jsx(H,{size:"sm",className:"mr-2",onClick:s,children:"Cancel"}),e.jsx(H,{size:"sm",variant:"solid",onClick:a,children:"Save"})]}),Ye=()=>{const a=f(),s=h(n=>n.crmCustomers.data.drawerOpen),t=()=>{a($()),a(V({}))},o=p.useRef(null),i=()=>{var n,m;console.log("formSubmit function called",(n=o.current)==null?void 0:n.values),(m=o.current)==null||m.submitForm()};return e.jsx(he,{isOpen:s,closable:!1,bodyClass:"p-0",footer:e.jsx(Xe,{onCancel:t,onSaveClick:i}),onClose:t,onRequestClose:t,children:e.jsx(ee,{ref:o})})},Ze=()=>{const a=f(),s=h(n=>n.crmCustomers.data.deleteConfirmation),t=h(n=>n.crmCustomers.data.selectedCustomer),o=()=>{a(K(!1))},i=async()=>{var m,d,c;a(K(!1));const n=await a(pe(t.id));(m=n==null?void 0:n.payload)!=null&&m.success?A.push(e.jsx(k,{title:"Successfuly Deleted",type:"success",duration:2500,children:(d=n==null?void 0:n.payload)==null?void 0:d.message}),{placement:"top-end"}):A.push(e.jsx(k,{title:"Something Went Wrong !!!",type:"danger",duration:2500,children:(c=n==null?void 0:n.error)==null?void 0:c.message}),{placement:"top-end"}),await a(O()),await a(B())};return e.jsx(ze,{isOpen:s,type:"danger",title:"Delete Client",confirmButtonColor:"red-600",onClose:o,onRequestClose:o,onCancel:o,onConfirm:i,children:e.jsx("p",{children:"Are you sure you want to delete this client? All record related to this client will be deleted as well. This action cannot be undone."})})},et=({row:a})=>{const{textTheme:s}=Q(),t=f(),o=()=>{t(G()),t(V(a))};return e.jsx("div",{className:`${s} cursor-pointer select-none font-semibold`,onClick:o,children:"Edit"})},tt=({row:a})=>{const{textTheme:s}=Q(),t=f(),o=async()=>{await t(V(a)),t(K(!0))};return e.jsx("div",{className:`${s} cursor-pointer select-none font-semibold text-red-500`,onClick:o,children:"Delete"})},st=()=>{const a=f(),s=h(u=>u.crmCustomers.data.displayedCustomersList),t=h(u=>u.crmCustomers.data.loading),o=P("clients","canModify"),i=P("clients","canDelete");h(u=>u.crmCustomers.data.filterData);const{pageIndex:n,pageSize:m,sort:d,query:c,total:x}=h(u=>u.crmCustomers.data.tableData),F=p.useCallback(()=>{a(O())},[a]);p.useEffect(()=>{F()},[F]);const C=p.useMemo(()=>({pageIndex:n,pageSize:m,sort:d,query:c,total:x}),[n,m,d,c,x]),D=p.useMemo(()=>{const u=[{header:"Clients Name",accessorKey:"clientName",cell:l=>{var r;const g=(r=l.row.original)==null?void 0:r.clientName;return e.jsx(R,{text:g,maxLength:20})}},{header:"Clients Number",accessorKey:"contactInfo",cell:l=>l.row.original.contactInfo},{header:"Address",accessorKey:"address",cell:l=>{var r;const g=(r=l.row.original)==null?void 0:r.address;return e.jsx(R,{text:g,maxLength:20})}},{header:"Billing Details",accessorKey:"billingDetails",cell:l=>{var r;const g=(r=l.row.original)==null?void 0:r.billingDetails;return e.jsx(R,{text:g,maxLength:20})}},{header:"History",accessorKey:"history",cell:l=>{var r;const g=(r=l.row.original)==null?void 0:r.history;return e.jsx(R,{text:g,maxLength:20})}},{header:"Notes",accessorKey:"notes",cell:l=>{var r;const g=(r=l.row.original)==null?void 0:r.notes;return e.jsx(R,{text:g,maxLength:20})}},{header:"Tag Name",accessorKey:"tagName",cell:l=>{var r;const g=((r=l.row.original)==null?void 0:r.tags)||[];return e.jsx(qe,{tags:g})}}];return i&&u.unshift({header:"Delete",id:"action",cell:l=>e.jsx(tt,{row:l.row.original})}),o&&u.unshift({header:"Edit",id:"action",cell:l=>e.jsx(et,{row:l.row.original})}),u},[o,i]),v=u=>{const l=E(C);l.pageIndex=u,a(z(l))},S=u=>{const l=E(C);l.pageSize=Number(u),l.pageIndex=1,a(z(l))},b=u=>{const l=E(C);l.sort=u,a(z(l))};return e.jsxs("div",{children:[e.jsx(ie,{columns:D,data:s,skeletonAvatarColumns:[0],skeletonAvatarProps:{width:28,height:28},loading:t,pagingData:{total:C.total,pageIndex:C.pageIndex,pageSize:C.pageSize},onPaginationChange:v,onSelectChange:S,onSort:b}),e.jsx(Ye,{}),e.jsx(Ze,{})]})},te=p.forwardRef((a,s)=>{const{onInputChange:t}=a,o=Be(i,500);function i(m){t==null||t(m)}const n=m=>{o(m.target.value)};return e.jsx(N,{ref:s,className:"max-w-md md:w-52 mb-4",size:"sm",placeholder:"Search",prefix:e.jsx(Se,{className:"text-lg"}),onChange:n})});te.displayName="CustomerTableSearch";const{Control:at}=$e,W=[{value:"",label:"All",color:"bg-gray-500"},{value:"active",label:"Active",color:"bg-emerald-500"},{value:"blocked",label:"Blocked",color:"bg-red-500"}],ot=({innerProps:a,label:s,data:t,isSelected:o})=>e.jsxs("div",{className:`flex items-center justify-between p-2 cursor-pointer ${o?"bg-gray-100 dark:bg-gray-500":"hover:bg-gray-50 dark:hover:bg-gray-600"}`,...a,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{innerClass:t.color}),e.jsx("span",{children:s})]}),o&&e.jsx(Te,{className:"text-emerald-500 text-xl"})]}),rt=({children:a,...s})=>{const t=s.getValue()[0];return e.jsxs(at,{...s,children:[t&&e.jsx(Y,{className:"ltr:ml-4 rtl:mr-4",innerClass:t.color}),a]})},nt=()=>{const a=f(),{status:s}=h(o=>o.crmCustomers.data.filterData),t=o=>{a(J({status:o==null?void 0:o.value}))};return e.jsx(He,{options:W,size:"sm",className:"mb-4 min-w-[130px]",components:{Option:ot,Control:rt},value:W.filter(o=>o.value===s),onChange:t})},it=()=>{const a=f(),s=p.useRef(null),t=h(c=>c.crmCustomers.data.tableData),o=P("clients","canCreate"),i=c=>{const x=E(t);x.query=c,x.pageIndex=1,typeof c=="string"&&c.length>1&&n(x),typeof c=="string"&&c.length===0&&n(x)},n=c=>{a(z(c)),a(O())},m=()=>{const c=E(t);c.query="",s.current&&(s.current.value=""),a(J({status:""})),n(c)},d=()=>{a(G())};return e.jsxs("div",{className:"md:flex items-center justify-between",children:[e.jsxs("div",{className:"md:flex items-center gap-4",children:[e.jsx(te,{ref:s,onInputChange:i}),e.jsx(nt,{})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx(H,{size:"sm",className:"me-2",onClick:m,children:"Clear All"}),o&&e.jsx(H,{size:"sm",onClick:d,children:"Add New"})]})]})},_=a=>{const{icon:s,avatarClass:t,label:o,value:i,growthRate:n,loading:m}=a,d=55;return e.jsx(Ke,{bordered:!0,children:e.jsx(oe,{loading:m,customLoader:e.jsx(Ve,{avatarProps:{className:"rounded",width:d,height:d}}),children:e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Pe,{className:t,size:d,icon:s}),e.jsxs("div",{children:[e.jsx("span",{children:o}),e.jsx("h3",{children:e.jsx(Ue,{thousandSeparator:!0,displayType:"text",value:i})})]})]})})})})},lt=()=>{var o,i,n,m;const a=f(),s=h(d=>d.crmCustomers.data.statisticData);console.log(s,"statisticData");const t=h(d=>d.crmCustomers.data.statisticLoading);return p.useEffect(()=>{a(B())},[]),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4 mb-6",children:[e.jsx(_,{icon:e.jsx(Ie,{}),avatarClass:"!bg-indigo-600",label:"Total Clients",value:(o=s==null?void 0:s.totalCustomers)==null?void 0:o.value,growthRate:(i=s==null?void 0:s.totalCustomers)==null?void 0:i.growShrink,loading:t}),e.jsx(_,{icon:e.jsx(Ae,{}),avatarClass:"!bg-emerald-500",label:"This Week's New Clients",value:(n=s==null?void 0:s.newCustomers)==null?void 0:n.value,growthRate:(m=s==null?void 0:s.newCustomers)==null?void 0:m.growShrink,loading:t})]})};re("crmCustomers",ge);const ct=()=>e.jsxs(e.Fragment,{children:[e.jsx(lt,{}),e.jsxs(ne,{bodyClass:"h-full",children:[e.jsx(it,{}),e.jsx(st,{})]})]}),Bs=ct;export{Bs as default};
