import{a as T,j as e,r as h,ap as re,aq as ie}from"./index-59d5b448.js";import{A as ne}from"./AdaptableCard-e9819ea9.js";import{F as k}from"./FormDesription-8da00f1c.js";import{D as ce}from"./DataTable-75ddba9e.js";import{T as le}from"./TagsList-f721f71b.js";import{T as E}from"./TextTruncate-f64f0cbd.js";import{u as R}from"./checkEditUpdate-547842ef.js";import{u as de}from"./useThemeClass-95bae207.js";import{c as q}from"./cloneDeep-aed446a8.js";import{U as me,N as pe,O as ue,b as xe}from"./index.esm-000f222a.js";import{u as f,t as B,d as he,g as K,a as Q,b as ge,c as fe,e as Ce,f as je,h as Ne,i as be,j as V,k as ye,l as we,s as X,m as H,n as $,o as Y,r as ve}from"./index-8de4805b.js";import{t as P,N as U}from"./toast-4fb7070f.js";import{C as Ie}from"./ConfirmDialog-615c6369.js";import{B as _}from"./Button-5fdc8ae1.js";import{D as De}from"./Drawer-d20ab55b.js";import{a as N,F as Se}from"./FormItem-f6244853.js";import{T as ee}from"./index-1356c0b5.js";import{u as Te,b as w,F as Fe,a as Me}from"./formik.esm-b68e401a.js";import{c as Ae,a as b,e as Le}from"./index.esm-d716c1df.js";import{I}from"./Input-231e09c8.js";/* empty css              */import{T as ze,d as Ee}from"./index.esm-57280789.js";import"./Alert-93591860.js";import"./index-a89362ce.js";import"./Badge-e03d5da2.js";import"./RangeCalendar-2cc8a304.js";import"./Card-5d1a5a32.js";import"./index-eb5fd987.js";import"./index-1e02d165.js";import"./Dialog-a750e519.js";import"./index-61ff5eee.js";import"./toString-7b1fdeb1.js";import"./index-b2ad62b7.js";import"./index-eaede97f.js";import"./index-f7021d30.js";import"./Pagination-5e980512.js";import"./Progress-a64810cd.js";import"./index-1d5c9077.js";import"./ScrollBar-cea6b53e.js";import"./index-7440612f.js";import{S as O}from"./Select-ee1aec02.js";import"./Skeleton-d921a7f4.js";import"./index-af92aa08.js";import"./Switcher-a1c19d2c.js";import"./index-c7139f0d.js";import"./Tag-edd7fd18.js";import"./index-8aead059.js";import"./index-5637e944.js";import{T as Z}from"./Tooltip-408dc3d5.js";import"./Upload-4e96c616.js";import{t as Oe}from"./tagAndCategory-0975d9d9.js";import{a as ke}from"./index.esm-5522ae29.js";import{F as Re}from"./index.esm-ae78bccf.js";import{a as G}from"./index.esm-a2caee4e.js";import{G as J}from"./index.esm-ba5b3922.js";import{M as qe}from"./index.esm-b753695d.js";import{C as $e}from"./react-select-creatable.esm-84ef6566.js";import{a as Ke}from"./index.esm-949617b0.js";import{d as We}from"./debounce-973c358d.js";import"./index-ddf97715.js";import"./_MapCache-e54d9323.js";import"./Views-64d17177.js";import"./_getPrototype-f444968c.js";import"./CrmService-a82a4f3a.js";import"./useTimeout-8dc1031d.js";import"./CloseButton-d1491053.js";import"./StatusIcon-9fe83ab5.js";import"./chainedFunction-070f832c.js";import"./index-72795205.js";import"./index-0f07cea4.js";import"./useControllableState-51fc22de.js";import"./isNil-4ce6fc45.js";import"./get-7830c53c.js";import"./useMergeRef-788c4cb0.js";import"./_baseIsEqual-ddd229ac.js";import"./useRootClose-c6fcb0f3.js";import"./usePopper-6c82c939.js";import"./TimeInput-5b439447.js";import"./useUniqueId-f1811c55.js";import"./useDidUpdate-1b514583.js";import"./useUncertainRef-c82b9981.js";import"./slicedToArray-cd867625.js";import"./objectWithoutProperties-8809bfcf.js";import"./toConsumableArray-1d5803e7.js";import"./floating-ui.dom-bef9cea3.js";import"./mapCloneElement-34a4b3d4.js";import"./index.esm-ee61d82c.js";const Ze=()=>{const o=T(),i=f(r=>r.crmContact.data.deleteConfirmation),t=f(r=>r.crmContact.data.selectedContact),c=()=>{o(B(!1))},l=async()=>{var u,d,m;o(B(!1));const r=await o(he(t==null?void 0:t.id));(u=r==null?void 0:r.payload)!=null&&u.success?P.push(e.jsx(U,{title:"Successfuly Deleted",type:"success",duration:2500,children:(d=r==null?void 0:r.payload)==null?void 0:d.message}),{placement:"top-end"}):P.push(e.jsx(U,{title:"Something Went Wrong !!!",type:"danger",duration:2500,children:(m=r==null?void 0:r.error)==null?void 0:m.message}),{placement:"top-end"}),await o(K()),await o(Q())};return e.jsx(Ie,{isOpen:i,type:"danger",title:"Delete Contact",confirmButtonColor:"red-600",onClose:c,onRequestClose:c,onCancel:c,onConfirm:l,children:e.jsx("p",{children:"Are you sure you want to delete this Contact? All record related to this contact will be deleted as well. This action cannot be undone."})})},Be=o=>{const{touched:i,errors:t,values:c,setFieldValue:l}=o,r=T(),[u,d]=h.useState([]),[m,y]=h.useState(null),D=f(a=>a.crmContact.data.companyList),x=f(a=>a.crmContact.data.sources),C=f(a=>a.crmContact.data.states);f(a=>a.crmContact.data.cities);const j=h.useMemo(()=>D.map(a=>({value:a.id,label:a.companyName})),[D]),v=h.useMemo(()=>C.map(a=>({value:a.id,label:a.stateName})),[C]),F=h.useMemo(()=>{if(!m)return[];const a=C.find(s=>s.id===m);return(a==null?void 0:a.cities.map(s=>({value:s.id,label:s.cityName})))||[]},[C,m]),A=h.useMemo(()=>x.map(s=>({label:s.sources,value:s.id})),[x]);h.useEffect(()=>{(async()=>{var s,g;try{const{payload:n}=await r(je()),S=(s=n==null?void 0:n.data)==null?void 0:s.find(M=>(M==null?void 0:M.moduleName)==="contacts");if(S){const{payload:M}=await r(Ne({id:(g=S==null?void 0:S.id)==null?void 0:g.toString()})),W=Oe(M.data);d(W)}}catch(n){console.error("Error fetching module data:",n)}})(),r(ge()),r(fe()),r(Ce())},[r]);const L=Te(),z=a=>{L.setFieldValue("tagId",a)},p=async(a,s)=>{const g={sources:a==null?void 0:a.label};switch(s.action){case"create-option":await r(be(g)),await r(V());break;case"select-option":l("sourceId",a);break;case"clear":l("sourceId",null);break}};return e.jsxs(e.Fragment,{children:[e.jsx(k,{title:"Contact Basic Information",desc:"",className:"mb-2"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"col-span-1",children:e.jsx(N,{label:"First Name *",invalid:t.firstName&&i.firstName,errorMessage:t.firstName,children:e.jsx(w,{type:"text",autoComplete:"off",name:"firstName",placeholder:"First Name",component:I,prefix:e.jsx(G,{className:"text-xl"})})})}),e.jsx("div",{className:"col-span-1",children:e.jsx(N,{label:"Last Name *",invalid:t.lastName&&i.lastName,errorMessage:t.lastName,children:e.jsx(w,{type:"text",autoComplete:"off",name:"lastName",placeholder:"Last Name",component:I,prefix:e.jsx(G,{className:"text-xl"})})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"col-span-1",children:e.jsx(N,{label:"Email *",invalid:t.email&&i.email,errorMessage:t.email,children:e.jsx(w,{type:"text",autoComplete:"off",name:"email",placeholder:"Email",component:I,prefix:e.jsx(me,{className:"text-xl"})})})}),e.jsx("div",{className:"col-span-1",children:e.jsx(N,{label:"Contact Number *",invalid:t.contactNumber&&i.contactNumber,errorMessage:t.contactNumber,children:e.jsx(w,{type:"tel",autoComplete:"off",name:"contactNumber",placeholder:"Contact Number",component:I,prefix:e.jsx(ke,{className:"text-xl"})})})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsx("div",{className:"col-span-1",children:e.jsx(N,{label:"Title",invalid:t.title&&i.title,errorMessage:t.title,children:e.jsx(w,{type:"text",autoComplete:"off",name:"title",placeholder:"Title",component:I,prefix:e.jsx(qe,{className:"text-xl"})})})})}),e.jsx(N,{label:"Notes",invalid:t.description&&i.description,errorMessage:t.description,children:e.jsx(w,{textArea:!0,type:"text",autoComplete:"off",name:"description",placeholder:"Notes",component:I,prefix:e.jsx(ze,{className:"text-xl"})})}),e.jsx(k,{title:"Address",desc:"",className:"mb-2"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"col-span-1",children:e.jsx(N,{label:"Address",invalid:t.address&&i.address,errorMessage:t.address,children:e.jsx(w,{type:"text",autoComplete:"off",name:"address",placeholder:"Address",component:I,prefix:e.jsx(Re,{className:"text-xl"})})})}),e.jsx("div",{className:"col-span-1",children:e.jsx("div",{className:"col-span-1",children:e.jsx(N,{label:"State",invalid:t.stateId&&i.stateId,errorMessage:t.stateId,children:e.jsx(O,{name:"stateId",placeholder:"Select State",options:v,id:"stateId",value:v.find(a=>(a==null?void 0:a.value)==(c==null?void 0:c.stateId)),onChange:a=>{const s=a.value;l("stateId",s||""),y(s)}})})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"col-span-1",children:e.jsx("div",{className:"col-span-1",children:e.jsx(N,{label:"City",invalid:t.cityId&&i.cityId,errorMessage:t.cityId,children:e.jsx(O,{name:"cityId",placeholder:"Select City",options:F,id:"cityId",value:F.find(a=>(a==null?void 0:a.value)==(c==null?void 0:c.cityId)),isDisabled:!m,onChange:a=>{const s=a.value;l("cityId",s||"")}})})})}),e.jsx("div",{className:"col-span-1",children:e.jsx("div",{style:{position:"relative"},children:e.jsx("div",{className:"col-span-1",children:e.jsx(N,{label:"ZipCode",invalid:t.zipcode&&i.zipcode,errorMessage:t.zipcode,children:e.jsx(w,{type:"text",autoComplete:"off",name:"zipcode",placeholder:"ZipCode",component:I,prefix:e.jsx(Ee,{className:"text-xl"})})})})})})]}),e.jsx(k,{title:"Contact Others Details",desc:"",className:"mb-2"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"col-span-1",children:e.jsx(N,{label:"Company Name",invalid:t.companiesId&&i.companiesId,errorMessage:t.companiesId,children:e.jsx(O,{name:"companiesId",placeholder:"Company Name",options:j,id:"companiesId",value:j.find(a=>(a==null?void 0:a.value)==(c==null?void 0:c.companiesId)),onChange:a=>{const s=a.value;l("companiesId",s||"")}})})}),e.jsx("div",{className:"col-span-1",children:e.jsx(N,{label:"Source",invalid:t.source&&i.source,errorMessage:t.source,children:e.jsx(w,{isClearable:!0,type:"text",autoComplete:"off",name:"sourceId",placeholder:"Source",component:O,componentAs:$e,options:A,prefix:e.jsx(J,{className:"text-xl"}),onChange:p})})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsx("div",{className:"col-span-1",children:e.jsx(N,{label:"Tag",children:e.jsx(w,{isClearable:!0,isMulti:!0,type:"text",autoComplete:"off",name:"tagId",placeholder:"Select tags",component:O,options:u,prefix:e.jsx(J,{className:"text-xl"}),closeMenuOnSelect:!1,onChange:z})})})})]})},He=Ae().shape({firstName:b().required("First Name is required"),lastName:b().required("Last Name is required"),title:b(),contactNumber:b().typeError("Contact must be a number").required("Contact is required").test("is-number","Contact must be a number",o=>!isNaN(o)).test("is-ten-digits","Contact must be exactly 10 digits",o=>{if(o){const i=Number(o);return/^\d{10}$/.test(i.toString())}return!0}).test("is-ten-digits","Contact number cannot start with 0",o=>o?!o.startsWith("0"):!0),email:b().matches(/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/i,"Invalid email").required("Email is required"),address:b(),stateId:b(),cityId:b(),zipcode:b().test("is-number","ZipCode must be a number",o=>!(o&&isNaN(Number(o)))).test("is-six-digits","ZipCode must be exactly 6 digits",o=>!(o&&o.length!==6)),companiesId:b().nullable(),companyName:b(),source:b().nullable(),description:b(),tagId:Le()}),{TabNav:Pe,TabList:Ue,TabContent:_e}=ee,te=h.forwardRef((o,i)=>{var d,m,y,D;const t=f(x=>x.crmContact.data.selectedContact),c=f(x=>x.crmContact.data.sources),l=h.useMemo(()=>c.map(C=>({label:C.sources,value:C.id})),[c]),r=!!t.id,u=T();return e.jsx(Fe,{innerRef:i,initialValues:{firstName:(t==null?void 0:t.firstName)||"",lastName:(t==null?void 0:t.lastName)||"",title:(t==null?void 0:t.title)||"",email:(t==null?void 0:t.email)||"",contactNumber:(t==null?void 0:t.contactNumber)||"",description:(t==null?void 0:t.description)||"",companyName:((d=t==null?void 0:t.company)==null?void 0:d.companyName)||"",sourceId:t!=null&&t.sourceId?l.find(x=>x.value===(t==null?void 0:t.sourceId)):null,address:(t==null?void 0:t.address)||"",stateId:(t==null?void 0:t.stateId)||"",cityId:(t==null?void 0:t.cityId)||"",zipcode:(t==null?void 0:t.zipcode)||"",tagName:((y=(m=t==null?void 0:t.tags)==null?void 0:m[0])==null?void 0:y.tagName)||"",tagId:((D=t==null?void 0:t.tags)==null?void 0:D.map(x=>({label:x.tagName,value:x.id})))||[],companiesId:(t==null?void 0:t.companiesId)||""},validationSchema:He,onSubmit:async(x,{setSubmitting:C})=>{var j,v,F,A,L,z,p;try{const{tagName:a,...s}=x,g={...s,sourceId:(j=s==null?void 0:s.sourceId)==null?void 0:j.value,tagId:s==null?void 0:s.tagId.map(oe=>oe.value)},n=r?await u(ye({contactId:(t==null?void 0:t.id)||"",updatedData:g})):await u(we(g)),S=(v=n==null?void 0:n.payload)!=null&&v.success?"Successfully Added":"Something went wrong !!!",M=(F=n==null?void 0:n.payload)!=null&&F.success?"success":"danger",W=(A=n==null?void 0:n.payload)!=null&&A.success?(L=n==null?void 0:n.payload)==null?void 0:L.message:(z=n==null?void 0:n.error)==null?void 0:z.message;P.push(e.jsx(U,{title:S,type:M,duration:2500,children:W}),{placement:"top-end"}),(p=n==null?void 0:n.payload)!=null&&p.success&&u(X()),await u(K()),await u(Q())}catch(a){console.error(a)}finally{C(!1)}},children:({touched:x,errors:C,values:j,setFieldValue:v})=>e.jsx(Me,{children:e.jsx(Se,{children:e.jsxs(ee,{defaultValue:"personalInfo",children:[e.jsx(Ue,{children:e.jsx(Pe,{value:"personalInfo",children:"Contact Details"})}),e.jsx("div",{className:"p-6",children:e.jsx(_e,{value:"personalInfo",children:e.jsx(Be,{touched:x,errors:C,values:j,setFieldValue:v})})})]})})})})});te.displayName="ContactForm";const ae=h.forwardRef((o,i)=>{T();const t=f(l=>l.crmContact.data.selectedContact);f(l=>l.crmContact.data.contactList);const c=async l=>{};return e.jsx(te,{ref:i,contact:t,onFormSubmit:c})});ae.displayName="ContactEditContent";const Ge=({onSaveClick:o,onCancel:i})=>e.jsxs("div",{className:"text-right w-full",children:[e.jsx(_,{size:"sm",className:"mr-2",onClick:i,children:"Cancel"}),e.jsx(_,{size:"sm",variant:"solid",onClick:o,children:"Save"})]}),Je=()=>{const o=T(),[i,t]=h.useState(window.innerWidth/2),c=f(m=>m.crmContact.data.drawerOpen),l=()=>{o(X()),o(H({}))},r=h.useRef(null),u=()=>{var m,y;console.log("formSubmit function called",(m=r.current)==null?void 0:m.values),(y=r.current)==null||y.submitForm()},d=()=>{t(window.innerWidth/2)};return h.useEffect(()=>(window.addEventListener("resize",d),()=>{window.removeEventListener("resize",d)}),[]),e.jsx(De,{isOpen:c,closable:!1,bodyClass:"p-0",width:i,footer:e.jsx(Ge,{onCancel:l,onSaveClick:u}),onClose:l,onRequestClose:l,children:e.jsx(ae,{ref:r})})},Qe=()=>{const o=T(),i=f(p=>p.crmContact.data.displayedContactList),t=R("contacts","canModify"),c=R("contacts","canDelete"),l=R("contacts","canView"),r=f(p=>p.crmContact.data.loading),u=re(),{pageIndex:d,pageSize:m,sort:y,query:D,total:x}=f(p=>p.crmContact.data.tableData),C=h.useCallback(()=>{o(K()),o(V())},[o]);h.useEffect(()=>{C()},[C]);const j=h.useMemo(()=>({pageIndex:d,pageSize:m,sort:y,query:D,total:x}),[d,m,y,D,x]),v=({row:p})=>{const a=T();de();const s=()=>{a(Y()),a(H(p))},g=async()=>{a(H(p)),a(B(!0))},n=()=>{const S=`/app/crm/contact-details/${p.id}`;u(S)};return e.jsxs("div",{className:"flex text-base items-center",children:[t&&e.jsx("span",{className:"cursor-pointer hover:text-indigo-500 circle items-center",onClick:s,children:e.jsx(pe,{})}),c&&e.jsx("span",{className:"cursor-pointer hover:text-red-500 circle mx-1 items-center",onClick:g,children:e.jsx(ue,{})}),l&&e.jsx("span",{className:"cursor-pointer hover:text-green-500 circle items-center text-lg",onClick:n,children:e.jsx(Ke,{})})]})},F=h.useMemo(()=>[{header:"Action",id:"action",cell:a=>e.jsx(v,{row:a.row.original})},{header:"Name",accessorKey:"firstName",cell:a=>{const{firstName:s,lastName:g}=a.row.original,n=`${s} ${g}`;return e.jsx(E,{text:n,maxLength:20})}},{header:"email",accessorKey:"email",cell:a=>a.row.original.email},{header:"Number",accessorKey:"contactNumber",cell:a=>a.row.original.contactNumber},{header:"source",accessorKey:"sourceId",cell:a=>{var g,n;const s=(n=(g=a.row.original)==null?void 0:g.source)==null?void 0:n.sources;return e.jsx(E,{text:s,maxLength:15})}},{header:"Tags",accessorKey:"tagName",cell:a=>{const s=a.row.original.tags||[];return e.jsx(le,{tags:s})}},{header:"Title",accessorKey:"title",cell:a=>{const s=a.row.original.title;return e.jsx(Z,{title:s,children:e.jsx(E,{text:s,maxLength:15})},s)}},{header:"Company",accessorKey:"companyName",cell:a=>{const s=a.row.original.company?a.row.original.company.companyName:"";return e.jsx(E,{text:s,maxLength:15})}},{header:"address",accessorKey:"address",cell:a=>{const s=[a.row.original.address,a.row.original.city,a.row.original.state,a.row.original.pincode].filter(g=>g!=null).join(" ");return e.jsx(Z,{title:s,children:e.jsx(E,{text:s,maxLength:20})},s)}},{header:"Notes",accessorKey:"description",cell:a=>{const s=a.row.original.description;return e.jsx(Z,{title:s,children:e.jsx(E,{text:s,maxLength:20})},s)}}],[t,c]),A=p=>{const a=q(j);a.pageIndex=p,o($(a))},L=p=>{const a=q(j);a.pageSize=Number(p),a.pageIndex=1,o($(a))},z=p=>{const a=q(j);a.sort=p,o($(a))};return e.jsxs("div",{children:[e.jsx(ce,{columns:F,data:i,loading:r,pagingData:{total:j.total,pageIndex:j.pageIndex,pageSize:j.pageSize},onPaginationChange:A,onSelectChange:L,onSort:z}),e.jsx(Je,{}),e.jsx(Ze,{})]})},se=h.forwardRef((o,i)=>{const{onInputChange:t}=o,c=We(l,500);function l(u){t==null||t(u)}const r=u=>{c(u.target.value)};return e.jsx(I,{ref:i,className:"max-w-md md:w-52 mb-4",size:"sm",placeholder:"Search",prefix:e.jsx(xe,{className:"text-lg"}),onChange:r})});se.displayName="ContactTableSearch";const Ve=()=>{const o=T(),i=h.useRef(null),t=f(d=>d.crmContact.data.tableData),c=R("contacts","canCreate"),l=d=>{const m=q(t);m.query=d,m.pageIndex=1,typeof d=="string"&&d.length>1&&r(m),typeof d=="string"&&d.length===0&&r(m)},r=d=>{o(d?$(d):K())},u=()=>{o(Y())};return e.jsxs("div",{className:"md:flex items-center justify-between",children:[e.jsx("div",{className:"md:flex items-center gap-4",children:e.jsx(se,{ref:i,onInputChange:l})}),e.jsx("div",{className:"mb-4",children:c&&e.jsx(_,{size:"sm",onClick:u,children:"Add New"})})]})};ie("crmContact",ve);const Xe=()=>{const o=f(i=>i.crmContact.data.tableData);return e.jsx(e.Fragment,{children:e.jsxs(ne,{bodyClass:"h-full",children:[e.jsx(k,{title:`Contacts (${o==null?void 0:o.total})`,desc:"",className:"mb-2"}),e.jsx(Ve,{}),e.jsx(Qe,{})]})})},La=Xe;export{La as default};
