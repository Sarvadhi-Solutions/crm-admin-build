import{r as h,j as t,a as F,$ as L,au as le,av as it,aw as P,p as st,ap as rt,ah as ot,aq as lt}from"./index-de229e0f.js";import{A as ct}from"./AdaptableCard-73970f77.js";import{u as b,c as J,g as ee,e as Oe,s as $e,a as Z,t as ye,d as dt,b as Se,f as ut,h as pt,i as mt,j as ft,k as me,p as he,l as ht,m as Te,n as qe,r as xt}from"./index-6002beb8.js";import{B as K}from"./Button-b15cd132.js";import{c as ie}from"./cloneDeep-e3592be4.js";import{I as q}from"./Input-0edbc257.js";import{b as gt,U as je,R as vt,P as yt,Q as Tt,o as jt,N as bt,C as Et}from"./index.esm-aee8ac7d.js";import{d as Ct}from"./debounce-3198f06d.js";import{u as pe}from"./checkEditUpdate-2235bd5d.js";import{D as St}from"./DataTable-fb614c2b.js";import"./Alert-6c1fb93d.js";import{A as Dt}from"./index-014db2f3.js";import"./Badge-1c9640f8.js";import"./RangeCalendar-a7904a79.js";import{C as Nt}from"./Card-a97e4c2f.js";import"./index-5d48ec0d.js";import"./index-c1fa956a.js";import{D as Ue}from"./Dialog-8e46cfc1.js";import{D as kt}from"./Drawer-f0faeb9e.js";import"./index-3edcad3a.js";import{a as N,F as De}from"./FormItem-babd9538.js";import"./toString-99f06a6f.js";import"./index-5c089da4.js";import"./index-a531e03b.js";import"./index-6be331b1.js";import{t as se,N as re}from"./toast-2a495ac5.js";import"./Pagination-eeb66415.js";import"./Progress-3fcd9e67.js";import"./index-8cb693c7.js";import"./ScrollBar-19fef748.js";import"./index-da4e4b17.js";import{m as wt,d as Mt,S as Q}from"./Select-7b8d032a.js";import"./Skeleton-fe9c87f9.js";import"./index-2cc6f2e5.js";import"./Switcher-a81d65e1.js";import"./index-a5a888d3.js";import{T as _e}from"./index-c847ee3d.js";import"./Tag-416f4bd5.js";import"./index-f77eb852.js";import"./index-3ec890d7.js";import{T as Ve}from"./Tooltip-f07ebc4b.js";import{U as It}from"./Upload-bc5be741.js";import{S as Fe}from"./StatusCapsule-96583ef0.js";import{T as Vt}from"./TagsList-d81f919b.js";import{T as ce}from"./TextTruncate-b6fa38c4.js";import{u as Ft}from"./useThemeClass-d77d5188.js";import{h as At}from"./moment-fbc5633a.js";import{b as Ne,A as ze,a as Pt}from"./index.esm-2164e7d1.js";import{a as Lt}from"./index.esm-b2a3e018.js";import{d as Rt}from"./index.esm-079ccece.js";import{C as Ot}from"./ConfirmDialog-3591d1f6.js";import{i as $t}from"./Views-e5666688.js";import{u as qt,b as A,F as ke,a as we}from"./formik.esm-db3e081d.js";import{c as xe,a as S,e as We}from"./index.esm-863c1a13.js";import{t as Ut}from"./tagAndCategory-228f57e7.js";/* empty css              */import{G as ge}from"./index.esm-de9b7c0a.js";import{a as He,_ as te}from"./objectWithoutProperties-8809bfcf.js";import{_ as U}from"./toConsumableArray-ccf7c0d4.js";import{_ as be}from"./slicedToArray-dce459c5.js";import{_ as Ye}from"./inheritsLoose-70ce4190.js";import{g as _t}from"./index-23122237.js";import"./chart.constant-14f0e72f.js";import"./chart.config-882b5369.js";import"./GrowShrinkTag-09430f1f.js";import"./react-tooltip.min-fe1d294b.js";import"./RichTextEditor-010ff880.js";import"./SegmentItemOption-dd1ea792.js";import{S as Ge}from"./StickyFooter-c8c685d1.js";import"./SvgIcon-8a149743.js";import{D as zt}from"./DoubleSidedImage-39f2aa8e.js";import{M as Wt}from"./MediaSkeleton-40af8cea.js";import{N as Ht}from"./react-number-format.es-63a72d58.js";import"./CrmService-3972df40.js";import"./index-30642ee1.js";import"./_MapCache-af06afb7.js";import"./_getPrototype-3735b5b3.js";import"./isNil-8888295d.js";import"./get-9c32eaa8.js";import"./index-bcf5a82e.js";import"./useTimeout-73ec5f9b.js";import"./CloseButton-a4aa9973.js";import"./StatusIcon-6f48f0ae.js";import"./useMergeRef-788c4cb0.js";import"./useControllableState-c13b1cb7.js";import"./_baseIsEqual-e27983a5.js";import"./useRootClose-2530cd3e.js";import"./usePopper-beea1819.js";import"./TimeInput-d14a467e.js";import"./useUniqueId-c7e0bf5f.js";import"./useDidUpdate-be9907f8.js";import"./index-ea6d121c.js";import"./useUncertainRef-4abf232b.js";import"./index-95f7d6b8.js";import"./chainedFunction-070f832c.js";import"./floating-ui.dom-bef9cea3.js";import"./mapCloneElement-03a07d0b.js";import"./index.esm-181c8c38.js";import"./index.esm-9e33621c.js";import"./index.esm-7525e498.js";const Ke=h.forwardRef((l,i)=>{const{onInputChange:e}=l,r=Ct(a,500);function a(s){e==null||e(s)}const n=s=>{r(s.target.value)};return t.jsx(q,{ref:i,className:"max-w-md md:w-52 mb-4",size:"sm",placeholder:"Search by title",prefix:t.jsx(gt,{className:"text-lg"}),onChange:n})});Ke.displayName="TasksTableSearch";const Yt=()=>{const l=F(),i=h.useRef(null),e=b(o=>o.crmTasks.data.tableData),r=pe("tasks","canCreate"),a=o=>{const c=ie(e);c.query=o,c.pageIndex=1,typeof o=="string"&&o.length>1&&n(c),typeof o=="string"&&o.length===0&&n(c)},n=o=>{l(o?J(o):ee())},s=()=>{l(Oe()),l($e("Add")),l(Z({}))};return h.useEffect(()=>{i.current&&(i.current.value=e.query||"",l(J(e)))},[e==null?void 0:e.query]),t.jsxs("div",{className:"md:flex items-center justify-between",children:[t.jsx("div",{className:"md:flex items-center gap-4",children:t.jsx(Ke,{ref:i,onInputChange:a})}),t.jsx("div",{className:"mb-4",children:r&&t.jsx(K,{size:"sm",onClick:s,children:"Add New"})})]})},Gt=()=>{const l=F(),i=b(n=>n.crmTasks.data.deleteConfirmation),e=b(n=>n.crmTasks.data.selectedTask),r=()=>{l(ye(!1))},a=async()=>{var s,o,c;l(ye(!1));const n=await l(dt(e.id));await l(ee()),(s=n==null?void 0:n.payload)!=null&&s.success?se.push(t.jsx(re,{title:"Successfuly Deleted",type:"success",duration:2500,children:(o=n==null?void 0:n.payload)==null?void 0:o.message}),{placement:"top-end"}):se.push(t.jsx(re,{title:"Something Went Wrong !!!",type:"danger",duration:2500,children:(c=n==null?void 0:n.error)==null?void 0:c.message}),{placement:"top-end"}),await l(Se())};return t.jsx(Ot,{isOpen:i,type:"danger",title:"Delete Task",confirmButtonColor:"red-600",onClose:r,onRequestClose:r,onCancel:r,onConfirm:a,children:t.jsx("p",{children:"Are you sure you want to delete this Task? All record related to this task will be deleted as well. This action cannot be undone."})})},Ae={disabled:!1},fe=L.createContext(null);var Kt=function(i){return i.scrollTop},ae="unmounted",H="exited",Y="entering",X="entered",Ee="exiting",R=function(l){Ye(i,l);function i(r,a){var n;n=l.call(this,r,a)||this;var s=a,o=s&&!s.isMounting?r.enter:r.appear,c;return n.appearStatus=null,r.in?o?(c=H,n.appearStatus=Y):c=X:r.unmountOnExit||r.mountOnEnter?c=ae:c=H,n.state={status:c},n.nextCallback=null,n}i.getDerivedStateFromProps=function(a,n){var s=a.in;return s&&n.status===ae?{status:H}:null};var e=i.prototype;return e.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},e.componentDidUpdate=function(a){var n=null;if(a!==this.props){var s=this.state.status;this.props.in?s!==Y&&s!==X&&(n=Y):(s===Y||s===X)&&(n=Ee)}this.updateStatus(!1,n)},e.componentWillUnmount=function(){this.cancelNextCallback()},e.getTimeouts=function(){var a=this.props.timeout,n,s,o;return n=s=o=a,a!=null&&typeof a!="number"&&(n=a.exit,s=a.enter,o=a.appear!==void 0?a.appear:s),{exit:n,enter:s,appear:o}},e.updateStatus=function(a,n){if(a===void 0&&(a=!1),n!==null)if(this.cancelNextCallback(),n===Y){if(this.props.unmountOnExit||this.props.mountOnEnter){var s=this.props.nodeRef?this.props.nodeRef.current:le.findDOMNode(this);s&&Kt(s)}this.performEnter(a)}else this.performExit();else this.props.unmountOnExit&&this.state.status===H&&this.setState({status:ae})},e.performEnter=function(a){var n=this,s=this.props.enter,o=this.context?this.context.isMounting:a,c=this.props.nodeRef?[o]:[le.findDOMNode(this),o],u=c[0],x=c[1],v=this.getTimeouts(),m=o?v.appear:v.enter;if(!a&&!s||Ae.disabled){this.safeSetState({status:X},function(){n.props.onEntered(u)});return}this.props.onEnter(u,x),this.safeSetState({status:Y},function(){n.props.onEntering(u,x),n.onTransitionEnd(m,function(){n.safeSetState({status:X},function(){n.props.onEntered(u,x)})})})},e.performExit=function(){var a=this,n=this.props.exit,s=this.getTimeouts(),o=this.props.nodeRef?void 0:le.findDOMNode(this);if(!n||Ae.disabled){this.safeSetState({status:H},function(){a.props.onExited(o)});return}this.props.onExit(o),this.safeSetState({status:Ee},function(){a.props.onExiting(o),a.onTransitionEnd(s.exit,function(){a.safeSetState({status:H},function(){a.props.onExited(o)})})})},e.cancelNextCallback=function(){this.nextCallback!==null&&(this.nextCallback.cancel(),this.nextCallback=null)},e.safeSetState=function(a,n){n=this.setNextCallback(n),this.setState(a,n)},e.setNextCallback=function(a){var n=this,s=!0;return this.nextCallback=function(o){s&&(s=!1,n.nextCallback=null,a(o))},this.nextCallback.cancel=function(){s=!1},this.nextCallback},e.onTransitionEnd=function(a,n){this.setNextCallback(n);var s=this.props.nodeRef?this.props.nodeRef.current:le.findDOMNode(this),o=a==null&&!this.props.addEndListener;if(!s||o){setTimeout(this.nextCallback,0);return}if(this.props.addEndListener){var c=this.props.nodeRef?[this.nextCallback]:[s,this.nextCallback],u=c[0],x=c[1];this.props.addEndListener(u,x)}a!=null&&setTimeout(this.nextCallback,a)},e.render=function(){var a=this.state.status;if(a===ae)return null;var n=this.props,s=n.children;n.in,n.mountOnEnter,n.unmountOnExit,n.appear,n.enter,n.exit,n.timeout,n.addEndListener,n.onEnter,n.onEntering,n.onEntered,n.onExit,n.onExiting,n.onExited,n.nodeRef;var o=He(n,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]);return L.createElement(fe.Provider,{value:null},typeof s=="function"?s(a,o):L.cloneElement(L.Children.only(s),o))},i}(L.Component);R.contextType=fe;R.propTypes={};function B(){}R.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:B,onEntering:B,onEntered:B,onExit:B,onExiting:B,onExited:B};R.UNMOUNTED=ae;R.EXITED=H;R.ENTERING=Y;R.ENTERED=X;R.EXITING=Ee;const Qe=R;function Me(l,i){var e=function(n){return i&&h.isValidElement(n)?i(n):n},r=Object.create(null);return l&&h.Children.map(l,function(a){return a}).forEach(function(a){r[a.key]=e(a)}),r}function Qt(l,i){l=l||{},i=i||{};function e(x){return x in i?i[x]:l[x]}var r=Object.create(null),a=[];for(var n in l)n in i?a.length&&(r[n]=a,a=[]):a.push(n);var s,o={};for(var c in i){if(r[c])for(s=0;s<r[c].length;s++){var u=r[c][s];o[r[c][s]]=e(u)}o[c]=e(c)}for(s=0;s<a.length;s++)o[a[s]]=e(a[s]);return o}function G(l,i,e){return e[i]!=null?e[i]:l.props[i]}function Bt(l,i){return Me(l.children,function(e){return h.cloneElement(e,{onExited:i.bind(null,e),in:!0,appear:G(e,"appear",l),enter:G(e,"enter",l),exit:G(e,"exit",l)})})}function Xt(l,i,e){var r=Me(l.children),a=Qt(i,r);return Object.keys(a).forEach(function(n){var s=a[n];if(h.isValidElement(s)){var o=n in i,c=n in r,u=i[n],x=h.isValidElement(u)&&!u.props.in;c&&(!o||x)?a[n]=h.cloneElement(s,{onExited:e.bind(null,s),in:!0,exit:G(s,"exit",l),enter:G(s,"enter",l)}):!c&&o&&!x?a[n]=h.cloneElement(s,{in:!1}):c&&o&&h.isValidElement(u)&&(a[n]=h.cloneElement(s,{onExited:e.bind(null,s),in:u.props.in,exit:G(s,"exit",l),enter:G(s,"enter",l)}))}}),a}var Jt=Object.values||function(l){return Object.keys(l).map(function(i){return l[i]})},Zt={component:"div",childFactory:function(i){return i}},Ie=function(l){Ye(i,l);function i(r,a){var n;n=l.call(this,r,a)||this;var s=n.handleExited.bind(it(n));return n.state={contextValue:{isMounting:!0},handleExited:s,firstRender:!0},n}var e=i.prototype;return e.componentDidMount=function(){this.mounted=!0,this.setState({contextValue:{isMounting:!1}})},e.componentWillUnmount=function(){this.mounted=!1},i.getDerivedStateFromProps=function(a,n){var s=n.children,o=n.handleExited,c=n.firstRender;return{children:c?Bt(a,o):Xt(a,s,o),firstRender:!1}},e.handleExited=function(a,n){var s=Me(this.props.children);a.key in s||(a.props.onExited&&a.props.onExited(n),this.mounted&&this.setState(function(o){var c=U({},o.children);return delete c[a.key],{children:c}}))},e.render=function(){var a=this.props,n=a.component,s=a.childFactory,o=He(a,["component","childFactory"]),c=this.state.contextValue,u=Jt(this.state.children).map(s);return delete o.appear,delete o.enter,delete o.exit,n===null?L.createElement(fe.Provider,{value:c},u):L.createElement(fe.Provider,{value:c},L.createElement(n,o,u))},i}(L.Component);Ie.propTypes={};Ie.defaultProps=Zt;const Be=Ie;var ea=["in","onExited","appear","enter","exit"],ta=function(i){return function(e){e.in,e.onExited,e.appear,e.enter,e.exit;var r=te(e,ea);return h.createElement(i,r)}},aa=ta,na=["component","duration","in","onExited"],Xe=function(i){var e=i.component,r=i.duration,a=r===void 0?1:r,n=i.in;i.onExited;var s=te(i,na),o=h.useRef(null),c={entering:{opacity:0},entered:{opacity:1,transition:"opacity ".concat(a,"ms")},exiting:{opacity:0},exited:{opacity:0}};return h.createElement(Qe,{mountOnEnter:!0,unmountOnExit:!0,in:n,timeout:a,nodeRef:o},function(u){var x={style:P({},c[u]),ref:o};return h.createElement(e,U({innerProps:x},s))})},Ce=260,ia=function(i){var e=i.children,r=i.in,a=i.onExited,n=h.useRef(null),s=h.useState("auto"),o=be(s,2),c=o[0],u=o[1];h.useEffect(function(){var v=n.current;if(v){var m=window.requestAnimationFrame(function(){return u(v.getBoundingClientRect().width)});return function(){return window.cancelAnimationFrame(m)}}},[]);var x=function(m){switch(m){default:return{width:c};case"exiting":return{width:0,transition:"width ".concat(Ce,"ms ease-out")};case"exited":return{width:0}}};return h.createElement(Qe,{enter:!1,mountOnEnter:!0,unmountOnExit:!0,in:r,onExited:function(){var m=n.current;m&&(a==null||a(m))},timeout:Ce,nodeRef:n},function(v){return h.createElement("div",{ref:n,style:P({overflow:"hidden",whiteSpace:"nowrap"},x(v))},e)})},sa=["in","onExited"],ra=function(i){return function(e){var r=e.in,a=e.onExited,n=te(e,sa);return h.createElement(ia,{in:r,onExited:a},h.createElement(i,U({cropWithEllipsis:r},n)))}},oa=ra,la=function(i){return function(e){return h.createElement(Xe,U({component:i,duration:e.isMulti?Ce:1},e))}},ca=la,da=function(i){return function(e){return h.createElement(Xe,U({component:i},e))}},ua=da,pa=["component"],ma=["children"],fa=function(i){return function(e){return e.isMulti?h.createElement(ha,U({component:i},e)):h.createElement(Be,U({component:i},e))}},ha=function(i){var e=i.component,r=te(i,pa),a=xa(r);return h.createElement(Be,U({component:e},a))},xa=function(i){var e=i.children,r=te(i,ma),a=r.isMulti,n=r.hasValue,s=r.innerProps,o=r.selectProps,c=o.components,u=o.controlShouldRenderValue,x=h.useState(a&&u&&n),v=be(x,2),m=v[0],y=v[1],E=h.useState(!1),D=be(E,2),w=D[0],k=D[1];h.useEffect(function(){n&&!m&&y(!0)},[n,m]),h.useEffect(function(){w&&!n&&m&&y(!1),k(!1)},[w,n,m]);var I=function(){return k(!0)},j=function(T){if(a&&h.isValidElement(T)){if(T.type===c.MultiValue)return h.cloneElement(T,{onExited:I});if(T.type===c.Placeholder&&m)return null}return T},p=P(P({},s),{},{style:P(P({},s==null?void 0:s.style),{},{display:a&&n||m?"flex":"grid"})}),f=P(P({},r),{},{innerProps:p,children:h.Children.toArray(e).map(j)});return f},ga=fa,va=["Input","MultiValue","Placeholder","SingleValue","ValueContainer"],Je=function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=Mt({components:i}),r=e.Input,a=e.MultiValue,n=e.Placeholder,s=e.SingleValue,o=e.ValueContainer,c=te(e,va);return P({Input:aa(r),MultiValue:oa(a),Placeholder:ca(n),SingleValue:ua(s),ValueContainer:ga(o)},c)},oe=Je();oe.Input;oe.MultiValue;oe.Placeholder;oe.SingleValue;oe.ValueContainer;var ya=wt(Je);const Pe=[{label:"None",value:"none"},{label:"Low",value:"low"},{label:"Medium",value:"medium"},{label:"High",value:"high"}],de=[{label:"Contact",value:"contact"},{label:"Lead",value:"lead"},{label:"Deal",value:"deal"}],Le={contact:[{label:"Meeting",value:"meeting"},{label:"Other",value:"other"}],lead:[{label:"FollowUp",value:"followup"},{label:"Quotation",value:"quotation"},{label:"Meeting",value:"meeting"},{label:"Other",value:"other"}],deal:[{label:"Feedback",value:"feedback"},{label:"Delivery",value:"delivery"},{label:"Payment Clearance",value:"Paymentclearness"}]},Re={followup:{label:"Next Follow-Up Date and Time*",placeholder:"Select Next Follow-Up Date and Time"},delivery:{label:"Delivery Date & Time*",placeholder:"Select Delivery Date & Time"},meeting:{label:"Meeting Date and Time*",placeholder:"Select Meeting Date & Time"}},ne=[],ue=[],Ta=l=>{var _,z,W;const{touched:i,errors:e,setFieldValue:r,values:a}=l,n=F();h.useState(!1),h.useState(!1);const[s,o]=h.useState(null),[c,u]=h.useState(null),[x,v]=h.useState(""),[m,y]=h.useState([]),[E,D]=h.useState("");h.useEffect(()=>{const d=async()=>{var C,V;try{const{payload:M}=await n(pt()),O=(C=M==null?void 0:M.data)==null?void 0:C.find($=>($==null?void 0:$.moduleName)==="tasks");if(D(O.id),o(a==null?void 0:a.module),u(a==null?void 0:a.type),v(a==null?void 0:a.nextDateTime),O){const{payload:$}=await n(mt({id:(V=O==null?void 0:O.id)==null?void 0:V.toString()})),nt=Ut($.data);y(nt)}}catch(M){console.error("Error fetching module data:",M)}};n(ut()),n(_t()),d()},[n]),b(d=>d.crmTasks.data.selectedTask);const w=b(d=>d.crmTasks.data.drawerMode),k=qt(),I=d=>{k.setFieldValue("tagId",d)},j=ya(),p=b(d=>d.crmTasks.data.usersList);ne.length=0,p==null||p.forEach(d=>{ne.push({label:`${d==null?void 0:d.firstName} ${d==null?void 0:d.lastName}`,value:d.id})});const f=d=>{o(d.value),r("module",d==null?void 0:d.value),u(null),v("")},g=d=>{r("type",d==null?void 0:d.value),u(d.value)},T=b(d=>d.crmTasks.data.leadsList);return ue.length=0,T==null||T.forEach(d=>{ue.push({value:d.id,label:d.title})}),t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsx("div",{className:"col-span-1",children:t.jsx(N,{label:"Module",invalid:e.module&&i.module,errorMessage:e.module,children:t.jsx(A,{type:"text",autoComplete:"off",name:"module",placeholder:"Module",component:Q,options:de,value:de==null?void 0:de.find(d=>(d==null?void 0:d.value)==(a==null?void 0:a.module)),prefix:t.jsx(ge,{className:"text-xl"}),onChange:f})})}),t.jsx("div",{className:"col-span-1",children:t.jsx(N,{label:"Type",invalid:e.type&&i.type,errorMessage:e.type,children:t.jsx(A,{type:"text",autoComplete:"off",name:"type",placeholder:"Type",component:Q,options:Le[s]||[],value:(_=Le[s])==null?void 0:_.find(d=>(d==null?void 0:d.value)==(a==null?void 0:a.type)),prefix:t.jsx(ge,{className:"text-xl"}),onChange:g})})})]}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:c==="followup"||c==="delivery"||c==="meeting"?t.jsx("div",{className:"col-span-1",children:t.jsx(N,{label:(z=Re[c])==null?void 0:z.label,invalid:e.nextDateTime&&i.nextDateTime,errorMessage:e.nextDateTime,children:t.jsx(A,{type:"dateTime-local",autoComplete:"off",name:"nextDateTime",placeholder:(W=Re[c])==null?void 0:W.placeholder,component:q,prefix:t.jsx(je,{className:"text-xl"}),value:a.nextDateTime,onChange:d=>{var C;v(d.target.value),r("nextDateTime",(C=d.target)==null?void 0:C.value)}})})}):null}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsx("div",{className:"col-span-1",children:t.jsx(N,{label:"Title *",invalid:e.title&&i.title,errorMessage:e.title,children:t.jsx(A,{type:"text",autoComplete:"off",name:"title",placeholder:"Title",component:q,prefix:t.jsx(vt,{className:"text-xl"})})})}),t.jsx("div",{className:"col-span-1",children:t.jsx(N,{label:"Due Date *",invalid:e.dueDate&&i.dueDate,errorMessage:e.dueDate,children:t.jsx(A,{isDisabled:w==="Edit",type:"dateTime-local",autoComplete:"off",name:"dueDate",component:q,prefix:t.jsx(je,{className:"text-xl"})})})})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsx("div",{className:"col-span-1",children:t.jsx(N,{label:"Priority *",invalid:e.priority&&i.priority,errorMessage:e.priority,children:t.jsx(Q,{name:"priority",id:"priority",components:j,value:Pe.find(d=>(d==null?void 0:d.value)===(a==null?void 0:a.priority)),options:Pe,onChange:d=>{r("priority",d.value||"")}})})}),t.jsx("div",{className:"col-span-1",children:t.jsx(N,{label:"Assigned To",invalid:e.assignedTo&&i.assignedTo,errorMessage:e.assignedTo,children:t.jsx(Q,{name:"assignedTo",id:"assignedTo",value:ne.find(d=>(d==null?void 0:d.value)===(a==null?void 0:a.assignedTo)),options:ne,onChange:d=>{r("assignedTo",d.value||"")}})})})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsx("div",{className:"col-span-1",children:t.jsx(N,{label:"Connected Lead",invalid:e.connectedLead&&i.connectedLead,errorMessage:e.connectedLead,children:t.jsx(Q,{name:"connectedLead",id:"connectedLead",value:ue.find(d=>(d==null?void 0:d.value)===(a==null?void 0:a.connectedLead)),options:ue,onChange:d=>{r("connectedLead",d.value||"")}})})}),t.jsx("div",{className:"col-span-1",children:t.jsx(N,{label:"Tag",children:t.jsx(A,{isClearable:!0,isMulti:!0,type:"text",autoComplete:"off",name:"tagId",placeholder:"Select tags",component:Q,options:m,prefix:t.jsx(ge,{className:"text-xl"}),closeMenuOnSelect:!1,onChange:I})})})]}),t.jsx(N,{label:"Notes",invalid:e.descriptions&&i.descriptions,errorMessage:e.descriptions,children:t.jsx(A,{textArea:!0,type:"text",autoComplete:"off",name:"descriptions",placeholder:"Notes",component:q,prefix:t.jsx(Ne,{className:"text-xl"})})})]})},ja=xe().shape({title:S().required("Title is Required"),module:S(),type:S(),tagId:We(),connectedLead:S(),descriptions:S(),priority:S().oneOf(["none","low","medium","high"]).required("Priority is required"),nextDateTime:S().test("date-required","Date is required",function(l){const i=this.parent.type;return!((i==="followup"||i==="delivery"||i==="meeting")&&!l)})}),ba=xe().shape({module:S(),type:S(),nextDateTime:S().test("date-required","Date is required",function(l){const i=this.parent.type;return!((i==="followup"||i==="delivery"||i==="meeting")&&!l)}),title:S().required("Title is required"),dueDate:S().required("Due Date is required"),tagId:We(),connectedLead:S(),descriptions:S(),assignedTo:S().test("is-valid-user","Invalid user selected",function(l){return this.parent.assignedTo&&this.parent.assignedTo.length>0?!!ne.find(i=>i.value==l):!0}),priority:S().oneOf(["none","low","medium","high"]).required("Priority is required")}),{TabNav:Ea,TabList:Ca,TabContent:Sa}=_e,Ze=h.forwardRef((l,i)=>{var c,u,x,v;const e=b(m=>m.crmTasks.data.selectedTask),r=b(m=>m.crmTasks.data.drawerMode),a=F();function n(m){if(!m)return"";const y=m.split("T");if(y.length!==2)return"";const E=y[0],D=y[1].slice(0,5);return`${E}T${D}`}const s=m=>{const y=new Date(m);if(isNaN(y.getTime()))return"";const E=y.getFullYear(),D=(y.getMonth()+1).toString().padStart(2,"0"),w=y.getDate().toString().padStart(2,"0"),k=y.getHours().toString().padStart(2,"0"),I=y.getMinutes().toString().padStart(2,"0");return`${E}-${D}-${w} ${k}:${I}`},o=async(m,y)=>{var T,_,z,W,d,C,V;const{colorName:E,tagName:D,dueDate:w,...k}=m,I=s(w);let j,p,f;r==="Add"?(j=await a(ft({dueDate:I,...k,tagId:m==null?void 0:m.tagId.map(M=>M.value)})),p="Successfully Added",f="Something went wrong !!!",(T=j==null?void 0:j.payload)!=null&&T.success&&a(me())):(j=await a(he({taskId:e==null?void 0:e.id,data:{...k,tagId:m==null?void 0:m.tagId.map(M=>M.value)}})),p="Successfully Updated",f="Something went wrong !!!",(_=j==null?void 0:j.payload)!=null&&_.success&&a(me()));const g=(z=j==null?void 0:j.payload)!=null&&z.success?"success":"danger";se.push(t.jsx(re,{title:(W=j==null?void 0:j.payload)!=null&&W.success?p:f,type:g,duration:2500,children:(d=j==null?void 0:j.payload)!=null&&d.success?(C=j==null?void 0:j.payload)==null?void 0:C.message:(V=j==null?void 0:j.error)==null?void 0:V.message}),{placement:"top-end"}),await a(ee()),await a(Se()),y(!1)};return t.jsx(ke,{innerRef:i,initialValues:{module:(e==null?void 0:e.module)||"",type:(e==null?void 0:e.type)||"",nextDateTime:n(e==null?void 0:e.nextDateTime)||"",title:(e==null?void 0:e.title)||"",connectedLead:(e==null?void 0:e.connectedLead)||"",dueDate:n(e==null?void 0:e.dueDate)||"",descriptions:(e==null?void 0:e.descriptions)||"",tagId:((c=e==null?void 0:e.tags)==null?void 0:c.map(m=>({label:m.tagName,value:m.id})))||[],tagName:((x=(u=e==null?void 0:e.tags)==null?void 0:u[0])==null?void 0:x.tagName)||"",priority:(e==null?void 0:e.priority)||"",assignedTo:((v=e==null?void 0:e.assignedToData)==null?void 0:v.id)||"",colorName:e!=null&&e.tags&&(e==null?void 0:e.tags.length)>0?e==null?void 0:e.tags[0].colorName:""},validationSchema:r==="Edit"?ja:ba,onSubmit:async(m,{setSubmitting:y})=>{await o(m,y)},children:({touched:m,errors:y,setFieldValue:E,values:D})=>t.jsx(we,{children:t.jsx(De,{children:t.jsxs(_e,{defaultValue:"taskDetails",children:[t.jsx(Ca,{children:t.jsx(Ea,{value:"taskDetails",children:"Tasks details"})}),t.jsx("div",{className:"p-6",children:t.jsx(Sa,{value:"taskDetails",children:t.jsx(Ta,{touched:m,errors:y,values:D,setFieldValue:E})})})]})})})})});Ze.displayName="TasksForm";const et=h.forwardRef((l,i)=>{const e=F(),r=b(o=>o.crmTasks.data.selectedTask),a=b(o=>o.crmTasks.data.tasksList),{id:n}=r,s=o=>{const{name:c,birthday:u,email:x,img:v,location:m,title:y,phoneNumber:E,facebook:D,twitter:w,pinterest:k,linkedIn:I}=o,j={name:c,email:x,img:v},p={location:m,title:y,birthday:st(u).format("DD/MM/YYYY"),phoneNumber:E,facebook:D,twitter:w,pinterest:k,linkedIn:I};let f=ie(a),g={};f=f.map(T=>(T.id===n&&(T={...T,...j},T.personalInfo={...T.personalInfo,...p},g=T),T)),$t(g)||e(he(g)),e(me()),e(ht(f))};return t.jsx(Ze,{ref:i,tasks:r,onFormSubmit:s})});et.displayName="TasksEditContent";const Da=({onSaveClick:l,onCancel:i})=>t.jsxs("div",{className:"text-right w-full",children:[t.jsx(K,{size:"sm",className:"mr-2",onClick:i,children:"Cancel"}),t.jsx(K,{size:"sm",variant:"solid",onClick:l,children:"Save"})]}),Na=()=>{const l=F(),i=b(c=>c.crmTasks.data.drawerOpen);b(c=>c.crmTasks.data.drawerMode),b(c=>c.crmTasks.data.selectedTask);const[e,r]=h.useState(window.innerWidth/2),a=()=>{l(me()),l(Z({}))},n=h.useRef(null),s=async()=>{var c;(c=n.current)==null||c.submitForm()};h.useEffect(()=>(window.addEventListener("resize",o),()=>{window.removeEventListener("resize",o)}),[]);const o=()=>{r(window.innerWidth/2)};return t.jsx(kt,{isOpen:i,closable:!1,bodyClass:"p-0",width:e,footer:t.jsx(Da,{onCancel:a,onSaveClick:s}),onClose:a,onRequestClose:a,children:t.jsx(et,{ref:n})})},tt=h.forwardRef((l,i)=>{const e=F(),r=b(u=>u.crmTasks.data.followUPConfirmation),a=b(u=>u.crmTasks.data.selectedTask),n=b(u=>u.crmTasks.data.loading),s=()=>{e(Te(!1))},o=xe().shape({descriptions:S().required("Notes is required")}),c=async u=>{var m,y,E;const x=await e(he({taskId:a==null?void 0:a.id,data:u})),v=(m=x==null?void 0:x.payload)!=null&&m.success?{title:"Successfully Updated",type:"success",message:(y=x==null?void 0:x.payload)==null?void 0:y.message}:{title:"Something Went Wrong !!!",type:"danger",message:(E=x==null?void 0:x.error)==null?void 0:E.message};se.push(t.jsx(re,{title:v.title,type:v==null?void 0:v.type,duration:2500,children:v.message}),{placement:"top-end"}),await e(ee()),await e(Te(!1))};return t.jsxs(Ue,{isOpen:r,onClose:s,children:[t.jsx("h5",{className:"mb-4",children:"Follow Up"}),t.jsx(ke,{innerRef:i,initialValues:{descriptions:"",nextDateTime:""},validationSchema:o,onSubmit:async(u,{setSubmitting:x})=>{console.log(u);const v={completionStatus:"completed",...u};await c(v),x(!1)},children:({touched:u,errors:x,values:v,setFieldValue:m})=>t.jsxs(we,{children:[t.jsxs(De,{children:[t.jsx(N,{label:"Next Follow-Up Date and Time",invalid:x.nextDateTime&&u.nextDateTime,errorMessage:x.nextDateTime,children:t.jsx(A,{type:"dateTime-local",autoComplete:"off",name:"nextDateTime",placeholder:"Select Next Follow-Up Date and Time",component:q,prefix:t.jsx(je,{className:"text-xl"})})}),t.jsx(N,{label:"Notes",invalid:x.descriptions&&u.descriptions,errorMessage:x.descriptions,children:t.jsx(A,{textArea:!0,type:"text",autoComplete:"off",name:"descriptions",placeholder:"Notes",component:q,prefix:t.jsx(Ne,{className:"text-xl"})})})]}),t.jsx(Ge,{className:"flex items-center justify-end py-2",stickyClass:"border-t bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700",children:t.jsxs("div",{className:"md:flex items-center",children:[t.jsx(K,{size:"sm",className:"ltr:mr-3 rtl:ml-3",type:"button",onClick:s,children:"Cancel"}),t.jsx(K,{size:"sm",type:"submit",variant:"solid",icon:t.jsx(ze,{}),loading:n,children:"Save"})]})})]})})]})});tt.displayName="FollowUpTaskConfirmation";const at=h.forwardRef((l,i)=>{const e=F(),r=b(u=>u.crmTasks.data.quotationConfirmation);b(u=>u.crmTasks.data.selectedTask);const a=b(u=>u.crmTasks.data.loading),n=()=>{e(qe(!1))},s=xe().shape({descriptions:S().required("Notes is required")}),o=u=>{let x=!0;const v=["image/jpeg","image/png","application/pdf"],m=5e6;if(u)for(const y of u)v.includes(y.type)||(x="Please upload a .jpeg, .png, or .pdf file!"),y.size>=m&&(x="Uploaded file cannot be larger than 5000kb!");return x},c=(u,x,v)=>{const m="1-img-0",y=v.length-1,E={id:m,name:v[y].name,img:URL.createObjectURL(v[y])};console.log("imageList",E),x("attachments",E)};return t.jsxs(Ue,{isOpen:r,onClose:n,children:[t.jsx("h5",{className:"mb-4",children:"Quotation"}),t.jsx(ke,{innerRef:i,initialValues:{descriptions:"",attachments:""},validationSchema:s,onSubmit:async(u,{setSubmitting:x})=>{console.log(u),{...u},x(!1)},children:({field:u,form:x,touched:v,errors:m,values:y,setFieldValue:E})=>t.jsxs(we,{children:[t.jsxs(De,{children:[t.jsx(N,{label:"Upload File",children:t.jsx(It,{draggable:!0,className:"min-h-fit",beforeUpload:o,showList:!1,onChange:D=>c(x,E,D),children:t.jsxs("div",{className:"max-w-full flex flex-col px-4 py-2 justify-center items-center",children:[t.jsx(zt,{src:"/img/others/upload.png",darkModeSrc:"/img/others/upload-dark.png"}),t.jsxs("p",{className:"font-semibold",children:[t.jsxs("span",{className:"text-gray-800 dark:text-white",children:["Drop your image here, or"," "]}),t.jsx("span",{className:"text-blue-500",children:"browse"})]}),t.jsx("p",{className:"mt-1 opacity-60 dark:text-white",children:"Support: jpeg, png, pdf"})]})})}),t.jsx(N,{label:"Notes",invalid:m.descriptions&&v.descriptions,errorMessage:m.descriptions,children:t.jsx(A,{textArea:!0,type:"text",autoComplete:"off",name:"descriptions",placeholder:"Notes",component:q,prefix:t.jsx(Ne,{className:"text-xl"})})})]}),t.jsx(Ge,{className:"flex items-center justify-end py-2",stickyClass:"border-t bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700",children:t.jsxs("div",{className:"md:flex items-center",children:[t.jsx(K,{size:"sm",className:"ltr:mr-3 rtl:ml-3",type:"button",onClick:n,children:"Cancel"}),t.jsx(K,{size:"sm",type:"submit",variant:"solid",icon:t.jsx(ze,{}),loading:a,children:"Save"})]})})]})})]})});at.displayName="QuotationTaskConfirmation";const ka=()=>{const l=F(),i=b(p=>p.crmTasks.data.displayedTasksList),e=b(p=>p.crmTasks.data.loading);b(p=>p.crmTasks.data.filterData);const r=b(p=>p.crmTasks.data.tableData),a=pe("tasks","canDelete"),n=pe("tasks","canModify"),s=pe("tasks","canView"),o=rt(),{pageIndex:c,pageSize:u,sort:x,query:v,total:m}=b(p=>p.crmTasks.data.tableData),y=h.useCallback(()=>{l(ee())},[l]);h.useEffect(()=>(y(),()=>{window.location.pathname.includes("task")||l(J({...r,query:""}))}),[y]);const E=h.useMemo(()=>({pageIndex:c,pageSize:u,sort:x,query:v,total:m}),[c,u,x,v,m]),D=({row:p})=>{const f=F();Ft();const g=()=>{f(Oe()),f(Z(p)),f($e("Edit"))},T=async()=>{await f(Z(p)),f(ye(!0))},_=async()=>{await f(Z(p));const d=`/app/crm/task-details/${p.id}`;o(d)},z=async()=>{var M,O,$;const d={completionStatus:"inProgress"},C=await f(he({taskId:p==null?void 0:p.id,data:d})),V=(M=C==null?void 0:C.payload)!=null&&M.success?{title:"Successfully Updated",type:"success",message:(O=C==null?void 0:C.payload)==null?void 0:O.message}:{title:"Something Went Wrong !!!",type:"danger",message:($=C==null?void 0:C.error)==null?void 0:$.message};se.push(t.jsx(re,{title:V.title,type:V==null?void 0:V.type,duration:2500,children:V.message}),{placement:"top-end"}),await f(ee())},W=async()=>{if(p!=null&&p.type)switch(console.group(),console.log(p==null?void 0:p.type),console.groupEnd(),await f(Z(p)),p==null?void 0:p.type){case"followup":f(Te(!0));break;case"quotation":f(qe(!0));break}};return t.jsxs("div",{className:"flex text-base items-center",children:[n&&t.jsx("span",{className:"cursor-pointer hover:text-indigo-500 circle items-center",onClick:g,children:t.jsx(yt,{})}),a&&t.jsx("span",{className:"cursor-pointer hover:text-red-500 circle  mx-1 items-center",onClick:T,children:t.jsx(Tt,{})}),s&&t.jsx("span",{className:"cursor-pointer  hover:text-green-500 circle items-center text-lg",onClick:_,children:t.jsx(Pt,{})}),n&&t.jsx("button",{disabled:(p==null?void 0:p.completionStatus)!=="pending",className:`cursor-pointer mx-1 circle items-center ${(p==null?void 0:p.completionStatus)!=="pending"?"!cursor-not-allowed":"cursor-pointer hover:text-amber-500"}`,onClick:z,children:t.jsx(Rt,{})}),n&&t.jsx("button",{disabled:(p==null?void 0:p.completionStatus)==="completed",className:`cursor-pointer circle items-center ${(p==null?void 0:p.completionStatus)==="completed"?"!cursor-not-allowed":"cursor-pointer hover:text-emerald-500"}`,onClick:W,children:t.jsx(Lt,{})})]})},w=h.useMemo(()=>[{header:"Action",id:"action",cell:f=>t.jsx(D,{row:f.row.original})},{header:"Title",accessorKey:"title",cell:f=>{const g=f.row.original.title;return t.jsx(Ve,{title:g,children:t.jsx(ce,{text:g,maxLength:20})},g)}},{header:"Due Date",accessorKey:"dueDate",cell:f=>{var g;return At((g=f.row.original)==null?void 0:g.dueDate).format("DD MMMM YYYY")}},{header:"priority",accessorKey:"priority",cell:f=>{const g=f.row.original.priority;return t.jsx(Fe,{status:g})}},{header:"module",accessorKey:"module",cell:f=>{var T;const g=(T=f.row.original)==null?void 0:T.module;return g?t.jsx(ce,{text:g,maxLength:20}):"-"}},{header:"type",accessorKey:"type",cell:f=>{var T;const g=(T=f.row.original)==null?void 0:T.type;return g?t.jsx(ce,{text:g,maxLength:20}):"-"}},{header:"Assigned to",accessorKey:"assignedTo",cell:f=>{const{firstName:g,lastName:T}=f.row.original.assignedToData||{};return g&&T?`${g} ${T}`:"-"}},{header:"Connected lead",accessorKey:"connectedLead",cell:f=>{var T;const g=f.row.original||{};return g!=null&&g.leadModel?`${(T=g==null?void 0:g.leadModel)==null?void 0:T.title}`:"-"}},{header:"Status",accessorKey:"completionStatus",cell:f=>{const g=f.row.original.completionStatus;return t.jsx(Fe,{status:g})}},{header:"Notes",accessorKey:"descriptions",cell:f=>{const g=f.row.original.descriptions;return t.jsx(Ve,{title:g,children:t.jsx(ce,{text:g,maxLength:20})},g)}},{header:"Tag Name",accessorKey:"tagName",cell:f=>{const g=f.row.original.tags||[];return g.length===0?"-":t.jsx(Vt,{tags:g})}}],[n,a]),k=p=>{const f=ie(E);f.pageIndex=p,l(J(f))},I=p=>{const f=ie(E);f.pageSize=Number(p),f.pageIndex=1,l(J(f))},j=p=>{const f=ie(E);f.sort=p,l(J(f))};return t.jsxs("div",{children:[t.jsx(St,{columns:w,data:i,skeletonAvatarColumns:[0],skeletonAvatarProps:{width:28,height:28},loading:e,pagingData:{total:E.total,pageIndex:E.pageIndex,pageSize:E.pageSize},onPaginationChange:k,onSelectChange:I,onSort:j}),t.jsx(Na,{}),t.jsx(at,{}),t.jsx(tt,{}),t.jsx(Gt,{})]})},ve=l=>{const{icon:i,avatarClass:e,label:r,value:a,growthRate:n,loading:s}=l,o=55;return t.jsx(Nt,{bordered:!0,children:t.jsx(ot,{loading:s,customLoader:t.jsx(Wt,{avatarProps:{className:"rounded",width:o,height:o}}),children:t.jsx("div",{className:"flex justify-between items-center",children:t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx(Dt,{className:e,size:o,icon:i}),t.jsxs("div",{children:[t.jsx("span",{children:r}),t.jsx("h3",{children:t.jsx(Ht,{thousandSeparator:!0,displayType:"text",value:a})})]})]})})})})},wa=()=>{const l=F(),i=b(r=>r.crmTasks.data.statisticData),e=b(r=>r.crmTasks.data.statisticLoading);return h.useEffect(()=>{l(Se())},[]),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4 mb-6",children:[t.jsx(ve,{icon:t.jsx(jt,{}),avatarClass:"!bg-indigo-600",label:"Total Tasks",value:i==null?void 0:i.totalTasks,loading:e}),t.jsx(ve,{icon:t.jsx(bt,{}),avatarClass:"!bg-blue-500",label:"Completed Tasks",value:i==null?void 0:i.completedTasks,loading:e}),t.jsx(ve,{icon:t.jsx(Et,{}),avatarClass:"!bg-emerald-500",label:"This Week's New Tasks",value:i==null?void 0:i.newTasks,loading:e})]})};lt("crmTasks",xt);const Ma=()=>t.jsxs(t.Fragment,{children:[t.jsx(wa,{}),t.jsxs(ct,{bodyClass:"h-full",children:[t.jsx(Yt,{}),t.jsx(ka,{})]})]}),Ci=Ma;export{Ci as default};
