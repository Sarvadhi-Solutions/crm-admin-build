import{am as C,an as ae,ao as se,ap as te,r as g,j as a,a as N,u as re,B as oe,ai as ne,ar as ie}from"./index-6767ac81.js";import{A as le}from"./AdaptableCard-1cecc9da.js";import{i as ce,j as de,k as q,l as me,m as pe,n as H,o as ue}from"./CrmService-e70a4be4.js";import{B as R}from"./Button-edcd26d9.js";import{c as A}from"./cloneDeep-028f7085.js";import{I as w}from"./Input-736c9e0d.js";import{z as ge,B as he,I as xe,a6 as fe,aa as Te,ab as be,d as ye,a7 as je,r as Ce}from"./index.esm-107f547f.js";import{d as ke}from"./debounce-7fa991f6.js";import{S as De,c as we}from"./Select-3d321c37.js";import{B as P}from"./Badge-1f68c9c2.js";import{D as Ne}from"./DataTable-7c33a6e6.js";import{u as Se}from"./useThemeClass-a62e85dc.js";import{D as ve}from"./Drawer-95c21b15.js";import{i as Ae}from"./Views-e5205a91.js";import{T as U}from"./index-149a53e8.js";import{u as Ie,c as k,d as D,F as Fe,a as Le,b as Oe}from"./formik.esm-35003a33.js";import{c as Me,a as L,f as Re,b as $e}from"./index.esm-a1939a1a.js";import{A as K}from"./index-688b9e70.js";import{U as Ee}from"./Upload-1c01a3b3.js";import{A as ze}from"./index.esm-a61e2fe0.js";import{T as Be,a as qe,b as He}from"./index.esm-da94fd5f.js";import{D as Pe,A as Ue,t as Ke,j as Ve}from"./AdditionalTag-8d9009b8.js";/* empty css              */import{C as Ge}from"./Card-da872ceb.js";import{M as Ye}from"./MediaSkeleton-4528ed7e.js";import{N as _e}from"./react-number-format.es-3a1aae10.js";import"./context-cdfa92ed.js";import"./_Uint8Array-81109713.js";import"./_MapCache-5db605d8.js";import"./_getPrototype-48c0ebaa.js";import"./isNil-1a1387e3.js";import"./get-582c28e3.js";import"./toString-5f976032.js";import"./toConsumableArray-af8bf1ee.js";import"./objectWithoutPropertiesLoose-df62547b.js";import"./floating-ui.dom-bef9cea3.js";import"./index-d5eb49a4.js";import"./index.esm-ad20eb15.js";import"./Pagination-3af44538.js";import"./index-5c02b9f9.js";import"./_baseIsEqual-98c979d7.js";import"./TableRowSkeleton-6125f39f.js";import"./Skeleton-f6501194.js";import"./index-43da21b1.js";import"./index-1bb56c96.js";import"./CloseButton-5ef937e0.js";import"./useControllableState-dba48cec.js";import"./index-fb02f18d.js";import"./useMergeRef-788c4cb0.js";import"./Tooltip-777f9f9c.js";import"./usePopper-ba5004dc.js";import"./index.esm-52ddd804.js";import"./index.esm-3da06225.js";import"./toast-33e99923.js";import"./useTimeout-395cc71e.js";import"./StatusIcon-33312305.js";import"./chainedFunction-070f832c.js";import"./Alert-c9b22c70.js";import"./Calendar-defcfa74.js";import"./index-6bf19af2.js";import"./useRootClose-6563c421.js";import"./RangeCalendar-2da4f4e1.js";import"./TimeInput-030e16c6.js";import"./useUniqueId-1387b982.js";import"./useDidUpdate-c5cefb65.js";import"./Dialog-b04dbbb3.js";import"./index-787c9736.js";import"./useUncertainRef-e1544d29.js";import"./index-9fee79d2.js";import"./index-5e02ae30.js";import"./index-375da5f6.js";import"./Progress-b13c43d8.js";import"./index-18c6d586.js";import"./ScrollBar-e8750282.js";import"./index-bf30d0ca.js";import"./index-8c6f1de1.js";import"./mapCloneElement-3589bfd8.js";import"./Switcher-becc3d78.js";import"./Tag-28e3c136.js";import"./index-d9614e75.js";import"./index-70261eaf.js";const Je="crmTasks",z=C("crmTasks/data/getTasksStatistic",async()=>(await ce()).data),$=C("crmTasks/data/getTasks",async()=>(await de()).data);C("crmTasks/data/editTask",async({taskId:e,updatedData:s})=>(await q(e)).data);C("crmTasks/data/deleteTask",async e=>await me(e));const Qe=C("crmTasks/data/createTasks",async(e,s)=>await q(e));C("crmTasks/data/createTasks",async e=>(await apiCreateCrmTasks(e)).data);C("crmTasks/data/module",async()=>{const e=await pe();return console.log(e.data,"response"),e.data});C("tag-category",async({id:e})=>{const s=await H(e);return console.log(s.data,"Getting Data"),s.data});C("crmTasks/data/fetchTag",async({id:e})=>(await H(e)).data);C("crmTasks/data/createTag",async({masterId:e,colorName:s,tagName:t,tagCategoryId:r})=>(await ue({colorName:s,tagName:t,masterId:e,tagCategoryId:r})).data);const We={total:0,pageIndex:1,pageSize:10,query:"",sort:{order:"",key:""}},Xe={status:""},Ze={loading:!1,statisticLoading:!1,tasksList:[],statisticData:{},tableData:We,filterData:Xe,drawerOpen:!1,selectedTask:{}},V=ae({name:`${Je}/state`,initialState:Ze,reducers:{setTableData:(e,s)=>{e.tableData=s.payload},setTasksList:(e,s)=>{e.tasksList=s.payload},setFilterData:(e,s)=>{e.filterData=s.payload},setSelectedTask:(e,s)=>{e.selectedTask=s.payload},setDrawerOpen:e=>{e.drawerOpen=!0},setDrawerClose:e=>{e.drawerOpen=!1}},extraReducers:e=>{e.addCase($.fulfilled,(s,t)=>{s.tasksList=t.payload.data,s.tableData.total=t.payload.total,s.loading=!1}).addCase($.pending,s=>{s.loading=!0}).addCase(z.fulfilled,(s,t)=>{s.statisticData=t.payload,s.statisticLoading=!1}).addCase(z.pending,s=>{s.statisticLoading=!0})}}),{setTableData:M,setTasksList:ea,setFilterData:G,setSelectedTask:Y,setDrawerOpen:_,setDrawerClose:J}=V.actions,aa=V.reducer,sa=se({data:aa}),T=te,Q=g.forwardRef((e,s)=>{const{onInputChange:t}=e,r=ke(i,500);function i(c){t==null||t(c)}const n=c=>{r(c.target.value)};return a.jsx(w,{ref:s,className:"max-w-md md:w-52 mb-4",size:"sm",placeholder:"Search",prefix:a.jsx(ge,{className:"text-lg"}),onChange:n})});Q.displayName="TasksTableSearch";const{Control:ta}=we,B=[{value:"",label:"All",color:"bg-gray-500"},{value:"active",label:"Active",color:"bg-emerald-500"},{value:"blocked",label:"Blocked",color:"bg-red-500"}],ra=({innerProps:e,label:s,data:t,isSelected:r})=>a.jsxs("div",{className:`flex items-center justify-between p-2 cursor-pointer ${r?"bg-gray-100 dark:bg-gray-500":"hover:bg-gray-50 dark:hover:bg-gray-600"}`,...e,children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(P,{innerClass:t.color}),a.jsx("span",{children:s})]}),r&&a.jsx(he,{className:"text-emerald-500 text-xl"})]}),oa=({children:e,...s})=>{const t=s.getValue()[0];return a.jsxs(ta,{...s,children:[t&&a.jsx(P,{className:"ltr:ml-4 rtl:mr-4",innerClass:t.color}),e]})},na=()=>{const e=N(),{status:s}=T(r=>r.crmTasks.data.filterData),t=r=>{e(G({status:r==null?void 0:r.value}))};return a.jsx(De,{options:B,size:"sm",className:"mb-4 min-w-[130px]",components:{Option:ra,Control:oa},value:B.filter(r=>r.value===s),onChange:t})},ia=(e,s)=>re(i=>{var n,c;return((c=(n=i.auth.user)==null?void 0:n.role)==null?void 0:c.rolePermissions)||[]}).some(i=>i.master.moduleName.toLowerCase()===e.toLowerCase()&&i[s]),la=()=>{const e=N(),s=g.useRef(null),t=T(m=>m.crmTasks.data.tableData),r=ia("tasks","canCreate"),i=m=>{const b=A(t);b.query=m,b.pageIndex=1,typeof m=="string"&&m.length>1&&n(b),typeof m=="string"&&m.length===0&&n(b)},n=m=>{e(M(m)),e($())},c=()=>{const m=A(t);m.query="",s.current&&(s.current.value=""),e(G({status:""})),n(m)},d=()=>{e(_())};return a.jsxs("div",{className:"md:flex items-center justify-between",children:[a.jsxs("div",{className:"md:flex items-center gap-4",children:[a.jsx(Q,{ref:s,onInputChange:i}),a.jsx(na,{})]}),a.jsxs("div",{className:"mb-4",children:[a.jsx(R,{size:"sm",className:"me-2",onClick:c,children:"Clear All"}),r&&a.jsx(R,{size:"sm",onClick:d,children:"Add New"})]})]})},ca=e=>{const{touched:s,errors:t}=e,r=useAppDispatch(),[i,n]=g.useState(!1);g.useState("#808080");const[c,d]=g.useState(!1),[m,b]=g.useState([]),[y,S]=g.useState([]),I=()=>{n(!i),d(!1)};g.useEffect(()=>{(async()=>{var h,f;try{const{payload:u}=await r(fetchModule());console.log(u,"send Me The Id And The Payload");const j=(h=u==null?void 0:u.data)==null?void 0:h.find(x=>(x==null?void 0:x.moduleName)==="tasks");if(j){const{payload:x}=await r(fetchCategory({id:(f=j==null?void 0:j.id)==null?void 0:f.toString()})),Z=Ke(x.data),ee=Ve(x.data);S(ee),b(Z)}}catch(u){console.error("Error fetching module data:",u)}})()},[r]);const v=useAppSelector(p=>p.crmCompany.data.selectedCompany),[O,F]=g.useState(v?v.tags||[]:[]),o=Ie(),l=p=>{F(p);const h=[p.value];o.setFieldValue("tagId",h)};return a.jsxs(a.Fragment,{children:[a.jsx(k,{invalid:t.upload&&s.upload,errorMessage:t.upload,children:a.jsx(D,{name:"img",children:({field:p,form:h})=>{const f=p.value?{src:p.value}:{};return a.jsx("div",{className:"flex justify-center",children:a.jsx(Ee,{className:"cursor-pointer",showList:!1,uploadLimit:1,onChange:u=>h.setFieldValue(p.name,URL.createObjectURL(u[0])),onFileRemove:u=>h.setFieldValue(p.name,URL.createObjectURL(u[0])),children:a.jsx(K,{className:"border-2 border-white dark:border-gray-800 shadow-lg",size:100,shape:"circle",icon:a.jsx(xe,{}),...f})})})}})}),a.jsx(k,{label:"Company Name",invalid:t.companyName&&s.companyName,errorMessage:t.companyName,children:a.jsx(D,{type:"text",autoComplete:"off",name:"companyName",placeholder:"Company Name",component:w,prefix:a.jsx(fe,{className:"text-xl"})})}),a.jsx(k,{label:"Contact Number",invalid:t.phone&&s.phone,errorMessage:t.phone,children:a.jsx(D,{type:"text",autoComplete:"off",name:"phone",placeholder:"phone",component:w,prefix:a.jsx(Te,{className:"text-xl"})})}),a.jsx(k,{label:"Address",invalid:t.address&&s.address,errorMessage:t.address,children:a.jsx(D,{type:"text",autoComplete:"off",name:"address",placeholder:"Address",component:w,prefix:a.jsx(be,{className:"text-xl"})})}),a.jsx(k,{label:"Billing Details",invalid:t.billingDetails&&s.billingDetails,errorMessage:t.billingDetails,children:a.jsx(D,{type:"text",autoComplete:"off",name:"billingDetails",placeholder:"Billing Details",component:w,prefix:a.jsx(Be,{className:"text-xl"})})}),a.jsxs("div",{style:{position:"relative"},children:[a.jsx(k,{label:"TagId",invalid:t.history&&s.history,errorMessage:t.history,children:a.jsxs("div",{style:{position:"relative"},children:[a.jsx(D,{name:"tagId",component:Pe,options:m,placeholder:"Select a Tag",onChange:l}),a.jsx(qe,{style:{position:"absolute",right:"10px",top:"10px",border:"none",background:"#FFF"},className:"text-xl",onClick:()=>{I(),d(!0)}})]})}),a.jsx(Ue,{isOpen:i,categoryList:y,onOpenChange:p=>n(p)})]}),a.jsx(k,{label:"History",invalid:t.history&&s.history,errorMessage:t.history,children:a.jsx(D,{type:"text",autoComplete:"off",name:"history",placeholder:"History",component:w,prefix:a.jsx(ze,{className:"text-xl"})})}),a.jsx(k,{label:"Notes",invalid:t.notes&&s.notes,errorMessage:t.notes,children:a.jsx(D,{type:"text",autoComplete:"off",name:"notes",placeholder:"Notes",component:w,prefix:a.jsx(He,{className:"text-xl"})})})]})},da=Me().shape({clientName:L().required("clientName are required"),contactInfo:Re().typeError("Contact must be a number").required("Contact is required").test("is-number","Contact must be a number",e=>!isNaN(e)).test("is-ten-digits"," Contact must be exactly 10 digits",e=>{if(e){const s=Number(e);return/^\d{10}$/.test(s.toString())}return!0}).test("is-not-more-than-ten-digits","Contact must not exceed 10 digits",e=>e?Number(e).toString().length<=10:!0),address:L().required("Address is required"),billingDetails:L().required("Address is required"),history:L(),notes:L(),tagId:$e()}),{TabNav:ma,TabList:pa,TabContent:ua}=U,W=g.forwardRef(()=>{var s;const e=T(t=>t.crmTasks.data.selectedTask);return console.log(e),a.jsx(Fe,{initialValues:{tasksName:(e==null?void 0:e.tasksName)||"",closeTime:(e==null?void 0:e.closeTime)||"",descriptions:(e==null?void 0:e.descriptions)||"",tagId:((s=e==null?void 0:e.tags)==null?void 0:s.map(t=>t.id))||[],priority:(e==null?void 0:e.priority)||"",completionStatus:(e==null?void 0:e.completionStatus)||"pending",assignedTo:(e==null?void 0:e.assignedToData)||"",relatedTo:(e==null?void 0:e.relatedToData)||"",colorName:e!=null&&e.tags&&(e==null?void 0:e.tags.length)>0?e==null?void 0:e.tags[0].colorName:""},validationSchema:da,onSubmit:(t,{setSubmitting:r})=>{r(!1)},children:({touched:t,errors:r})=>a.jsx(Le,{children:a.jsx(Oe,{children:a.jsxs(U,{defaultValue:"taskDetails",children:[a.jsx(pa,{children:a.jsx(ma,{value:"taskDetails",children:"Tasks"})}),a.jsx("div",{className:"p-6",children:a.jsx(ua,{value:"taskDetails",children:a.jsx(ca,{touched:t,errors:r})})})]})})})})});W.displayName="TasksForm";const X=g.forwardRef((e,s)=>{const t=N(),r=T(d=>d.crmTasks.data.selectedTask),i=T(d=>d.crmTasks.data.tasksList),{id:n}=r,c=d=>{const{name:m,birthday:b,email:y,img:S,location:I,title:v,phoneNumber:O,facebook:F,twitter:o,pinterest:l,linkedIn:p}=d,h={name:m,email:y,img:S},f={location:I,title:v,birthday:oe(b).format("DD/MM/YYYY"),phoneNumber:O,facebook:F,twitter:o,pinterest:l,linkedIn:p};let u=A(i),j={};u=u.map(x=>(x.id===n&&(x={...x,...h},x.personalInfo={...x.personalInfo,...f},j=x),x)),Ae(j)||t(Qe(j)),t(J()),t(ea(u))};return a.jsx(W,{ref:s,tasks:r,onFormSubmit:c})});X.displayName="TasksEditContent";const ga=({onSaveClick:e,onCancel:s})=>a.jsxs("div",{className:"text-right w-full",children:[a.jsx(R,{size:"sm",className:"mr-2",onClick:s,children:"Cancel"}),a.jsx(R,{size:"sm",variant:"solid",onClick:e,children:"Save"})]}),ha=()=>{const e=N(),s=T(n=>n.crmTasks.data.drawerOpen),t=()=>{e(J()),e(Y({}))},r=g.useRef(null),i=()=>{var n;(n=r.current)==null||n.submitForm()};return a.jsx(ve,{isOpen:s,closable:!1,bodyClass:"p-0",footer:a.jsx(ga,{onCancel:t,onSaveClick:i}),onClose:t,onRequestClose:t,children:a.jsx(X,{ref:r})})},xa=({row:e})=>{const{textTheme:s}=Se(),t=N(),r=()=>{t(_()),t(Y(e))};return a.jsx("div",{className:`${s} cursor-pointer select-none font-semibold`,onClick:r,children:"Edit"})},fa=()=>{const e=N(),s=T(o=>o.crmTasks.data.tasksList),t=T(o=>o.crmTasks.data.loading),r=T(o=>o.crmTasks.data.filterData),{pageIndex:i,pageSize:n,sort:c,query:d,total:m}=T(o=>o.crmTasks.data.tableData),b=g.useCallback(()=>{e($({pageIndex:i,pageSize:n,sort:c,query:d,filterData:r}))},[i,n,c,d,r,e]);g.useEffect(()=>{b()},[b,i,n,c,r]);const y=g.useMemo(()=>({pageIndex:i,pageSize:n,sort:c,query:d,total:m}),[i,n,c,d,m]),S=o=>{if(o){const l=new Date(o),p=l.getDate().toString().padStart(2,"0"),h=(l.getMonth()+1).toString().padStart(2,"0"),f=l.getFullYear(),u=l.getHours().toString().padStart(2,"0"),j=l.getMinutes().toString().padStart(2,"0");return`${p}/${h}/${f} ${u}:${j}`}else return"-"},I=g.useMemo(()=>[{header:"Tasks Name",accessorKey:"tasksName",cell:o=>o.row.original.tasksName,width:200},{header:"Due Date",accessorKey:"dueDate",cell:o=>S(o.row.original.dueDate),width:200},{header:"Closing Date",accessorKey:"closeTime",cell:o=>{var l;return S((l=o.row.original)==null?void 0:l.closeTime)},width:200},{header:"assignedTo",accessorKey:"assignedTo",cell:o=>o.row.original.assignedToData.firstName,width:200},{header:"assignedBy",accessorKey:"assignedBy",cell:o=>o.row.original.assignedByData.firstName,width:200},{header:"relatedTo",accessorKey:"relatedTo",cell:o=>console.log(o.row.original.relatedToData),width:200},{header:"Tag Name",accessorKey:"tagName",width:200,cell:o=>{const p=(o.row.original.tags||[]).map(h=>{const f=h.colorName||"#000000",u={backgroundColor:`rgba(${parseInt(f.slice(1,3),16)}, ${parseInt(f.slice(3,5),16)}, ${parseInt(f.slice(5,7),16)}, 0.2)`,color:f,padding:"4px 8px",borderRadius:"4px",marginRight:"4px",marginBottom:"4px"};return a.jsx("div",{style:u,children:h.tagName},h.id)});return a.jsx("div",{children:p})}},{header:"priority",accessorKey:"priority",cell:o=>o.row.original.priority,width:200},{header:"completionStatus",accessorKey:"completionStatus",cell:o=>o.row.original.completionStatus,width:200},{header:"descriptions",accessorKey:"descriptions",cell:o=>o.row.original.descriptions,width:200},{header:"Edit",id:"action",cell:o=>a.jsx(xa,{row:o.row.original})}],[]),v=o=>{const l=A(y);l.pageIndex=o,e(M(l))},O=o=>{const l=A(y);l.pageSize=Number(o),l.pageIndex=1,e(M(l))},F=o=>{const l=A(y);l.sort=o,e(M(l))};return a.jsxs("div",{children:[a.jsx(Ne,{columns:I,data:s,skeletonAvatarColumns:[0],skeletonAvatarProps:{width:28,height:28},loading:t,pagingData:{total:y.total,pageIndex:y.pageIndex,pageSize:y.pageSize},onPaginationChange:v,onSelectChange:O,onSort:F}),a.jsx(ha,{})]})},E=e=>{const{icon:s,avatarClass:t,label:r,value:i,growthRate:n,loading:c}=e,d=55;return a.jsx(Ge,{bordered:!0,children:a.jsx(ne,{loading:c,customLoader:a.jsx(Ye,{avatarProps:{className:"rounded",width:d,height:d}}),children:a.jsx("div",{className:"flex justify-between items-center",children:a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx(K,{className:t,size:d,icon:s}),a.jsxs("div",{children:[a.jsx("span",{children:r}),a.jsx("h3",{children:a.jsx(_e,{thousandSeparator:!0,displayType:"text",value:i})})]})]})})})})},Ta=()=>{const e=N(),s=T(r=>r.crmTasks.data.statisticData),t=T(r=>r.crmTasks.data.statisticLoading);return g.useEffect(()=>{e(z())},[]),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4 mb-6",children:[a.jsx(E,{icon:a.jsx(ye,{}),avatarClass:"!bg-indigo-600",label:"Total Tasks",value:s==null?void 0:s.totalTasks,loading:t}),a.jsx(E,{icon:a.jsx(je,{}),avatarClass:"!bg-blue-500",label:"Active Tasks",value:s==null?void 0:s.completedTasks,loading:t}),a.jsx(E,{icon:a.jsx(Ce,{}),avatarClass:"!bg-emerald-500",label:"New Tasks",value:s==null?void 0:s.newTasks,loading:t})]})};ie("crmTasks",sa);const ba=()=>a.jsxs(a.Fragment,{children:[a.jsx(Ta,{}),a.jsxs(le,{bodyClass:"h-full",children:[a.jsx(la,{}),a.jsx(fa,{})]})]}),Ys=ba;export{Ys as default};
