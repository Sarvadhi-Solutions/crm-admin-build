import{am as O,an as $,ao as B,ap as V,a as N,j as e,B as p,ar as A,r as L}from"./index-04de45f1.js";import{C as M}from"./CalendarView-2a895139.js";import{C as P}from"./Views-9d427d6f.js";import{I as z}from"./Input-177911dc.js";import{B as T}from"./Button-c014eb4a.js";import{S as W,c as U}from"./Select-8dd681ec.js";import{D as C}from"./index-688929a7.js";import{D as G}from"./Dialog-94528cff.js";import{F as H,a as _,b as J,c as u,d as g}from"./formik.esm-21613a47.js";import{B as w}from"./Badge-fd219ce7.js";import{h as K}from"./index-942d8076.js";import{b as Q}from"./CrmService-1cd24b67.js";import{B as X}from"./index.esm-dece01db.js";import{c as Y,a as f,e as D}from"./index.esm-7ed3d02a.js";import{c as j}from"./cloneDeep-9e3b0d5b.js";import"./context-3f43d22b.js";import"./isNil-2d09164b.js";import"./get-e02c019e.js";import"./toString-85ae3482.js";import"./_MapCache-593c8f28.js";import"./toConsumableArray-c4879a90.js";import"./objectWithoutPropertiesLoose-df62547b.js";import"./floating-ui.dom-bef9cea3.js";import"./useControllableState-517757cf.js";import"./useMergeRef-788c4cb0.js";import"./Calendar-3ea43322.js";import"./useRootClose-9c807e39.js";import"./usePopper-301f1b7b.js";import"./CloseButton-c81f3a7a.js";import"./RangeCalendar-31722222.js";import"./TimeInput-89c18d58.js";import"./useUniqueId-d1553e7a.js";import"./useDidUpdate-be24419c.js";import"./index-ce7a2c9a.js";import"./index-5206a52a.js";import"./useTimeout-352435f8.js";import"./useUncertainRef-83c88a9e.js";import"./_Uint8Array-51fedccd.js";import"./_getPrototype-c53c6c29.js";const F="crmCalendar",R=O(F+"/getEvents",async()=>(await Q()).data),Z={loading:!1,eventList:[],dialogOpen:!1,selected:{type:""}},q=$({name:`${F}/state`,initialState:Z,reducers:{updateEvent:(t,o)=>{t.eventList=o.payload},openDialog:t=>{t.dialogOpen=!0},closeDialog:t=>{t.dialogOpen=!1},setSelected:(t,o)=>{t.selected=o.payload}},extraReducers:t=>{t.addCase(R.fulfilled,(o,m)=>{o.eventList=m.payload})}}),{updateEvent:y,openDialog:E,closeDialog:S,setSelected:k}=q.actions,ee=q.reducer,te=B({data:ee}),x=V,{Control:ae}=U,{useUniqueId:le}=K,h=[{value:"red",label:"red",color:"bg-red-500"},{value:"orange",label:"orange",color:"bg-orange-500"},{value:"amber",label:"amber",color:"bg-amber-500"},{value:"yellow",label:"yellow",color:"bg-yellow-500"},{value:"lime",label:"lime",color:"bg-lime-500"},{value:"green",label:"green",color:"bg-green-500"},{value:"emerald",label:"emerald",color:"bg-emerald-500"},{value:"teal",label:"teal",color:"bg-teal-500"},{value:"cyan",label:"cyan",color:"bg-cyan-500"},{value:"sky",label:"sky",color:"bg-sky-500"},{value:"blue",label:"blue",color:"bg-blue-500"},{value:"indigo",label:"indigo",color:"bg-indigo-500"},{value:"purple",label:"purple",color:"bg-purple-500"},{value:"fuchsia",label:"fuchsia",color:"bg-fuchsia-500"},{value:"pink",label:"pink",color:"bg-pink-500"},{value:"rose",label:"rose",color:"bg-rose-500"}],re=({innerProps:t,label:o,data:m,isSelected:s})=>e.jsxs("div",{className:`flex items-center justify-between p-2 ${s?"bg-gray-100 dark:bg-gray-500":"hover:bg-gray-50 dark:hover:bg-gray-600"}`,...t,children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(w,{className:m.color}),e.jsx("span",{className:"ml-2 rtl:mr-2 capitalize",children:o})]}),s&&e.jsx(X,{className:"text-emerald-500 text-xl"})]}),oe=({children:t,...o})=>{const m=o.getValue()[0];return e.jsxs(ae,{className:"capitalize",...o,children:[m&&e.jsx(w,{className:`${m.color} ltr:ml-4 rtl:mr-4`}),t]})},se=Y().shape({title:f().required("Event title Required"),startDate:D().required("Start Date Required"),endDate:D(),color:f().required("Color Required")}),ne=({submit:t})=>{const o=N(),m=x(a=>a.crmCalendar.data.dialogOpen),s=x(a=>a.crmCalendar.data.selected),v=le("event-"),b=()=>{o(S())},n=(a,l)=>{l(!1);const r={id:s.id||v,title:a.title,start:p(a.startDate).format(),eventColor:a.color};a.endDate&&(r.end=p(a.endDate).format()),t==null||t(r,s.type),o(S())};return e.jsxs(G,{isOpen:m,onClose:b,onRequestClose:b,children:[e.jsx("h5",{className:"mb-4",children:s.type==="NEW"?"Add New Event":"Edit Event"}),e.jsx("div",{children:e.jsx(H,{enableReinitialize:!0,initialValues:{title:s.title||"",startDate:s.start?p(s.start).toDate():"",endDate:s.end?p(s.end).toDate():"",color:s.eventColor||h[0].value},validationSchema:se,onSubmit:(a,{setSubmitting:l})=>{n(a,l)},children:({values:a,touched:l,errors:r})=>e.jsx(_,{children:e.jsxs(J,{children:[e.jsx(u,{label:"User Name",invalid:r.title&&l.title,errorMessage:r.title,children:e.jsx(g,{type:"text",autoComplete:"off",name:"title",placeholder:"Please enter title",component:z})}),e.jsx(u,{label:"Start Date",invalid:r.startDate&&l.startDate,errorMessage:r.startDate,children:e.jsx(g,{name:"startDate",placeholder:"Date",children:({field:i,form:c})=>e.jsx(C,{field:i,form:c,value:i.value,onChange:d=>{c.setFieldValue(i.name,d)}})})}),e.jsx(u,{label:"End Date",invalid:r.endDate&&l.endDate,errorMessage:r.endDate,children:e.jsx(g,{name:"endDate",placeholder:"Date",children:({field:i,form:c})=>e.jsx(C,{field:i,form:c,value:i.value,onChange:d=>{c.setFieldValue(i.name,d)}})})}),e.jsx(u,{label:"Prefered",asterisk:!0,invalid:r.color&&l.color,errorMessage:r.color,children:e.jsx(g,{name:"color",children:({field:i,form:c})=>e.jsx(W,{field:i,form:c,options:h,value:h.filter(d=>d.value===a.color),components:{Option:re,Control:oe},onChange:d=>c.setFieldValue(i.name,d==null?void 0:d.value)})})}),e.jsx(u,{className:"mb-0 text-right rtl:text-left",children:e.jsx(T,{variant:"solid",type:"submit",children:"Submit"})})]})})})})]})};A("crmCalendar",te);const ie=()=>{const t=N(),o=x(n=>n.crmCalendar.data.eventList);L.useEffect(()=>{t(R())},[]);const m=n=>{const{start:a,end:l}=n;t(k({type:"NEW",start:p(a).format(),end:p(l).format()})),t(E())},s=n=>{const{start:a,end:l,id:r,title:i,extendedProps:c}=n.event;t(k({type:"EDIT",eventColor:c.eventColor,title:i,start:a,end:l,id:r})),t(E())},v=(n,a)=>{let l=j(o);a==="NEW"&&l.push(n),a==="EDIT"&&(l=l.map(r=>(n.id===r.id&&(r=n),r))),t(y(l))},b=n=>{const a=j(o).map(l=>{if(n.event.id===l.id){const{id:r,extendedProps:i,start:c,end:d,title:I}=n.event;l={id:r,start:p(c).format(),end:p(d).format(),title:I,eventColor:i.eventColor}}return l});t(y(a))};return e.jsxs(P,{className:"h-full",children:[e.jsx(M,{editable:!0,selectable:!0,events:o,eventClick:s,select:m,eventDrop:b}),e.jsx(ne,{submit:v})]})},Je=ie;export{Je as default};
