import{al as I,am as oa,an as da,ao as ca,a as q,r as R,j as a,c as la,aq as ma}from"./index-fbeb73e8.js";import{S as X}from"./StickyFooter-1a744f3f.js";import"./Alert-9eeb3e1b.js";import"./index-193266b4.js";import"./Badge-67aa5111.js";import{B as D}from"./Button-fa703339.js";import"./RangeCalendar-07e95539.js";import"./Card-2611bbf0.js";import"./index-fa7b3b75.js";import"./index-197628eb.js";import{D as pa}from"./Dialog-04fb7b63.js";import"./Drawer-383b2f06.js";import"./index-91e30e73.js";import{a as f,F as Z}from"./FormItem-be8e2cb8.js";import"./toString-e7e32846.js";import{I as z}from"./Input-ea43c704.js";import"./index-2090c75d.js";import"./index-e5cf4612.js";import"./index-9afb8437.js";import{t as $,N as H}from"./toast-8910f630.js";import"./Pagination-70a157e9.js";import"./Progress-d00a7ee9.js";import"./index-5fefc1aa.js";import"./ScrollBar-f7d5b71e.js";import"./index-4aafab9b.js";import{S as ga}from"./Select-d04732be.js";import"./Skeleton-e59059fb.js";import"./index-dcf21671.js";import{S as ua}from"./Switcher-0771dd88.js";import"./index-af747e82.js";import"./index-b84a5e6c.js";import{T as ha}from"./Tag-a8ec6a60.js";import"./index-f04e83aa.js";import"./index-df93595f.js";import"./Tooltip-56eb9eeb.js";import"./Upload-e917b755.js";import{i as fa}from"./isLastChild-83eb4c23.js";import{F as xa}from"./FormDesription-1db8f159.js";import{F as ba}from"./FormRow-dc129d3c.js";import{u as ya,b as j,F as U,a as aa}from"./formik.esm-23ee2cb1.js";import{c as ja}from"./cloneDeep-2449545a.js";import{A as ea,c as Na}from"./index.esm-7bee018d.js";import{S as wa,ad as Ca}from"./index.esm-966eae5b.js";import{R as ta}from"./index.esm-d93e8434.js";import{c as sa,a as S,d as Oa}from"./index.esm-3c9a3967.js";import{a6 as za,a7 as va,a8 as Ea,a9 as Sa,aa as Ia,ab as Da,Q as ka}from"./CrmService-0260fe15.js";/* empty css              */import{B as Ma}from"./index.esm-00218edb.js";import"./Views-e8d5fb02.js";import"./chart.constant-80226332.js";import"./chart.config-61f234bb.js";import"./DataTable-2ef1b7c2.js";import"./GrowShrinkTag-6bf7fae1.js";import"./react-tooltip.min-6d896212.js";import{R as Fa}from"./RichTextEditor-554e9538.js";import"./SegmentItemOption-43e428e6.js";import"./SvgIcon-6b6efa8a.js";import{G as Aa}from"./index.esm-e21bb47f.js";import{b as Ba}from"./index.esm-394c7a2d.js";import{T as Ra}from"./index.esm-859698dd.js";const La="crmOrganizations",M=I("crmOrganizations/data/organization",async()=>(await za()).data),T=I("crmOrganizations/data/editOrganization",async({organizationId:s,updatedData:e})=>{var t,r;try{return(await va(s,e)).data}catch(i){throw new Error((r=(t=i==null?void 0:i.response)==null?void 0:t.data)==null?void 0:r.message)}}),F=I("crmOrganizations/data/organization-branches",async()=>(await Ea()).data),V=I("crmOrganizations/data/editBranch",async({branchId:s,updatedData:e})=>{var t,r;try{return(await Sa(s,e)).data}catch(i){throw new Error((r=(t=i==null?void 0:i.response)==null?void 0:t.data)==null?void 0:r.message)}}),qa=I("crmOrganizations/data/createBranch",async s=>{var e,t;try{return(await Ia(s)).data}catch(r){throw new Error((t=(e=r==null?void 0:r.response)==null?void 0:e.data)==null?void 0:t.message)}});I("crmOrganizations/data/organization",async s=>{var e,t;try{return(await Da(s)).data}catch(r){throw new Error((t=(e=r==null?void 0:r.response)==null?void 0:e.data)==null?void 0:t.message)}});const Q=I("crmOrganizations/data/getUsers",async()=>{var s,e;try{return(await ka()).data}catch(t){throw new Error((e=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:e.message)}}),$a={organizationData:[],loading:!1,statisticLoading:!1,branchList:[],isDialogOpen:!1,selectedBranch:{},deleteConfirmation:!1,usersList:[],dialogMode:"Add"},ra=oa({name:`${La}/state`,initialState:$a,reducers:{setBranchList:(s,e)=>{s.branchList=e.payload},setSelectedBranch:(s,e)=>{s.selectedBranch=e.payload},setDialogToggle:(s,e)=>{s.isDialogOpen=e.payload},toggleDeleteConfirmation:(s,e)=>{s.deleteConfirmation=e.payload},setUsersList:(s,e)=>{s.usersList=e.payload},setDialogMode:(s,e)=>{s.dialogMode=e.payload}},extraReducers:s=>{s.addCase(M.fulfilled,(e,t)=>{e.organizationData=t.payload.data,e.loading=!1}).addCase(M.pending,e=>{e.loading=!0}).addCase(Q.fulfilled,(e,t)=>{e.usersList=t.payload.data,e.loading=!1}).addCase(F.fulfilled,(e,t)=>{e.branchList=t.payload.data,e.loading=!1}).addCase(F.pending,e=>{e.statisticLoading=!0}).addCase(V.fulfilled,(e,t)=>{e.loading=!1}).addCase(V.pending,e=>{e.loading=!0}).addCase(T.fulfilled,(e,t)=>{e.loading=!1}).addCase(T.pending,e=>{e.loading=!0})}}),{setBranchList:Ha,setSelectedBranch:Ta,setDialogToggle:k,setUsersList:et,setDialogMode:K,toggleDeleteConfirmation:tt}=ra.actions,Va=ra.reducer,Qa=da({data:Va}),v=ca,w=[],Ga=s=>{const{touched:e,errors:t,setFieldValue:r,values:i}=s,l=q();R.useEffect(()=>{(async()=>{await l(Q())})()},[l]);const d=v(n=>{var N,E;return(E=(N=n.crmOrganizations)==null?void 0:N.data)==null?void 0:E.usersList});w.length=0,d==null||d.forEach(n=>{w==null||w.push({label:`${n==null?void 0:n.firstName} ${n==null?void 0:n.lastName}`,value:n.id})});const m=()=>{l(k(!1))},C=ya();return a.jsxs(a.Fragment,{children:[a.jsx(f,{label:"Branch Name",invalid:t.branchName&&e.branchName,errorMessage:t.branchName,children:a.jsx(j,{type:"text",autoComplete:"off",name:"branchName",placeholder:"Branch Name",component:z,prefix:a.jsx(ta,{className:"text-xl"})})}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsx("div",{className:"col-span-1",children:a.jsx(f,{label:"Branch Owner",invalid:t.branchOwnerId&&e.branchOwnerId,errorMessage:t.branchOwnerId,children:a.jsx(ga,{name:"branchOwnerId",placeholder:"Branch Owner",options:w,id:"branchOwnerId",value:w==null?void 0:w.find(n=>(n==null?void 0:n.value)===(i==null?void 0:i.branchOwnerId)),onChange:n=>{const N=n==null?void 0:n.value;r("branchOwnerId",N)}})})}),a.jsx("div",{className:"col-span-1",children:a.jsx(f,{label:"Contact Number",invalid:t.contact&&e.contact,errorMessage:t.contact,children:a.jsx(j,{type:"text",autoComplete:"off",name:"contact",placeholder:"Contact",component:z,prefix:a.jsx(Ma,{className:"text-xl"})})})})]}),a.jsx(f,{children:a.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[a.jsx("label",{className:"form-label",style:{marginRight:"10px"},children:"Head Quarter"}),a.jsx(j,{autoComplete:"off",name:"isHeadQuarter",component:ua,checked:C.values.isHeadQuarter})]})}),a.jsx(f,{label:"Address",invalid:t.addressInformation&&e.addressInformation,errorMessage:t.addressInformation,children:a.jsx(j,{type:"text",autoComplete:"off",name:"addressInformation",placeholder:"Address",component:z,prefix:a.jsx(wa,{className:"text-xl"})})}),a.jsx(X,{className:" px-8 flex items-center justify-between py-4",stickyClass:"border-t bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700",children:a.jsxs("div",{className:"md:flex items-center",children:[a.jsx(D,{size:"sm",className:"ltr:mr-3 rtl:ml-3",type:"button",onClick:m,children:"Cancel"}),a.jsx(D,{size:"sm",type:"submit",variant:"solid",icon:a.jsx(ea,{}),children:"Save"})]})})]})},Pa=sa().shape({branchName:S().required("Details are required"),contact:S().typeError("Contact must be a number").required("Contact is required").test("is-number","Contact must be a number",s=>!isNaN(s)).test("is-ten-digits"," Contact must be exactly 10 digits",s=>{if(s){const e=Number(s);return/^\d{10}$/.test(e.toString())}return!0}).test("is-not-more-than-ten-digits","Contact must not exceed 10 digits",s=>s?Number(s).toString().length<=10:!0),addressInformation:S(),isHeadQuarter:S(),branchOwnerId:S().required("This field is required").test("is-valid-contact","Invalid contact selected",s=>!!w.find(e=>e.value==s))}),ia=R.forwardRef((s,e)=>{const t=q(),r=v(l=>l.crmOrganizations.data.dialogMode),i=v(l=>{var d,m;return(m=(d=l.crmOrganizations)==null?void 0:d.data)==null?void 0:m.selectedBranch});return a.jsx(U,{innerRef:e,initialValues:{branchName:r==="Edit"?i==null?void 0:i.branchName:"",branchOwnerId:r==="Edit"?i==null?void 0:i.branchOwnerId:"",addressInformation:r==="Edit"?i==null?void 0:i.addressInformation:"",contact:r==="Edit"?i==null?void 0:i.contact:null,isHeadQuarter:r==="Edit"?i==null?void 0:i.isHeadQuarter:!1},validationSchema:Pa,onSubmit:async(l,{setSubmitting:d})=>{var m,C,n,N,E,L;if(r==="Add"){const o=await t(qa(l));let x="",b="",y="";(m=o==null?void 0:o.payload)!=null&&m.success?(x="Successfully Added",b=(C=o==null?void 0:o.payload)==null?void 0:C.message,y="success"):(x="Something went wrong !!!",b=(n=o==null?void 0:o.error)==null?void 0:n.message,y="danger"),$.push(a.jsx(H,{title:x,type:y,duration:2500,children:b}),{placement:"top-end"}),t(k(!1)),await t(M()),await t(F()),d(!1)}else{const o=await t(V({branchId:i==null?void 0:i.id,updatedData:l}));let x="",b="",y="";(N=o==null?void 0:o.payload)!=null&&N.success?(x="Successfully Added",b=(E=o==null?void 0:o.payload)==null?void 0:E.message,y="success"):(x="Something went wrong !!!",b=(L=o==null?void 0:o.error)==null?void 0:L.message,y="danger"),$.push(a.jsx(H,{title:x,type:y,duration:2500,children:b}),{placement:"top-end"}),t(k(!1)),await t(M()),await t(F()),d(!1)}},children:({touched:l,errors:d,values:m,setFieldValue:C})=>a.jsx(aa,{children:a.jsx(Z,{children:a.jsx(Ga,{touched:l,errors:d,setFieldValue:C,values:m})})})})});ia.displayName="BranchesMainForm";const Wa=s=>{const{values:e,touched:t,errors:r}=s;return a.jsxs(a.Fragment,{children:[a.jsx("h5",{children:"Organizations"}),a.jsx("p",{className:"mb-6",children:"Section to config the organizations attribute"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsx("div",{className:"col-span-1",children:a.jsx(f,{label:"Organization Name",invalid:r.organizationName&&t.organizationName,errorMessage:r.organizationName,children:a.jsx(j,{type:"text",autoComplete:"off",name:"organizationName",placeholder:"Organization Name",component:z,prefix:a.jsx(Aa,{className:"text-xl"})})})}),a.jsx("div",{className:"col-span-1",children:a.jsx(f,{label:"Industry",invalid:r.industry&&t.industry,errorMessage:r.industry,children:a.jsx(j,{type:"text",autoComplete:"off",name:"industry",value:e.industry,placeholder:"Organization Industry",component:z})})})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsx("div",{className:"col-span-1",children:a.jsx(f,{label:"Contact",invalid:r.contact&&t.contact,errorMessage:r.contact,children:a.jsx(j,{type:"number",autoComplete:"off",name:"contact",placeholder:"Contact",component:z,prefix:a.jsx(Ra,{className:"text-xl"})})})}),a.jsx("div",{className:"col-span-1",children:a.jsx(f,{label:"Website",invalid:r.website&&t.website,errorMessage:r.website,children:a.jsx(j,{type:"test",autoComplete:"off",name:"website",placeholder:"Website",component:z,prefix:a.jsx(Ba,{className:"text-xl"})})})})]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:a.jsx("div",{className:"col-span-1",children:a.jsx(f,{label:"Number Of Employees",invalid:r.numberOfEmployees&&t.numberOfEmployees,errorMessage:r.numberOfEmployees,children:a.jsx(j,{type:"number",autoComplete:"off",name:"numberOfEmployees",placeholder:"Number Of Employees",component:z,prefix:a.jsx(Na,{className:"text-xl"})})})})}),a.jsx(f,{label:"Description",labelClass:"!justify-start",invalid:r.notes&&t.notes,errorMessage:r.notes,children:a.jsx(j,{name:"notes",children:({field:i,form:l})=>a.jsx(Fa,{value:i.value,onChange:d=>l.setFieldValue(i.name,d)})})})]})},_a=sa().shape({organizationName:S().required("Organization Name Required"),industry:S().required("Industry Required"),contact:Oa().typeError("Contact must be a number").required("Contact is required").test("is-number","Contact must be a number",s=>!isNaN(s)).test("is-ten-digits"," Contact must be exactly 10 digits",s=>{if(s){const e=Number(s);return/^\d{10}$/.test(e.toString())}return!0}).test("is-not-more-than-ten-digits","Contact must not exceed 10 digits",s=>s?Number(s).toString().length<=10:!0)}),na=R.forwardRef((s,e)=>{var x,b,y,G,P,W;const t=q(),r=v(c=>{var p,g;return(g=(p=c.crmOrganizations)==null?void 0:p.data)==null?void 0:g.organizationData});R.useEffect(()=>{(async()=>{var g;const p=await t(F());t(Ha((g=p==null?void 0:p.payload)==null?void 0:g.data)),await t(Q()),await t(F())})()},[t]);const i=v(c=>c.crmOrganizations.data.usersList),{type:l,onFormSubmit:d,onDiscard:m}=s,C=v(c=>c.crmOrganizations.data.isDialogOpen),n=v(c=>c.crmOrganizations.data.branchList),N=v(c=>c.crmOrganizations.data.dialogMode),E=()=>{t(k(!1))},L=()=>{t(k(!0)),t(K("Add"))},o=c=>{t(k(!0)),t(Ta(c)),t(K("Edit"))};return a.jsxs(a.Fragment,{children:[a.jsx(U,{innerRef:e,initialValues:{organizationName:((x=r[0])==null?void 0:x.organizationName)||"",industry:((b=r[0])==null?void 0:b.industry)||"",contact:((y=r[0])==null?void 0:y.contact)||null,website:((G=r[0])==null?void 0:G.website)||"",numberOfEmployees:((P=r[0])==null?void 0:P.numberOfEmployees)||null,notes:((W=r[0])==null?void 0:W.notes)||""},validationSchema:_a,onSubmit:async(c,{setSubmitting:p})=>{var O,_,Y,J;const g=ja(c),u=await t(T({organizationId:(O=r[0])==null?void 0:O.id,updatedData:g}));let A="",h="",B="";(_=u==null?void 0:u.payload)!=null&&_.success?(A="Successfully Added",h=(Y=u==null?void 0:u.payload)==null?void 0:Y.message,B="success"):(A="Something went wrong !!!",h=(J=u==null?void 0:u.error)==null?void 0:J.message,B="danger"),$.push(a.jsx(H,{title:A,type:B,duration:2500,children:h}),{placement:"top-end"}),await t(M()),d==null||d(g,p)},children:({values:c,touched:p,errors:g,isSubmitting:u})=>{const A={touched:p,errors:g};return a.jsx(aa,{children:a.jsxs(Z,{children:[a.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:a.jsx("div",{className:"lg:col-span-4",children:a.jsx(Wa,{touched:p,errors:g,values:c})})}),a.jsx(xa,{title:" Branches",desc:"You can update your branches information here"}),a.jsxs(ba,{name:"branches",alignCenter:!0,label:"",...A,children:[a.jsx("div",{className:"rounded-lg border border-gray-200 dark:border-gray-600",children:n==null?void 0:n.map((h,B)=>a.jsxs("div",{className:la("flex items-center justify-between p-4",!fa(n,B)&&"border-b border-gray-200 dark:border-gray-600"),children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx(ta,{}),a.jsx("div",{className:"ml-3 rtl:mr-3",children:a.jsxs("div",{className:"flex items-center",children:[a.jsxs("div",{className:"text-gray-900 dark:text-gray-100 font-semibold",children:[h.branchName," ",i!=null&&i.find(O=>O.id===h.branchOwnerId)?`${i.find(O=>O.id===h.branchOwnerId).firstName} ${i.find(O=>O.id===h.branchOwnerId).lastName}`:""]}),h.isHeadQuarter&&a.jsx(ha,{className:"bg-sky-100 text-sky-600 dark:bg-sky-500/20 dark:text-sky-100 rounded-md border-0 mx-2",children:a.jsxs("span",{className:"capitalize",children:[" ","Head Quarter"," "]})})]})})]}),a.jsx("div",{className:"flex",children:a.jsx(D,{size:"sm",type:"button",onClick:()=>o(h),children:"Edit"})})]},h.id))}),a.jsx("div",{className:"mt-2",children:a.jsx(D,{type:"button",variant:"plain",size:"sm",icon:a.jsx(Ca,{className:"text-lg"}),onClick:()=>L(),children:a.jsx("span",{className:"font-semibold",children:"Add new branch"})})})]}),a.jsx(X,{className:"-mx-8 px-8 flex items-center justify-between py-4",stickyClass:"border-t bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700",children:a.jsxs("div",{className:"md:flex items-center",children:[a.jsx(D,{size:"sm",className:"ltr:mr-3 rtl:ml-3",type:"button",onClick:()=>m==null?void 0:m(),children:"Discard"}),a.jsx(D,{size:"sm",variant:"solid",loading:u,icon:a.jsx(ea,{}),type:"submit",children:"Save"})]})})]})})}}),a.jsxs(pa,{isOpen:C,onClose:E,children:[a.jsxs("h5",{className:"mb-4",children:[N==="Edit"?"Edit":"Add New"," Branch"]}),a.jsx(ia,{})]})]})});na.displayName="OrganizationForm";ma("crmOrganizations",Qa);const Ya=()=>{const s=q();return R.useEffect(()=>{s(M())},[s]),a.jsx(a.Fragment,{children:a.jsx(na,{type:"edit",onFormSubmit:function(e,t){t(!1)}})})},st=Ya;export{st as O};
