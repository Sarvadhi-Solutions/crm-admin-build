import{a as D,j as e,r as x,aq as re}from"./index-3e880d58.js";import{A as ne}from"./AdaptableCard-c2187b0f.js";import{F as B}from"./FormDesription-1f8ea7a5.js";import{D as ie}from"./DataTable-5b7f8f4c.js";import{T as ce}from"./TagsList-79ed58cc.js";import{T as L}from"./TextTruncate-1e259c49.js";import{u as W}from"./checkEditUpdate-712507f0.js";import{u as le}from"./useThemeClass-ee469ab6.js";import{c as K}from"./cloneDeep-3c6952f1.js";import{W as me,O as de,P as pe,b as ue}from"./index.esm-72033000.js";import{u as f,t as P,d as xe,g as z,a as H,b as he,f as ge,c as fe,e as Ce,s as Z,h as je,i as _,j as V,k as Q,r as Ne}from"./index-e0301c9f.js";import{t as M,N as k}from"./toast-b78f7559.js";import{C as be}from"./ConfirmDialog-90e160ad.js";import{B as G}from"./Button-2946c768.js";import{D as ye}from"./Drawer-9836140f.js";import{T as X}from"./index-3c7f8823.js";import{a as j,F as we}from"./FormItem-2c1e6567.js";import{u as De,b,F as ve,a as Se}from"./formik.esm-b6fc01f9.js";import{c as Te,a as N,e as Ie}from"./index.esm-ef8817a5.js";import{I as y}from"./Input-cc5b259f.js";import{D as Fe,t as Ae,c as Le}from"./tagAndCategory-beef627f.js";/* empty css              */import{b as Me,a as ke}from"./index.esm-218c3d6f.js";import"./Alert-f6d23cba.js";import"./index-4d380cc3.js";import"./Badge-dfca28fd.js";import"./RangeCalendar-76b3d14c.js";import"./Card-229ace64.js";import"./index-f0b859a7.js";import"./index-3e1bfc83.js";import"./Dialog-a9e6c446.js";import"./index-9d9ccba3.js";import"./toString-5649af70.js";import"./index-0199cfe3.js";import"./index-989e0cf5.js";import"./index-78df0a35.js";import"./Pagination-65d73c7a.js";import"./Progress-ae30664a.js";import"./index-e719384e.js";import"./ScrollBar-71fa1417.js";import"./index-ab165616.js";import{S as Ee}from"./Select-76acedff.js";import"./Skeleton-6f0cf5d7.js";import"./index-6b09464f.js";import"./Switcher-15616a0a.js";import"./index-2e6e3f8b.js";import"./Tag-baf7a322.js";import"./index-2f9ef4f4.js";import"./index-95cf3345.js";import"./Tooltip-e9d0a24c.js";import"./Upload-2e16c5c2.js";import{a as J}from"./index.esm-2a281149.js";import{M as Oe}from"./index.esm-7d8c0f8e.js";import{a as Re}from"./index.esm-33df2266.js";import{G as qe}from"./index.esm-c5183d83.js";import{d as ze}from"./index.esm-9d327cb5.js";import{d as $e}from"./debounce-104cbb1c.js";import"./index-de567301.js";import"./_MapCache-7f2c37e9.js";import"./Views-075eae35.js";import"./_getPrototype-484592c8.js";import"./CrmService-a38b0f72.js";import"./useTimeout-eadd7d3b.js";import"./CloseButton-4efc1add.js";import"./StatusIcon-ff12f8c4.js";import"./chainedFunction-070f832c.js";import"./index-9c0cabce.js";import"./useControllableState-f10b9480.js";import"./index-f502ce4c.js";import"./isNil-4c059865.js";import"./get-4c4ae8d7.js";import"./useMergeRef-788c4cb0.js";import"./_baseIsEqual-785b16ba.js";import"./useRootClose-0ff11c2b.js";import"./usePopper-5fe449ce.js";import"./TimeInput-6b863084.js";import"./useUniqueId-e46a3a66.js";import"./useDidUpdate-4d89c820.js";import"./useUncertainRef-48982c60.js";import"./slicedToArray-a34215eb.js";import"./objectWithoutProperties-8809bfcf.js";import"./toConsumableArray-4b935cb5.js";import"./floating-ui.dom-bef9cea3.js";import"./mapCloneElement-024d59c7.js";import"./index.esm-4e597ee1.js";const Ke=()=>{const s=D(),r=f(o=>o.crmContact.data.deleteConfirmation),t=f(o=>o.crmContact.data.selectedContact),l=()=>{s(P(!1))},n=async()=>{var p,i,u;s(P(!1));const o=await s(xe(t==null?void 0:t.id));(p=o==null?void 0:o.payload)!=null&&p.success?M.push(e.jsx(k,{title:"Successfuly Deleted",type:"success",duration:2500,children:(i=o==null?void 0:o.payload)==null?void 0:i.message}),{placement:"top-end"}):M.push(e.jsx(k,{title:"Something Went Wrong !!!",type:"danger",duration:2500,children:(u=o==null?void 0:o.error)==null?void 0:u.message}),{placement:"top-end"}),await s(z()),await s(H())};return e.jsx(be,{isOpen:r,type:"danger",title:"Delete Contact",confirmButtonColor:"red-600",onClose:l,onRequestClose:l,onCancel:l,onConfirm:n,children:e.jsx("p",{children:"Are you sure you want to delete this Contact? All record related to this contact will be deleted as well. This action cannot be undone."})})},$=[],Ve=s=>{const{touched:r,errors:t,values:l,setFieldValue:n}=s,o=D(),[p,i]=x.useState(!1),[u,g]=x.useState(!1),[w,C]=x.useState([]),[E,v]=x.useState([]),S=()=>{i(!p),g(!1)},T=f(h=>h.crmContact.data.companyList);$.length=0,T.forEach(h=>{$.push({value:h.id,label:h.companyName})});const[O,m]=x.useState("");x.useEffect(()=>{(async()=>{var F,U;try{const{payload:R}=await o(ge()),q=(F=R==null?void 0:R.data)==null?void 0:F.find(A=>(A==null?void 0:A.moduleName)==="contacts");if(m(q.id),q){const{payload:A}=await o(fe({id:(U=q==null?void 0:q.id)==null?void 0:U.toString()})),se=Ae(A.data),oe=Le(A.data);v(oe),C(se)}}catch(R){console.error("Error fetching module data:",R)}})(),o(he())},[o]);const a=f(h=>h.crmContact.data.selectedContact),[d,c]=x.useState(a?a.tags||[]:[]),I=De(),ae=h=>{c(h);const F=[h.value];I.setFieldValue("tagId",F)};return e.jsxs(e.Fragment,{children:[e.jsx(B,{title:"Contact Basic Information",desc:"",className:"mb-2"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"col-span-1",children:e.jsx(j,{label:"First Name *",invalid:t.firstName&&r.firstName,errorMessage:t.firstName,children:e.jsx(b,{type:"text",autoComplete:"off",name:"firstName",placeholder:"First Name",component:y,prefix:e.jsx(J,{className:"text-xl"})})})}),e.jsx("div",{className:"col-span-1",children:e.jsx(j,{label:"Last Name *",invalid:t.lastName&&r.lastName,errorMessage:t.lastName,children:e.jsx(b,{type:"text",autoComplete:"off",name:"lastName",placeholder:"Last Name",component:y,prefix:e.jsx(J,{className:"text-xl"})})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"col-span-1",children:e.jsx(j,{label:"Email *",invalid:t.email&&r.email,errorMessage:t.email,children:e.jsx(b,{type:"text",autoComplete:"off",name:"email",placeholder:"Email",component:y,prefix:e.jsx(me,{className:"text-xl"})})})}),e.jsx("div",{className:"col-span-1",children:e.jsx(j,{label:"Contact Number *",invalid:t.contactNumber&&r.contactNumber,errorMessage:t.contactNumber,children:e.jsx(b,{type:"text",autoComplete:"off",name:"contactNumber",placeholder:"Contact Number",component:y,prefix:e.jsx(Re,{className:"text-xl"})})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"col-span-1",children:e.jsx(j,{label:"Title",invalid:t.title&&r.title,errorMessage:t.title,children:e.jsx(b,{type:"text",autoComplete:"off",name:"title",placeholder:"Title",component:y,prefix:e.jsx(Oe,{className:"text-xl"})})})}),e.jsx("div",{className:"col-span-1",children:e.jsx(j,{label:"Description",invalid:t.description&&r.description,errorMessage:t.description,children:e.jsx(b,{type:"text",autoComplete:"off",name:"description",placeholder:"Description",component:y,prefix:e.jsx(Me,{className:"text-xl"})})})})]}),e.jsx(B,{title:"Contact Others Details",desc:"",className:"mb-2"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"col-span-1",children:e.jsx(j,{label:"Company Name",invalid:t.companiesId&&r.companiesId,errorMessage:t.companiesId,children:e.jsx(Ee,{name:"companiesId",placeholder:"Company Name",options:$,id:"companiesId",value:$.find(h=>(h==null?void 0:h.value)==(l==null?void 0:l.companiesId)),onChange:h=>{const F=h.value;n("companiesId",F||"")}})})}),e.jsx("div",{className:"col-span-1",children:e.jsx(j,{label:"Source",invalid:t.source&&r.source,errorMessage:t.source,children:e.jsx(b,{type:"text",autoComplete:"off",name:"source",placeholder:"Source",component:y,prefix:e.jsx(qe,{className:"text-xl"})})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"col-span-1",children:e.jsx(j,{label:"Address",invalid:t.address&&r.address,errorMessage:t.address,children:e.jsx(b,{type:"text",autoComplete:"off",name:"address",placeholder:"Address",component:y,prefix:e.jsx(ze,{className:"text-xl"})})})}),e.jsx("div",{className:"col-span-1",children:e.jsx("div",{style:{position:"relative"},children:e.jsx(j,{label:"Tag",children:e.jsxs("div",{style:{position:"relative"},children:[e.jsx(b,{name:"tagId",component:Fe,options:w,placeholder:"Select a Tag",value:I.initialValues.tagName,onChange:ae}),e.jsx(ke,{style:{position:"absolute",right:"10px",top:"10px",border:"none",background:"#FFF"},className:"text-xl",onClick:()=>{S(),g(!0)}})]})})})})]})]})},Be=Te().shape({firstName:N().required("First Name is required"),lastName:N().required("Last Name is required"),title:N(),contactNumber:N().typeError("Contact must be a number").required("Contact is required").test("is-number","Contact must be a number",s=>!isNaN(s)).test("is-ten-digits"," Contact must be exactly 10 digits",s=>{if(s){const r=Number(s);return/^\d{10}$/.test(r.toString())}return!0}).test("is-not-more-than-ten-digits","Contact must not exceed 10 digits",s=>s?Number(s).toString().length<=10:!0),email:N().matches(/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/i,"Invalid email").required("Email is required"),address:N(),companiesId:N().nullable(),companyName:N(),source:N().nullable(),description:N(),tagId:Ie()}),{TabNav:We,TabList:Pe,TabContent:He}=X,Y=x.forwardRef((s,r)=>{var o,p,i,u;const t=f(g=>g.crmContact.data.selectedContact),l=!!t.id,n=D();return e.jsx(ve,{innerRef:r,initialValues:{firstName:(t==null?void 0:t.firstName)||"",lastName:(t==null?void 0:t.lastName)||"",title:(t==null?void 0:t.title)||"",email:(t==null?void 0:t.email)||"",contactNumber:(t==null?void 0:t.contactNumber)||"",description:(t==null?void 0:t.description)||"",companyName:((o=t==null?void 0:t.company)==null?void 0:o.companyName)||"",source:(t==null?void 0:t.source)||"",address:(t==null?void 0:t.address)||"",tagName:((i=(p=t==null?void 0:t.tags)==null?void 0:p[0])==null?void 0:i.tagName)||"",tagId:((u=t==null?void 0:t.tags)==null?void 0:u.map(g=>g.id))||[],companiesId:(t==null?void 0:t.companiesId)||""},validationSchema:Be,onSubmit:async(g,{setSubmitting:w})=>{var S,T,O,m,a,d;const{colorName:C,tagName:E,...v}=g;if(l===!0){const c=await n(Ce({contactId:(t==null?void 0:t.id)||"",updatedData:v}));(S=c==null?void 0:c.payload)!=null&&S.success?M.push(e.jsx(k,{title:"Successfully Added",type:"success",duration:2500,children:(T=c==null?void 0:c.payload)==null?void 0:T.message}),{placement:"top-end"}):M.push(e.jsx(k,{title:"Something went wrong !!!",type:"danger",duration:2500,children:(O=c==null?void 0:c.error)==null?void 0:O.message}),{placement:"top-end"}),n(Z()),await n(z()),await n(H())}else{const c=await n(je(v));(m=c==null?void 0:c.payload)!=null&&m.success?M.push(e.jsx(k,{title:"Successfully Added",type:"success",duration:2500,children:(a=c==null?void 0:c.payload)==null?void 0:a.message}),{placement:"top-end"}):M.push(e.jsx(k,{title:"Something went wrong !!!",type:"danger",duration:2500,children:(d=c==null?void 0:c.error)==null?void 0:d.message}),{placement:"top-end"}),n(Z()),await n(z()),await n(H())}w(!1)},children:({touched:g,errors:w,values:C,setFieldValue:E})=>e.jsx(Se,{children:e.jsx(we,{children:e.jsxs(X,{defaultValue:"personalInfo",children:[e.jsx(Pe,{children:e.jsx(We,{value:"personalInfo",children:"Contact Details"})}),e.jsx("div",{className:"p-6",children:e.jsx(He,{value:"personalInfo",children:e.jsx(Ve,{touched:g,errors:w,values:C,setFieldValue:E})})})]})})})})});Y.displayName="ContactForm";const ee=x.forwardRef((s,r)=>{D();const t=f(n=>n.crmContact.data.selectedContact);f(n=>n.crmContact.data.contactList);const l=async n=>{};return e.jsx(Y,{ref:r,contact:t,onFormSubmit:l})});ee.displayName="ContactEditContent";const Ze=({onSaveClick:s,onCancel:r})=>e.jsxs("div",{className:"text-right w-full",children:[e.jsx(G,{size:"sm",className:"mr-2",onClick:r,children:"Cancel"}),e.jsx(G,{size:"sm",variant:"solid",onClick:s,children:"Save"})]}),_e=()=>{const s=D(),[r,t]=x.useState(window.innerWidth/2),l=f(i=>i.crmContact.data.drawerOpen),n=()=>{s(Z()),s(_({}))},o=x.useRef(null),p=()=>{var i,u;console.log("formSubmit function called",(i=o.current)==null?void 0:i.values),(u=o.current)==null||u.submitForm()};return e.jsx(ye,{isOpen:l,closable:!1,bodyClass:"p-0",width:r,footer:e.jsx(Ze,{onCancel:n,onSaveClick:p}),onClose:n,onRequestClose:n,children:e.jsx(ee,{ref:o})})},Ge=()=>{const s=D(),r=f(m=>m.crmContact.data.displayedContactList),t=W("contacts","canModify"),l=W("contacts","canDelete"),n=f(m=>m.crmContact.data.loading),{pageIndex:o,pageSize:p,sort:i,query:u,total:g}=f(m=>m.crmContact.data.tableData),w=x.useCallback(()=>{s(z())},[s]);x.useEffect(()=>{w()},[w]);const C=x.useMemo(()=>({pageIndex:o,pageSize:p,sort:i,query:u,total:g}),[o,p,i,u,g]),E=({row:m})=>{const a=D(),{textTheme:d}=le(),c=()=>{a(Q()),a(_(m))},I=async()=>{a(_(m)),a(P(!0))};return e.jsxs("div",{className:"flex justify-start text-lg",children:[l&&e.jsx("span",{className:`cursor-pointer p-2 hover:${d}`,onClick:c,children:e.jsx(de,{})}),t&&e.jsx("span",{className:"cursor-pointer p-2 hover:text-red-500",onClick:I,children:e.jsx(pe,{})})]})},v=x.useMemo(()=>[{header:"Action",id:"action",cell:a=>e.jsx(E,{row:a.row.original})},{header:"Name",accessorKey:"firstName",cell:a=>{const{firstName:d,lastName:c}=a.row.original,I=`${d} ${c}`;return e.jsx(L,{text:I,maxLength:20})}},{header:"email",accessorKey:"email",cell:a=>a.row.original.email},{header:"Number",accessorKey:"contactNumber",cell:a=>a.row.original.contactNumber},{header:"source",accessorKey:"source",cell:a=>{const d=a.row.original.source;return e.jsx(L,{text:d,maxLength:15})}},{header:"Tags",accessorKey:"tagName",cell:a=>{const d=a.row.original.tags||[];return e.jsx(ce,{tags:d})}},{header:"Title",accessorKey:"title",cell:a=>{const d=a.row.original.title;return e.jsx(L,{text:d,maxLength:15})}},{header:"Company",accessorKey:"companyName",cell:a=>{const d=a.row.original.company?a.row.original.company.companyName:"";return e.jsx(L,{text:d,maxLength:15})}},{header:"address",accessorKey:"address",cell:a=>{const d=a.row.original.address;return e.jsx(L,{text:d,maxLength:20})}},{header:"Notes",accessorKey:"description",cell:a=>{const d=a.row.original.description;return e.jsx(L,{text:d,maxLength:20})}}],[t,l]),S=m=>{const a=K(C);a.pageIndex=m,s(V(a))},T=m=>{const a=K(C);a.pageSize=Number(m),a.pageIndex=1,s(V(a))},O=m=>{const a=K(C);a.sort=m,s(V(a))};return e.jsxs("div",{children:[e.jsx(ie,{columns:v,data:r,loading:n,pagingData:{total:C.total,pageIndex:C.pageIndex,pageSize:C.pageSize},onPaginationChange:S,onSelectChange:T,onSort:O}),e.jsx(_e,{}),e.jsx(Ke,{})]})},te=x.forwardRef((s,r)=>{const{onInputChange:t}=s,l=$e(n,500);function n(p){t==null||t(p)}const o=p=>{l(p.target.value)};return e.jsx(y,{ref:r,className:"max-w-md md:w-52 mb-4",size:"sm",placeholder:"Search",prefix:e.jsx(ue,{className:"text-lg"}),onChange:o})});te.displayName="ContactTableSearch";const Ue=()=>{const s=D(),r=x.useRef(null),t=f(i=>i.crmContact.data.tableData),l=W("contacts","canCreate"),n=i=>{const u=K(t);u.query=i,u.pageIndex=1,typeof i=="string"&&i.length>1&&o(u),typeof i=="string"&&i.length===0&&o(u)},o=i=>{s(V(i)),s(z())},p=()=>{s(Q())};return e.jsxs("div",{className:"md:flex items-center justify-between",children:[e.jsx("div",{className:"md:flex items-center gap-4",children:e.jsx(te,{ref:r,onInputChange:n})}),e.jsx("div",{className:"mb-4",children:l&&e.jsx(G,{size:"sm",onClick:p,children:"Add New"})})]})};re("crmContact",Ne);const Je=()=>{const s=f(r=>r.crmContact.data.tableData);return e.jsx(e.Fragment,{children:e.jsxs(ne,{bodyClass:"h-full",children:[e.jsx(B,{title:`Contacts (${s==null?void 0:s.total})`,desc:"",className:"mb-2"}),e.jsx(Ue,{}),e.jsx(Ge,{})]})})},Ia=Je;export{Ia as default};
