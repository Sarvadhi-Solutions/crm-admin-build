import{al as T,am as H,an as G,ao as V,r as y,j as t,a as x,aq as W}from"./index-c91233c4.js";import{J as _,G as J,av as K,aw as U}from"./CrmService-0926a59f.js";import{B as I}from"./Button-113f2dd5.js";import{I as v}from"./Input-3db03e3e.js";import{b as Q,O as X,P as Y}from"./index.esm-3e702816.js";import{d as Z}from"./debounce-e0e0a602.js";import{c as N}from"./cloneDeep-3478dfeb.js";import{D as ee}from"./DataTable-2296ca1a.js";import{u as F}from"./checkEditUpdate-ac8ef005.js";import{u as ae}from"./useThemeClass-90ce08ab.js";import"./Alert-5079d0b3.js";import"./index-ab87cb73.js";import"./Badge-4bf3424a.js";import"./RangeCalendar-ef1c5cb5.js";import"./Card-9fc6ce8c.js";import"./index-385919dd.js";import"./index-573812b1.js";import{D as oe}from"./Dialog-7536f1c9.js";import"./Drawer-1eb99a1f.js";import"./index-5e45e4e6.js";import{F as te,a as se}from"./FormItem-03780ce8.js";import"./toString-02d61bde.js";import"./index-0c57aa38.js";import"./index-ae85a04b.js";import"./index-4b57f9f6.js";import{N as L,t as E}from"./toast-3356881f.js";import"./Pagination-ecd3ce06.js";import"./Progress-d02ad1c6.js";import"./index-53a76053.js";import"./ScrollBar-7545d350.js";import"./index-d1291c10.js";import"./Select-eb35ba81.js";import"./Skeleton-c238629d.js";import"./index-897c901b.js";import"./Switcher-168eb353.js";import"./index-117fd06f.js";import"./index-9515aebe.js";import"./Tag-8be02ac4.js";import"./index-64df10c7.js";import"./index-c7f4c752.js";import"./Tooltip-63f372a9.js";import"./Upload-49e8a9f3.js";import"./Views-7340793d.js";import"./chart.constant-984c1f0e.js";import"./chart.config-e8e3d2b8.js";import"./GrowShrinkTag-80982248.js";import"./react-tooltip.min-d2946e0c.js";import"./RichTextEditor-a10e3225.js";import"./SegmentItemOption-65792c40.js";import{S as re}from"./StickyFooter-3bfb1813.js";import"./SvgIcon-e2422980.js";import{F as ce,a as ie,b as ne}from"./formik.esm-302d3744.js";import{A as le}from"./index.esm-bb37fee7.js";import{a as de}from"./index.esm-2faaa5cf.js";import{c as me,a as pe}from"./index.esm-b1ea5004.js";import{C as ue}from"./ConfirmDialog-b19fcb2d.js";const ge="crmSource",M=T("crmSource/data/createSource",async a=>{var e,o;try{return(await _(a)).data}catch(s){throw new Error((o=(e=s==null?void 0:s.response)==null?void 0:e.data)==null?void 0:o.message)}}),D=T("crmSource/data/getSource",async()=>{var a,e;try{return(await J()).data}catch(o){throw new Error((e=(a=o==null?void 0:o.response)==null?void 0:a.data)==null?void 0:e.message)}}),Se=T("crmSource/data/editSource",async({id:a,updatedData:e})=>{var o,s;try{return(await K(a,e)).data}catch(c){throw new Error((s=(o=c==null?void 0:c.response)==null?void 0:o.data)==null?void 0:s.message)}}),fe=T("crmLeads/data/deleteSource",async a=>{var e,o;try{return await U(a)}catch(s){throw new Error((o=(e=s==null?void 0:s.response)==null?void 0:e.data)==null?void 0:o.message)}}),he={total:0,pageIndex:1,pageSize:10,query:"",sort:{order:"",key:""}},ye={loading:!1,tableData:he,displayedSourceList:[],categoryList:[],isDialogOpen:!1,dialogMode:"Add",selectedSource:null,deleteConfirmation:!1},O=H({name:`${ge}/state`,initialState:ye,reducers:{setTableData:(a,e)=>{a.tableData=e.payload,console.log(a.categoryList);const o=a.categoryList.filter(s=>s.sources.toLowerCase().includes(e.payload.query.toLowerCase()));a.tableData.total=o.length,a.displayedSourceList=o.slice(e.payload.pageSize*(e.payload.pageIndex-1),e.payload.pageSize*e.payload.pageIndex)},setSelectedState:(a,e)=>{a.selectedSource=e.payload},setDialogToggle:(a,e)=>{a.isDialogOpen=e.payload},setDialogMode:(a,e)=>{a.dialogMode=e.payload},toggleDeleteConfirmation:(a,e)=>{a.deleteConfirmation=e.payload}},extraReducers:a=>{a.addCase(M.fulfilled,(e,o)=>{e.loading=!1}).addCase(M.pending,e=>{e.loading=!0}).addCase(D.fulfilled,(e,o)=>{var s,c,i,r,l;e.loading=!1,e.categoryList=o==null?void 0:o.payload.data,e.tableData.total=(s=o.payload.data)==null?void 0:s.length,e.displayedSourceList=o==null?void 0:o.payload.data.slice(((c=e==null?void 0:e.tableData)==null?void 0:c.pageSize)*(((i=e==null?void 0:e.tableData)==null?void 0:i.pageIndex)-1),((r=e==null?void 0:e.tableData)==null?void 0:r.pageSize)*((l=e==null?void 0:e.tableData)==null?void 0:l.pageIndex))}).addCase(D.pending,e=>{e.loading=!0})}}),{setTableData:A,setDialogToggle:C,setDialogMode:R,setSelectedState:z,toggleDeleteConfirmation:k}=O.actions,xe=O.reducer,De=G({data:xe}),S=V,q=y.forwardRef((a,e)=>{const{onInputChange:o}=a,s=Z(c,500);function c(r){o==null||o(r)}const i=r=>{s(r.target.value)};return t.jsx(v,{ref:e,className:"max-w-md md:w-52 mb-4",size:"sm",placeholder:"Search",prefix:t.jsx(Q,{className:"text-lg"}),onChange:i})});q.displayName="StateTableSearch";const be=()=>{const a=x(),e=y.useRef(null),o=S(i=>i.crmSource.data.tableData),s=i=>{const r=N(o);r.query=i,r.pageIndex=1,typeof i=="string"&&i.length>1&&c(r),typeof i=="string"&&i.length===0&&c(r)},c=i=>{a(i?A(i):D())};return t.jsxs("div",{className:"md:flex items-center justify-between",children:[t.jsx("div",{className:"md:flex items-center gap-4",children:t.jsx(q,{ref:e,onInputChange:s})}),t.jsx("div",{className:"mb-4",children:t.jsx(I,{size:"sm",onClick:()=>{a(C(!0)),a(R("Add"))},children:"Add New"})})]})},Ce=()=>{const a=x(),e=S(d=>d.crmSource.data.loading),o=F("roles","canModify"),s=F("roles","canDelete"),{pageIndex:c,pageSize:i,sort:r,query:l,total:p}=S(d=>d.crmSource.data.tableData),f=S(d=>d.crmSource.data.displayedSourceList);console.log({data:f});const u=({row:d})=>{const n=x(),{textTheme:w}=ae(),$=()=>{n(z(d)),n(C(!0)),n(R("Edit"))},B=async()=>{await n(z(d)),n(k(!0))};return t.jsxs("div",{className:"flex justify-start text-lg",children:[t.jsx("span",{className:`cursor-pointer p-2 hover:${w}`,onClick:$,children:t.jsx(X,{})}),t.jsx("span",{className:"cursor-pointer p-2 hover:text-red-500",onClick:B,children:t.jsx(Y,{})})]})},g=y.useMemo(()=>({pageIndex:c,pageSize:i,sort:r,query:l,total:p}),[c,i,r,l,p]),m=y.useMemo(()=>[{header:"Action",id:"action",cell:n=>t.jsx(u,{row:n.row.original})},{header:"Source",accessorKey:"sources",cell:n=>n.row.original.sources}],[o,s]),h=d=>{const n=N(g);n.pageIndex=d,a(A(n))},b=d=>{const n=N(g);n.pageSize=Number(d),n.pageIndex=1,a(A(n))},j=d=>{const n=N(g);n.sort=d,a(A(n))};return t.jsx("div",{children:t.jsx(ee,{columns:m,data:f,skeletonAvatarColumns:[0],skeletonAvatarProps:{width:28,height:28},loading:e,pagingData:{total:g.total,pageIndex:g.pageIndex,pageSize:g.pageSize},onPaginationChange:h,onSelectChange:b,onSort:j})})},je=me().shape({sources:pe().required("Source name is required")}),P=y.forwardRef((a,e)=>{const o=x(),s=S(l=>l.crmSource.data.dialogMode),c=S(l=>l.crmSource.data.selectedSource),i=()=>{o(C(!1))};console.log(s);const r=async(l,p,f,u,g)=>{var d,n,w;const m=await u(l==="Add"?M(p):Se({id:f==null?void 0:f.id,updatedData:p}));let h="",b="",j="danger";(d=m==null?void 0:m.payload)!=null&&d.success?(h="Successfully Added",b=(n=m==null?void 0:m.payload)==null?void 0:n.message,j="success"):(h="Something went wrong !!!",b=(w=m==null?void 0:m.error)==null?void 0:w.message),g.push(t.jsx(L,{title:h,type:j,duration:2500,children:b}),{placement:"top-end"}),u(C(!1)),await u(D())};return t.jsx(ce,{innerRef:e,initialValues:{sources:s==="Edit"?c==null?void 0:c.sources:""},validationSchema:je,onSubmit:async(l,{setSubmitting:p})=>{s==="Add"?await r("Add",l,null,o,E):await r("Edit",l,c,o,E),p(!1)},children:({touched:l,errors:p,values:f,setFieldValue:u})=>t.jsxs(ie,{children:[t.jsx(te,{children:t.jsx(se,{label:"Source",invalid:p.sources&&l.sources,errorMessage:p.sources,children:t.jsx(ne,{type:"text",autoComplete:"off",name:"sources",placeholder:"Source",component:v,prefix:t.jsx(de,{className:"text-xl"})})})}),t.jsx(re,{className:"flex items-center justify-end py-2",stickyClass:"border-t bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700",children:t.jsxs("div",{className:"md:flex items-center",children:[t.jsx(I,{size:"sm",className:"ltr:mr-3 rtl:ml-3",type:"button",onClick:i,children:"Cancel"}),t.jsx(I,{size:"sm",type:"submit",variant:"solid",icon:t.jsx(le,{}),children:"Save"})]})})]})})});P.displayName="SourceForm";const we=()=>{const a=x(),e=S(r=>r.crmSource.data.deleteConfirmation),o=S(r=>r.crmSource.data.selectedSource),s=()=>{a(k(!1))},c=(r,l,p,f)=>{var g,m,h;const u=(g=r==null?void 0:r.payload)==null?void 0:g.success;l.push(t.jsx(L,{title:u?p:f,type:u?"success":"danger",duration:2500,children:u?(m=r==null?void 0:r.payload)==null?void 0:m.message:(h=r==null?void 0:r.error)==null?void 0:h.message}),{placement:"top-end"})},i=async()=>{a(k(!1));const r=await a(fe(o==null?void 0:o.id));c(r,E,"Successfully Deleted","Something Went Wrong !!!"),await a(D())};return t.jsx(ue,{isOpen:e,type:"danger",title:"Delete Source",confirmButtonColor:"red-600",onClose:s,onRequestClose:s,onCancel:s,onConfirm:i,children:t.jsx("p",{children:"Are you sure you want to delete this Source? All record related to this Source will be deleted as well. This action cannot be undone."})})};W("crmSource",De);const Ne=()=>{const a=x(),e=S(c=>c.crmSource.data.isDialogOpen),o=S(c=>c.crmSource.data.dialogMode),s=()=>{a(C(!1))};return y.useEffect(()=>{a(D())},[]),t.jsxs(t.Fragment,{children:[t.jsx("h5",{className:"mb-2",children:"Source"}),t.jsx(be,{}),t.jsx(Ce,{}),t.jsxs(oe,{isOpen:e,onClose:s,children:[t.jsxs("h5",{className:"mb-4",children:[o==="Edit"?"Edit":"Add New"," Source"]}),t.jsx(P,{})]}),t.jsx(we,{})]})},Ia=Ne;export{Ia as S};
