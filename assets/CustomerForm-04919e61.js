import{a as V,r as n,j as t}from"./index-f40e4d75.js";import{T as $}from"./index-e9a19be6.js";import{a as l,F as R}from"./FormItem-e9df506f.js";import{u as U,b as d,F as _,a as z}from"./formik.esm-a717025a.js";import{c as G,a as b,f as J,b as K}from"./index.esm-6a659974.js";import{u as B,A as Q,h as W,i as X,j as Y,s as L,g as E,b as H,k as Z}from"./AdditionalTag-7eeec0fc.js";import{t as v,N as S}from"./toast-a13e90a2.js";import{I as g}from"./Input-a28838c6.js";import{a6 as ee,ab as te,a7 as ae}from"./index.esm-0d86f991.js";import{A as se}from"./index.esm-102c4743.js";import{a as oe,T as ie,b as ne}from"./index.esm-d23b2af8.js";import{D as re,t as le,c as de}from"./tagAndCategory-9190e9b0.js";/* empty css              */const ce=c=>{const{touched:o,errors:e}=c,x=V(),[s,u]=n.useState(!1);n.useState("#808080");const[F,h]=n.useState(!1),[i,f]=n.useState([]),[M,k]=n.useState([]),N=()=>{u(!s),h(!1)},[D,I]=n.useState("");n.useEffect(()=>{(async()=>{var T,q;try{const{payload:m}=await x(W());console.log(m,"send Me The Id And The Payload");const C=(T=m==null?void 0:m.data)==null?void 0:T.find(p=>(p==null?void 0:p.moduleName)==="clients");if(I(C.id),C){const{payload:p}=await x(X({id:(q=C==null?void 0:C.id)==null?void 0:q.toString()})),O=le(p.data),P=de(p.data);k(P),f(O)}}catch(m){console.error("Error fetching module data:",m)}})()},[x]);const y=B(r=>r.crmCustomers.data.selectedCustomer),[A,w]=n.useState(y?y.tags||[]:[]),j=U(),a=r=>{console.log(r),w(r);const T=[r.value];j.setFieldValue("tagId",T)};return t.jsxs(t.Fragment,{children:[t.jsx(l,{label:"Client Name",invalid:e.clientName&&o.clientName,errorMessage:e.clientName,children:t.jsx(d,{type:"text",autoComplete:"off",name:"clientName",placeholder:"Client Name",component:g,prefix:t.jsx(ee,{className:"text-xl"})})}),t.jsx(l,{label:"Contact Number",invalid:e.contactInfo&&o.contactInfo,errorMessage:e.contactInfo,children:t.jsx(d,{type:"text",autoComplete:"off",name:"contactInfo",placeholder:"Contact Number",component:g,prefix:t.jsx(te,{className:"text-xl"})})}),t.jsx(l,{label:"Address",invalid:e.address&&o.address,errorMessage:e.address,children:t.jsx(d,{type:"text",autoComplete:"off",name:"address",placeholder:"Address",component:g,prefix:t.jsx(ae,{className:"text-xl"})})}),t.jsx(l,{label:"Billing Details",invalid:e.billingDetails&&o.billingDetails,errorMessage:e.billingDetails,children:t.jsx(d,{type:"text",autoComplete:"off",name:"billingDetails",placeholder:"Billing Details",component:g,prefix:t.jsx(oe,{className:"text-xl"})})}),t.jsxs("div",{style:{position:"relative"},children:[t.jsx(l,{label:"Tags",invalid:e.history&&o.history,errorMessage:e.history,children:t.jsxs("div",{style:{position:"relative"},children:[t.jsx(d,{name:"Tag",component:re,options:i,placeholder:"Select a Tag",value:j.initialValues.tagName,onChange:a}),t.jsx(ie,{style:{position:"absolute",right:"10px",top:"10px",border:"none",background:"#FFF"},className:"text-xl",onClick:()=>{N(),h(!0)}})]})}),t.jsx(Q,{isOpen:s,moduleName:D,categoryList:M,onOpenChange:r=>u(r)})]}),t.jsx(l,{label:"History",invalid:e.history&&o.history,errorMessage:e.history,children:t.jsx(d,{type:"text",autoComplete:"off",name:"history",placeholder:"History",component:g,prefix:t.jsx(se,{className:"text-xl"})})}),t.jsx(l,{label:"Notes",invalid:e.notes&&o.notes,errorMessage:e.notes,children:t.jsx(d,{type:"text",autoComplete:"off",name:"notes",placeholder:"Notes",component:g,prefix:t.jsx(ne,{className:"text-xl"})})})]})},me=G().shape({clientName:b().required("Customer Name is required"),contactInfo:J().typeError("Contact must be a number").required("Contact is required").test("is-number","Contact must be a number",c=>!isNaN(c)).test("is-ten-digits","Contact must be exactly 10 digits",c=>/^\d{10}$/.test(c)),address:b().required("Address is required"),billingDetails:b().required("Billing Details is required"),history:b(),notes:b(),tagId:K()}),{TabNav:pe,TabList:ge,TabContent:xe}=$,ue=n.forwardRef((c,o)=>{var u,F,h;const e=B(i=>i.crmCustomers.data.selectedCustomer),x=!!e.id,s=V();return t.jsx(_,{innerRef:o,initialValues:{clientName:(e==null?void 0:e.clientName)||"",contactInfo:(e==null?void 0:e.contactInfo)||"",address:(e==null?void 0:e.address)||"",billingDetails:(e==null?void 0:e.billingDetails)||"",history:(e==null?void 0:e.history)||"",notes:(e==null?void 0:e.notes)||"",tagName:((F=(u=e==null?void 0:e.tags)==null?void 0:u[0])==null?void 0:F.tagName)||"",tagId:((h=e==null?void 0:e.tags)==null?void 0:h.map(i=>i.id))||[],colorName:e!=null&&e.tags&&(e==null?void 0:e.tags.length)>0?e==null?void 0:e.tags[0].colorName:""},validationSchema:me,onSubmit:async(i,{setSubmitting:f})=>{var D,I,y,A,w,j;const{colorName:M,tagName:k,...N}=i;if(x){const a=await s(Y({customerId:(e==null?void 0:e.id)||"",updatedData:N}));(D=a==null?void 0:a.payload)!=null&&D.success?v.push(t.jsx(S,{title:"Successfully Added",type:"success",duration:2500,children:(I=a==null?void 0:a.payload)==null?void 0:I.message}),{placement:"top-end"}):v.push(t.jsx(S,{title:"Something went wrong !!!",type:"danger",duration:2500,children:(y=a==null?void 0:a.error)==null?void 0:y.message}),{placement:"top-end"}),s(L()),await s(E()),await s(H())}else{const a=await s(Z(N));(A=a==null?void 0:a.payload)!=null&&A.success?v.push(t.jsx(S,{title:"Successfully Added",type:"success",duration:2500,children:(w=a==null?void 0:a.payload)==null?void 0:w.message}),{placement:"top-end"}):v.push(t.jsx(S,{title:"Something went wrong !!!",type:"danger",duration:2500,children:(j=a==null?void 0:a.error)==null?void 0:j.message}),{placement:"top-end"}),await s(E()),await s(L()),await s(H())}f(!1)},children:({touched:i,errors:f})=>t.jsx(z,{children:t.jsx(R,{children:t.jsxs($,{defaultValue:"customerInfo",children:[t.jsx(ge,{children:t.jsx(pe,{value:"customerInfo",children:"Client Details"})}),t.jsx("div",{className:"p-6",children:t.jsx(xe,{value:"customerInfo",children:t.jsx(ce,{touched:i,errors:f})})})]})})})})});ue.displayName="CustomerForm";export{ue as C};
