import{r as y,a as w,j as e,ah as fe,aq as ye}from"./index-afeb99dd.js";import{u as te}from"./useThemeClass-a6e6a15d.js";import"./Card-a25bc86a.js";import"./Views-f7a9b898.js";import{B as Ce}from"./Badge-57260147.js";import"./chart.constant-e1b2238d.js";import"./GrowShrinkTag-c4569aa9.js";import{aa as Ne,ab as Te,ac as be,O as se,P as oe}from"./index.esm-f4f10cf9.js";import"./index-08720d19.js";import{B as R}from"./Button-5e9321cd.js";import{D as U}from"./Dialog-b0478122.js";import{T as Se}from"./DataTable-3d6ba875.js";import{I as z}from"./Input-fe5fc582.js";import"./Skeleton-1c4e4b72.js";import"./react-tooltip.min-7fdd29c0.js";import"./RichTextEditor-9ad39754.js";import"./SegmentItemOption-666cf094.js";import"./SvgIcon-aa33ab6d.js";import{T as we}from"./Tooltip-46e989ae.js";import{T as B}from"./index-45766b4b.js";import{u as re,f as $,g as ie,e as De,d as ve}from"./index-535d7f05.js";import"./Alert-abc01096.js";import"./RangeCalendar-c8e5e23d.js";import"./index-646ce73f.js";import"./index-71f17666.js";import"./Drawer-6021c63b.js";import"./index-29936284.js";import{F as Y,a as F}from"./FormItem-2a151033.js";import"./toString-79dd21b9.js";import"./index-ed8cb66a.js";import"./index-cf176bc9.js";import"./index-8145753b.js";import{t as I,N as M}from"./toast-b57ee67d.js";import{P as Ie}from"./Pagination-46eefec6.js";import"./Progress-65192619.js";import"./index-fde04e31.js";import"./ScrollBar-93cfd3f9.js";import"./index-b82cade4.js";import{S as ne}from"./Select-2984c046.js";import"./index-a70c7a57.js";import"./Switcher-83e7e292.js";import"./index-b8a0c8d7.js";import"./Tag-f3e28a4c.js";import"./index-53e11fec.js";import"./index-16b82756.js";import"./Upload-1e962b58.js";import{F as _,a as G,b as k,c as Me,g as J}from"./formik.esm-e70cf2ce.js";import{c as q,a as D,e as Fe}from"./index.esm-639db9d4.js";import{u as C,e as Ee,t as V,g as E,T as Ae,a as K,d as Re,m as v,c as ke,b as L,f as le,h as $e,i as qe,j as O,s as H,k as ce,l as Q,n as W,o as Oe,p as X,r as Be}from"./TagCategoryDetailsForm-f590f4cb.js";import{C as de}from"./ConfirmDialog-16c69999.js";import{c as Z}from"./cloneDeep-f2528b95.js";import{u as He}from"./checkEditUpdate-9f459668.js";import{L as me}from"./colorPicker-cac7af9a.js";import{d as Pe}from"./index.esm-726f6b92.js";const ze=q().shape({categoryName:D().required("Field is required")}),ge=y.forwardRef((i,d)=>{var c;const l=w(),u=C(r=>r.crmTagCategories.data.formToggle),x=()=>{l(V(!1))},a=C(r=>r.crmTagCategories.data.selectedTagCategory);return e.jsx(U,{isOpen:u,onClose:x,children:e.jsx(_,{innerRef:d,initialValues:{categoryName:(a==null?void 0:a.categoryName)||"",master:((c=a==null?void 0:a.master)==null?void 0:c.id)||"",tags:(a==null?void 0:a.tags)||[]},validationSchema:ze,onSubmit:async(r,{setSubmitting:s})=>{var p,T,f,b;s(!1);const t={...r,masterId:r==null?void 0:r.master,tagId:((p=r==null?void 0:r.tags)==null?void 0:p.map(S=>S==null?void 0:S.id))||[]};delete t.master,delete t.tags;const n=await l(Ee({tagCategoryId:(a==null?void 0:a.id)||"",updatedData:t}));let h="",j="",N="";(T=n==null?void 0:n.payload)!=null&&T.success?(h="Successfully Update",j=(f=n==null?void 0:n.payload)==null?void 0:f.message,N="success"):(h="Something went wrong !!!",j=(b=n==null?void 0:n.error)==null?void 0:b.message,N="danger"),I.push(e.jsx(M,{title:h,type:N,duration:2500,children:j}),{placement:"top-end"}),l(V(!1)),await l(E())},children:({touched:r,errors:s,values:t,setFieldValue:n})=>e.jsx(G,{children:e.jsx(Y,{children:e.jsx(Ae,{touched:r,errors:s,values:t,setFieldValue:n})})})})})});ge.displayName="TagCategoryForm";const Ve=()=>{const i=w(),d=C(a=>a.crmTagCategories.data.deleteConfirmation),l=C(a=>a.crmTagCategories.data.selectedTagCategory),u=()=>{i(K(!1))},x=async()=>{var c,r,s;i(K(!1));const a=await i(Re(l.id));(c=a==null?void 0:a.payload)!=null&&c.success?I.push(e.jsx(M,{title:"Successfuly Deleted",type:"success",duration:2500,children:(r=a==null?void 0:a.payload)==null?void 0:r.message}),{placement:"top-end"}):I.push(e.jsx(M,{title:"Something Went Wrong !!!",type:"danger",duration:2500,children:(s=a==null?void 0:a.error)==null?void 0:s.message}),{placement:"top-end"}),await i(E())};return e.jsx(de,{isOpen:d,type:"danger",title:"Delete Tag Category",confirmButtonColor:"red-600",onClose:u,onRequestClose:u,onCancel:u,onConfirm:x,children:e.jsx("p",{children:"Are you sure you want to delete this Tag Category? All record related to this tag category will be deleted as well. This action cannot be undone."})})};const Ke=q({categoryName:D().required("Category Name is required"),masterId:D().required("This field is required").test("is-valid-module","Invalid module selected",i=>!!v.find(d=>d.value==i)),tags:Fe().of(q().shape({tagName:D().required("Name required"),colorName:D().required("Color required")}))}),ee=(i,d)=>{const l=J(i.errors,d),u=J(i.touched,d);return{errorMessage:l||"",invalid:typeof u>"u"?!1:l&&u}},Le=()=>{const i=w(),[d,l]=y.useState([]);y.useEffect(()=>{(async()=>{var r;const c=await i(le());l((r=c==null?void 0:c.payload)==null?void 0:r.data)})()},[i]),v.length=0,d==null||d.forEach(a=>{v.push({value:a.id,label:a.moduleName})});const u=C(a=>a.crmTagCategories.data.addForm),x=()=>{i(L(!1))};return e.jsx("div",{children:e.jsx(U,{isOpen:u,onClose:x,children:e.jsx(_,{validationSchema:Ke,initialValues:{tags:[{tagName:"",colorName:""}],categoryName:"",masterId:""},onSubmit:async a=>{var n,h,j;let c="",r="",s="";const t=await i(ke(a));(n=t==null?void 0:t.payload)!=null&&n.success?(c="Successfully Added",r=(h=t==null?void 0:t.payload)==null?void 0:h.message,s="success"):(c="Something went wrong !!!",r=(j=t==null?void 0:t.error)==null?void 0:j.message,s="danger"),I.push(e.jsx(M,{title:c,type:s,duration:2500,children:r}),{placement:"top-end"}),i(L(!1)),await i(E())},children:({touched:a,errors:c,values:r,setFieldValue:s})=>{const t=r.tags;return e.jsx(G,{children:e.jsx(Y,{layout:"inline",children:e.jsxs("div",{className:"w-full custom-scrollbar",style:{maxHeight:"75vh",overflowY:"auto"},children:[e.jsxs("div",{className:"mb-10",children:[e.jsx("h5",{className:"mb-4",children:"Add Tag Category"}),e.jsx(F,{layout:"vertical",label:"Category Name",invalid:c.categoryName&&a.categoryName,errorMessage:c.categoryName,children:e.jsx(k,{placeholder:"Category Name",name:"categoryName",component:z})}),e.jsx(F,{layout:"vertical",label:"Module Name",invalid:c.masterId&&a.masterId,errorMessage:c.masterId,children:e.jsx(ne,{name:"masterId",placeholder:"Module Name",options:v,id:"masterId",value:v.find(n=>(n==null?void 0:n.value)==(r==null?void 0:r.masterId)),onChange:n=>{const h=n.value;s("masterId",h||"")}})})]}),e.jsx(Me,{name:"tags",children:({form:n,remove:h,push:j})=>e.jsxs("div",{children:[t&&t.length>0?t.map((N,p)=>{const T=ee(n,`tags[${p}].tagName`),f=ee(n,`tags[${p}].colorName`);return e.jsxs("div",{children:[e.jsx(F,{label:"Name",invalid:T.invalid,errorMessage:T.errorMessage,children:e.jsx(k,{invalid:T.invalid,placeholder:"Tag Name",name:`tags[${p}].tagName`,type:"text",component:z})}),e.jsx(F,{invalid:f.invalid,children:e.jsx(k,{invalid:f.invalid,placeholder:"Color",name:`tags[${p}].colorName`,render:({field:b})=>e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:0},children:[e.jsx(me,{field:b}),f.invalid&&e.jsx("div",{style:{marginTop:15,marginLeft:5,color:"red"},children:f.errorMessage})]})})}),e.jsx(R,{shape:"circle",size:"sm",icon:e.jsx(Ne,{}),onClick:()=>h(p)})]},p)}):null,e.jsxs("div",{children:[e.jsx(R,{type:"button",className:"ltr:mr-2 rtl:ml-2",onClick:()=>{j({tagName:"",colorName:""})},children:"Add tags"}),e.jsx(R,{type:"submit",variant:"solid",children:"Submit"})]})]})})]})})})}})})})},We=q({tagName:D().required("Tag Name is required"),colorName:D().required("Color required")}),ue=()=>{const i=w(),[d,l]=y.useState([]);y.useEffect(()=>{(async()=>{var n;const t=await i(le());l((n=t==null?void 0:t.payload)==null?void 0:n.data)})()},[i]),v.length=0,d==null||d.forEach(s=>{v.push({value:s.id,label:s.moduleName})});const u=C(s=>s.crmTagCategories.data.editForm),x=C(s=>{var t,n;return(n=(t=s==null?void 0:s.crmTagCategories)==null?void 0:t.data)==null?void 0:n.dialogMode}),a=C(s=>s.crmTagCategories.data.selectedTag),c=()=>{i(O(!1))},r=C(s=>s.crmTagCategories.data.selectedTagCategory);return e.jsx("div",{children:e.jsx(U,{isOpen:u,onClose:c,children:e.jsx(_,{validationSchema:We,initialValues:{tagName:x==="Edit"?a==null?void 0:a.tagName:"",colorName:x==="Edit"?a==null?void 0:a.colorName:"",masterId:x==="Edit"?a==null?void 0:a.masterId:""},onSubmit:async s=>{var N,p,T,f,b,S;let t="",n="",h="";const j={...s};if(x==="Add"){const m=await i($e({masterId:r==null?void 0:r.masterId,tagName:s==null?void 0:s.tagName,colorName:s==null?void 0:s.colorName,tagCategoryId:r==null?void 0:r.id}));(N=m==null?void 0:m.payload)!=null&&N.success?(t="Successfully Added",n=(p=m==null?void 0:m.payload)==null?void 0:p.message,h="success"):(t="Something went wrong !!!",n=(T=m==null?void 0:m.error)==null?void 0:T.message,h="danger")}else{const m=await i(qe({tagId:(a==null?void 0:a.id)||"",data:j}));(f=m==null?void 0:m.payload)!=null&&f.success?(t="Successfully Added",n=(b=m==null?void 0:m.payload)==null?void 0:b.message,h="success"):(t="Something went wrong !!!",n=(S=m==null?void 0:m.error)==null?void 0:S.message,h="danger")}I.push(e.jsx(M,{title:t,type:h,duration:2500,children:n}),{placement:"top-end"}),i(O(!1)),await i(E())},children:({touched:s,errors:t,values:n,setFieldValue:h})=>e.jsx(G,{children:e.jsx(Y,{layout:"inline",children:e.jsxs("div",{className:"w-full custom-scrollbar",style:{maxHeight:"75vh",overflowY:"auto"},children:[e.jsx("div",{className:"mb-10",children:e.jsx("h5",{className:"mb-4",children:x==="Edit"?"Edit Tag Category":"Add Tag Category"})}),e.jsx(F,{label:"Name",invalid:t.tagName&&s.tagName,errorMessage:t.tagName,children:e.jsx(k,{placeholder:"Tag Name",name:"tagName",type:"text",component:z})}),e.jsx(F,{invalid:t.colorName&&s.colorName,children:e.jsx(k,{invalid:t.colorName&&s.colorName,placeholder:"Color",name:"colorName",render:({field:j})=>e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:0},children:[e.jsx(me,{field:j}),t.colorName&&e.jsx("div",{style:{marginTop:15,marginLeft:5,color:"red"},children:t.colorName})]})})}),e.jsx("div",{children:e.jsx(R,{type:"submit",variant:"solid",children:"Submit"})})]})})})})})})},{Tr:P,Th:Ue,Td:Ye,THead:_e,TBody:Ge}=B,Je=({renderRowSubComponent:i,getRowCanExpand:d})=>{const l=w(),u=({row:o})=>{te();const g=()=>{l(V(!0)),l(H(o))},A=async()=>{await l(H(o)),l(K(!0))},je=async()=>{l(ce("Add")),l(O(!0)),l(H(o))};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex text-base items-center",children:[e.jsx(we,{title:"Add Tag",children:e.jsx("button",{className:" cursor-pointer circle items-center hover:text-green-500 mr-1",onClick:je,children:e.jsx(Pe,{})})}),e.jsx("button",{className:" cursor-pointer circle items-center hover:text-blue-500 ",onClick:g,children:e.jsx(se,{})}),e.jsx("span",{className:"cursor-pointer hover:text-red-500 mx-1 circle items-center",onClick:A,children:e.jsx(oe,{})})]})})},x=[10,25,50,100],a=C(o=>o.crmTagCategories.data.displayedTagCategoriesList),c=C(o=>o.crmTagCategories.data.loading),{pageIndex:r,pageSize:s,sort:t,query:n,total:h}=C(o=>o.crmTagCategories.data.tableData),j=y.useMemo(()=>({pageIndex:r,pageSize:s,sort:t,query:n,total:h}),[r,s,t,n,h]),N=y.useMemo(()=>[{header:()=>null,id:"expander",cell:({row:o})=>e.jsx(e.Fragment,{children:o.getCanExpand()?e.jsx("button",{className:"text-lg",onClick:o.getToggleExpandedHandler(),children:o.getIsExpanded()?e.jsx(Te,{}):e.jsx(be,{})}):null}),subCell:()=>null},{header:"Actions",id:"action",cell:o=>e.jsx(u,{row:o.row.original})},{header:"Category Name",accessorKey:"categoryName"},{header:"Module Name",accessorKey:"master.moduleName"},{header:"Created By",accessorKey:"createdBy",cell:o=>{var g,A;return`${(g=o.row.original.createdData)==null?void 0:g.firstName} ${(A=o.row.original.createdData)==null?void 0:A.lastName}`}}],[]),[p,T]=y.useState(a),f=y.useMemo(()=>x.map(o=>({value:o,label:`${o} / page`})),[x]);y.useEffect(()=>{const o=a==null?void 0:a.map(g=>({...g,subRows:g.tags}));T(o)},[a]);const b=re({data:p,columns:N,getRowCanExpand:d,getCoreRowModel:ie(),getExpandedRowModel:De(),manualPagination:!0,manualSorting:!0}),S=o=>{const g=Z(j);g.pageIndex=o,l(Q(g))},m=o=>{const g=Z(j);g.pageSize=Number(o),g.pageIndex=1,l(Q(g))},he=o=>{c||m==null||m(Number(o))},pe=o=>{c||S==null||S(o)};He("tagcategory","canCreate");const xe=()=>{l(L(!0))};return e.jsxs(e.Fragment,{children:[e.jsxs(fe,{loading:c&&(p==null?void 0:p.length)!==0,type:"cover",children:[e.jsx("div",{className:"md:flex items-center justify-end",children:e.jsx("div",{className:"mb-4",children:e.jsx(R,{size:"sm",onClick:xe,children:"Add New"})})}),e.jsxs(B,{children:[e.jsx(_e,{children:b.getHeaderGroups().map(o=>e.jsx(P,{children:o.headers.map(g=>e.jsx(Ue,{colSpan:g.colSpan,children:$(g.column.columnDef.header,g.getContext())},g.id))},o.id))}),c&&(p==null?void 0:p.length)===0?e.jsx(Se,{columns:N==null?void 0:N.length,avatarInColumns:[0],avatarProps:{width:28,height:28}}):e.jsx(Ge,{children:b.getRowModel().rows.map(o=>e.jsxs(y.Fragment,{children:[e.jsx(P,{children:o.getVisibleCells().map(g=>e.jsx("td",{children:$(g.column.columnDef.cell,g.getContext())},g.id))}),o.getIsExpanded()&&e.jsx(P,{children:e.jsx(Ye,{colSpan:o.getVisibleCells().length,children:i({row:o})})})]},o.id))})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx(Ie,{pageSize:s,currentPage:r,total:h,onChange:pe}),e.jsx("div",{style:{minWidth:130},children:e.jsx(ne,{size:"sm",menuPlacement:"top",isSearchable:!1,value:f==null?void 0:f.filter(o=>o.value===s),options:f,onChange:o=>he(o==null?void 0:o.value)})})]})]}),e.jsx(Ve,{}),e.jsx(ge,{}),e.jsx(Le,{}),e.jsx(ue,{})]})},Qe=()=>{const i=w(),d=C(a=>a.crmTagCategories.data.deleteSubTagConfirmation),l=C(a=>a.crmTagCategories.data.selectedTag),u=()=>{i(W(!1))},x=async()=>{var c,r,s;i(W(!1));const a=await i(Oe(l.id));(c=a==null?void 0:a.payload)!=null&&c.success?I.push(e.jsx(M,{title:"Successfuly Deleted",type:"success",duration:2500,children:(r=a==null?void 0:a.payload)==null?void 0:r.message}),{placement:"top-end"}):I.push(e.jsx(M,{title:"Something Went Wrong !!!",type:"danger",duration:2500,children:(s=a==null?void 0:a.error)==null?void 0:s.message}),{placement:"top-end"}),await i(E())};return e.jsx(de,{isOpen:d,type:"danger",title:"Delete Tag",confirmButtonColor:"red-600",onClose:u,onRequestClose:u,onCancel:u,onConfirm:x,children:e.jsx("p",{children:"Are you sure you want to delete this Tag? All record related to this tag will be deleted as well. This action cannot be undone."})})},{Tr:ae,Th:Xe,Td:Ze,THead:ea,TBody:aa,Sorter:ta}=B,sa=({row:i})=>{te();const d=()=>{l(ce("Edit")),l(O(!0)),l(X(i))},l=w(),u=async()=>{await l(X(i)),await l(W(!0))};return e.jsxs("div",{className:"flex text-base items-center",children:[e.jsx("button",{className:"circle items-center hover:text-blue-500",onClick:d,children:e.jsx(se,{})}),e.jsx("span",{className:"cursor-pointer hover:text-red-500 mx-1 circle items-center",onClick:u,children:e.jsx(oe,{})})]})},oa=i=>{const{tableData:d}=i,[l,u]=y.useState([]),[x,a]=y.useState(d),c=[{header:"Actions",id:"action",cell:s=>e.jsx(sa,{row:s.row.original})},{header:"Tag Name",accessorKey:"tagName"},{header:"Color",accessorKey:"colorName",cell:s=>{const t=s.row.original;return e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ce,{style:{backgroundColor:`${t.colorName}`}}),e.jsx("span",{className:"ml-2 rtl:mr-2 capitalize",children:t.colorName})]})}}];y.useEffect(()=>{a(d)},[d]);const r=re({data:x,columns:c,state:{sorting:l},onSortingChange:u,getCoreRowModel:ie(),getSortedRowModel:ve()});return e.jsxs(e.Fragment,{children:[e.jsxs(B,{children:[e.jsx(ea,{children:r.getHeaderGroups().map(s=>e.jsx(ae,{children:s.headers.map(t=>e.jsx(Xe,{colSpan:t.colSpan,children:t.isPlaceholder?null:e.jsxs("div",{className:t.column.getCanSort()?"cursor-pointer select-none":"",onClick:t.column.getToggleSortingHandler(),children:[$(t.column.columnDef.header,t.getContext()),e.jsx(ta,{sort:t.column.getIsSorted()})]})},t.id))},s.id))}),e.jsx(aa,{children:r.getRowModel().rows.slice(0,10).map(s=>e.jsx(ae,{children:s.getVisibleCells().map(t=>e.jsx(Ze,{children:$(t.column.columnDef.cell,t.getContext())},t.id))},s.id))})]}),e.jsx(Qe,{}),e.jsx(ue,{})]})},ra=({row:i})=>e.jsx("pre",{style:{fontSize:"10px"},children:e.jsx(oa,{tableData:i.original.tags})});ye("crmTagCategories",Be);const ia=()=>{const i=w(),d=async()=>{await i(E())};return y.useEffect(()=>{d()},[i]),e.jsxs(e.Fragment,{children:[e.jsx("h5",{className:"mb-2",children:"Manage Tags"}),e.jsx(Je,{renderRowSubComponent:ra,getRowCanExpand:()=>!0})]})},nt=ia;export{nt as T};
