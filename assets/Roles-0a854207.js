import{a as R,r as w,j as e,u as oe,B as Ce,ar as Ne}from"./index-04de45f1.js";import{A as Re}from"./AdaptableCard-b66d711f.js";import{D as De}from"./DataTable-26a56396.js";import{u as ie}from"./useThemeClass-d6175223.js";import{c as I}from"./cloneDeep-9e3b0d5b.js";import{f as ve,u as C,p as me,s as V,a as Se,b as O,c as Ie,g as T,d as z,e as de,h as pe,i as ke,j as ue,r as Me}from"./index-b352d657.js";import{B as q}from"./Button-c014eb4a.js";import{D as Fe}from"./Drawer-a2e296b0.js";import{i as Te}from"./Views-9d427d6f.js";import{u as Ae,c as re,d as le,F as Ee,a as Pe,b as Ve}from"./formik.esm-21613a47.js";import{T as xe}from"./index-d856057f.js";import{c as he,a as fe}from"./index.esm-7ed3d02a.js";import"./Alert-b77365f1.js";import"./index-d960fe16.js";import{B as je}from"./Badge-fd219ce7.js";import"./Calendar-3ea43322.js";import"./Card-5dadf163.js";import{C as ze}from"./index-746fa18b.js";import"./index-688929a7.js";import"./Dialog-94528cff.js";import"./index-34afd70e.js";import"./toString-85ae3482.js";import{I as ge}from"./Input-177911dc.js";import"./index-0dfb4b3d.js";import"./index-4e807dfb.js";import"./index-18e79e75.js";import"./toast-5c5a7d02.js";import"./Pagination-d7bd87b8.js";import"./Progress-500b53ea.js";import"./index-5445ceea.js";import"./RangeCalendar-31722222.js";import"./ScrollBar-9c40bad5.js";import"./index-eb3ec0a1.js";import{S as qe,c as Oe}from"./Select-8dd681ec.js";import"./Skeleton-74d23b60.js";import"./index-7626a7a3.js";import"./Switcher-51151d96.js";import"./index-f4f40370.js";import"./Tag-b89b8728.js";import"./index-8639ecda.js";import"./index-b1e5b8b7.js";import"./Tooltip-8263a1ca.js";import"./Upload-8284d175.js";/* empty css              */import{a6 as ne,B as Be,z as $e}from"./index.esm-dece01db.js";import{p as k,q as M}from"./index.esm-bec52084.js";import{d as Le}from"./debounce-72f24c40.js";import"./TableRowSkeleton-b8809059.js";import"./index-57d63c42.js";import"./_Uint8Array-51fedccd.js";import"./_MapCache-593c8f28.js";import"./_getPrototype-c53c6c29.js";import"./CrmService-1cd24b67.js";import"./context-3f43d22b.js";import"./index-ce7a2c9a.js";import"./CloseButton-c81f3a7a.js";import"./index-5206a52a.js";import"./useControllableState-517757cf.js";import"./useTimeout-352435f8.js";import"./StatusIcon-43cda077.js";import"./useMergeRef-788c4cb0.js";import"./_baseIsEqual-aab3701d.js";import"./get-e02c019e.js";import"./useRootClose-9c807e39.js";import"./usePopper-301f1b7b.js";import"./TimeInput-89c18d58.js";import"./useUniqueId-d1553e7a.js";import"./useDidUpdate-be24419c.js";import"./useUncertainRef-83c88a9e.js";import"./isNil-2d09164b.js";import"./chainedFunction-070f832c.js";import"./toConsumableArray-c4879a90.js";import"./objectWithoutPropertiesLoose-df62547b.js";import"./floating-ui.dom-bef9cea3.js";import"./mapCloneElement-022773c2.js";import"./index.esm-86efb1ff.js";import"./index.esm-31d11ed9.js";const F=({value:s,onClick:n,greenIcon:t,grayIcon:c,canPermission:o})=>e.jsx("td",{className:"px-4 py-2 text-center",children:e.jsx("div",{className:`${o?" border-blue-600":" border-red-300"} rounded-full p-2 cursor-pointer flex justify-center items-center`,onClick:n,children:o?t:c})}),Ye=s=>{const{roles:n,drawerMode:t}=s,c=R(),[o,p]=w.useState([]),[d,a]=w.useState([]),i=Ae();w.useEffect(()=>{async function m(){var r;try{const u=await c(ve()),x=(r=u==null?void 0:u.payload)==null?void 0:r.data.map(f=>({masterId:f.id,canCreate:!1,canModify:!1,canView:!1,canDelete:!1,canManage:!1}));t==="Edit"&&n&&Array.isArray(n.rolePermissions)&&[...n.rolePermissions].sort((l,h)=>l.masterId-h.masterId).forEach(l=>{const h=x.findIndex(D=>D.masterId===l.masterId);h!==-1&&(x[h]=l)}),i.setFieldValue("modules",x),a(x),p(u.payload.data)}catch(u){console.error("Error fetching modules:",u)}}m()},[c]),he().shape({rolename:fe().required("Role Name is required")});const y=(m,r,u,x)=>{const f=JSON.parse(JSON.stringify(i.values.modules));if(r!=="canManage")f[x][r]=u,f[x].canManage=f[x].canCreate&&f[x].canModify&&f[x].canView&&f[x].canDelete;else{const l={canManage:u,canCreate:u,canModify:u,canView:u,canDelete:u,masterId:m};f[x]=l}i.setFieldValue("modules",f)};return e.jsxs(e.Fragment,{children:[e.jsx(re,{label:"Role Name",children:e.jsx(le,{type:"text",autoComplete:"off",name:"roleName",placeholder:"Role Name",component:ge,prefix:e.jsx(ne,{className:"text-xl"})})}),e.jsx(re,{label:"System",children:e.jsx(le,{autoComplete:"off",name:"isSystem",placeholder:"System",component:ze,checked:i.values.isSystem,prefix:e.jsx(ne,{className:"text-xl"})})}),e.jsxs("table",{className:"w-full border-collapse ",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-200",children:[e.jsx("th",{className:"px-4 py-2 text-center",children:"Module"}),e.jsx("th",{className:"px-4 py-2 w-1/6 text-center",children:"All"}),e.jsx("th",{className:"px-4 py-2 w-1/6 text-center",children:"Read"}),e.jsx("th",{className:"px-4 py-2 w-1/6 text-center",children:"Write"}),e.jsx("th",{className:"px-4 py-2 w-1/6 text-center",children:"Update"}),e.jsx("th",{className:"px-4 py-2 w-1/6 text-center",children:"Delete"})]})}),e.jsx("tbody",{children:o==null?void 0:o.map((m,r)=>{var u,x,f,l,h,D,A,E,P,v,S,N,B,$,L,Y,H,U,J,K,_,W,G,Q,X,Z,ee,se,ae,te;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2 text-center",children:m==null?void 0:m.moduleName.toUpperCase()}),e.jsx(F,{value:(f=(x=(u=i.values)==null?void 0:u.modules)==null?void 0:x[r])==null?void 0:f.canManage,onClick:()=>{var j,g,b;return y(m.id,"canManage",!((b=(g=(j=i.values)==null?void 0:j.modules)==null?void 0:g[r])!=null&&b.canManage),r)},greenIcon:e.jsx(k,{className:"text-blue-600"}),grayIcon:e.jsx(M,{className:"text-red-500"}),canPermission:(D=(h=(l=i.values)==null?void 0:l.modules)==null?void 0:h[r])==null?void 0:D.canManage}),e.jsx(F,{value:(P=(E=(A=i.values)==null?void 0:A.modules)==null?void 0:E[r])==null?void 0:P.canView,onClick:()=>{var j,g,b;return y(m.id,"canView",!((b=(g=(j=i.values)==null?void 0:j.modules)==null?void 0:g[r])!=null&&b.canView),r)},greenIcon:e.jsx(k,{className:"text-blue-600"}),grayIcon:e.jsx(M,{className:"text-red-500"}),canPermission:(N=(S=(v=i.values)==null?void 0:v.modules)==null?void 0:S[r])==null?void 0:N.canView}),e.jsx(F,{value:(L=($=(B=i.values)==null?void 0:B.modules)==null?void 0:$[r])==null?void 0:L.canCreate,onClick:()=>{var j,g,b;return y(m.id,"canCreate",!((b=(g=(j=i.values)==null?void 0:j.modules)==null?void 0:g[r])!=null&&b.canCreate),r)},greenIcon:e.jsx(k,{className:"text-blue-600"}),grayIcon:e.jsx(M,{className:"text-red-500"}),canPermission:(U=(H=(Y=i.values)==null?void 0:Y.modules)==null?void 0:H[r])==null?void 0:U.canCreate}),e.jsx(F,{value:(_=(K=(J=i.values)==null?void 0:J.modules)==null?void 0:K[r])==null?void 0:_.canModify,onClick:()=>{var j,g,b;return y(m.id,"canModify",!((b=(g=(j=i.values)==null?void 0:j.modules)==null?void 0:g[r])!=null&&b.canModify),r)},greenIcon:e.jsx(k,{className:"text-blue-600"}),grayIcon:e.jsx(M,{className:"text-red-500"}),canPermission:(Q=(G=(W=i.values)==null?void 0:W.modules)==null?void 0:G[r])==null?void 0:Q.canModify}),e.jsx(F,{value:(ee=(Z=(X=i.values)==null?void 0:X.modules)==null?void 0:Z[r])==null?void 0:ee.canDelete,onClick:()=>{var j,g,b;return y(m.id,"canDelete",!((b=(g=(j=i.values)==null?void 0:j.modules)==null?void 0:g[r])!=null&&b.canDelete),r)},greenIcon:e.jsx(k,{className:"text-blue-600"}),grayIcon:e.jsx(M,{className:"text-red-500"}),canPermission:(te=(ae=(se=i.values)==null?void 0:se.modules)==null?void 0:ae[r])==null?void 0:te.canDelete})]},r)})})]})]})},He=he().shape({rolename:fe().required("Role Name is required")}),{TabNav:Ue,TabList:Je,TabContent:Ke}=xe,be=w.forwardRef((s,n)=>{const[t,c]=w.useState([]);R();const o=oe(d=>d.crmRoles.data.selectedRole),p=oe(d=>d.crmRoles.data.drawerMode);return e.jsx(Ee,{innerRef:n,initialValues:{roleName:p==="Edit"&&(o==null?void 0:o.roleName)||"",isSystem:p==="Edit"&&(o==null?void 0:o.isSystem)||!1,isDefault:(o==null?void 0:o.isDefault)||!1,modules:t},validationSchema:He,onSubmit:(d,{setSubmitting:a})=>{console.log("on submit called "),a(!1)},children:({touched:d,errors:a})=>e.jsx(Pe,{children:e.jsx(Ve,{children:e.jsxs(xe,{defaultValue:"roles",children:[e.jsx(Je,{children:e.jsx(Ue,{value:"roles",children:"Role Form"})}),e.jsx("div",{className:"p-6",children:e.jsx(Ke,{value:"roles",children:e.jsx(Ye,{touched:d,errors:a,roles:o,drawerMode:p})})})]})})})})});be.displayName="RolesForm";const ye=w.forwardRef((s,n)=>{const t=R(),c=C(a=>a.crmRoles.data.selectedRole),o=C(a=>a.crmRoles.data.rolesList),{id:p}=c,d=a=>{const{name:i,birthday:y,email:m,img:r,location:u,title:x,phoneNumber:f,facebook:l,twitter:h,pinterest:D,linkedIn:A}=a,E={name:i,email:m,img:r},P={location:u,title:x,birthday:Ce(y).format("DD/MM/YYYY"),phoneNumber:f,facebook:l,twitter:h,pinterest:D,linkedIn:A};let v=I(o),S={};v=v.map(N=>(N.id===p&&(N={...N,...E},N.personalInfo={...N.personalInfo,...P},S=N),N)),Te(S)||t(me(S)),t(V()),t(Se(v))};return e.jsx(be,{ref:n,roles:c,onFormSubmit:d})});ye.displayName="RolesEditContent";const _e=({onSaveClick:s,onCancel:n})=>e.jsxs("div",{className:"text-right w-full",children:[e.jsx(q,{size:"sm",className:"mr-2",onClick:n,children:"Cancel"}),e.jsx(q,{size:"sm",variant:"solid",onClick:s,children:"Save"})]}),We=()=>{const s=R(),n=C(a=>a.crmRoles.data.drawerOpen),t=C(a=>a.crmRoles.data.drawerMode),c=C(a=>a.crmRoles.data.selectedRole),o=()=>{s(V()),s(O({}))},p=w.useRef(null),d=async()=>{var i,y;const a=(i=p.current)==null?void 0:i.values;if(t==="ADD"){const m=await s(Ie(a));console.log(m,"response"),await s(V()),await s(T())}else{const m=c.id,r=await s(me({id:m,data:a}));console.log(r,"response"),await s(V()),await s(T())}(y=p.current)==null||y.submitForm()};return e.jsx(Fe,{isOpen:n,closable:!1,bodyClass:"p-0",footer:e.jsx(_e,{onCancel:o,onSaveClick:d}),onClose:o,onRequestClose:o,width:600,children:e.jsx(ye,{ref:p})})},Ge=({row:s})=>{const{textTheme:n}=ie(),t=R(),c=()=>{t(de()),t(O(s)),t(pe("Edit"))};return e.jsx("div",{className:`${n} cursor-pointer select-none font-semibold`,onClick:c,children:"Edit"})},Qe=({row:s})=>{const{textTheme:n}=ie(),t=R(),c=async()=>{await t(O(s)),await t(ke(s.id)),await t(T())};return e.jsx("div",{className:`${n} cursor-pointer select-none font-semibold text-red-500`,onClick:c,children:"Delete"})},Xe=()=>{const s=R(),n=C(l=>l.crmRoles.data.rolesList),t=C(l=>l.crmRoles.data.loading),c=C(l=>l.crmRoles.data.filterData),{pageIndex:o,pageSize:p,sort:d,query:a,total:i}=C(l=>l.crmRoles.data.tableData),y=w.useCallback(()=>{s(T())},[o,p,d,a,c,s]);w.useEffect(()=>{y()},[y,o,p,d,c]);const m=w.useMemo(()=>({pageIndex:o,pageSize:p,sort:d,query:a,total:i}),[o,p,d,a,i]),r=w.useMemo(()=>[{header:"Role Name",accessorKey:"tasksName",cell:l=>l.row.original.roleName,width:200},{header:"System",accessorKey:"isSystem",cell:l=>l.row.original.isSystem.toString(),width:200},{header:"Edit",id:"action",cell:l=>e.jsx(Ge,{row:l.row.original})},{header:"Delete",id:"delete",cell:l=>e.jsx(Qe,{row:l.row.original})}],[]),u=l=>{const h=I(m);h.pageIndex=l,s(z(h))},x=l=>{const h=I(m);h.pageSize=Number(l),h.pageIndex=1,s(z(h))},f=l=>{const h=I(m);h.sort=l,s(z(h))};return e.jsxs("div",{children:[e.jsx(De,{columns:r,data:n,skeletonAvatarColumns:[0],skeletonAvatarProps:{width:28,height:28},loading:t,pagingData:{total:m.total,pageIndex:m.pageIndex,pageSize:m.pageSize},onPaginationChange:u,onSelectChange:x,onSort:f}),e.jsx(We,{})]})},{Control:Ze}=Oe,ce=[{value:"",label:"All",color:"bg-gray-500"},{value:"active",label:"Active",color:"bg-emerald-500"},{value:"blocked",label:"Blocked",color:"bg-red-500"}],es=({innerProps:s,label:n,data:t,isSelected:c})=>e.jsxs("div",{className:`flex items-center justify-between p-2 cursor-pointer ${c?"bg-gray-100 dark:bg-gray-500":"hover:bg-gray-50 dark:hover:bg-gray-600"}`,...s,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(je,{innerClass:t.color}),e.jsx("span",{children:n})]}),c&&e.jsx(Be,{className:"text-emerald-500 text-xl"})]}),ss=({children:s,...n})=>{const t=n.getValue()[0];return e.jsxs(Ze,{...n,children:[t&&e.jsx(je,{className:"ltr:ml-4 rtl:mr-4",innerClass:t.color}),s]})},as=()=>{const s=R(),{status:n}=C(c=>c.crmRoles.data.filterData),t=c=>{s(ue({status:c==null?void 0:c.value}))};return e.jsx(qe,{options:ce,size:"sm",className:"mb-4 min-w-[130px]",components:{Option:es,Control:ss},value:ce.filter(c=>c.value===n),onChange:t})},we=w.forwardRef((s,n)=>{const{onInputChange:t}=s,c=Le(o,500);function o(d){t==null||t(d)}const p=d=>{c(d.target.value)};return e.jsx(ge,{ref:n,className:"max-w-md md:w-52 mb-4",size:"sm",placeholder:"Search",prefix:e.jsx($e,{className:"text-lg"}),onChange:p})});we.displayName="RolesTableSearch";const ts=()=>{const s=R(),n=w.useRef(null),t=C(a=>a.crmRoles.data.tableData),c=a=>{const i=I(t);i.query=a,i.pageIndex=1,typeof a=="string"&&a.length>1&&o(i),typeof a=="string"&&a.length===0&&o(i)},o=a=>{s(z(a)),s(T(a))},p=()=>{const a=I(t);a.query="",n.current&&(n.current.value=""),s(ue({status:""})),o(a)},d=()=>{s(de()),s(pe("ADD"))};return e.jsxs("div",{className:"md:flex items-center justify-between",children:[e.jsxs("div",{className:"md:flex items-center gap-4",children:[e.jsx(we,{ref:n,onInputChange:c}),e.jsx(as,{})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx(q,{size:"sm",className:"me-2",onClick:p,children:"Clear All"}),e.jsx(q,{size:"sm",onClick:d,children:"Add New"})]})]})};Ne("crmRoles",Me);const Sa=()=>e.jsx(e.Fragment,{children:e.jsxs(Re,{bodyClass:"h-full",children:[e.jsx(ts,{}),e.jsx(Xe,{})]})});export{Sa as default};
