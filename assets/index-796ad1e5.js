import{am as O,an as $,ao as B,ap as V,a as N,j as e,B as p,ar as A,r as L}from"./index-2a02f09f.js";import{C as M}from"./CalendarView-6d5b05a0.js";import{C as P}from"./Views-597fd265.js";import{I as z}from"./Input-4032ba6b.js";import{B as T}from"./Button-3d6c325f.js";import{S as W,c as U}from"./Select-e6a28a89.js";import{D as f}from"./index-cd684465.js";import{D as G}from"./Dialog-fa942d86.js";import{F as H,a as u}from"./FormItem-c05bb264.js";import{B as w}from"./Badge-ed31d9ee.js";import{h as _}from"./index-b6583a03.js";import{b as J}from"./CrmService-dd365f26.js";import{F as K,a as Q,b as g}from"./formik.esm-dba0dfcc.js";import{B as X}from"./index.esm-c61f0406.js";import{c as Y,a as C,e as D}from"./index.esm-d97e517c.js";import{c as j}from"./cloneDeep-f2fd7982.js";import"./context-ccc0a902.js";import"./isNil-68e69365.js";import"./get-c92f924e.js";import"./toString-8660963f.js";import"./_MapCache-dabc1c97.js";import"./toConsumableArray-648e2274.js";import"./objectWithoutPropertiesLoose-df62547b.js";import"./floating-ui.dom-bef9cea3.js";import"./useControllableState-1afbd3cb.js";import"./useMergeRef-788c4cb0.js";import"./Calendar-10f7bbb4.js";import"./useRootClose-245ef2ef.js";import"./usePopper-1bbb94fb.js";import"./CloseButton-1ba6d0ce.js";import"./RangeCalendar-f83aa7d5.js";import"./TimeInput-5e6b4bd8.js";import"./useUniqueId-5771e452.js";import"./useDidUpdate-63a48c56.js";import"./index-02c6e7a7.js";import"./index-30fffd86.js";import"./useTimeout-90c2003f.js";import"./useUncertainRef-cde3ec19.js";import"./_Uint8Array-49dd6612.js";import"./_getPrototype-63f10215.js";const F="crmCalendar",R=O(F+"/getEvents",async()=>(await J()).data),Z={loading:!1,eventList:[],dialogOpen:!1,selected:{type:""}},q=$({name:`${F}/state`,initialState:Z,reducers:{updateEvent:(t,o)=>{t.eventList=o.payload},openDialog:t=>{t.dialogOpen=!0},closeDialog:t=>{t.dialogOpen=!1},setSelected:(t,o)=>{t.selected=o.payload}},extraReducers:t=>{t.addCase(R.fulfilled,(o,m)=>{o.eventList=m.payload})}}),{updateEvent:y,openDialog:E,closeDialog:S,setSelected:k}=q.actions,ee=q.reducer,te=B({data:ee}),x=V,{Control:ae}=U,{useUniqueId:le}=_,h=[{value:"red",label:"red",color:"bg-red-500"},{value:"orange",label:"orange",color:"bg-orange-500"},{value:"amber",label:"amber",color:"bg-amber-500"},{value:"yellow",label:"yellow",color:"bg-yellow-500"},{value:"lime",label:"lime",color:"bg-lime-500"},{value:"green",label:"green",color:"bg-green-500"},{value:"emerald",label:"emerald",color:"bg-emerald-500"},{value:"teal",label:"teal",color:"bg-teal-500"},{value:"cyan",label:"cyan",color:"bg-cyan-500"},{value:"sky",label:"sky",color:"bg-sky-500"},{value:"blue",label:"blue",color:"bg-blue-500"},{value:"indigo",label:"indigo",color:"bg-indigo-500"},{value:"purple",label:"purple",color:"bg-purple-500"},{value:"fuchsia",label:"fuchsia",color:"bg-fuchsia-500"},{value:"pink",label:"pink",color:"bg-pink-500"},{value:"rose",label:"rose",color:"bg-rose-500"}],re=({innerProps:t,label:o,data:m,isSelected:s})=>e.jsxs("div",{className:`flex items-center justify-between p-2 ${s?"bg-gray-100 dark:bg-gray-500":"hover:bg-gray-50 dark:hover:bg-gray-600"}`,...t,children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(w,{className:m.color}),e.jsx("span",{className:"ml-2 rtl:mr-2 capitalize",children:o})]}),s&&e.jsx(X,{className:"text-emerald-500 text-xl"})]}),oe=({children:t,...o})=>{const m=o.getValue()[0];return e.jsxs(ae,{className:"capitalize",...o,children:[m&&e.jsx(w,{className:`${m.color} ltr:ml-4 rtl:mr-4`}),t]})},se=Y().shape({title:C().required("Event title Required"),startDate:D().required("Start Date Required"),endDate:D(),color:C().required("Color Required")}),ne=({submit:t})=>{const o=N(),m=x(a=>a.crmCalendar.data.dialogOpen),s=x(a=>a.crmCalendar.data.selected),v=le("event-"),b=()=>{o(S())},n=(a,l)=>{l(!1);const r={id:s.id||v,title:a.title,start:p(a.startDate).format(),eventColor:a.color};a.endDate&&(r.end=p(a.endDate).format()),t==null||t(r,s.type),o(S())};return e.jsxs(G,{isOpen:m,onClose:b,onRequestClose:b,children:[e.jsx("h5",{className:"mb-4",children:s.type==="NEW"?"Add New Event":"Edit Event"}),e.jsx("div",{children:e.jsx(K,{enableReinitialize:!0,initialValues:{title:s.title||"",startDate:s.start?p(s.start).toDate():"",endDate:s.end?p(s.end).toDate():"",color:s.eventColor||h[0].value},validationSchema:se,onSubmit:(a,{setSubmitting:l})=>{n(a,l)},children:({values:a,touched:l,errors:r})=>e.jsx(Q,{children:e.jsxs(H,{children:[e.jsx(u,{label:"User Name",invalid:r.title&&l.title,errorMessage:r.title,children:e.jsx(g,{type:"text",autoComplete:"off",name:"title",placeholder:"Please enter title",component:z})}),e.jsx(u,{label:"Start Date",invalid:r.startDate&&l.startDate,errorMessage:r.startDate,children:e.jsx(g,{name:"startDate",placeholder:"Date",children:({field:i,form:c})=>e.jsx(f,{field:i,form:c,value:i.value,onChange:d=>{c.setFieldValue(i.name,d)}})})}),e.jsx(u,{label:"End Date",invalid:r.endDate&&l.endDate,errorMessage:r.endDate,children:e.jsx(g,{name:"endDate",placeholder:"Date",children:({field:i,form:c})=>e.jsx(f,{field:i,form:c,value:i.value,onChange:d=>{c.setFieldValue(i.name,d)}})})}),e.jsx(u,{label:"Prefered",asterisk:!0,invalid:r.color&&l.color,errorMessage:r.color,children:e.jsx(g,{name:"color",children:({field:i,form:c})=>e.jsx(W,{field:i,form:c,options:h,value:h.filter(d=>d.value===a.color),components:{Option:re,Control:oe},onChange:d=>c.setFieldValue(i.name,d==null?void 0:d.value)})})}),e.jsx(u,{className:"mb-0 text-right rtl:text-left",children:e.jsx(T,{variant:"solid",type:"submit",children:"Submit"})})]})})})})]})};A("crmCalendar",te);const ie=()=>{const t=N(),o=x(n=>n.crmCalendar.data.eventList);L.useEffect(()=>{t(R())},[]);const m=n=>{const{start:a,end:l}=n;t(k({type:"NEW",start:p(a).format(),end:p(l).format()})),t(E())},s=n=>{const{start:a,end:l,id:r,title:i,extendedProps:c}=n.event;t(k({type:"EDIT",eventColor:c.eventColor,title:i,start:a,end:l,id:r})),t(E())},v=(n,a)=>{let l=j(o);a==="NEW"&&l.push(n),a==="EDIT"&&(l=l.map(r=>(n.id===r.id&&(r=n),r))),t(y(l))},b=n=>{const a=j(o).map(l=>{if(n.event.id===l.id){const{id:r,extendedProps:i,start:c,end:d,title:I}=n.event;l={id:r,start:p(c).format(),end:p(d).format(),title:I,eventColor:i.eventColor}}return l});t(y(a))};return e.jsxs(P,{className:"h-full",children:[e.jsx(M,{editable:!0,selectable:!0,events:o,eventClick:s,select:m,eventDrop:b}),e.jsx(ne,{submit:v})]})},Ke=ie;export{Ke as default};
