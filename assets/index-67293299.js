import{al as g,am as _,an as J,ao as X,r as h,j as o,a as N,ap as Y,aq as Z}from"./index-e30b2821.js";import{A as ee}from"./AdaptableCard-b9911837.js";import"./Views-64b223ad.js";import"./Badge-de325884.js";import"./chart.constant-2781d8ba.js";import"./chart.config-a0ce2d6f.js";import"./index-0327ff47.js";import{B as ae}from"./Button-7f51b5aa.js";import{D as te}from"./Dialog-947aeb41.js";import{D as se}from"./DataTable-94966960.js";import{I as oe}from"./Input-2c261c20.js";import"./GrowShrinkTag-81ab4f4c.js";import"./Skeleton-09e40cfd.js";import"./react-tooltip.min-3647c508.js";import"./RichTextEditor-1e959dd9.js";import"./SegmentItemOption-b1f0bb3f.js";import"./SvgIcon-533f1ac5.js";import{T as j}from"./Tooltip-4148a5c6.js";import{F as re}from"./FormDesription-184ab78d.js";import{u as L}from"./checkEditUpdate-02ebf296.js";import{c as T}from"./cloneDeep-1d9827ea.js";import{s as ne}from"./index-6ae21097.js";import{g as le}from"./index-05ab8d5e.js";import{s as ie,t as ce,h as de,u as pe,v as me,w as ge,l as ue,m as De,n as he,o as ye,p as G,q as fe}from"./CrmService-42c2fe6d.js";import{b as xe,P as Ce,Q as we}from"./index.esm-8b3184d4.js";import{d as be}from"./debounce-4a3ce893.js";import{T as je}from"./TagsList-337ffa26.js";import{T as f}from"./TextTruncate-fd98ed7e.js";import{u as Le}from"./useThemeClass-2717215d.js";import{t as k,N as q}from"./toast-840a302f.js";import{C as Te}from"./ConfirmDialog-d0893bcb.js";import{a as Se}from"./index.esm-bfa2a58b.js";import"./Alert-af1ef9c4.js";import"./RangeCalendar-52c9edad.js";import"./Card-99dac552.js";import"./index-813d88fe.js";import"./index-017925a1.js";import"./Drawer-512316c8.js";import"./index-bec78d8a.js";import"./FormItem-65da11c0.js";import"./toString-c9827e55.js";import"./index-96254e25.js";import"./index-b20af312.js";import"./index-a41ebc95.js";import"./Pagination-7a8e4a2f.js";import"./Progress-f1b3cd0a.js";import"./index-3660cee2.js";import"./ScrollBar-8849e487.js";import"./index-376e52ed.js";import"./Select-aa8bbc1c.js";import"./index-be44997b.js";import"./Switcher-058a0731.js";import"./index-3bedb6be.js";import"./index-992cb74f.js";import"./Tag-f4e18e1c.js";import"./index-c12e5611.js";import"./index-8e7844cf.js";import"./Upload-2e677169.js";import"./useMergeRef-788c4cb0.js";import"./index-85ad734e.js";import"./CloseButton-eaa8212e.js";import"./index-4d6ba2a7.js";import"./isNil-4b53f2ef.js";import"./get-53a32457.js";import"./_MapCache-e35f57ee.js";import"./floating-ui.dom-bef9cea3.js";import"./_baseIsEqual-435397ea.js";import"./usePopper-60810edb.js";import"./index.esm-7ff63e29.js";import"./index-aa71065b.js";import"./_getPrototype-18d03f40.js";import"./index-fe85553b.js";import"./index-06c9dfe2.js";import"./useTimeout-0dbf2c49.js";import"./StatusIcon-b75ecd57.js";import"./chainedFunction-070f832c.js";import"./useControllableState-610fbaba.js";import"./useRootClose-121cd6e5.js";import"./TimeInput-cb813c47.js";import"./useUniqueId-78294896.js";import"./useDidUpdate-e23da06a.js";import"./useUncertainRef-e5b747fb.js";import"./slicedToArray-2d4e1c7e.js";import"./objectWithoutProperties-8809bfcf.js";import"./toConsumableArray-07c3bb38.js";import"./mapCloneElement-85c9a3af.js";import"./index.esm-8f4487ea.js";import"./index.esm-d088d8ae.js";const Ne="crmDeals",I=g("crmDeals/data/getDealsStatistic",async()=>(await ie()).data),x=g("crmDeals/data/getDeals",async()=>(await ce()).data),B=g("crmContact/data/getContact",async()=>(await de()).data);g("crmDeals/data/editDeals",async({DealsId:a,updatedData:e})=>{var t,s;try{return(await pe(a,e)).data}catch(d){throw new Error((s=(t=d==null?void 0:d.response)==null?void 0:t.data)==null?void 0:s.message)}});const Ie=g("crmDeals/data/deleteDeals",async a=>{var e,t;try{return await me(a)}catch(s){throw new Error((t=(e=s==null?void 0:s.response)==null?void 0:e.data)==null?void 0:t.message)}});g("crmDeals/data/createDeals",async a=>{var e,t;try{return(await ge(a)).data}catch(s){throw new Error((t=(e=s==null?void 0:s.response)==null?void 0:e.data)==null?void 0:t.message)}});const Ae=g("crmDeals/data/getProduct",async a=>{var e,t;try{const s=await ue(a);return console.log({response:s}),s.data}catch(s){throw new Error((t=(e=s==null?void 0:s.response)==null?void 0:e.data)==null?void 0:t.message)}}),Ee=g("crmDeals/data/getSubByIdCategory",async a=>{var e,t;try{return(await De(a)).data}catch(s){throw new Error((t=(e=s==null?void 0:s.response)==null?void 0:e.data)==null?void 0:t.message)}}),Oe=g("crmDeals/data/getCategory",async()=>{var a,e;try{return(await he()).data}catch(t){throw new Error((e=(a=t==null?void 0:t.response)==null?void 0:a.data)==null?void 0:e.message)}});g("crmDeals/data/module",async()=>(await ye()).data);g("tag-category",async({id:a})=>(await G(a)).data);g("crmDeals/data/fetchTag",async({id:a})=>(await G(a)).data);g("crmDeals/data/createTag",async({masterId:a,colorName:e,tagName:t,tagCategoryId:s})=>(await fe({colorName:e,tagName:t,masterId:a,tagCategoryId:s})).data);const Re={total:0,pageIndex:1,pageSize:10,query:"",sort:{order:"",key:""}},ve={status:""},ze={loading:!1,statisticLoading:!1,DealsList:[],categoryList:[],productList:[],subCategoryList:[],displayedDealsList:[],statisticData:{},isDialogOpen:!1,tableData:Re,filterData:ve,drawerOpen:!1,selectedDeals:{},contactList:[],deleteConfirmation:!1},P=_({name:`${Ne}/state`,initialState:ze,reducers:{setTableData:(a,e)=>{const t=a.DealsList.filter(s=>{var d,n;return((d=s.contactData)==null?void 0:d.firstName.toLowerCase().includes(e.payload.query.toLowerCase()))||((n=s.contactData)==null?void 0:n.lastName.toLowerCase().includes(e.payload.query.toLowerCase()))||(s==null?void 0:s.title.toLowerCase().includes(e.payload.query.toLowerCase()))});a.tableData={...e.payload,total:t==null?void 0:t.length},a.displayedDealsList=t.slice(e.payload.pageSize*(e.payload.pageIndex-1),e.payload.pageSize*e.payload.pageIndex)},setDealsList:(a,e)=>{a.DealsList=e.payload},setFilterData:(a,e)=>{a.filterData=e.payload},setSelectedDeals:(a,e)=>{a.selectedDeals=e.payload},setDrawerOpen:a=>{a.drawerOpen=!0},setDialogToggle:(a,e)=>{a.isDialogOpen=e.payload},setDrawerClose:a=>{a.drawerOpen=!1},toggleDeleteConfirmation:(a,e)=>{a.deleteConfirmation=e.payload}},extraReducers:a=>{a.addCase(x.fulfilled,(e,t)=>{var s,d,n,p,c;e.DealsList=t.payload.data,e.tableData.total=(s=t.payload.data)==null?void 0:s.length,e.displayedDealsList=t.payload.data.slice(((d=e==null?void 0:e.tableData)==null?void 0:d.pageSize)*(((n=e==null?void 0:e.tableData)==null?void 0:n.pageIndex)-1),((p=e==null?void 0:e.tableData)==null?void 0:p.pageSize)*((c=e==null?void 0:e.tableData)==null?void 0:c.pageIndex)),e.loading=!1}).addCase(x.pending,e=>{e.loading=!0}).addCase(I.fulfilled,(e,t)=>{e.statisticData=t.payload,e.statisticLoading=!1}).addCase(I.pending,e=>{e.statisticLoading=!0}).addCase(B.fulfilled,(e,t)=>{e.contactList=t.payload.data,e.loading=!1}).addCase(B.pending,e=>{e.loading=!0}).addCase(Ee.fulfilled,(e,t)=>{e.subCategoryList=t==null?void 0:t.payload.data}).addCase(Oe.fulfilled,(e,t)=>{e.categoryList=t==null?void 0:t.payload.data}).addCase(Ae.fulfilled,(e,t)=>{e.productList=t==null?void 0:t.payload.data})}}),{setTableData:S,setDealsList:bt,setFilterData:jt,setSelectedDeals:A,setDrawerOpen:F,setDrawerClose:Lt,setDialogToggle:ke,toggleDeleteConfirmation:E}=P.actions,qe=P.reducer,Be=J({data:qe}),u=X,K=h.forwardRef((a,e)=>{const{onInputChange:t}=a,s=be(d,500);function d(p){t==null||t(p)}const n=p=>{s(p.target.value)};return o.jsx(oe,{ref:e,className:"max-w-md md:w-52 mb-4",size:"sm",placeholder:"Search",prefix:o.jsx(xe,{className:"text-lg"}),onChange:n})});K.displayName="DealTableSearch";const Ge=()=>{const a=N(),e=h.useRef(null),t=u(c=>{var m,C;return(C=(m=c.crmDeals)==null?void 0:m.data)==null?void 0:C.tableData}),s=L("Deal","canCreate"),d=c=>{const m=T(t);m.query=c,m.pageIndex=1,typeof c=="string"&&c.length>1&&n(m),typeof c=="string"&&c.length===0&&n(m)},n=c=>{a(c?S(c):x())},p=()=>{a(F()),a(A([])),a(ne("Add"))};return h.useEffect(()=>{async function c(){await a(le())}c()},[a]),o.jsxs("div",{className:"md:flex items-center justify-between",children:[o.jsx("div",{className:"md:flex items-center gap-4",children:o.jsx(K,{ref:e,onInputChange:d})}),o.jsx("div",{className:"mb-4",children:s&&o.jsx(ae,{size:"sm",onClick:p,children:"Add New"})})]})},Pe=()=>{const a=N(),e=u(n=>n.crmDeals.data.deleteConfirmation),t=u(n=>n.crmDeals.data.selectedDeals),s=()=>{a(E(!1))},d=async()=>{var p,c,m;a(E(!1));const n=await a(Ie(t.id));await a(x()),(p=n==null?void 0:n.payload)!=null&&p.success?k.push(o.jsx(q,{title:"Successfuly Deleted",type:"success",duration:2500,children:(c=n==null?void 0:n.payload)==null?void 0:c.message}),{placement:"top-end"}):k.push(o.jsx(q,{title:"Something Went Wrong !!!",type:"danger",duration:2500,children:(m=n==null?void 0:n.error)==null?void 0:m.message}),{placement:"top-end"}),await a(x()),await a(I())};return o.jsx(Te,{isOpen:e,type:"danger",title:"Delete Deal",confirmButtonColor:"red-600",onClose:s,onRequestClose:s,onCancel:s,onConfirm:d,children:o.jsx("p",{children:"Are you sure you want to delete this Deal? All record related to this Deal will be deleted as well. This action cannot be undone."})})},Fe=()=>{const a=N(),e=u(l=>l.crmDeals.data.displayedDealsList),t=u(l=>l.crmDeals.data.loading),s=u(l=>l.crmDeals.data.isDialogOpen),{pageIndex:d,pageSize:n,sort:p,query:c,total:m}=u(l=>l.crmDeals.data.tableData),C=h.useCallback(()=>{a(x())},[a]);h.useEffect(()=>{C()},[C]);const y=h.useMemo(()=>({pageIndex:d,pageSize:n,sort:p,query:c,total:m}),[d,n,p,c,m]);u(l=>l.crmDeals.data.selectedDeals);const O=L("Deal","canDelete"),R=L("Deal","canModify"),M=L("Deal","canView"),$=Y(),H=({row:l})=>{const r=N();Le();const i=()=>{r(F()),r(A(l))},D=async()=>{await r(A(l)),r(E(!0))},w=()=>{const b=`/app/crm/deal-details/${l.id}`;$(b)};return o.jsxs("div",{className:"flex text-base items-center",children:[R&&o.jsx("button",{disabled:(l==null?void 0:l.status)!=="open",className:`circle items-center ${(l==null?void 0:l.status)!=="open"?"!cursor-not-allowed":"cursor-pointer hover:text-indigo-500"}`,onClick:i,children:o.jsx(Ce,{})}),M&&o.jsx("span",{className:"cursor-pointer  hover:text-green-500 circle mx-1 items-center text-lg",onClick:w,children:o.jsx(Se,{})}),O&&o.jsx("span",{className:"cursor-pointer hover:text-red-500 mx-1 circle items-center",onClick:D,children:o.jsx(we,{})})]})},V=h.useMemo(()=>[{header:"Action",id:"action",cell:r=>o.jsx(H,{row:r.row.original})},{header:"Contact Name",accessorKey:"contactName",cell:r=>{var D,w,b,v,z;const i=(D=r.row.original)!=null&&D.contactData?((b=(w=r.row.original)==null?void 0:w.contactData)==null?void 0:b.firstName)+" "+((z=(v=r.row.original)==null?void 0:v.contactData)==null?void 0:z.lastName):"-";return o.jsx(f,{text:i,maxLength:20})}},{header:"Title",accessorKey:"title",cell:r=>{const i=r.row.original.title;return o.jsx(j,{title:i,children:o.jsx(f,{text:i,maxLength:20})},i)}},{header:"Budget",accessorKey:"budget",cell:r=>{const i=r.row.original;return o.jsx(f,{text:i.budget,maxLength:20})}},{header:"Tag Name",accessorKey:"tagName",cell:r=>{const i=r.row.original.tags;return i!=null&&i.length>0?o.jsx(je,{tags:i}):"-"}},{header:"Notes",accessorKey:"description",cell:r=>{const i=r.row.original.description?r.row.original.description:"-";return o.jsx(j,{title:i,children:o.jsx(f,{text:i,maxLength:20})},i)}},{header:"Reason",accessorKey:"reason",cell:r=>{var D;const i=(D=r.row.original)==null?void 0:D.reason;return i?o.jsx(j,{title:i,children:o.jsx(f,{text:i,maxLength:20})},i):o.jsx(j,{title:i,children:o.jsx(f,{text:"NA",maxLength:20})},i)}}],[R,O]),W=l=>{const r=T(y);r.pageIndex=l,a(S(r))},Q=l=>{const r=T(y);r.pageSize=Number(l),r.pageIndex=1,a(S(r))},U=l=>{const r=T(y);r.sort=l,a(S(r))};return o.jsxs("div",{children:[o.jsx(se,{columns:V,data:e,skeletonAvatarColumns:[0],skeletonAvatarProps:{width:28,height:28},loading:t,pagingData:{total:y.total,pageIndex:y.pageIndex,pageSize:y.pageSize},onPaginationChange:W,onSelectChange:Q,onSort:U}),o.jsx(Pe,{}),o.jsx(te,{isOpen:s,onClose:()=>a(ke(!1)),children:o.jsx("h5",{className:"mb-4",children:"Enter Reason"})})]})};Z("crmDeals",Be);const Ke=()=>{const a=u(e=>e.crmDeals.data.displayedDealsList);return o.jsxs(ee,{bodyClass:"h-full",children:[o.jsx(re,{title:`Deals (${(a==null?void 0:a.length)||0})`,desc:"",className:"mb-2"}),o.jsx(Ge,{}),o.jsx(Fe,{})]})},Tt=Ke;export{Tt as default};
