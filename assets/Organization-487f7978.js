import{am as I,an as oa,ao as da,ap as ca,a as q,r as L,j as a,c as la,aq as ma,ah as pa}from"./index-814886c9.js";import{S as X}from"./StickyFooter-10209310.js";import"./Alert-b0f262ad.js";import"./index-44a5db3e.js";import"./Badge-6740e82e.js";import{B as D}from"./Button-3b704f3e.js";import"./RangeCalendar-dfea7372.js";import"./Card-dd06927c.js";import"./index-b7e31a2e.js";import"./index-48f4e996.js";import{D as ga}from"./Dialog-7b46051f.js";import"./Drawer-11d68f58.js";import"./index-247a4da4.js";import{a as f,F as Z}from"./FormItem-718faadb.js";import"./toString-dfebe446.js";import{I as v}from"./Input-2049b051.js";import"./index-ef1708cf.js";import"./index-b0a87e1b.js";import"./index-d04fa1a2.js";import{t as $,N as T}from"./toast-208340c6.js";import"./Pagination-9fd494c1.js";import"./Progress-e2f778d5.js";import"./index-0b2c26a4.js";import"./ScrollBar-86fa4e32.js";import"./index-1a150266.js";import{S as ua}from"./Select-b3f832ed.js";import"./Skeleton-f103a7cb.js";import"./index-40caa853.js";import{S as ha}from"./Switcher-e40ff6b0.js";import"./index-d9751af2.js";import"./index-f1114e94.js";import{T as fa}from"./Tag-d328000b.js";import"./index-fd153dc3.js";import"./index-45d98e78.js";import"./Tooltip-07e1f3da.js";import"./Upload-befa0358.js";import{i as xa}from"./isLastChild-83eb4c23.js";import{F as ba}from"./FormDesription-20959162.js";import{F as ya}from"./FormRow-7891ca2f.js";import{u as ja,b as j,F as U,a as aa}from"./formik.esm-fe25dc70.js";import{c as Na}from"./cloneDeep-3031fb0b.js";import{A as ea,c as wa}from"./index.esm-6ecb1cd0.js";import{S as Oa,ad as Ca}from"./index.esm-d47a8d30.js";import{R as ta}from"./index.esm-3af0b46d.js";import{c as sa,a as S,d as za}from"./index.esm-48ebf711.js";import{ab as va,ac as Ea,ad as Sa,ae as Ia,af as Da,ag as ka,T as Ma}from"./CrmService-9aed65a4.js";/* empty css              */import{B as Fa}from"./index.esm-cc12ad2c.js";import"./Views-fed2ee34.js";import"./chart.constant-2e14b09f.js";import"./GrowShrinkTag-7335a295.js";import"./DataTable-3c3dbcc0.js";import"./react-tooltip.min-6c3ed628.js";import{R as Aa}from"./RichTextEditor-ad8e3931.js";import"./SegmentItemOption-a23af702.js";import"./SvgIcon-19ec43ce.js";import{G as Ba}from"./index.esm-2e56a7d2.js";import{b as La}from"./index.esm-4ad154d0.js";import{T as Ra}from"./index.esm-2390b5a0.js";const qa="crmOrganizations",M=I("crmOrganizations/data/organization",async()=>(await va()).data),H=I("crmOrganizations/data/editOrganization",async({organizationId:s,updatedData:e})=>{var t,r;try{return(await Ea(s,e)).data}catch(i){throw new Error((r=(t=i==null?void 0:i.response)==null?void 0:t.data)==null?void 0:r.message)}}),F=I("crmOrganizations/data/organization-branches",async()=>(await Sa()).data),V=I("crmOrganizations/data/editBranch",async({branchId:s,updatedData:e})=>{var t,r;try{return(await Ia(s,e)).data}catch(i){throw new Error((r=(t=i==null?void 0:i.response)==null?void 0:t.data)==null?void 0:r.message)}}),$a=I("crmOrganizations/data/createBranch",async s=>{var e,t;try{return(await Da(s)).data}catch(r){throw new Error((t=(e=r==null?void 0:r.response)==null?void 0:e.data)==null?void 0:t.message)}});I("crmOrganizations/data/organization",async s=>{var e,t;try{return(await ka(s)).data}catch(r){throw new Error((t=(e=r==null?void 0:r.response)==null?void 0:e.data)==null?void 0:t.message)}});const Q=I("crmOrganizations/data/getUsers",async()=>{var s,e;try{return(await Ma()).data}catch(t){throw new Error((e=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:e.message)}}),Ta={organizationData:[],loading:!1,statisticLoading:!1,branchList:[],isDialogOpen:!1,selectedBranch:{},deleteConfirmation:!1,usersList:[],dialogMode:"Add"},ra=oa({name:`${qa}/state`,initialState:Ta,reducers:{setBranchList:(s,e)=>{s.branchList=e.payload},setSelectedBranch:(s,e)=>{s.selectedBranch=e.payload},setDialogToggle:(s,e)=>{s.isDialogOpen=e.payload},toggleDeleteConfirmation:(s,e)=>{s.deleteConfirmation=e.payload},setUsersList:(s,e)=>{s.usersList=e.payload},setDialogMode:(s,e)=>{s.dialogMode=e.payload}},extraReducers:s=>{s.addCase(M.fulfilled,(e,t)=>{e.organizationData=t.payload.data,e.loading=!1}).addCase(M.pending,e=>{e.loading=!0}).addCase(Q.fulfilled,(e,t)=>{e.usersList=t.payload.data,e.loading=!1}).addCase(F.fulfilled,(e,t)=>{e.branchList=t.payload.data,e.loading=!1}).addCase(F.pending,e=>{e.statisticLoading=!0}).addCase(V.fulfilled,(e,t)=>{e.loading=!1}).addCase(V.pending,e=>{e.loading=!0}).addCase(H.fulfilled,(e,t)=>{e.loading=!1}).addCase(H.pending,e=>{e.loading=!0})}}),{setBranchList:Ha,setSelectedBranch:Va,setDialogToggle:k,setUsersList:et,setDialogMode:K,toggleDeleteConfirmation:tt}=ra.actions,Qa=ra.reducer,Ga=da({data:Qa}),O=ca,w=[],Pa=s=>{const{touched:e,errors:t,setFieldValue:r,values:i}=s,l=q();L.useEffect(()=>{(async()=>{await l(Q())})()},[l]);const d=O(n=>{var N,E;return(E=(N=n.crmOrganizations)==null?void 0:N.data)==null?void 0:E.usersList});w.length=0,d==null||d.forEach(n=>{w==null||w.push({label:`${n==null?void 0:n.firstName} ${n==null?void 0:n.lastName}`,value:n.id})});const m=()=>{l(k(!1))},C=ja();return a.jsxs(a.Fragment,{children:[a.jsx(f,{label:"Branch Name",invalid:t.branchName&&e.branchName,errorMessage:t.branchName,children:a.jsx(j,{type:"text",autoComplete:"off",name:"branchName",placeholder:"Branch Name",component:v,prefix:a.jsx(ta,{className:"text-xl"})})}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsx("div",{className:"col-span-1",children:a.jsx(f,{label:"Branch Owner",invalid:t.branchOwnerId&&e.branchOwnerId,errorMessage:t.branchOwnerId,children:a.jsx(ua,{name:"branchOwnerId",placeholder:"Branch Owner",options:w,id:"branchOwnerId",value:w==null?void 0:w.find(n=>(n==null?void 0:n.value)===(i==null?void 0:i.branchOwnerId)),onChange:n=>{const N=n==null?void 0:n.value;r("branchOwnerId",N)}})})}),a.jsx("div",{className:"col-span-1",children:a.jsx(f,{label:"Contact Number",invalid:t.contact&&e.contact,errorMessage:t.contact,children:a.jsx(j,{type:"text",autoComplete:"off",name:"contact",placeholder:"Contact",component:v,prefix:a.jsx(Fa,{className:"text-xl"})})})})]}),a.jsx(f,{children:a.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[a.jsx("label",{className:"form-label",style:{marginRight:"10px"},children:"Head Quarter"}),a.jsx(j,{autoComplete:"off",name:"isHeadQuarter",component:ha,checked:C.values.isHeadQuarter})]})}),a.jsx(f,{label:"Address",invalid:t.addressInformation&&e.addressInformation,errorMessage:t.addressInformation,children:a.jsx(j,{type:"text",autoComplete:"off",name:"addressInformation",placeholder:"Address",component:v,prefix:a.jsx(Oa,{className:"text-xl"})})}),a.jsx(X,{className:" px-8 flex items-center justify-between py-4",stickyClass:"border-t bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700",children:a.jsxs("div",{className:"md:flex items-center",children:[a.jsx(D,{size:"sm",className:"ltr:mr-3 rtl:ml-3",type:"button",onClick:m,children:"Cancel"}),a.jsx(D,{size:"sm",type:"submit",variant:"solid",icon:a.jsx(ea,{}),children:"Save"})]})})]})},Wa=sa().shape({branchName:S().required("Details are required"),contact:S().typeError("Contact must be a number").required("Contact is required").test("is-number","Contact must be a number",s=>!isNaN(s)).test("is-ten-digits"," Contact must be exactly 10 digits",s=>{if(s){const e=Number(s);return/^\d{10}$/.test(e.toString())}return!0}).test("is-not-more-than-ten-digits","Contact must not exceed 10 digits",s=>s?Number(s).toString().length<=10:!0),addressInformation:S(),isHeadQuarter:S(),branchOwnerId:S().required("This field is required").test("is-valid-contact","Invalid contact selected",s=>!!w.find(e=>e.value==s))}),ia=L.forwardRef((s,e)=>{const t=q(),r=O(l=>l.crmOrganizations.data.dialogMode),i=O(l=>{var d,m;return(m=(d=l.crmOrganizations)==null?void 0:d.data)==null?void 0:m.selectedBranch});return a.jsx(U,{innerRef:e,initialValues:{branchName:r==="Edit"?i==null?void 0:i.branchName:"",branchOwnerId:r==="Edit"?i==null?void 0:i.branchOwnerId:"",addressInformation:r==="Edit"?i==null?void 0:i.addressInformation:"",contact:r==="Edit"?i==null?void 0:i.contact:null,isHeadQuarter:r==="Edit"?i==null?void 0:i.isHeadQuarter:!1},validationSchema:Wa,onSubmit:async(l,{setSubmitting:d})=>{var m,C,n,N,E,R;if(r==="Add"){const o=await t($a(l));let x="",b="",y="";(m=o==null?void 0:o.payload)!=null&&m.success?(x="Successfully Added",b=(C=o==null?void 0:o.payload)==null?void 0:C.message,y="success"):(x="Something went wrong !!!",b=(n=o==null?void 0:o.error)==null?void 0:n.message,y="danger"),$.push(a.jsx(T,{title:x,type:y,duration:2500,children:b}),{placement:"top-end"}),t(k(!1)),await t(M()),await t(F()),d(!1)}else{const o=await t(V({branchId:i==null?void 0:i.id,updatedData:l}));let x="",b="",y="";(N=o==null?void 0:o.payload)!=null&&N.success?(x="Successfully Added",b=(E=o==null?void 0:o.payload)==null?void 0:E.message,y="success"):(x="Something went wrong !!!",b=(R=o==null?void 0:o.error)==null?void 0:R.message,y="danger"),$.push(a.jsx(T,{title:x,type:y,duration:2500,children:b}),{placement:"top-end"}),t(k(!1)),await t(M()),await t(F()),d(!1)}},children:({touched:l,errors:d,values:m,setFieldValue:C})=>a.jsx(aa,{children:a.jsx(Z,{children:a.jsx(Pa,{touched:l,errors:d,setFieldValue:C,values:m})})})})});ia.displayName="BranchesMainForm";const _a=s=>{const{values:e,touched:t,errors:r}=s;return a.jsxs(a.Fragment,{children:[a.jsx("h5",{children:"Organizations"}),a.jsx("p",{className:"mb-6",children:"Section to config the organizations attribute"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsx("div",{className:"col-span-1",children:a.jsx(f,{label:"Organization Name",invalid:r.organizationName&&t.organizationName,errorMessage:r.organizationName,children:a.jsx(j,{type:"text",autoComplete:"off",name:"organizationName",placeholder:"Organization Name",component:v,prefix:a.jsx(Ba,{className:"text-xl"})})})}),a.jsx("div",{className:"col-span-1",children:a.jsx(f,{label:"Industry",invalid:r.industry&&t.industry,errorMessage:r.industry,children:a.jsx(j,{type:"text",autoComplete:"off",name:"industry",value:e.industry,placeholder:"Organization Industry",component:v})})})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsx("div",{className:"col-span-1",children:a.jsx(f,{label:"Contact",invalid:r.contact&&t.contact,errorMessage:r.contact,children:a.jsx(j,{type:"number",autoComplete:"off",name:"contact",placeholder:"Contact",component:v,prefix:a.jsx(Ra,{className:"text-xl"})})})}),a.jsx("div",{className:"col-span-1",children:a.jsx(f,{label:"Website",invalid:r.website&&t.website,errorMessage:r.website,children:a.jsx(j,{type:"test",autoComplete:"off",name:"website",placeholder:"Website",component:v,prefix:a.jsx(La,{className:"text-xl"})})})})]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:a.jsx("div",{className:"col-span-1",children:a.jsx(f,{label:"Number Of Employees",invalid:r.numberOfEmployees&&t.numberOfEmployees,errorMessage:r.numberOfEmployees,children:a.jsx(j,{type:"number",autoComplete:"off",name:"numberOfEmployees",placeholder:"Number Of Employees",component:v,prefix:a.jsx(wa,{className:"text-xl"})})})})}),a.jsx(f,{label:"Description",labelClass:"!justify-start",invalid:r.notes&&t.notes,errorMessage:r.notes,children:a.jsx(j,{name:"notes",children:({field:i,form:l})=>a.jsx(Aa,{value:i.value,onChange:d=>l.setFieldValue(i.name,d)})})})]})},Ya=sa().shape({organizationName:S().required("Organization Name Required"),industry:S().required("Industry Required"),contact:za().typeError("Contact must be a number").required("Contact is required").test("is-number","Contact must be a number",s=>!isNaN(s)).test("is-ten-digits"," Contact must be exactly 10 digits",s=>{if(s){const e=Number(s);return/^\d{10}$/.test(e.toString())}return!0}).test("is-not-more-than-ten-digits","Contact must not exceed 10 digits",s=>s?Number(s).toString().length<=10:!0)}),na=L.forwardRef((s,e)=>{var x,b,y,G,P,W;const t=q(),r=O(c=>{var p,g;return(g=(p=c.crmOrganizations)==null?void 0:p.data)==null?void 0:g.organizationData});L.useEffect(()=>{(async()=>{var g;const p=await t(F());t(Ha((g=p==null?void 0:p.payload)==null?void 0:g.data)),await t(Q()),await t(F())})()},[t]);const i=O(c=>c.crmOrganizations.data.usersList),{type:l,onFormSubmit:d,onDiscard:m}=s,C=O(c=>c.crmOrganizations.data.isDialogOpen),n=O(c=>c.crmOrganizations.data.branchList),N=O(c=>c.crmOrganizations.data.dialogMode),E=()=>{t(k(!1))},R=()=>{t(k(!0)),t(K("Add"))},o=c=>{t(k(!0)),t(Va(c)),t(K("Edit"))};return a.jsxs(a.Fragment,{children:[a.jsx(U,{innerRef:e,initialValues:{organizationName:((x=r[0])==null?void 0:x.organizationName)||"",industry:((b=r[0])==null?void 0:b.industry)||"",contact:((y=r[0])==null?void 0:y.contact)||null,website:((G=r[0])==null?void 0:G.website)||"",numberOfEmployees:((P=r[0])==null?void 0:P.numberOfEmployees)||null,notes:((W=r[0])==null?void 0:W.notes)||""},validationSchema:Ya,onSubmit:async(c,{setSubmitting:p})=>{var z,_,Y,J;const g=Na(c),u=await t(H({organizationId:(z=r[0])==null?void 0:z.id,updatedData:g}));let A="",h="",B="";(_=u==null?void 0:u.payload)!=null&&_.success?(A="Successfully Added",h=(Y=u==null?void 0:u.payload)==null?void 0:Y.message,B="success"):(A="Something went wrong !!!",h=(J=u==null?void 0:u.error)==null?void 0:J.message,B="danger"),$.push(a.jsx(T,{title:A,type:B,duration:2500,children:h}),{placement:"top-end"}),await t(M()),d==null||d(g,p)},children:({values:c,touched:p,errors:g,isSubmitting:u})=>{const A={touched:p,errors:g};return a.jsx(aa,{children:a.jsxs(Z,{children:[a.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:a.jsx("div",{className:"lg:col-span-4",children:a.jsx(_a,{touched:p,errors:g,values:c})})}),a.jsx(ba,{title:" Branches",desc:"You can update your branches information here"}),a.jsxs(ya,{name:"branches",alignCenter:!0,label:"",...A,children:[a.jsx("div",{className:"rounded-lg border border-gray-200 dark:border-gray-600",children:n==null?void 0:n.map((h,B)=>a.jsxs("div",{className:la("flex items-center justify-between p-4",!xa(n,B)&&"border-b border-gray-200 dark:border-gray-600"),children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx(ta,{}),a.jsx("div",{className:"ml-3 rtl:mr-3",children:a.jsxs("div",{className:"flex items-center",children:[a.jsxs("div",{className:"text-gray-900 dark:text-gray-100 font-semibold",children:[h.branchName," ",i!=null&&i.find(z=>z.id===h.branchOwnerId)?`${i.find(z=>z.id===h.branchOwnerId).firstName} ${i.find(z=>z.id===h.branchOwnerId).lastName}`:""]}),h.isHeadQuarter&&a.jsx(fa,{className:"bg-sky-100 text-sky-600 dark:bg-sky-500/20 dark:text-sky-100 rounded-md border-0 mx-2",children:a.jsxs("span",{className:"capitalize",children:[" ","Head Quarter"," "]})})]})})]}),a.jsx("div",{className:"flex",children:a.jsx(D,{size:"sm",type:"button",onClick:()=>o(h),children:"Edit"})})]},h.id))}),a.jsx("div",{className:"mt-2",children:a.jsx(D,{type:"button",variant:"plain",size:"sm",icon:a.jsx(Ca,{className:"text-lg"}),onClick:()=>R(),children:a.jsx("span",{className:"font-semibold",children:"Add new branch"})})})]}),a.jsx(X,{className:"-mx-8 px-8 flex items-center justify-between py-4",stickyClass:"border-t bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700",children:a.jsxs("div",{className:"md:flex items-center",children:[a.jsx(D,{size:"sm",className:"ltr:mr-3 rtl:ml-3",type:"button",onClick:()=>m==null?void 0:m(),children:"Discard"}),a.jsx(D,{size:"sm",variant:"solid",loading:u,icon:a.jsx(ea,{}),type:"submit",children:"Save"})]})})]})})}}),a.jsxs(ga,{isOpen:C,onClose:E,children:[a.jsxs("h5",{className:"mb-4",children:[N==="Edit"?"Edit":"Add New"," Branch"]}),a.jsx(ia,{})]})]})});na.displayName="OrganizationForm";ma("crmOrganizations",Ga);const Ja=()=>{const s=q(),e=O(t=>t.crmOrganizations.data.loading);return L.useEffect(()=>{s(M())},[]),a.jsx(a.Fragment,{children:a.jsx(pa,{loading:e,children:a.jsx(na,{type:"edit",onFormSubmit:function(t,r){r(!1)}})})})},st=Ja;export{st as O};
