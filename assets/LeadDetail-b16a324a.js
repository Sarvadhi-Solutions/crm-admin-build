import{al as F,am as J,an as Q,ao as Z,a as T,r as C,j as t,ap as ee,aq as V,at as te,ah as se}from"./index-3e8ea6f8.js";import{C as oe,i as Y}from"./Views-cc709248.js";import{h as ie,i as re,j as le,k as ae}from"./CrmService-cfe882b2.js";import{A as $}from"./AdaptableCard-188bda95.js";import"./Badge-eeedee10.js";import"./chart.constant-85777c77.js";import"./GrowShrinkTag-c04fc29b.js";import"./index-1d299906.js";import{B as R}from"./Button-76f1570d.js";import{D as ne}from"./Dialog-52f96620.js";import{D as ce}from"./DataTable-5e8afa6a.js";import{D as me}from"./DoubleSidedImage-a9aeb3e6.js";import{I as de}from"./Input-fcdfcb5e.js";import"./Skeleton-32fefde5.js";import"./react-tooltip.min-3fffe7ac.js";import"./RichTextEditor-aa042621.js";import"./SegmentItemOption-538b3009.js";import"./SvgIcon-bcf0c327.js";import{T as pe}from"./Tooltip-cd4efb66.js";import{N as ue,L as ge}from"./LeadActivity-3f258ba5.js";import"./Alert-7c38cc47.js";import"./RangeCalendar-39ffd35c.js";import{C as he}from"./Card-f647d961.js";import"./index-0e62fb49.js";import"./index-82e9f824.js";import"./Drawer-0605b25d.js";import"./index-644264f8.js";import{F as xe,a as fe}from"./FormItem-cd2f592d.js";import"./toString-11f799aa.js";import"./index-d5aa1b1d.js";import"./index-8027bcf5.js";import"./index-8a954033.js";import{t as S,N as A}from"./toast-7ff9f8c4.js";import"./Pagination-96c1f0d2.js";import"./Progress-11481b60.js";import"./index-c8dfa8be.js";import"./ScrollBar-080eb132.js";import"./index-bf896e9f.js";import"./Select-3f8173b3.js";import"./index-132323ef.js";import"./Switcher-0d6c2ebf.js";import"./index-6e2d0c70.js";import"./index-6ac68218.js";import"./Tag-d66306a5.js";import"./index-8dfb88a1.js";import"./index-195fe53b.js";import"./Upload-73ca2c13.js";import{a as je}from"./index.esm-46e7ba4d.js";import{I as ye}from"./index.esm-1a6a7bf2.js";import{F as De,a as Ne,b as we,c as Ce}from"./formik.esm-07b32d21.js";import{c as Le,a as be}from"./index.esm-f87d0251.js";import{u as B,m as W}from"./TagCategoryDetailsForm-779eed6c.js";import{C as X}from"./ConfirmDialog-f6dece80.js";import{S as K}from"./StatusCapsule-efe3e5e6.js";import{T as ve}from"./TagsList-4c54aa9b.js";import{P as Se}from"./index.esm-9f04789b.js";import{u as Ae,d as Te,a as _,k as ke,g as Ee}from"./index-a58ba9eb.js";import{T as O}from"./TextTruncate-996b47c0.js";import{c as q}from"./cloneDeep-682c094b.js";import{r as Me,u as E,g as Ie,a as M}from"./index-bc41d870.js";import{h as Fe}from"./moment-fbc5633a.js";import{u as z}from"./checkEditUpdate-50871c95.js";import"./useMergeRef-788c4cb0.js";import"./index-d6f80d82.js";import"./CloseButton-64a34d57.js";import"./index-67b94fe2.js";import"./isNil-9b846371.js";import"./get-cefdaee1.js";import"./_MapCache-3ab7a0d7.js";import"./floating-ui.dom-bef9cea3.js";import"./_baseIsEqual-88c079cd.js";import"./useThemeClass-dcc2d2c0.js";import"./usePopper-43e347b2.js";import"./index.esm-66cb0ca3.js";import"./index-2bce6170.js";import"./useTimeout-b972535c.js";import"./StatusIcon-d01ba88d.js";import"./useControllableState-7991db37.js";import"./useRootClose-c072e07a.js";import"./TimeInput-4555e543.js";import"./useUniqueId-28e40ab3.js";import"./useDidUpdate-85d8cc72.js";import"./useUncertainRef-41a44258.js";import"./chainedFunction-070f832c.js";import"./slicedToArray-96762860.js";import"./objectWithoutProperties-8809bfcf.js";import"./toConsumableArray-078cc0f3.js";import"./mapCloneElement-ddf17a05.js";import"./index.esm-5a90f68a.js";import"./index.esm-7a0c39a8.js";/* empty css              */import"./_getPrototype-2d790319.js";import"./index-946c846c.js";import"./index-b678071a.js";const k="crmLeadDetails",$e={total:0,pageIndex:1,pageSize:10,query:"",sort:{order:"",key:""}},Be={loading:!0,lead:{},addForm:!1,dialogMode:"",selectedNote:{},deleteConfirmation:!1,tableData:$e},L=F(`${k}/getLeadById`,async e=>{var s,n;try{return await ie(e)}catch(o){throw new Error((n=(s=o==null?void 0:o.response)==null?void 0:s.data)==null?void 0:n.message)}}),Oe=F(`${k}/getNotes`,async e=>{var s,n;try{return(await re(e)).data}catch(o){throw new Error((n=(s=o==null?void 0:o.response)==null?void 0:s.data)==null?void 0:n.message)}}),qe=F(`${k}/editNotes`,async({id:e,formData:s})=>{var n,o;try{return console.log("data",s),(await le(e,s)).data}catch(d){throw new Error((o=(n=d==null?void 0:d.response)==null?void 0:n.data)==null?void 0:o.message)}}),ze=F(`${k}/deleteNote`,async e=>{var s,n;try{return(await ae(e)).data}catch(o){throw new Error((n=(s=o==null?void 0:o.response)==null?void 0:s.data)==null?void 0:n.message)}}),U=J({name:`${k}/state`,initialState:Be,reducers:{toggleAddForm:(e,s)=>{e.addForm=s.payload},setSelectedNote:(e,s)=>{e.selectedNote=s.payload},setDialogMode:(e,s)=>{e.dialogMode=s.payload},toggleDeleteConfirmation:(e,s)=>{e.deleteConfirmation=s.payload}},extraReducers:e=>{e.addCase(L.fulfilled,(s,n)=>{var o,d,m,a;s.loading=!1,s.lead=n==null?void 0:n.payload.data,s.tableData.total=(a=(m=(d=(o=n.payload)==null?void 0:o.data)==null?void 0:d.data)==null?void 0:m.relatedTaskList)==null?void 0:a.length}).addCase(L.pending,s=>{s.loading=!0})}}),{toggleAddForm:I,setSelectedNote:H,setDialogMode:G,toggleDeleteConfirmation:P}=U.actions,Ke=U.reducer,Pe=Q({data:Ke}),v=Z,Re=Le({notes:be().required("Notes is required")}),Ye=()=>{var g;const e=T(),s=B(c=>{var i;return(i=c==null?void 0:c.crmLeadDetails)==null?void 0:i.data}),[n,o]=C.useState([]),d=B(c=>{var i,p,u;return(u=(p=(i=c.crmLeadDetails)==null?void 0:i.data)==null?void 0:p.lead)==null?void 0:u.data}),m=B(c=>c.crmLeadDetails.data.addForm);W.length=0,n==null||n.forEach(c=>{W.push({value:c.id,label:c.moduleName})});const a=()=>{e(I(!1))};return t.jsx("div",{children:t.jsx(ne,{isOpen:m,onClose:a,children:t.jsx(De,{validationSchema:Re,initialValues:{notes:(s==null?void 0:s.dialogMode)==="Edit"?(g=s.selectedNote)==null?void 0:g.notes:""},onSubmit:async c=>{var j,w,x,l,r,f,b;let i="",p="",u="";const h={notes:c.notes,masterId:"4",modelDataId:d==null?void 0:d.id};if((s==null?void 0:s.dialogMode)==="Edit"&&s.selectedNote){const y=(j=s==null?void 0:s.selectedNote)==null?void 0:j.id,N=await e(qe({id:y,formData:h}));(w=N==null?void 0:N.payload)!=null&&w.success?(i="Successfully Edited",p=(x=N==null?void 0:N.payload)==null?void 0:x.message,u="success"):(i="Something went wrong !!!",p=(l=N==null?void 0:N.error)==null?void 0:l.message,u="danger")}else{const y=await e(Oe(h));(r=y==null?void 0:y.payload)!=null&&r.success?(i="Successfully Added",p=(f=y==null?void 0:y.payload)==null?void 0:f.message,u="success"):(i="Something went wrong !!!",p=(b=y==null?void 0:y.error)==null?void 0:b.message,u="danger")}S.push(t.jsx(A,{title:i,type:u,duration:2500,children:p}),{placement:"top-end"}),e(I(!1)),e(L(d==null?void 0:d.id))},children:({touched:c,errors:i,values:p,setFieldValue:u})=>t.jsx(Ne,{children:t.jsx(xe,{layout:"inline",children:t.jsxs("div",{className:"w-full custom-scrollbar",style:{maxHeight:"75vh",overflowY:"auto"},children:[t.jsxs("div",{className:"mb-10",children:[t.jsxs("h5",{className:"mb-4",children:[" ",(s==null?void 0:s.dialogMode)==="Add"?"Add Notes":"Edit Notes"]}),t.jsx(fe,{layout:"vertical",label:"Notes",invalid:i.notes&&c.notes,errorMessage:i.notes,children:t.jsx(we,{textArea:!0,placeholder:"Notes",name:"notes",component:de})})]}),t.jsx(Ce,{name:"tags",children:({form:h,remove:j,push:w})=>t.jsx("div",{children:t.jsx("div",{children:t.jsx(R,{type:"submit",variant:"solid",children:(s==null?void 0:s.dialogMode)==="Add"?"Add":"Edit"})})})})]})})})})})})},D=({title:e,value:s})=>{const o=(m,a)=>m.length>a?`${m.slice(0,a)}
${o(m.slice(a),a)}`:m,d=s.length>80?o(s,80):s;return t.jsxs("div",{children:[t.jsx("span",{children:e}),t.jsx("p",{className:"text-gray-700 dark:text-gray-200 font-semibold mb-4",style:{maxWidth:"500px",wordWrap:"break-word"},children:d})]})},We=e=>{const s=T(),[n,o]=C.useState(!1),d=ee(),m=()=>{o(!1)},a=()=>{o(!0)},g=Ae(i=>{var p,u;return(u=(p=i.crmLeads)==null?void 0:p.data)==null?void 0:u.selectedLeads}),c=async()=>{var p,u,h;o(!1);const i=await s(Te(g.id));await s(_()),(p=i==null?void 0:i.payload)!=null&&p.success?(S.push(t.jsx(A,{title:"Successfuly Deleted",type:"success",duration:2500,children:(u=i==null?void 0:i.payload)==null?void 0:u.message}),{placement:"top-end"}),d("/app/crm/leads"),s(ke({}))):S.push(t.jsx(A,{title:"Something Went Wrong !!!",type:"danger",duration:2500,children:(h=i==null?void 0:i.error)==null?void 0:h.message}),{placement:"top-end"}),await s(_()),await s(Ee())};return t.jsxs(t.Fragment,{children:[t.jsx(R,{block:!0,icon:t.jsx(Se,{}),variant:"solid",onClick:a,children:"Delete"}),t.jsx(X,{isOpen:n,type:"danger",title:"Delete Lead",confirmButtonColor:"red-600",onClose:m,onRequestClose:m,onCancel:m,onConfirm:c,children:t.jsx("p",{children:"Are you sure you want to delete this Lead? All record related to this Lead will be deleted as well. This action cannot be undone."})})]})},_e=e=>{var n,o;const s=[e.address,(n=e.cityData)==null?void 0:n.cityName,(o=e.stateData)==null?void 0:o.stateName,e.zipcode].filter(Boolean).join(", ");return s.length>0?s:"Location not provided"},He=({data:e={}})=>{var s,n,o,d,m,a,g,c,i,p;return t.jsx(he,{className:"w-1/3 h-fit max-h-fit",children:t.jsxs("div",{className:"flex flex-col xl:justify-between",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 mt-3",children:[(e==null?void 0:e.title)&&t.jsx(D,{title:"Title",value:e==null?void 0:e.title}),e.budget&&t.jsx(D,{title:"Budget",value:e.budget}),((s=e==null?void 0:e.contactData)==null?void 0:s.firstName)&&t.jsx(D,{title:"Contact Name",value:(n=e==null?void 0:e.contactData)==null?void 0:n.firstName}),(e==null?void 0:e.email)&&t.jsx(D,{title:"Email",value:e==null?void 0:e.email}),((o=e==null?void 0:e.contactData)==null?void 0:o.email)&&t.jsx(D,{title:"Contact Email",value:e.contactData.email}),(e==null?void 0:e.contactNumber)&&t.jsx(D,{title:"Contact Number",value:e.contactNumber}),(d=e==null?void 0:e.contactData)!=null&&d.address||(m=e==null?void 0:e.contactData)!=null&&m.cityData||(a=e==null?void 0:e.contactData)!=null&&a.stateData||(g=e==null?void 0:e.contactData)!=null&&g.zipcode?t.jsx(D,{title:"Contact Address",value:_e(e==null?void 0:e.contactData)}):null,(e==null?void 0:e.status)&&t.jsxs("div",{className:"flex items-center",children:[t.jsx("span",{className:"font-semibold mb-4",children:"Status:"}),t.jsx("div",{className:"ml-2 mb-4",children:t.jsx(K,{status:e==null?void 0:e.status})})]}),(e==null?void 0:e.reason)&&t.jsx(D,{title:"Reason",value:e==null?void 0:e.reason}),(e==null?void 0:e.description)&&t.jsx(D,{title:"Description",value:e==null?void 0:e.description}),((c=e==null?void 0:e.tags)==null?void 0:c.length)>0?t.jsxs("div",{className:"col-span-1",children:[t.jsx(D,{title:"Tags",value:""}),t.jsx(ve,{fullDisplay:!0,tags:e==null?void 0:e.tags})]}):null,((i=e==null?void 0:e.leadFields)==null?void 0:i.length)>0?t.jsx(t.Fragment,{children:(p=e.leadFields)==null?void 0:p.map((u,h)=>{var j;return t.jsxs("div",{className:"col-span-1",children:[u.value&&t.jsx(D,{title:(j=u.customKey)==null?void 0:j.name,value:u.value}),h<e.leadFields.length-1&&u.value&&t.jsx("br",{})]})})}):null]}),t.jsx("div",{className:"mt-4 flex flex-col xl:flex-row gap-2",children:t.jsx(We,{data:e})})]})})},Ge=()=>{const e=T(),s=v(a=>{var g,c,i;return(i=(c=(g=a.crmLeadDetails)==null?void 0:g.data)==null?void 0:c.lead)==null?void 0:i.data}),n=v(a=>{var g,c;return(c=(g=a.crmLeadDetails)==null?void 0:g.data)==null?void 0:c.deleteConfirmation}),o=v(a=>{var g;return(g=a==null?void 0:a.crmLeadDetails)==null?void 0:g.data}),d=()=>{e(P(!1))},m=async()=>{var g,c,i,p,u;e(P(!1)),console.log("jh===d",(g=o==null?void 0:o.selectedNote)==null?void 0:g.id);const a=await e(ze((c=o==null?void 0:o.selectedNote)==null?void 0:c.id));await e(L(s==null?void 0:s.id)),console.log("wdwd",a),(i=a==null?void 0:a.payload)!=null&&i.success?S.push(t.jsx(A,{title:"Successfuly Deleted",type:"success",duration:2500,children:(p=a==null?void 0:a.payload)==null?void 0:p.message}),{placement:"top-end"}):S.push(t.jsx(A,{title:"Something Went Wrong !!!",type:"danger",duration:2500,children:(u=a==null?void 0:a.error)==null?void 0:u.message}),{placement:"top-end"}),await e(L(s==null?void 0:s.id))};return t.jsx(X,{isOpen:n,type:"danger",title:"Delete Note",confirmButtonColor:"red-600",onClose:d,onRequestClose:d,onCancel:d,onConfirm:m,children:t.jsx("p",{children:"Are you sure you want to delete this Note? This action cannot be undone."})})};V("crmTasks",Me);const Ve=()=>{const e=T(),s=E(x=>{var l,r,f,b;return(b=(f=(r=(l=x.crmLeadDetails)==null?void 0:l.data)==null?void 0:r.lead)==null?void 0:f.data)==null?void 0:b.relatedTaskList}),n=E(x=>{var l,r;return(r=(l=x.crmLeadDetails)==null?void 0:l.data)==null?void 0:r.loading}),o=E(x=>{var l,r;return(r=(l=x.crmLeadDetails)==null?void 0:l.data)==null?void 0:r.tableData}),{pageIndex:d,pageSize:m,sort:a,query:g,total:c}=E(x=>{var l,r;return(r=(l=x.crmLeadDetails)==null?void 0:l.data)==null?void 0:r.tableData}),i=C.useCallback(()=>{e(Ie())},[e]);C.useEffect(()=>(i(),()=>{window.location.pathname.includes("lead")||e(M({...o,query:""}))}),[i]);const p=C.useMemo(()=>({pageIndex:d,pageSize:m,sort:a,query:g,total:c}),[d,m,a,g,c]),u=C.useMemo(()=>[{header:"Title",accessorKey:"title",cell:l=>{const r=l.row.original.title;return t.jsx(pe,{title:r,children:t.jsx(O,{text:r,maxLength:20})},r)}},{header:"Due Date",accessorKey:"dueDate",cell:l=>{var r;return Fe((r=l.row.original)==null?void 0:r.dueDate).format("DD MMMM YYYY")}},{header:"priority",accessorKey:"priority",cell:l=>{const r=l.row.original.priority;return t.jsx(K,{status:r})}},{header:"module",accessorKey:"module",cell:l=>{var f;const r=(f=l.row.original)==null?void 0:f.module;return r?t.jsx(O,{text:r,maxLength:20}):"-"}},{header:"type",accessorKey:"type",cell:l=>{var f;const r=(f=l.row.original)==null?void 0:f.type;return r?t.jsx(O,{text:r,maxLength:20}):"-"}},{header:"Assigned to",accessorKey:"assignedTo",cell:l=>{const{firstName:r,lastName:f}=l.row.original.assignedToData||{};return r&&f?`${r} ${f}`:"-"}},{header:"Connected lead",accessorKey:"connectedLead",cell:l=>{var f;const r=l.row.original||{};return r!=null&&r.leadModel?`${(f=r==null?void 0:r.leadModel)==null?void 0:f.title}`:"-"}},{header:"Status",accessorKey:"completionStatus",cell:l=>{const r=l.row.original.completionStatus;return t.jsx(K,{status:r})}}],[]),h=x=>{const l=q(p);l.pageIndex=x,e(M(l))},j=x=>{const l=q(p);l.pageSize=Number(x),l.pageIndex=1,e(M(l))},w=x=>{const l=q(p);l.sort=x,e(M(l))};return t.jsx("div",{children:t.jsx(ce,{columns:u,data:s,skeletonAvatarColumns:[0],skeletonAvatarProps:{width:28,height:28},loading:n,pagingData:{total:p.total,pageIndex:p.pageIndex,pageSize:p.pageSize},onPaginationChange:h,onSelectChange:j,onSort:w})})};V("crmLeadDetails",Pe);const $s=()=>{const e=T(),s=te(),{id:n}=s,o=v(h=>{var j,w;return(w=(j=h==null?void 0:h.crmLeadDetails)==null?void 0:j.data)==null?void 0:w.lead}),d=()=>{e(I(!0)),e(G("Add"))},m=o==null?void 0:o.data,a=v(h=>{var j;return(j=h==null?void 0:h.crmLeadDetails)==null?void 0:j.data.loading});C.useEffect(()=>{g()},[]);const g=async()=>{n&&e(L(n))},c=()=>{window.history.back()},i=z("leads","canModify");z("leads","canDelete"),z("leads","canCreate");const p=h=>{e(I(!0)),e(H(h)),e(G("Edit"))},u=h=>{e(H(h)),e(P(!0))};return console.log("leads data",{data:m}),t.jsxs(t.Fragment,{children:[t.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",marginBottom:"15px"},children:[t.jsx("span",{className:"cursor-pointer hover:text-indigo-500 items-center lg mr-2 mt-0",style:{fontSize:"2.5rem",fontWeight:"bold",color:"black"},onClick:c,children:t.jsx(ye,{})}),t.jsx("h3",{children:"Lead Details"})]}),t.jsxs(oe,{className:"h-full",children:[t.jsxs(se,{loading:a,children:[!Y(m)&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex flex-col xl:flex-row gap-4",children:[t.jsx(He,{data:m}),t.jsxs($,{className:"w-1/3",children:[t.jsxs("div",{className:"flex justify-between mb-2",children:[t.jsx("h5",{children:"Notes"}),i&&t.jsx(R,{size:"xs",type:"button",className:"!px-2 !text-lg",onClick:d,children:t.jsx(je,{})})]}),t.jsx(ue,{notes:(m==null?void 0:m.leadNotes)||[],canEdit:i,onEdit:p,onDelete:u})]}),t.jsxs($,{className:"w-1/2",children:[t.jsx("h5",{children:"Lead Activity"}),t.jsx(ge,{activity:(m==null?void 0:m.leadsActivity)||[]})]})]}),t.jsxs($,{className:"mt-4",children:[t.jsx("h4",{className:"mb-3",children:"Connected Tasks"}),t.jsx(Ve,{})]})]}),t.jsx(Ye,{}),t.jsx(Ge,{})]}),!a&&Y(m)&&t.jsxs("div",{className:"h-full flex flex-col items-center justify-center",children:[t.jsx(me,{src:"/img/others/img-2.png",darkModeSrc:"/img/others/img-2-dark.png",alt:"No user found!"}),t.jsx("h3",{className:"mt-8",children:"No user found!"})]})]})]})};export{$s as default};
