import{al as C,am as z,an as V,ao as K,a as v,r as b,j as s,ap as U,aq as J,at as Q,ah as Z}from"./index-3e8ea6f8.js";import{C as ee,i as B}from"./Views-cc709248.js";import{x as se,i as te,j as oe,k as ie}from"./CrmService-cfe882b2.js";import{A as O}from"./AdaptableCard-188bda95.js";import"./Badge-eeedee10.js";import"./chart.constant-85777c77.js";import"./GrowShrinkTag-c04fc29b.js";import"./index-1d299906.js";import{B as M}from"./Button-76f1570d.js";import{D as re}from"./Dialog-52f96620.js";import"./DataTable-5e8afa6a.js";import{D as le}from"./DoubleSidedImage-a9aeb3e6.js";import{I as ne}from"./Input-fcdfcb5e.js";import"./Skeleton-32fefde5.js";import"./react-tooltip.min-3fffe7ac.js";import"./RichTextEditor-aa042621.js";import"./SegmentItemOption-538b3009.js";import"./SvgIcon-bcf0c327.js";import"./Tooltip-cd4efb66.js";import{N as ce,L as ae}from"./LeadActivity-3f258ba5.js";import"./Alert-7c38cc47.js";import"./RangeCalendar-39ffd35c.js";import{C as me}from"./Card-f647d961.js";import"./index-0e62fb49.js";import"./index-82e9f824.js";import"./Drawer-0605b25d.js";import"./index-644264f8.js";import{F as de,a as pe}from"./FormItem-cd2f592d.js";import"./toString-11f799aa.js";import"./index-d5aa1b1d.js";import"./index-8027bcf5.js";import"./index-8a954033.js";import{t as D,N as k}from"./toast-7ff9f8c4.js";import"./Pagination-96c1f0d2.js";import"./Progress-11481b60.js";import"./index-c8dfa8be.js";import"./ScrollBar-080eb132.js";import"./index-bf896e9f.js";import"./Select-3f8173b3.js";import"./index-132323ef.js";import"./Switcher-0d6c2ebf.js";import"./index-6e2d0c70.js";import"./index-6ac68218.js";import"./Tag-d66306a5.js";import"./index-8dfb88a1.js";import"./index-195fe53b.js";import"./Upload-73ca2c13.js";import{u as ue}from"./checkEditUpdate-50871c95.js";import{a as xe}from"./index.esm-46e7ba4d.js";import{I as ge}from"./index.esm-1a6a7bf2.js";import{u as he,b as P,t as fe,d as je,g as A,c as ye}from"./index-bc41d870.js";import{F as Ne,a as De,b as ke,c as Te}from"./formik.esm-07b32d21.js";import{c as we,a as Ce}from"./index.esm-f87d0251.js";import{u as S,m as R}from"./TagCategoryDetailsForm-779eed6c.js";import{C as G}from"./ConfirmDialog-f6dece80.js";import{S as _}from"./StatusCapsule-efe3e5e6.js";import{h as q}from"./moment-fbc5633a.js";import{P as ve}from"./index.esm-9f04789b.js";import{T as Se}from"./TagsList-4c54aa9b.js";import"./useMergeRef-788c4cb0.js";import"./index-d6f80d82.js";import"./CloseButton-64a34d57.js";import"./index-67b94fe2.js";import"./isNil-9b846371.js";import"./get-cefdaee1.js";import"./_MapCache-3ab7a0d7.js";import"./floating-ui.dom-bef9cea3.js";import"./_baseIsEqual-88c079cd.js";import"./cloneDeep-682c094b.js";import"./_getPrototype-2d790319.js";import"./useThemeClass-dcc2d2c0.js";import"./usePopper-43e347b2.js";import"./index.esm-66cb0ca3.js";import"./index-2bce6170.js";import"./useTimeout-b972535c.js";import"./StatusIcon-d01ba88d.js";import"./useControllableState-7991db37.js";import"./useRootClose-c072e07a.js";import"./TimeInput-4555e543.js";import"./useUniqueId-28e40ab3.js";import"./useDidUpdate-85d8cc72.js";import"./useUncertainRef-41a44258.js";import"./chainedFunction-070f832c.js";import"./slicedToArray-96762860.js";import"./objectWithoutProperties-8809bfcf.js";import"./toConsumableArray-078cc0f3.js";import"./mapCloneElement-ddf17a05.js";import"./index.esm-5a90f68a.js";import"./index.esm-7a0c39a8.js";import"./index-946c846c.js";import"./index-b678071a.js";/* empty css              */const T="crmTaskDetails",Ae={loading:!0,task:{},addForm:!1,dialogMode:"",selectedNote:{},deleteConfirmation:!1},y=C(`${T}/getTaskById`,async e=>{var t,i;try{return await se(e)}catch(r){throw new Error((i=(t=r==null?void 0:r.response)==null?void 0:t.data)==null?void 0:i.message)}}),Fe=C(`${T}/getNotes`,async e=>{var t,i;try{return(await te(e)).data}catch(r){throw new Error((i=(t=r==null?void 0:r.response)==null?void 0:t.data)==null?void 0:i.message)}}),be=C(`${T}/editNotes`,async({id:e,formData:t})=>{var i,r;try{return(await oe(e,t)).data}catch(l){throw new Error((r=(i=l==null?void 0:l.response)==null?void 0:i.data)==null?void 0:r.message)}}),Me=C(`${T}/deleteNote`,async e=>{var t,i;try{return(await ie(e)).data}catch(r){throw new Error((i=(t=r==null?void 0:r.response)==null?void 0:t.data)==null?void 0:i.message)}}),X=z({name:`${T}/state`,initialState:Ae,reducers:{toggleAddForm:(e,t)=>{e.addForm=t.payload},setSelectedNote:(e,t)=>{e.selectedNote=t.payload},setDialogMode:(e,t)=>{e.dialogMode=t.payload},toggleDeleteConfirmation:(e,t)=>{e.deleteConfirmation=t.payload}},extraReducers:e=>{e.addCase(y.fulfilled,(t,i)=>{t.loading=!1,t.task=i==null?void 0:i.payload.data}).addCase(y.pending,t=>{t.loading=!0})}}),{toggleAddForm:w,setSelectedNote:H,setDialogMode:W,toggleDeleteConfirmation:F}=X.actions,Ee=X.reducer,Ie=V({data:Ee}),N=K,Le=we({notes:Ce().required("Notes is required")}),$e=()=>{var a;const e=v(),t=S(c=>{var o;return(o=c==null?void 0:c.crmTaskDetails)==null?void 0:o.data}),[i,r]=b.useState([]),l=S(c=>{var o,m,d;return(d=(m=(o=c.crmTaskDetails)==null?void 0:o.data)==null?void 0:m.task)==null?void 0:d.data}),u=S(c=>c.crmTaskDetails.data.addForm);R.length=0,i==null||i.forEach(c=>{R.push({value:c.id,label:c.moduleName})});const n=()=>{e(w(!1))};return s.jsx("div",{children:s.jsx(re,{isOpen:u,onClose:n,children:s.jsx(Ne,{validationSchema:Le,initialValues:{notes:(t==null?void 0:t.dialogMode)==="Edit"?(a=t.selectedNote)==null?void 0:a.notes:""},onSubmit:async c=>{var f,j,E,I,L,$,Y;let o="",m="",d="";const p={notes:c.notes,masterId:"6",modelDataId:l==null?void 0:l.id};if((t==null?void 0:t.dialogMode)==="Edit"&&t.selectedNote){const x=(f=t==null?void 0:t.selectedNote)==null?void 0:f.id,h=await e(be({id:x,formData:p}));(j=h==null?void 0:h.payload)!=null&&j.success?(o="Successfully Edited",m=(E=h==null?void 0:h.payload)==null?void 0:E.message,d="success"):(o="Something went wrong !!!",m=(I=h==null?void 0:h.error)==null?void 0:I.message,d="danger")}else{const x=await e(Fe(p));(L=x==null?void 0:x.payload)!=null&&L.success?(o="Successfully Added",m=($=x==null?void 0:x.payload)==null?void 0:$.message,d="success"):(o="Something went wrong !!!",m=(Y=x==null?void 0:x.error)==null?void 0:Y.message,d="danger")}D.push(s.jsx(k,{title:o,type:d,duration:2500,children:m}),{placement:"top-end"}),e(w(!1)),e(y(l==null?void 0:l.id))},children:({touched:c,errors:o,values:m,setFieldValue:d})=>s.jsx(De,{children:s.jsx(de,{layout:"inline",children:s.jsxs("div",{className:"w-full custom-scrollbar",style:{maxHeight:"75vh",overflowY:"auto"},children:[s.jsxs("div",{className:"mb-10",children:[s.jsxs("h5",{className:"mb-4",children:[" ",(t==null?void 0:t.dialogMode)==="Add"?"Add Notes":"Edit Notes"]}),s.jsx(pe,{layout:"vertical",label:"Notes",invalid:o.notes&&c.notes,errorMessage:o.notes,children:s.jsx(ke,{textArea:!0,placeholder:"Notes",name:"notes",component:ne})})]}),s.jsx(Te,{name:"tags",children:({form:p,remove:f,push:j})=>s.jsx("div",{children:s.jsx("div",{children:s.jsx(M,{type:"submit",variant:"solid",children:(t==null?void 0:t.dialogMode)==="Add"?"Add":"Edit"})})})})]})})})})})})},Ye=()=>{const e=v(),t=N(n=>{var a,c,o;return(o=(c=(a=n.crmTaskDetails)==null?void 0:a.data)==null?void 0:c.task)==null?void 0:o.data}),i=N(n=>{var a,c;return(c=(a=n.crmTaskDetails)==null?void 0:a.data)==null?void 0:c.deleteConfirmation}),r=N(n=>{var a;return(a=n==null?void 0:n.crmTaskDetails)==null?void 0:a.data}),l=()=>{e(F(!1))},u=async()=>{var a,c,o,m,d;e(F(!1)),console.log("jh===d",(a=r==null?void 0:r.selectedNote)==null?void 0:a.id);const n=await e(Me((c=r==null?void 0:r.selectedNote)==null?void 0:c.id));await e(y(t==null?void 0:t.id)),console.log("wdwd",n),(o=n==null?void 0:n.payload)!=null&&o.success?D.push(s.jsx(k,{title:"Successfuly Deleted",type:"success",duration:2500,children:(m=n==null?void 0:n.payload)==null?void 0:m.message}),{placement:"top-end"}):D.push(s.jsx(k,{title:"Something Went Wrong !!!",type:"danger",duration:2500,children:(d=n==null?void 0:n.error)==null?void 0:d.message}),{placement:"top-end"}),await e(y(t==null?void 0:t.id))};return s.jsx(G,{isOpen:i,type:"danger",title:"Delete Note",confirmButtonColor:"red-600",onClose:l,onRequestClose:l,onCancel:l,onConfirm:u,children:s.jsx("p",{children:"Are you sure you want to delete this Note? This action cannot be undone."})})},g=({title:e,value:t})=>{const r={maxHeight:"100px",wordWrap:"break-word"};return s.jsxs("div",{children:[s.jsx("span",{children:e}),s.jsx("p",{className:"text-gray-700 dark:text-gray-200 font-semibold",style:r,children:(t==null?void 0:t.length)>50?`${t==null?void 0:t.substring(0,50)}...`:t})]})},Be=e=>{const t=he(o=>{var m,d;return(d=(m=o.crmTasks)==null?void 0:m.data)==null?void 0:d.selectedTask}),i=v(),[r,l]=b.useState(!1),u=U(),n=()=>{l(!1)},a=()=>{l(!0)},c=async()=>{var m,d,p;await i(P(e)),i(fe(!1));const o=await i(je(t.id));await i(A()),(m=o==null?void 0:o.payload)!=null&&m.success?(D.push(s.jsx(k,{title:"Successfuly Deleted",type:"success",duration:2500,children:(d=o==null?void 0:o.payload)==null?void 0:d.message}),{placement:"top-end"}),u("/app/crm/tasks"),i(P({}))):D.push(s.jsx(k,{title:"Something Went Wrong !!!",type:"danger",duration:2500,children:(p=o==null?void 0:o.error)==null?void 0:p.message}),{placement:"top-end"}),await i(A()),await i(ye())};return s.jsxs(s.Fragment,{children:[s.jsx(M,{block:!0,icon:s.jsx(ve,{}),variant:"solid",onClick:a,children:"Delete"}),s.jsx(G,{isOpen:r,type:"danger",title:"Delete Task",confirmButtonColor:"red-600",onClose:n,onRequestClose:n,onCancel:n,onConfirm:c,children:s.jsx("p",{children:"Are you sure you want to delete this Task? All record related to this Task will be deleted as well. This action cannot be undone."})})]})},Oe=({data:e={}})=>{var t,i,r,l,u,n;return s.jsx(me,{children:s.jsxs("div",{className:"flex flex-col xl:justify-between",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 mt-3 wrap-data",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("span",{className:"font-semibold",children:"Priority:"}),s.jsx("div",{className:"ml-2",children:s.jsx(_,{status:e==null?void 0:e.priority})})]}),s.jsxs("div",{className:"flex items-center",children:[s.jsx("span",{className:"font-semibold",children:"Status:"}),s.jsx("div",{className:"ml-2",children:s.jsx(_,{status:e==null?void 0:e.completionStatus})})]}),e!=null&&e.dueDate?s.jsx(s.Fragment,{children:s.jsx(g,{title:"Due Date",value:q(e==null?void 0:e.dueDate).format("DD MMMM YYYY")})}):null,e!=null&&e.title?s.jsx(s.Fragment,{children:s.jsx(g,{title:"Title",value:e==null?void 0:e.title})}):null,e!=null&&e.descriptions?s.jsx(s.Fragment,{children:s.jsx(g,{title:"Description",value:e==null?void 0:e.descriptions})}):null,e!=null&&e.assignedToData?s.jsx(s.Fragment,{children:s.jsx(g,{title:"Assigned To",value:`${(t=e==null?void 0:e.assignedToData)==null?void 0:t.firstName}  ${(i=e==null?void 0:e.assignedToData)==null?void 0:i.lastName}`})}):null,e!=null&&e.module?s.jsx(s.Fragment,{children:s.jsx(g,{title:"Module",value:e==null?void 0:e.module})}):null,e!=null&&e.type?s.jsx(s.Fragment,{children:s.jsx(g,{title:"Type",value:e==null?void 0:e.type})}):null,e!=null&&e.nextDateTime?s.jsx(s.Fragment,{children:s.jsx(g,{title:"Date Time",value:q(e==null?void 0:e.nextDateTime).format("DD MMMM YYYY")})}):null,e!=null&&e.connectedLead?s.jsx(s.Fragment,{children:s.jsx(g,{title:"Connected Lead",value:(r=e==null?void 0:e.leadModel)==null?void 0:r.title})}):null,((l=e==null?void 0:e.tags)==null?void 0:l.length)>0?s.jsxs("div",{className:"col-span-1",children:[s.jsx(g,{title:"Tags",value:""}),s.jsx(Se,{fullDisplay:!0,tags:e==null?void 0:e.tags})]}):null,((u=e==null?void 0:e.taskFields)==null?void 0:u.length)>0?s.jsx(s.Fragment,{children:(n=e.taskFields)==null?void 0:n.map((a,c)=>{var o;return s.jsxs(s.Fragment,{children:[a.value&&s.jsx(g,{title:(o=a.customKey)==null?void 0:o.name,value:a.value}),c<e.taskFields.length-1&&a.value&&s.jsx("br",{})]})})}):null]}),s.jsx("div",{className:"mt-4 flex flex-col xl:flex-row gap-2",children:s.jsx(Be,{data:e})})]})})};J("crmTaskDetails",Ie);const Tt=()=>{const e=v(),t=Q(),{id:i}=t,r=N(p=>{var f,j;return(j=(f=p==null?void 0:p.crmTaskDetails)==null?void 0:f.data)==null?void 0:j.task}),l=r==null?void 0:r.data,u=N(p=>p.crmTaskDetails.data.loading),n=ue("tasks","canModify");b.useEffect(()=>{a()},[]);const a=async()=>{i&&e(y(i)),await e(A())},c=p=>{e(w(!0)),e(H(p)),e(W("Edit"))},o=p=>{e(H(p)),e(F(!0))},m=()=>{e(w(!0)),e(W("Add"))},d=()=>{window.history.back()};return s.jsxs(s.Fragment,{children:[s.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",marginBottom:"15px"},children:[s.jsx("span",{className:"cursor-pointer hover:text-indigo-500 items-center lg mr-2 mt-0",style:{fontSize:"2.5rem",fontWeight:"bold",color:"black"},onClick:d,children:s.jsx(ge,{})}),s.jsx("h3",{children:"Task Details"})]}),s.jsxs(ee,{className:"h-full",children:[s.jsx(Z,{loading:u,children:!B(l)&&s.jsxs("div",{className:"flex flex-col xl:flex-row gap-4",children:[s.jsx(Oe,{data:l}),s.jsxs(O,{className:"w-1/3",children:[s.jsxs("div",{className:"flex justify-between mb-2",children:[s.jsx("h5",{children:"Notes"}),n&&s.jsx(M,{size:"xs",type:"button",className:"!px-2 !text-lg",onClick:m,children:s.jsx(xe,{})})]}),s.jsx(ce,{notes:(l==null?void 0:l.taskNotes)||[],canEdit:n,onEdit:c,onDelete:o})]}),s.jsxs(O,{className:"w-1/2",children:[s.jsx("h5",{children:"Task Activity"}),s.jsx(ae,{activity:(l==null?void 0:l.taskActivities)||[]})]})]})}),!u&&B(l)&&s.jsxs("div",{className:"h-full flex flex-col items-center justify-center",children:[s.jsx(le,{src:"/img/others/img-2.png",darkModeSrc:"/img/others/img-2-dark.png",alt:"No user found!"}),s.jsx("h3",{className:"mt-8",children:"No user found!"})]}),s.jsx($e,{}),s.jsx(Ye,{})]})]})};export{Tt as default};
