import{am as v,an as z,ao as H,ap as V,j as e,a as b,r as E,al as G,aq as U,at as Y,ah as _}from"./index-8f180057.js";import{C as J,i as T}from"./Views-0f0dd1b0.js";import{g as K,h as Q,i as X,j as Z}from"./CrmService-4ead0dba.js";import{C as L}from"./ConfirmDialog-aae1170e.js";import{B as F}from"./Button-9a124664.js";import{C as ee}from"./Card-c08b3dc7.js";import{t as N,N as y}from"./toast-d4a23693.js";import{P as se}from"./index.esm-d559b7a8.js";import{u as te,d as oe,g as $,s as ie}from"./index-c4d57c33.js";import{T as le}from"./TagsList-e6a75e8b.js";import{A as re}from"./AdaptableCard-4ed28de0.js";import"./Badge-da9b4bac.js";import"./chart.constant-9b9fa33b.js";import"./GrowShrinkTag-a0071cd9.js";import"./index-50da1f05.js";import{D as ae}from"./Dialog-00762d81.js";import"./DataTable-3741aea2.js";import{D as ne}from"./DoubleSidedImage-21e051fa.js";import{I as ce}from"./Input-80948cc5.js";import"./Skeleton-a652bf9f.js";import"./react-tooltip.min-4facd0ed.js";import"./RichTextEditor-233df5d8.js";import"./SegmentItemOption-79a4fade.js";import"./SvgIcon-70b4e497.js";import"./Tooltip-c46cdf61.js";import{I as de}from"./index.esm-5eff4e23.js";import{u as me}from"./checkEditUpdate-a2ffee2c.js";import"./Alert-26b93c15.js";import"./RangeCalendar-4f882c48.js";import"./index-467c57d1.js";import"./index-f90d0a46.js";import"./Drawer-9e2f40a2.js";import"./index-57f971c2.js";import{F as pe,a as ue}from"./FormItem-6da989b2.js";import"./toString-6546c1f5.js";import"./index-c14dd8b2.js";import"./index-7419ce87.js";import"./index-8db80fc8.js";import"./Pagination-02ddc899.js";import"./Progress-4aad2981.js";import"./index-f1c49e5c.js";import"./ScrollBar-cc732ada.js";import"./index-5c4aebcf.js";import"./Select-b8e32f8a.js";import"./index-3ad4fd06.js";import"./Switcher-b15fc15a.js";import"./index-68091566.js";import"./index-19730294.js";import"./Tag-f078f978.js";import"./index-04594492.js";import"./index-f2e93cf2.js";import"./Upload-5d1aec4a.js";import{a as he}from"./index.esm-4bf6ba60.js";import{N as ge}from"./NoteTimeline-da6f4a50.js";import{F as xe,a as fe,b as je,c as De}from"./formik.esm-23c950a3.js";import{c as Ne,a as ye}from"./index.esm-f2cf7456.js";import{u as S,m as R}from"./TagCategoryDetailsForm-7f96e2d0.js";import"./useTimeout-6ce9cc18.js";import"./CloseButton-f457d2a5.js";import"./StatusIcon-af9b884d.js";import"./chainedFunction-070f832c.js";import"./useMergeRef-788c4cb0.js";import"./index-21bd03ca.js";import"./index-9a956df5.js";import"./isNil-7f5c5bc3.js";import"./get-49349d76.js";import"./_MapCache-c801105a.js";import"./floating-ui.dom-4bc0055b.js";import"./_baseIsEqual-f757163a.js";import"./cloneDeep-1f39f070.js";import"./_getPrototype-6ef2344b.js";import"./useThemeClass-fedd2393.js";import"./usePopper-4f231cdc.js";import"./index.esm-047fe164.js";import"./index-56b40026.js";import"./moment-fbc5633a.js";import"./useControllableState-a20a08a7.js";import"./useRootClose-849d9b9c.js";import"./TimeInput-a4c2e8c8.js";import"./useUniqueId-b6b18158.js";import"./useDidUpdate-6bcd31b9.js";import"./useUncertainRef-cd8eb299.js";import"./slicedToArray-4e770983.js";import"./objectWithoutProperties-8809bfcf.js";import"./toConsumableArray-10fd47e9.js";import"./mapCloneElement-4d24a9a7.js";import"./index.esm-7da1e9bd.js";import"./index.esm-e628df3b.js";/* empty css              */const w="crmDealDetails",we={loading:!0,deal:{},addForm:!1,dialogMode:"",selectedNote:{},deleteConfirmation:!1},j=v(`${w}/getDealById`,async s=>{var t,i;try{return await K(s)}catch(l){throw new Error((i=(t=l==null?void 0:l.response)==null?void 0:t.data)==null?void 0:i.message)}}),Ce=v(`${w}/getNotes`,async s=>{var t,i;try{return(await Q(s)).data}catch(l){throw new Error((i=(t=l==null?void 0:l.response)==null?void 0:t.data)==null?void 0:i.message)}}),ve=v(`${w}/editNotes`,async({id:s,formData:t})=>{var i,l;try{return(await X(s,t)).data}catch(a){throw new Error((l=(i=a==null?void 0:a.response)==null?void 0:i.data)==null?void 0:l.message)}}),be=v(`${w}/deleteNote`,async s=>{var t,i;try{return(await Z(s)).data}catch(l){throw new Error((i=(t=l==null?void 0:l.response)==null?void 0:t.data)==null?void 0:i.message)}}),P=z({name:`${w}/state`,initialState:we,reducers:{toggleAddForm:(s,t)=>{s.addForm=t.payload},setSelectedNote:(s,t)=>{s.selectedNote=t.payload},setDialogMode:(s,t)=>{s.dialogMode=t.payload},toggleDeleteConfirmation:(s,t)=>{s.deleteConfirmation=t.payload}},extraReducers:s=>{s.addCase(j.fulfilled,(t,i)=>{t.loading=!1,t.deal=i==null?void 0:i.payload.data}).addCase(j.pending,t=>{t.loading=!0})}}),{toggleAddForm:C,setSelectedNote:q,setDialogMode:W,toggleDeleteConfirmation:A}=P.actions,Se=P.reducer,Ae=H({data:Se}),D=V,Ee=s=>{const t=te(o=>{var d,c;return(c=(d=o.crmDeals)==null?void 0:d.data)==null?void 0:c.selectedDeals}),i=b(),[l,a]=E.useState(!1),f=G(),n=()=>{a(!1)},m=()=>{a(!0)},r=async()=>{var d,c,p,h,g;a(!1);const o=await i(oe(t.id));await i($()),(c=(d=o==null?void 0:o.payload)==null?void 0:d.data)!=null&&c.success?(N.push(e.jsx(y,{title:"Successfuly Deleted",type:"success",duration:2500,children:(h=(p=o==null?void 0:o.payload)==null?void 0:p.data)==null?void 0:h.message}),{placement:"top-end"}),f("/app/crm/deals"),i(ie({}))):N.push(e.jsx(y,{title:"Something Went Wrong !!!",type:"danger",duration:2500,children:(g=o==null?void 0:o.error)==null?void 0:g.message}),{placement:"top-end"}),await i($())};return e.jsxs(e.Fragment,{children:[e.jsx(F,{block:!0,icon:e.jsx(se,{}),variant:"solid",size:"xs",onClick:m,children:"Delete"}),e.jsx(L,{isOpen:l,type:"danger",title:"Delete Deal",confirmButtonColor:"red-600",onClose:n,onRequestClose:n,onCancel:n,onConfirm:r,children:e.jsx("p",{children:"Are you sure you want to delete this Deal? All record related to this Deal will be deleted as well. This action cannot be undone."})})]})},Fe=({data:s={}})=>{var t,i;return e.jsx(ee,{children:e.jsxs("div",{className:"flex flex-col xl:justify-between min-w-[300px] mx-auto p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-1 gap-y-7 gap-x-4 ",children:[(s==null?void 0:s.title)&&e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"font-semibold",children:"Title:"}),e.jsx("div",{className:"ml-2",children:s==null?void 0:s.title})]}),(s==null?void 0:s.budget)&&e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"font-semibold",children:"Budget:"}),e.jsx("div",{className:"ml-2",children:s==null?void 0:s.budget})]}),(s==null?void 0:s.description)&&e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"font-semibold",children:"Description:"}),e.jsx("div",{className:"ml-2",children:s==null?void 0:s.description})]}),((t=s==null?void 0:s.tags)==null?void 0:t.length)>0&&e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"font-semibold",children:"Tags:"}),e.jsx("div",{className:"ml-2",children:e.jsx(le,{fullDisplay:!0,tags:s==null?void 0:s.tags})})]}),(s==null?void 0:s.leadModel)&&e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"font-semibold",children:"Connected Lead:"}),e.jsx("div",{className:"ml-2",children:(i=s==null?void 0:s.leadModel)==null?void 0:i.title})]})]}),e.jsx("div",{className:"mt-5 flex flex-col xl:flex-row gap-2 w-1/4 float-left",children:e.jsx(Ee,{data:s})})]})})},Me=()=>{const s=b(),t=D(n=>{var m,r,o;return(o=(r=(m=n.crmDealDetails)==null?void 0:m.data)==null?void 0:r.deal)==null?void 0:o.data}),i=D(n=>{var m,r;return(r=(m=n.crmDealDetails)==null?void 0:m.data)==null?void 0:r.deleteConfirmation}),l=D(n=>{var m;return(m=n==null?void 0:n.crmDealDetails)==null?void 0:m.data}),a=()=>{s(A(!1))},f=async()=>{var m,r,o,d,c;s(A(!1)),console.log("jh===d",(m=l==null?void 0:l.selectedNote)==null?void 0:m.id);const n=await s(be((r=l==null?void 0:l.selectedNote)==null?void 0:r.id));await s(j(t==null?void 0:t.id)),console.log("wdwd",n),(o=n==null?void 0:n.payload)!=null&&o.success?N.push(e.jsx(y,{title:"Successfuly Deleted",type:"success",duration:2500,children:(d=n==null?void 0:n.payload)==null?void 0:d.message}),{placement:"top-end"}):N.push(e.jsx(y,{title:"Something Went Wrong !!!",type:"danger",duration:2500,children:(c=n==null?void 0:n.error)==null?void 0:c.message}),{placement:"top-end"}),await s(j(t==null?void 0:t.id))};return e.jsx(L,{isOpen:i,type:"danger",title:"Delete Note",confirmButtonColor:"red-600",onClose:a,onRequestClose:a,onCancel:a,onConfirm:f,children:e.jsx("p",{children:"Are you sure you want to delete this Note? This action cannot be undone."})})},Ie=Ne({notes:ye().required("Notes is required")}),ke=()=>{var m;const s=b(),t=S(r=>{var o;return(o=r==null?void 0:r.crmDealDetails)==null?void 0:o.data}),[i,l]=E.useState([]),a=S(r=>{var o,d,c;return(c=(d=(o=r.crmDealDetails)==null?void 0:o.data)==null?void 0:d.deal)==null?void 0:c.data}),f=S(r=>r.crmDealDetails.data.addForm);R.length=0,i==null||i.forEach(r=>{R.push({value:r.id,label:r.moduleName})});const n=()=>{s(C(!1))};return e.jsx("div",{children:e.jsx(ae,{isOpen:f,onClose:n,children:e.jsx(xe,{validationSchema:Ie,initialValues:{notes:(t==null?void 0:t.dialogMode)==="Edit"?(m=t.selectedNote)==null?void 0:m.notes:""},onSubmit:async r=>{var h,g,M,I,k,B,O;let o="",d="",c="";const p={notes:r.notes,masterId:"6",modelDataId:a==null?void 0:a.id};if((t==null?void 0:t.dialogMode)==="Edit"&&t.selectedNote){const u=(h=t==null?void 0:t.selectedNote)==null?void 0:h.id,x=await s(ve({id:u,formData:p}));(g=x==null?void 0:x.payload)!=null&&g.success?(o="Successfully Edited",d=(M=x==null?void 0:x.payload)==null?void 0:M.message,c="success"):(o="Something went wrong !!!",d=(I=x==null?void 0:x.error)==null?void 0:I.message,c="danger")}else{const u=await s(Ce(p));(k=u==null?void 0:u.payload)!=null&&k.success?(o="Successfully Added",d=(B=u==null?void 0:u.payload)==null?void 0:B.message,c="success"):(o="Something went wrong !!!",d=(O=u==null?void 0:u.error)==null?void 0:O.message,c="danger")}N.push(e.jsx(y,{title:o,type:c,duration:2500,children:d}),{placement:"top-end"}),s(C(!1)),s(j(a==null?void 0:a.id))},children:({touched:r,errors:o,values:d,setFieldValue:c})=>e.jsx(fe,{children:e.jsx(pe,{layout:"inline",children:e.jsxs("div",{className:"w-full custom-scrollbar",style:{maxHeight:"75vh",overflowY:"auto"},children:[e.jsxs("div",{className:"mb-10",children:[e.jsxs("h5",{className:"mb-4",children:[" ",(t==null?void 0:t.dialogMode)==="Add"?"Add Notes":"Edit Notes"]}),e.jsx(ue,{layout:"vertical",label:"Notes",invalid:o.notes&&r.notes,errorMessage:o.notes,children:e.jsx(je,{textArea:!0,placeholder:"Notes",name:"notes",component:ce})})]}),e.jsx(De,{name:"tags",children:({form:p,remove:h,push:g})=>e.jsx("div",{children:e.jsx("div",{children:e.jsx(F,{type:"submit",variant:"solid",children:(t==null?void 0:t.dialogMode)==="Add"?"Add":"Edit"})})})})]})})})})})})};U("crmDealDetails",Ae);const ht=()=>{const s=b(),t=Y(),{id:i}=t,l=D(p=>{var h,g;return(g=(h=p==null?void 0:p.crmDealDetails)==null?void 0:h.data)==null?void 0:g.deal}),a=l==null?void 0:l.data,f=D(p=>p.crmDealDetails.data.loading);E.useEffect(()=>{n()},[]);const n=()=>{i&&s(j(i))},m=()=>{s(C(!0)),s(W("Add"))},r=p=>{s(C(!0)),s(q(p)),s(W("Edit"))},o=p=>{s(q(p)),s(A(!0))},d=()=>{window.history.back()},c=me("Deal","canModify");return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",marginBottom:"15px"},children:[e.jsx("span",{className:"cursor-pointer hover:text-indigo-500 items-center lg mr-2 mt-0",style:{fontSize:"2.5rem",fontWeight:"bold",color:"black"},onClick:d,children:e.jsx(de,{})}),e.jsx("h3",{children:"Deal Details"})]}),e.jsxs(J,{className:"h-full",children:[e.jsx(_,{loading:f,children:!T(a)&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-3 lg:grid-cols-4 gap-4 mt-2",children:[e.jsx("div",{className:"col-span-2",children:e.jsx(Fe,{data:a})}),e.jsxs(re,{className:"col-span-2",children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("h5",{children:"Notes"}),c&&e.jsx(F,{size:"xs",type:"button",className:"!px-2 !text-lg",onClick:m,children:e.jsx(he,{})})]}),e.jsx(ge,{notes:(a==null?void 0:a.dealNotes)||[],canEdit:c,onEdit:r,onDelete:o})]})]})})}),!f&&T(a)&&e.jsxs("div",{className:"h-full flex flex-col items-center justify-center",children:[e.jsx(ne,{src:"/img/others/img-2.png",darkModeSrc:"/img/others/img-2-dark.png",alt:"No user found!"}),e.jsx("h3",{className:"mt-8",children:"No user found!"})]}),e.jsx(ke,{}),e.jsx(Me,{})]})]})};export{ht as default};
