import{am as S,an as ne,ao as le,ap as ie,r as f,j as t,a as j,ar as de}from"./index-b09faefa.js";import{T as Me}from"./index-addd5e63.js";import{V as Ve,W as ce,X as He,Y as Xe,Z as Qe,_ as Ee,$ as Ue,a0 as Ye,a1 as Ze,a2 as Je,a3 as ea,a4 as aa,a5 as ta}from"./CrmService-5f2f53bd.js";import{B as I}from"./Button-3bdf4581.js";import{I as L}from"./Input-8c731b0c.js";import{b as ge,W as me,X as ue}from"./index.esm-2c67faf2.js";import{d as pe}from"./debounce-24a9e0ff.js";import{c as N}from"./cloneDeep-de9ec659.js";import{g as oa}from"./index-cd4985d7.js";import{D as ye}from"./DataTable-ca158282.js";import{u as z}from"./checkEditUpdate-cffc7ae3.js";import{u as Ce}from"./useThemeClass-ee0e86a7.js";import"./Alert-a515d81f.js";import"./index-2f1f758f.js";import"./Badge-d1515062.js";import"./Calendar-6959847d.js";import"./Card-33431fc8.js";import"./index-c173cf47.js";import"./index-82bb2b50.js";import{D as he}from"./Dialog-a2bd00be.js";import"./Drawer-1ea16c4a.js";import"./index-96409d01.js";import{F as fe,a as M}from"./FormItem-cdcc11d5.js";import"./toString-9cef9a7f.js";import"./index-c886a512.js";import"./index-056a1440.js";import"./index-ae319e32.js";import{N as R,t as v}from"./toast-2c9f9fcf.js";import"./Pagination-d71ebe95.js";import"./Progress-a1e68dcb.js";import"./index-bc0f434c.js";import"./RangeCalendar-b4e9e88f.js";import"./ScrollBar-a256ec53.js";import"./index-d106a35e.js";import{S as Q}from"./Select-71db8857.js";import"./Skeleton-5bf82d8e.js";import"./index-975733af.js";import"./Switcher-e643b9c6.js";import"./index-a157bc37.js";import"./Tag-0d544e3b.js";import"./index-ba770d43.js";import"./index-dd0b5a15.js";import"./Tooltip-5b8c5fcd.js";import"./Upload-8f332031.js";import"./Views-57e82c67.js";import"./chart.constant-ef346b48.js";import"./chart.config-4c177efc.js";import"./GrowShrinkTag-2a08ec85.js";import"./react-tooltip.min-77f6174b.js";import"./RichTextEditor-de87e477.js";import"./SegmentItemOption-5b527349.js";import{S as xe}from"./StickyFooter-d10b4485.js";import"./SvgIcon-7aba062d.js";import{F as be,a as je,b as E}from"./formik.esm-93e44345.js";import{a as Se}from"./index.esm-ef7b0069.js";import{c as O,e as sa}from"./index.esm-aece8080.js";import{c as k,a as X,f as ra}from"./index.esm-333232d6.js";import{C as we}from"./ConfirmDialog-1096cdd6.js";import{e as na}from"./index.esm-7a963ea9.js";import{a as la}from"./index.esm-ce76beb6.js";import{T as ia}from"./TextTruncate-222d0204.js";const da="crmCategory",U=S("crmCategory/data/createCategory",async o=>{var e,a;try{return(await Ve(o)).data}catch(s){throw new Error((a=(e=s==null?void 0:s.response)==null?void 0:e.data)==null?void 0:a.message)}}),F=S("crmCategory/data/getCategory",async()=>{var o,e;try{return(await ce()).data}catch(a){throw new Error((e=(o=a==null?void 0:a.response)==null?void 0:o.data)==null?void 0:e.message)}}),ca=S("crmLeads/data/editCategory",async({id:o,updatedData:e})=>{var a,s;try{return(await He(o,e)).data}catch(n){throw new Error((s=(a=n==null?void 0:n.response)==null?void 0:a.data)==null?void 0:s.message)}}),ga=S("crmLeads/data/deleteCategory",async o=>{var e,a;try{return await Xe(o)}catch(s){throw new Error((a=(e=s==null?void 0:s.response)==null?void 0:e.data)==null?void 0:a.message)}}),ma={total:0,pageIndex:1,pageSize:10,query:"",sort:{order:"",key:""}},ua={loading:!1,tableData:ma,displayedCategoryList:[],categoryList:[],isDialogOpen:!1,dialogMode:"Add",selectedCategory:null,deleteConfirmation:!1},Le=ne({name:`${da}/state`,initialState:ua,reducers:{setTableData:(o,e)=>{o.tableData=e.payload;const a=o.categoryList.filter(s=>s.name.toLowerCase().includes(e.payload.query.toLowerCase()));o.displayedCategoryList=a.slice(e.payload.pageSize*(e.payload.pageIndex-1),e.payload.pageSize*e.payload.pageIndex)},setSelectedCategory:(o,e)=>{o.selectedCategory=e.payload},setDialogToggle:(o,e)=>{o.isDialogOpen=e.payload},setDialogMode:(o,e)=>{o.dialogMode=e.payload},toggleDeleteConfirmation:(o,e)=>{o.deleteConfirmation=e.payload}},extraReducers:o=>{o.addCase(U.fulfilled,(e,a)=>{e.loading=!1}).addCase(U.pending,e=>{e.loading=!0}).addCase(F.fulfilled,(e,a)=>{var s;e.loading=!1,e.categoryList=a==null?void 0:a.payload.data,e.tableData.total=(s=a.payload.data)==null?void 0:s.length,e.displayedCategoryList=a==null?void 0:a.payload.data.slice(0,10)}).addCase(F.pending,e=>{e.loading=!0})}}),{setTableData:G,setDialogToggle:B,setDialogMode:ke,setSelectedCategory:Ie,toggleDeleteConfirmation:Y}=Le.actions,pa=Le.reducer,ya=le({data:pa}),P=ie,ze=f.forwardRef((o,e)=>{const{onInputChange:a}=o,s=pe(n,500);function n(r){a==null||a(r)}const i=r=>{s(r.target.value)};return t.jsx(L,{ref:e,className:"max-w-md md:w-52 mb-4",size:"sm",placeholder:"Search",prefix:t.jsx(ge,{className:"text-lg"}),onChange:i})});ze.displayName="CategoryTableSearch";const Ca=()=>{const o=j(),e=f.useRef(null),a=P(i=>i.crmCategory.data.tableData),s=i=>{const r=N(a);r.query=i,r.pageIndex=1,typeof i=="string"&&i.length>1&&n(r),typeof i=="string"&&i.length===0&&n(r)},n=i=>{o(i?G(i):oa())};return t.jsxs("div",{className:"md:flex items-center justify-between",children:[t.jsx("div",{className:"md:flex items-center gap-4",children:t.jsx(ze,{ref:e,onInputChange:s})}),t.jsxs("div",{className:"mb-4",children:[t.jsx(I,{size:"sm",className:"me-2",onClick:()=>{},children:"Clear All"}),t.jsx(I,{size:"sm",onClick:()=>{o(B(!0)),o(ke("Add"))},children:"Add New"})]})]})},ha=()=>{const o=j(),e=P(d=>d.crmCategory.data.loading),a=z("roles","canModify"),s=z("roles","canDelete"),{pageIndex:n,pageSize:i,sort:r,query:p,total:y}=P(d=>d.crmCategory.data.tableData),u=P(d=>d.crmCategory.data.displayedCategoryList),m=({row:d})=>{const l=j(),{textTheme:b}=Ce(),w=()=>{l(Ie(d)),l(B(!0)),l(ke("Edit"))},T=async()=>{await l(Ie(d)),l(Y(!0))};return t.jsxs("div",{className:"flex justify-start text-lg",children:[t.jsx("span",{className:`cursor-pointer p-2 hover:${b}`,onClick:w,children:t.jsx(me,{})}),t.jsx("span",{className:"cursor-pointer p-2 hover:text-red-500",onClick:T,children:t.jsx(ue,{})})]})},g=f.useMemo(()=>({pageIndex:n,pageSize:i,sort:r,query:p,total:y}),[n,i,r,p,y]),c=f.useMemo(()=>[{header:"Action",id:"action",cell:l=>t.jsx(m,{row:l.row.original})},{header:"Category",accessorKey:"name",cell:l=>l.row.original.name}],[a,s]),C=d=>{const l=N(g);l.pageIndex=d,o(G(l))},x=d=>{const l=N(g);l.pageSize=Number(d),l.pageIndex=1,o(G(l))},h=d=>{const l=N(g);l.sort=d,o(G(l))};return t.jsx("div",{children:t.jsx(ye,{columns:c,data:u,skeletonAvatarColumns:[0],skeletonAvatarProps:{width:28,height:28},loading:e,pagingData:{total:g.total,pageIndex:g.pageIndex,pageSize:g.pageSize},onPaginationChange:C,onSelectChange:x,onSort:h})})},fa=k().shape({name:X().required("Category name is required")}),$e=f.forwardRef((o,e)=>{const a=j(),s=P(p=>p.crmCategory.data.dialogMode),n=P(p=>p.crmCategory.data.selectedCategory),i=()=>{a(B(!1))};console.log(s);const r=async(p,y,u,m,g)=>{var d,l,b;const c=await m(p==="Add"?U(y):ca({id:u==null?void 0:u.id,updatedData:{name:y.name}}));let C="",x="",h="danger";(d=c==null?void 0:c.payload)!=null&&d.success?(C="Successfully Added",x=(l=c==null?void 0:c.payload)==null?void 0:l.message,h="success"):(C="Something went wrong !!!",x=(b=c==null?void 0:c.error)==null?void 0:b.message),g.push(t.jsx(R,{title:C,type:h,duration:2500,children:x}),{placement:"top-end"}),m(B(!1)),await m(F())};return t.jsx(be,{innerRef:e,initialValues:{name:s==="Edit"?n==null?void 0:n.name:""},validationSchema:fa,onSubmit:async(p,{setSubmitting:y})=>{s==="Add"?await r("Add",p,null,a,v):await r("Edit",p,n,a,v),y(!1)},children:({touched:p,errors:y,values:u,setFieldValue:m})=>t.jsxs(je,{children:[t.jsx(fe,{children:t.jsx(M,{label:"Category Name",invalid:y.name&&p.name,errorMessage:y.name,children:t.jsx(E,{type:"text",autoComplete:"off",name:"name",placeholder:"Category Name",component:L,prefix:t.jsx(O,{className:"text-xl"})})})}),t.jsx(xe,{className:"flex items-center justify-end py-2",stickyClass:"border-t bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700",children:t.jsxs("div",{className:"md:flex items-center",children:[t.jsx(I,{size:"sm",className:"ltr:mr-3 rtl:ml-3",type:"button",onClick:i,children:"Cancel"}),t.jsx(I,{size:"sm",type:"submit",variant:"solid",icon:t.jsx(Se,{}),children:"Save"})]})})]})})});$e.displayName="CategoryForm";const xa=()=>{const o=j(),e=P(r=>r.crmCategory.data.deleteConfirmation),a=P(r=>r.crmCategory.data.selectedCategory),s=()=>{o(Y(!1))},n=(r,p,y,u)=>{var g,c,C;const m=(g=r==null?void 0:r.payload)==null?void 0:g.success;p.push(t.jsx(R,{title:m?y:u,type:m?"success":"danger",duration:2500,children:m?(c=r==null?void 0:r.payload)==null?void 0:c.message:(C=r==null?void 0:r.error)==null?void 0:C.message}),{placement:"top-end"})},i=async()=>{o(Y(!1));const r=await o(ga(a==null?void 0:a.id));n(r,v,"Successfully Deleted","Something Went Wrong !!!"),await o(F())};return t.jsx(we,{isOpen:e,type:"danger",title:"Delete Category",confirmButtonColor:"red-600",onClose:s,onRequestClose:s,onCancel:s,onConfirm:i,children:t.jsx("p",{children:"Are you sure you want to delete this Category? All record related to this Category will be deleted as well. This action cannot be undone."})})};de("crmCategory",ya);const ba=()=>{const o=j(),e=P(n=>n.crmCategory.data.isDialogOpen),a=P(n=>n.crmCategory.data.dialogMode),s=()=>{o(B(!1))};return f.useEffect(()=>{o(F())},[]),t.jsxs(t.Fragment,{children:[t.jsx(Ca,{}),t.jsx(ha,{}),t.jsxs(he,{isOpen:e,onClose:s,children:[t.jsxs("h5",{className:"mb-4",children:[a==="Edit"?"Edit":"Add New"," Category"]}),t.jsx($e,{})]}),t.jsx(xa,{})]})},ja="crmSubCategory",Sa={total:0,pageIndex:1,pageSize:10,query:"",sort:{order:"",key:""}},wa={loading:!1,tableData:Sa,displayedSubCategoryList:[],subCategoryList:[],categoryList:[],isDialogOpen:!1,dialogMode:"Add",selectedSubCategory:null,deleteConfirmation:!1},Z=S("crmSubCategory/data/createSubCategory",async o=>{var e,a;try{return(await Qe(o)).data}catch(s){throw new Error((a=(e=s==null?void 0:s.response)==null?void 0:e.data)==null?void 0:a.message)}}),$=S("crmSubCategory/data/getSubCategory",async()=>{var o,e;try{return(await Ee()).data}catch(a){throw new Error((e=(o=a==null?void 0:a.response)==null?void 0:o.data)==null?void 0:e.message)}}),Re=S("crmSubCategory/data/getCategory",async()=>{var o,e;try{return(await ce()).data}catch(a){throw new Error((e=(o=a==null?void 0:a.response)==null?void 0:o.data)==null?void 0:e.message)}}),Da=S("crmSubCategory/data/editSubCategory",async({id:o,updatedData:e})=>{var a,s;try{return(await Ue(o,e)).data}catch(n){throw new Error((s=(a=n==null?void 0:n.response)==null?void 0:a.data)==null?void 0:s.message)}}),Na=S("crmSubCategory/data/deleteSubCategory",async o=>{var e,a;try{return await Ye(o)}catch(s){throw new Error((a=(e=s==null?void 0:s.response)==null?void 0:e.data)==null?void 0:a.message)}}),qe=ne({name:`${ja}/state`,initialState:wa,reducers:{setTableData:(o,e)=>{o.tableData=e.payload;const a=o.subCategoryList.filter(s=>s.name.toLowerCase().includes(e.payload.query.toLowerCase()));o.displayedSubCategoryList=a.slice(e.payload.pageSize*(e.payload.pageIndex-1),e.payload.pageSize*e.payload.pageIndex)},setSelectedSubCategory:(o,e)=>{o.selectedSubCategory=e.payload},setDialogToggle:(o,e)=>{o.isDialogOpen=e.payload},setDialogMode:(o,e)=>{o.dialogMode=e.payload},toggleDeleteConfirmation:(o,e)=>{o.deleteConfirmation=e.payload}},extraReducers:o=>{o.addCase(Z.fulfilled,(e,a)=>{e.loading=!1}).addCase(Z.pending,e=>{e.loading=!0}).addCase($.fulfilled,(e,a)=>{var s;e.loading=!1,e.subCategoryList=a==null?void 0:a.payload.data,e.tableData.total=(s=a.payload.data)==null?void 0:s.length,e.displayedSubCategoryList=a==null?void 0:a.payload.data.slice(0,10)}).addCase(Re.fulfilled,(e,a)=>{e.categoryList=a==null?void 0:a.payload.data}).addCase($.pending,e=>{e.loading=!0})}}),{setTableData:V,setSelectedSubCategory:Te,setDialogToggle:K,setDialogMode:Oe,toggleDeleteConfirmation:J}=qe.actions,Ia=qe.reducer,Ta=le({data:Ia}),A=ie,Aa=()=>{const o=j(),e=A(r=>r.crmSubCategory.data.deleteConfirmation),a=A(r=>r.crmSubCategory.data.selectedSubCategory),s=()=>{o(J(!1))},n=(r,p,y,u)=>{var g,c,C;const m=(g=r==null?void 0:r.payload)==null?void 0:g.success;p.push(t.jsx(R,{title:m?y:u,type:m?"success":"danger",duration:2500,children:m?(c=r==null?void 0:r.payload)==null?void 0:c.message:(C=r==null?void 0:r.error)==null?void 0:C.message}),{placement:"top-end"})},i=async()=>{o(J(!1));const r=await o(Na(a==null?void 0:a.id));n(r,v,"Successfully Deleted","Something Went Wrong !!!"),await o($())};return t.jsx(we,{isOpen:e,type:"danger",title:"Delete Sub Category",confirmButtonColor:"red-600",onClose:s,onRequestClose:s,onCancel:s,onConfirm:i,children:t.jsx("p",{children:"Are you sure you want to delete this Sub Category? All record related to this Sub Category will be deleted as well. This action cannot be undone."})})},Pa=k().shape({categoryId:k().required("Category is required"),name:X().required("Sub Category name is required")}),Fe=f.forwardRef((o,e)=>{const a=j(),s=A(u=>u.crmSubCategory.data.dialogMode),n=A(u=>u.crmSubCategory.data.selectedSubCategory),i=A(u=>u.crmSubCategory.data.categoryList),r=f.useMemo(()=>i.map(m=>({label:m.name,value:m.id})),[i]),p=()=>{a(K(!1))},y=async(u,m,g,c,C)=>{var w,T,q;const x={name:m.name,categoryId:m.categoryId.value},h=await c(u==="Add"?Z(x):Da({id:g==null?void 0:g.id,updatedData:x}));let d="",l="",b="danger";(w=h==null?void 0:h.payload)!=null&&w.success?(d="Successfully Added",l=(T=h==null?void 0:h.payload)==null?void 0:T.message,b="success"):(d="Something went wrong !!!",l=(q=h==null?void 0:h.error)==null?void 0:q.message),C.push(t.jsx(R,{title:d,type:b,duration:2500,children:l}),{placement:"top-end"}),c(K(!1)),await c($())};return t.jsx(be,{innerRef:e,initialValues:{name:s==="Edit"?n==null?void 0:n.name:"",categoryId:s==="Edit"?r.find(u=>u.value===(n==null?void 0:n.category.id)):""},validationSchema:Pa,onSubmit:async(u,{setSubmitting:m})=>{s==="Add"?await y("Add",u,null,a,v):await y("Edit",u,n,a,v),m(!1)},children:({touched:u,errors:m,values:g,setFieldValue:c})=>t.jsxs(je,{children:[t.jsxs(fe,{children:[t.jsx(M,{label:"Category Name",invalid:m.categoryId&&u.categoryId,errorMessage:m.categoryId,children:t.jsx(E,{type:"text",autoComplete:"off",name:"categoryId",placeholder:"Category",options:r,component:Q,prefix:t.jsx(O,{className:"text-xl"}),onChange:C=>{c("categoryId",C)}})}),t.jsx(M,{label:"Sub Category Name",invalid:m.name&&u.name,errorMessage:m.name,children:t.jsx(E,{type:"text",autoComplete:"off",name:"name",placeholder:"Sub Category Name",component:L,prefix:t.jsx(O,{className:"text-xl"})})})]}),t.jsx(xe,{className:"flex items-center justify-end py-2",stickyClass:"border-t bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700",children:t.jsxs("div",{className:"md:flex items-center",children:[t.jsx(I,{size:"sm",className:"ltr:mr-3 rtl:ml-3",type:"button",onClick:p,children:"Cancel"}),t.jsx(I,{size:"sm",type:"submit",variant:"solid",icon:t.jsx(Se,{}),children:"Save"})]})})]})})});Fe.displayName="SubCategoryForm";const va=()=>{const o=j(),e=A(d=>d.crmSubCategory.data.loading),a=A(d=>d.crmSubCategory.data.displayedSubCategoryList),s=z("roles","canModify"),n=z("roles","canDelete"),{pageIndex:i,pageSize:r,sort:p,query:y,total:u}=A(d=>d.crmSubCategory.data.tableData),m=f.useMemo(()=>({pageIndex:i,pageSize:r,sort:p,query:y,total:u}),[i,r,p,y,u]),g=({row:d})=>{const l=j(),{textTheme:b}=Ce(),w=()=>{l(Te(d)),l(K(!0)),l(Oe("Edit"))},T=async()=>{await l(Te(d)),l(J(!0))};return t.jsxs("div",{className:"flex justify-start text-lg",children:[t.jsx("span",{className:`cursor-pointer p-2 hover:${b}`,onClick:w,children:t.jsx(me,{})}),t.jsx("span",{className:"cursor-pointer p-2 hover:text-red-500",onClick:T,children:t.jsx(ue,{})})]})},c=f.useMemo(()=>[{header:"Action",id:"action",cell:l=>t.jsx(g,{row:l.row.original})},{header:"Sub Category",accessorKey:"name",cell:l=>l.row.original.name},{header:"Category",accessorKey:"name",cell:l=>l.row.original.category.name}],[s,n]),C=d=>{const l=N(m);l.pageIndex=d,o(V(l))},x=d=>{const l=N(m);l.pageSize=Number(d),l.pageIndex=1,o(V(l))},h=d=>{const l=N(m);l.sort=d,o(V(l))};return t.jsx("div",{children:t.jsx(ye,{columns:c,data:a,skeletonAvatarColumns:[0],skeletonAvatarProps:{width:28,height:28},loading:e,pagingData:{total:m.total,pageIndex:m.pageIndex,pageSize:m.pageSize},onPaginationChange:C,onSelectChange:x,onSort:h})})},Be=f.forwardRef((o,e)=>{const{onInputChange:a}=o,s=pe(n,500);function n(r){a==null||a(r)}const i=r=>{s(r.target.value)};return t.jsx(L,{ref:e,className:"max-w-md md:w-52 mb-4",size:"sm",placeholder:"Search",prefix:t.jsx(ge,{className:"text-lg"}),onChange:i})});Be.displayName="SubCategoryTableSearch";const Ma=()=>{const o=j(),e=f.useRef(null),a=A(i=>i.crmSubCategory.data.tableData),s=i=>{const r=N(a);r.query=i,r.pageIndex=1,typeof i=="string"&&i.length>1&&n(r),typeof i=="string"&&i.length===0&&n(r)},n=i=>{console.log(i),o(i?V(i):$())};return t.jsxs("div",{className:"md:flex items-center justify-between",children:[t.jsx("div",{className:"md:flex items-center gap-4",children:t.jsx(Be,{ref:e,onInputChange:s})}),t.jsxs("div",{className:"mb-4",children:[t.jsx(I,{size:"sm",className:"me-2",onClick:()=>{},children:"Clear All"}),t.jsx(I,{size:"sm",onClick:()=>{o(K(!0)),o(Oe("Add"))},children:"Add New"})]})]})};de("crmSubCategory",Ta);const Ea=()=>{const o=j(),e=A(n=>n.crmSubCategory.data.isDialogOpen),a=A(n=>n.crmSubCategory.data.dialogMode),s=()=>{o(K(!1))};return f.useEffect(()=>{o($()),o(Re())},[]),t.jsxs(t.Fragment,{children:[t.jsx(Ma,{}),t.jsx(va,{}),t.jsxs(he,{isOpen:e,onClose:s,children:[t.jsxs("h5",{className:"mb-4",children:[a==="Edit"?"Edit":"Add New"," Sub Category"]}),t.jsx(Fe,{})]}),t.jsx(Aa,{})]})},La="crmProduct",ka={total:0,pageIndex:1,pageSize:10,query:"",sort:{order:"",key:""}},za={loading:!1,tableData:ka,displayedProductList:[],productList:[],categoryList:[],subCategoryList:[],selectedProduct:null,isDialogOpen:!1,dialogMode:"Add",deleteConfirmation:!1},ee=S("crmProduct/data/createProduct",async o=>{var e,a;try{return(await Ze(o)).data}catch(s){throw new Error((a=(e=s==null?void 0:s.response)==null?void 0:e.data)==null?void 0:a.message)}}),_=S("crmProduct/data/getProduct",async()=>{var o,e;try{return(await Je()).data}catch(a){throw new Error((e=(o=a==null?void 0:a.response)==null?void 0:o.data)==null?void 0:e.message)}}),ae=S("crmProduct/data/editProduct",async({id:o,updatedData:e})=>{var a,s;try{return(await ea(o,e)).data}catch(n){throw new Error((s=(a=n==null?void 0:n.response)==null?void 0:a.data)==null?void 0:s.message)}}),te=S("crmProduct/data/deleteProduct",async o=>{var e,a;try{return await aa(o)}catch(s){throw new Error((a=(e=s==null?void 0:s.response)==null?void 0:e.data)==null?void 0:a.message)}}),oe=S("crmProduct/data/getSubByIdCategory",async o=>{var e,a;try{const s=await ta(o);return console.log(s.data),s.data}catch(s){throw new Error((a=(e=s==null?void 0:s.response)==null?void 0:e.data)==null?void 0:a.message)}}),Ae=S("crmProduct/data/getSubCategory",async()=>{var o,e;try{const a=await Ee();return console.log(a.data),a.data}catch(a){throw new Error((e=(o=a==null?void 0:a.response)==null?void 0:o.data)==null?void 0:e.message)}}),se=S("crmProduct/data/getCategory",async()=>{var o,e;try{return(await ce()).data}catch(a){throw new Error((e=(o=a==null?void 0:a.response)==null?void 0:o.data)==null?void 0:e.message)}}),Ke=ne({name:`${La}/state`,initialState:za,reducers:{setTableData:(o,e)=>{o.tableData=e.payload;const a=o.productList.filter(s=>s.name.toLowerCase().includes(e.payload.query.toLowerCase()));o.displayedProductList=a.slice(e.payload.pageSize*(e.payload.pageIndex-1),e.payload.pageSize*e.payload.pageIndex)},setSelectedProduct:(o,e)=>{o.selectedProduct=e.payload},setDialogToggle:(o,e)=>{o.isDialogOpen=e.payload},setDialogMode:(o,e)=>{o.dialogMode=e.payload},toggleDeleteConfirmation:(o,e)=>{o.deleteConfirmation=e.payload}},extraReducers:o=>{o.addCase(ee.fulfilled,(e,a)=>{e.loading=!1}).addCase(ee.pending,e=>{e.loading=!0}).addCase(_.fulfilled,(e,a)=>{var s;e.loading=!1,e.productList=a==null?void 0:a.payload.data,e.tableData.total=(s=a.payload.data)==null?void 0:s.length,e.displayedProductList=a==null?void 0:a.payload.data.slice(0,10)}).addCase(oe.fulfilled,(e,a)=>{e.loading=!1,e.subCategoryList=a==null?void 0:a.payload.data}).addCase(Ae.fulfilled,(e,a)=>{e.loading=!1,e.subCategoryList=a==null?void 0:a.payload.data}).addCase(se.fulfilled,(e,a)=>{e.categoryList=a==null?void 0:a.payload.data}).addCase(se.pending,e=>{e.loading=!0}).addCase(oe.pending,e=>{e.loading=!0}).addCase(Ae.pending,e=>{e.loading=!0}).addCase(te.pending,e=>{e.loading=!0}).addCase(te.fulfilled,e=>{e.loading=!1}).addCase(ae.pending,e=>{e.loading=!0}).addCase(ae.fulfilled,e=>{e.loading=!1})}}),{setTableData:H,setSelectedProduct:Pe,setDialogToggle:W,setDialogMode:We,toggleDeleteConfirmation:re}=Ke.actions,$a=Ke.reducer,Ra=le({data:$a}),D=ie,qa=k().shape({categoryId:k().required("Category is required"),subCategoryId:k().notRequired(),name:X().required("Product name is required"),price:ra().test("greaterThanOne","Price must be greater than 1",o=>o>1).required("Price is required"),description:X().notRequired()}),_e=f.forwardRef((o,e)=>{const a=j(),s=D(g=>g.crmProduct.data.dialogMode),n=D(g=>g.crmProduct.data.selectedProduct),i=D(g=>g.crmProduct.data.categoryList),r=D(g=>g.crmProduct.data.subCategoryList),p=f.useMemo(()=>i.map(c=>({label:c.name,value:c.id})),[i]),y=f.useMemo(()=>r.map(c=>({label:c.name,value:c.id})),[r]),u=()=>{a(W(!1))},m=async(g,c,C,x,h)=>{var q,De,Ne;const d={name:c.name,categoryId:c.categoryId.value,subCategoryId:c.subCategoryId.value,price:c.price,description:c.description},l=await x(g==="Add"?ee(d):ae({id:C==null?void 0:C.id,updatedData:d}));let b="",w="",T="danger";(q=l==null?void 0:l.payload)!=null&&q.success?(b="Successfully Added",w=(De=l==null?void 0:l.payload)==null?void 0:De.message,T="success"):(b="Something went wrong !!!",w=(Ne=l==null?void 0:l.error)==null?void 0:Ne.message),h.push(t.jsx(R,{title:b,type:T,duration:2500,children:w}),{placement:"top-end"}),x(W(!1)),await x(_())};return console.log(n),t.jsx(be,{innerRef:e,initialValues:{name:s==="Edit"?n==null?void 0:n.name:"",categoryId:s==="Edit"?p.find(g=>g.value===(n==null?void 0:n.categoryId)):"",subCategoryId:s==="Edit"?y.find(g=>g.value===(n==null?void 0:n.subCategoryId)):"",price:s==="Edit"?n==null?void 0:n.price:0,description:s==="Edit"?n==null?void 0:n.description:""},validationSchema:qa,onSubmit:async(g,{setSubmitting:c})=>{s==="Add"?await m("Add",g,null,a,v):await m("Edit",g,n,a,v),c(!1)},children:({touched:g,errors:c,values:C,setFieldValue:x})=>t.jsxs(je,{children:[t.jsxs(fe,{children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsx("div",{className:"col-span-1",children:t.jsx(M,{label:"Category",invalid:c.categoryId&&g.categoryId,errorMessage:c.categoryId,children:t.jsx(E,{type:"text",autoComplete:"off",name:"categoryId",placeholder:"Category",options:p,component:Q,prefix:t.jsx(O,{className:"text-xl"}),onChange:async h=>{await a(oe(h.value)),x("categoryId",h)}})})}),t.jsx("div",{className:"col-span-1",children:t.jsx(M,{label:"Sub Category",invalid:c.subCategoryId&&g.subCategoryId,errorMessage:c.subCategoryId,children:t.jsx(E,{type:"text",autoComplete:"off",name:"subCategoryId",placeholder:"Sub Category",options:y,component:Q,prefix:t.jsx(O,{className:"text-xl"}),onChange:h=>{x("subCategoryId",h)}})})})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsx("div",{className:"col-span-1",children:t.jsx(M,{label:"Product Name",invalid:c.name&&g.name,errorMessage:c.name,children:t.jsx(E,{type:"text",autoComplete:"off",name:"name",placeholder:"Product Name",component:L,prefix:t.jsx(la,{className:"text-xl"})})})}),t.jsx("div",{className:"col-span-1",children:t.jsx(M,{label:"Price",invalid:c.price&&g.price,errorMessage:c.price,children:t.jsx(E,{type:"number",autoComplete:"off",name:"price",placeholder:"Price",component:L,prefix:t.jsx(na,{className:"text-xl"})})})})]}),t.jsx(M,{label:"Description",invalid:c.description&&g.description,errorMessage:c.description,children:t.jsx(E,{type:"text",autoComplete:"off",name:"description",placeholder:"Description",component:L,prefix:t.jsx(sa,{className:"text-xl"})})})]}),t.jsx(xe,{className:"flex items-center justify-end py-2",stickyClass:"border-t bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700",children:t.jsxs("div",{className:"md:flex items-center",children:[t.jsx(I,{size:"sm",className:"ltr:mr-3 rtl:ml-3",type:"button",onClick:u,children:"Cancel"}),t.jsx(I,{size:"sm",type:"submit",variant:"solid",icon:t.jsx(Se,{}),children:"Save"})]})})]})})});_e.displayName="ProductForm";const Oa=()=>{const o=j(),e=D(d=>d.crmProduct.data.loading),a=z("roles","canModify"),s=z("roles","canDelete"),{pageIndex:n,pageSize:i,sort:r,query:p,total:y}=D(d=>d.crmProduct.data.tableData),u=f.useMemo(()=>({pageIndex:n,pageSize:i,sort:r,query:p,total:y}),[n,i,r,p,y]),m=D(d=>d.crmProduct.data.displayedProductList),g=({row:d})=>{const l=j(),{textTheme:b}=Ce(),w=()=>{l(Pe(d)),l(W(!0)),l(We("Edit"))},T=async()=>{await l(Pe(d)),l(re(!0))};return t.jsxs("div",{className:"flex justify-start text-lg",children:[t.jsx("span",{className:`cursor-pointer p-2 hover:${b}`,onClick:w,children:t.jsx(me,{})}),t.jsx("span",{className:"cursor-pointer p-2 hover:text-red-500",onClick:T,children:t.jsx(ue,{})})]})},c=f.useMemo(()=>[{header:"Action",id:"action",cell:l=>t.jsx(g,{row:l.row.original})},{header:"Product",accessorKey:"name",cell:l=>l.row.original.name},{header:"Category",accessorKey:"category.name",cell:l=>l.row.original.category.name},{header:"Sub Category",accessorKey:"subCategory.name",cell:l=>{var b;return((b=l.row.original.subCategory)==null?void 0:b.name)||"-"}},{header:"Price",accessorKey:"price",cell:l=>l.row.original.price},{header:"Description",accessorKey:"description",cell:l=>{const b=l.row.original.description;return t.jsx(ia,{text:b,maxLength:20})}}],[a,s]),C=d=>{const l=N(u);l.pageIndex=d,o(H(l))},x=d=>{const l=N(u);l.pageSize=Number(d),l.pageIndex=1,o(H(l))},h=d=>{const l=N(u);l.sort=d,o(H(l))};return t.jsx("div",{children:t.jsx(ye,{columns:c,data:m,skeletonAvatarColumns:[0],skeletonAvatarProps:{width:28,height:28},loading:e,pagingData:{total:u.total,pageIndex:u.pageIndex,pageSize:u.pageSize},onPaginationChange:C,onSelectChange:x,onSort:h})})},Ge=f.forwardRef((o,e)=>{const{onInputChange:a}=o,s=pe(n,500);function n(r){a==null||a(r)}const i=r=>{s(r.target.value)};return t.jsx(L,{ref:e,className:"max-w-md md:w-52 mb-4",size:"sm",placeholder:"Search",prefix:t.jsx(ge,{className:"text-lg"}),onChange:i})});Ge.displayName="ProductTableSearch";const Fa=()=>{const o=j(),e=f.useRef(null),a=D(i=>i.crmProduct.data.tableData),s=i=>{const r=N(a);r.query=i,r.pageIndex=1,typeof i=="string"&&i.length>1&&n(r),typeof i=="string"&&i.length===0&&n(r)},n=i=>{console.log(i),o(i?H(i):_())};return t.jsxs("div",{className:"md:flex items-center justify-between",children:[t.jsx("div",{className:"md:flex items-center gap-4",children:t.jsx(Ge,{ref:e,onInputChange:s})}),t.jsxs("div",{className:"mb-4",children:[t.jsx(I,{size:"sm",className:"me-2",onClick:()=>{},children:"Clear All"}),t.jsx(I,{size:"sm",onClick:()=>{o(W(!0)),o(We("Add"))},children:"Add New"})]})]})},Ba=()=>{const o=j(),e=D(r=>r.crmProduct.data.deleteConfirmation),a=D(r=>r.crmProduct.data.selectedProduct),s=()=>{o(re(!1))},n=(r,p,y,u)=>{var g,c,C;const m=(g=r==null?void 0:r.payload)==null?void 0:g.success;p.push(t.jsx(R,{title:m?y:u,type:m?"success":"danger",duration:2500,children:m?(c=r==null?void 0:r.payload)==null?void 0:c.message:(C=r==null?void 0:r.error)==null?void 0:C.message}),{placement:"top-end"})},i=async()=>{o(re(!1));const r=await o(te(a==null?void 0:a.id));n(r,v,"Successfully Deleted","Something Went Wrong !!!"),await o(_())};return t.jsx(we,{isOpen:e,type:"danger",title:"Delete Product",confirmButtonColor:"red-600",onClose:s,onRequestClose:s,onCancel:s,onConfirm:i,children:t.jsx("p",{children:"Are you sure you want to delete this Product? All record related to this Product will be deleted as well. This action cannot be undone."})})};de("crmProduct",Ra);const Ka=()=>{const o=j(),e=D(n=>n.crmProduct.data.isDialogOpen),a=D(n=>n.crmProduct.data.dialogMode),s=()=>{o(W(!1))};return f.useEffect(()=>{o(_()),o(se())},[]),t.jsxs(t.Fragment,{children:[t.jsx(Fa,{}),t.jsx(Oa,{}),t.jsxs(he,{isOpen:e,onClose:s,children:[t.jsxs("h5",{className:"mb-4",children:[a==="Edit"?"Edit":"Add New"," Product"]}),t.jsx(_e,{})]}),t.jsx(Ba,{})]})},{TabNav:Wa,TabList:_a}=Me,ve={category:{label:"Category",path:"category"},subCategory:{label:"SubCategory",path:"subCategory"},product:{label:"Product",path:"product"}},Ga=()=>{const[o,e]=f.useState("category"),a=s=>{e(s)};return t.jsxs(t.Fragment,{children:[t.jsx(Me,{value:o,variant:"pill",onChange:s=>a(s),children:t.jsx(_a,{children:Object.keys(ve).map(s=>t.jsx(Wa,{value:s,children:ve[s].label},s))})}),t.jsx("div",{className:"py-4",children:t.jsxs(f.Suspense,{fallback:t.jsx(t.Fragment,{children:"loading..."}),children:[o==="category"&&t.jsx(ba,{}),o==="subCategory"&&t.jsx(Ea,{}),o==="product"&&t.jsx(Ka,{})]})})]})},Jt=Ga;export{Jt as I};
