import{a as M,j as e,r as h,ap as oe,aq as ie}from"./index-de229e0f.js";import{A as ne}from"./AdaptableCard-73970f77.js";import{F as W}from"./FormDesription-4c1c908a.js";import{D as ce}from"./DataTable-fb614c2b.js";import{T as le}from"./TagsList-d81f919b.js";import{T as q}from"./TextTruncate-b6fa38c4.js";import{u as Z}from"./checkEditUpdate-2235bd5d.js";import{u as de}from"./useThemeClass-d77d5188.js";import{c as B}from"./cloneDeep-e3592be4.js";import{O as me,P as pe,Q as ue,b as xe}from"./index.esm-aee8ac7d.js";import{u as C,t as H,d as he,g as P,a as V,b as ge,c as fe,e as Ce,f as je,h as Ne,i as be,j as X,k as ye,l as we,m as Y,s as O,n as L,o as ee,r as ve}from"./index-30642ee1.js";import{t as _,N as G}from"./toast-2a495ac5.js";import{C as Ie}from"./ConfirmDialog-3591d1f6.js";import{B as U}from"./Button-b15cd132.js";import{D as Se}from"./Drawer-f0faeb9e.js";import{a as b,F as De}from"./FormItem-babd9538.js";import{T as te}from"./index-c847ee3d.js";import{u as Te,b as D,F as Fe,a as Me}from"./formik.esm-db3e081d.js";import{c as Ae,a as y,e as ze}from"./index.esm-863c1a13.js";import{I as F}from"./Input-0edbc257.js";/* empty css              */import{T as Ee,e as ke}from"./index.esm-079ccece.js";import"./Alert-6c1fb93d.js";import"./index-014db2f3.js";import"./Badge-1c9640f8.js";import"./RangeCalendar-a7904a79.js";import"./Card-a97e4c2f.js";import"./index-5d48ec0d.js";import"./index-c1fa956a.js";import"./Dialog-8e46cfc1.js";import"./index-3edcad3a.js";import"./toString-99f06a6f.js";import"./index-5c089da4.js";import"./index-a531e03b.js";import"./index-6be331b1.js";import"./Pagination-eeb66415.js";import"./Progress-3fcd9e67.js";import"./index-8cb693c7.js";import"./ScrollBar-19fef748.js";import"./index-da4e4b17.js";import{S as R}from"./Select-7b8d032a.js";import"./Skeleton-fe9c87f9.js";import"./index-2cc6f2e5.js";import"./Switcher-a81d65e1.js";import"./index-a5a888d3.js";import"./Tag-416f4bd5.js";import"./index-f77eb852.js";import"./index-3ec890d7.js";import{T as K}from"./Tooltip-f07ebc4b.js";import"./Upload-bc5be741.js";import{t as qe}from"./tagAndCategory-228f57e7.js";import{B as Le}from"./index.esm-9e33621c.js";import{F as Re}from"./index.esm-181c8c38.js";import{a as Q}from"./index.esm-e920c6bb.js";import{G as J}from"./index.esm-de9b7c0a.js";import{M as Oe}from"./index.esm-b2a3e018.js";import{C as $e}from"./react-select-creatable.esm-51dd59ae.js";import{a as Ke}from"./index.esm-2164e7d1.js";import{d as We}from"./debounce-3198f06d.js";import"./index-bcf5a82e.js";import"./_MapCache-af06afb7.js";import"./Views-e5666688.js";import"./_getPrototype-3735b5b3.js";import"./CrmService-3972df40.js";import"./useTimeout-73ec5f9b.js";import"./CloseButton-a4aa9973.js";import"./StatusIcon-6f48f0ae.js";import"./chainedFunction-070f832c.js";import"./index-ea6d121c.js";import"./index-95f7d6b8.js";import"./useControllableState-c13b1cb7.js";import"./isNil-8888295d.js";import"./get-9c32eaa8.js";import"./useMergeRef-788c4cb0.js";import"./_baseIsEqual-e27983a5.js";import"./useRootClose-2530cd3e.js";import"./usePopper-beea1819.js";import"./TimeInput-d14a467e.js";import"./useUniqueId-c7e0bf5f.js";import"./useDidUpdate-be9907f8.js";import"./useUncertainRef-4abf232b.js";import"./slicedToArray-dce459c5.js";import"./objectWithoutProperties-8809bfcf.js";import"./toConsumableArray-ccf7c0d4.js";import"./floating-ui.dom-bef9cea3.js";import"./mapCloneElement-03a07d0b.js";import"./index.esm-7525e498.js";const Ze=()=>{const r=M(),c=C(o=>o.crmContact.data.deleteConfirmation),t=C(o=>o.crmContact.data.selectedContact),l=()=>{r(H(!1))},d=async()=>{var u,m,x;r(H(!1));const o=await r(he(t==null?void 0:t.id));(u=o==null?void 0:o.payload)!=null&&u.success?_.push(e.jsx(G,{title:"Successfuly Deleted",type:"success",duration:2500,children:(m=o==null?void 0:o.payload)==null?void 0:m.message}),{placement:"top-end"}):_.push(e.jsx(G,{title:"Something Went Wrong !!!",type:"danger",duration:2500,children:(x=o==null?void 0:o.error)==null?void 0:x.message}),{placement:"top-end"}),await r(P()),await r(V())};return e.jsx(Ie,{isOpen:c,type:"danger",title:"Delete Contact",confirmButtonColor:"red-600",onClose:l,onRequestClose:l,onCancel:l,onConfirm:d,children:e.jsx("p",{children:"Are you sure you want to delete this Contact? All record related to this contact will be deleted as well. This action cannot be undone."})})},Be=r=>{const{touched:c,errors:t,values:l,setFieldValue:d}=r,o=M(),[u,m]=h.useState([]),[x,v]=h.useState(null),I=C(a=>a.crmContact.data.companyList),p=C(a=>a.crmContact.data.sources),f=C(a=>a.crmContact.data.states);C(a=>a.crmContact.data.cities);const w=h.useMemo(()=>I==null?void 0:I.map(a=>({value:a.id,label:a.companyName})),[I]),j=h.useMemo(()=>f==null?void 0:f.map(a=>({value:a.id,label:a.stateName})),[f]),T=h.useMemo(()=>{var s;const a=f==null?void 0:f.find(i=>i.id===l.stateId);return((s=a==null?void 0:a.cities)==null?void 0:s.map(i=>({value:i.id,label:i.cityName})))||[]},[f,x]),A=h.useMemo(()=>p==null?void 0:p.map(s=>({label:s.sources,value:s.id})),[p]);h.useEffect(()=>{(async()=>{var s,i;try{const{payload:n}=await o(je()),g=(s=n==null?void 0:n.data)==null?void 0:s.find(N=>(N==null?void 0:N.moduleName)==="contacts");if(g){const{payload:N}=await o(Ne({id:(i=g==null?void 0:g.id)==null?void 0:i.toString()})),S=qe(N==null?void 0:N.data);m(S)}}catch(n){console.error("Error fetching module data:",n)}})(),o(ge()),o(fe()),o(Ce())},[o]);const z=Te(),E=a=>{z.setFieldValue("tagId",a)},k=async(a,s)=>{const i={sources:a==null?void 0:a.label};switch(s.action){case"create-option":await o(be(i)),await o(X());break;case"select-option":d("sourceId",a);break;case"clear":d("sourceId",null);break}};return e.jsxs(e.Fragment,{children:[e.jsx(W,{title:"Contact Basic Information",desc:"",className:"mb-2"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"col-span-1",children:e.jsx(b,{label:"First Name *",invalid:t.firstName&&c.firstName,errorMessage:t.firstName,children:e.jsx(D,{type:"text",autoComplete:"off",name:"firstName",placeholder:"First Name",component:F,prefix:e.jsx(Q,{className:"text-xl"})})})}),e.jsx("div",{className:"col-span-1",children:e.jsx(b,{label:"Last Name *",invalid:t.lastName&&c.lastName,errorMessage:t.lastName,children:e.jsx(D,{type:"text",autoComplete:"off",name:"lastName",placeholder:"Last Name",component:F,prefix:e.jsx(Q,{className:"text-xl"})})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"col-span-1",children:e.jsx(b,{label:"Email *",invalid:t.email&&c.email,errorMessage:t.email,children:e.jsx(D,{type:"text",autoComplete:"off",name:"email",placeholder:"Email",component:F,prefix:e.jsx(me,{className:"text-xl"})})})}),e.jsx("div",{className:"col-span-1",children:e.jsx(b,{label:"Contact Number *",invalid:t.contactNumber&&c.contactNumber,errorMessage:t.contactNumber,children:e.jsx(D,{type:"tel",autoComplete:"off",name:"contactNumber",placeholder:"Contact Number",component:F,prefix:e.jsx(Le,{className:"text-xl"})})})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsx("div",{className:"col-span-1",children:e.jsx(b,{label:"Title",invalid:t.title&&c.title,errorMessage:t.title,children:e.jsx(D,{type:"text",autoComplete:"off",name:"title",placeholder:"Title",component:F,prefix:e.jsx(Oe,{className:"text-xl"})})})})}),e.jsx(b,{label:"Notes",invalid:t.description&&c.description,errorMessage:t.description,children:e.jsx(D,{textArea:!0,type:"text",autoComplete:"off",name:"description",placeholder:"Notes",component:F,prefix:e.jsx(Ee,{className:"text-xl"})})}),e.jsx(W,{title:"Address",desc:"",className:"mb-2"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"col-span-1",children:e.jsx(b,{label:"Address",invalid:t.address&&c.address,errorMessage:t.address,children:e.jsx(D,{type:"text",autoComplete:"off",name:"address",placeholder:"Address",component:F,prefix:e.jsx(Re,{className:"text-xl"})})})}),e.jsx("div",{className:"col-span-1",children:e.jsx("div",{className:"col-span-1",children:e.jsx(b,{label:"State",invalid:t.stateId&&c.stateId,errorMessage:t.stateId,children:e.jsx(R,{name:"stateId",placeholder:"Select State",options:j,id:"stateId",value:j==null?void 0:j.find(a=>(a==null?void 0:a.value)==(l==null?void 0:l.stateId)),onChange:a=>{const s=a.value;l.stateId!==s&&d("cityId",""),d("stateId",s||""),v(s)}})})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"col-span-1",children:e.jsx("div",{className:"col-span-1",children:e.jsx(b,{label:"City",invalid:t.cityId&&c.cityId,errorMessage:t.cityId,children:e.jsx(R,{name:"cityId",placeholder:"Select City",options:T,id:"cityId",value:(T==null?void 0:T.find(a=>(a==null?void 0:a.value)===(l==null?void 0:l.cityId)))||{value:"",label:"Select City"},onChange:a=>{const s=a.value;s!==l.cityId&&d("cityId",s||"")}})})})}),e.jsx("div",{className:"col-span-1",children:e.jsx("div",{style:{position:"relative"},children:e.jsx("div",{className:"col-span-1",children:e.jsx(b,{label:"ZipCode",invalid:t.zipcode&&c.zipcode,errorMessage:t.zipcode,children:e.jsx(D,{type:"text",autoComplete:"off",name:"zipcode",placeholder:"ZipCode",component:F,prefix:e.jsx(ke,{className:"text-xl"})})})})})})]}),e.jsx(W,{title:"Contact Others Details",desc:"",className:"mb-2"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"col-span-1",children:e.jsx(b,{label:"Company Name",invalid:t.companiesId&&c.companiesId,errorMessage:t.companiesId,children:e.jsx(R,{name:"companiesId",placeholder:"Company Name",options:w,id:"companiesId",value:w==null?void 0:w.find(a=>(a==null?void 0:a.value)==(l==null?void 0:l.companiesId)),onChange:a=>{const s=a.value;d("companiesId",s||"")}})})}),e.jsx("div",{className:"col-span-1",children:e.jsx(b,{label:"Source",invalid:t.source&&c.source,errorMessage:t.source,children:e.jsx(D,{isClearable:!0,type:"text",autoComplete:"off",name:"sourceId",placeholder:"Source",component:R,componentAs:$e,options:A,prefix:e.jsx(J,{className:"text-xl"}),onChange:k})})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsx("div",{className:"col-span-1",children:e.jsx(b,{label:"Tag",children:e.jsx(D,{isClearable:!0,isMulti:!0,type:"text",autoComplete:"off",name:"tagId",placeholder:"Select tags",component:R,options:u,prefix:e.jsx(J,{className:"text-xl"}),closeMenuOnSelect:!1,onChange:E})})})})]})},Pe=Ae().shape({firstName:y().required("First Name is required"),lastName:y().required("Last Name is required"),title:y(),contactNumber:y().typeError("Contact must be a number").required("Contact is required").test("is-number","Contact must be a number",r=>!isNaN(r)).test("is-ten-digits","Contact must be exactly 10 digits",r=>{if(r){const c=Number(r);return/^\d{10}$/.test(c.toString())}return!0}).test("is-ten-digits","Contact number cannot start with 0",r=>r?!r.startsWith("0"):!0),email:y().matches(/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/i,"Invalid email").required("Email is required"),address:y(),stateId:y(),cityId:y(),zipcode:y().test("is-number","ZipCode must be a number",r=>!(r&&isNaN(Number(r)))).test("is-six-digits","ZipCode must be exactly 6 digits",r=>!(r&&r.length!==6)),companiesId:y().nullable(),companyName:y(),source:y().nullable(),description:y(),tagId:ze()}),{TabNav:He,TabList:_e,TabContent:Ge}=te,ae=h.forwardRef((r,c)=>{var m,x,v,I;const t=C(p=>p.crmContact.data.selectedContact),l=C(p=>p.crmContact.data.sources),d=h.useMemo(()=>l.map(f=>({label:f.sources,value:f.id})),[l]),o=!!t.id,u=M();return e.jsx(Fe,{innerRef:c,initialValues:{firstName:(t==null?void 0:t.firstName)||"",lastName:(t==null?void 0:t.lastName)||"",title:(t==null?void 0:t.title)||"",email:(t==null?void 0:t.email)||"",contactNumber:(t==null?void 0:t.contactNumber)||"",description:(t==null?void 0:t.description)||"",companyName:((m=t==null?void 0:t.company)==null?void 0:m.companyName)||"",sourceId:t!=null&&t.sourceId?d.find(p=>p.value===(t==null?void 0:t.sourceId)):null,address:(t==null?void 0:t.address)||"",stateId:(t==null?void 0:t.stateId)||"",cityId:(t==null?void 0:t.cityId)||"",zipcode:(t==null?void 0:t.zipcode)||"",tagName:((v=(x=t==null?void 0:t.tags)==null?void 0:x[0])==null?void 0:v.tagName)||"",tagId:((I=t==null?void 0:t.tags)==null?void 0:I.map(p=>({label:p.tagName,value:p.id})))||[],companiesId:(t==null?void 0:t.companiesId)||""},validationSchema:Pe,onSubmit:async(p,{setSubmitting:f})=>{var w,j,T,A,z,E,k;try{const{tagName:a,...s}=p,i={...s,sourceId:(w=s==null?void 0:s.sourceId)==null?void 0:w.value,tagId:s==null?void 0:s.tagId.map($=>$.value)},n=o?await u(ye({contactId:(t==null?void 0:t.id)||"",updatedData:i})):await u(we(i)),g=(j=n==null?void 0:n.payload)!=null&&j.success?"Successfully Added":"Something went wrong !!!",N=(T=n==null?void 0:n.payload)!=null&&T.success?"success":"danger",S=(A=n==null?void 0:n.payload)!=null&&A.success?(z=n==null?void 0:n.payload)==null?void 0:z.message:(E=n==null?void 0:n.error)==null?void 0:E.message;_.push(e.jsx(G,{title:g,type:N,duration:2500,children:S}),{placement:"top-end"}),(k=n==null?void 0:n.payload)!=null&&k.success&&u(Y()),await u(P()),await u(V())}catch(a){console.error(a)}finally{f(!1)}},children:({touched:p,errors:f,values:w,setFieldValue:j})=>e.jsx(Me,{children:e.jsx(De,{children:e.jsxs(te,{defaultValue:"personalInfo",children:[e.jsx(_e,{children:e.jsx(He,{value:"personalInfo",children:"Contact Details"})}),e.jsx("div",{className:"p-6",children:e.jsx(Ge,{value:"personalInfo",children:e.jsx(Be,{touched:p,errors:f,values:w,setFieldValue:j})})})]})})})})});ae.displayName="ContactForm";const se=h.forwardRef((r,c)=>{M();const t=C(d=>d.crmContact.data.selectedContact);C(d=>d.crmContact.data.contactList);const l=async d=>{};return e.jsx(ae,{ref:c,contact:t,onFormSubmit:l})});se.displayName="ContactEditContent";const Ue=({onSaveClick:r,onCancel:c})=>e.jsxs("div",{className:"text-right w-full",children:[e.jsx(U,{size:"sm",className:"mr-2",onClick:c,children:"Cancel"}),e.jsx(U,{size:"sm",variant:"solid",onClick:r,children:"Save"})]}),Qe=()=>{const r=M(),[c,t]=h.useState(window.innerWidth/2),l=C(x=>x.crmContact.data.drawerOpen),d=()=>{r(Y()),r(O({}))},o=h.useRef(null),u=()=>{var x,v;console.log("formSubmit function called",(x=o.current)==null?void 0:x.values),(v=o.current)==null||v.submitForm()},m=()=>{t(window.innerWidth/2)};return h.useEffect(()=>(window.addEventListener("resize",m),()=>{window.removeEventListener("resize",m)}),[]),e.jsx(Se,{isOpen:l,closable:!1,bodyClass:"p-0",width:c,footer:e.jsx(Ue,{onCancel:d,onSaveClick:u}),onClose:d,onRequestClose:d,children:e.jsx(se,{ref:o})})},Je=()=>{const r=M(),c=C(a=>a.crmContact.data.displayedContactList),t=C(a=>a.crmContact.data.tableData),l=Z("contacts","canModify"),d=Z("contacts","canDelete"),o=Z("contacts","canView"),u=C(a=>a.crmContact.data.loading),m=oe(),{pageIndex:x,pageSize:v,sort:I,query:p,total:f}=C(a=>a.crmContact.data.tableData),w=h.useCallback(()=>{r(P()),r(X())},[r]);h.useEffect(()=>(w(),()=>{window.location.pathname.includes("contact")||r(L({...t,query:""}))}),[w]);const j=h.useMemo(()=>({pageIndex:x,pageSize:v,sort:I,query:p,total:f}),[x,v,I,p,f]),T=({row:a})=>{const s=M();de();const i=()=>{s(ee()),s(O(a))},n=async()=>{s(O(a)),s(H(!0))},g=()=>{s(O(a));const N=`/app/crm/contact-details/${a.id}`;m(N)};return e.jsxs("div",{className:"flex text-base items-center",children:[l&&e.jsx("span",{className:"cursor-pointer hover:text-indigo-500 circle items-center",onClick:i,children:e.jsx(pe,{})}),d&&e.jsx("span",{className:"cursor-pointer hover:text-red-500 circle mx-1 items-center",onClick:n,children:e.jsx(ue,{})}),o&&e.jsx("span",{className:"cursor-pointer hover:text-green-500 circle items-center text-lg",onClick:g,children:e.jsx(Ke,{})})]})},A=h.useMemo(()=>[{header:"Action",id:"action",cell:s=>e.jsx(T,{row:s.row.original})},{header:"Name",accessorKey:"firstName",cell:s=>{const{firstName:i,lastName:n}=s.row.original,g=`${i} ${n}`;return e.jsx(K,{title:g,children:e.jsx(q,{text:g,maxLength:15})},g)}},{header:"email",accessorKey:"email",cell:s=>s.row.original.email},{header:"Number",accessorKey:"contactNumber",cell:s=>s.row.original.contactNumber},{header:"source",accessorKey:"sourceId",cell:s=>{var n,g,N,S;const i=(g=(n=s.row.original)==null?void 0:n.source)!=null&&g.sources?(S=(N=s.row.original)==null?void 0:N.source)==null?void 0:S.sources:"-";return e.jsx(q,{text:i,maxLength:15})}},{header:"Tags",accessorKey:"tagName",cell:s=>{const i=s.row.original.tags;return i!=null&&i.length>0?e.jsx(le,{tags:i}):"-"}},{header:"Title",accessorKey:"title",cell:s=>{const i=s.row.original.title?s.row.original.title:"-";return e.jsx(K,{title:i,children:e.jsx(q,{text:i,maxLength:15})},i)}},{header:"Company",accessorKey:"companyName",cell:s=>{const i=s.row.original.company?s.row.original.company.companyName:"-";return e.jsx(q,{text:i,maxLength:15})}},{header:"Address",accessorKey:"address",cell:s=>{const{address:i,cityData:n,stateData:g,zipcode:N}=s.row.original,S=[i,n==null?void 0:n.cityName,g==null?void 0:g.stateName,N].filter($=>$!=null).join(" ");return e.jsx(K,{title:S||"-",children:e.jsx(q,{text:S||"-",maxLength:20})},S)}},{header:"Notes",accessorKey:"description",cell:s=>{const i=s.row.original.description?s.row.original.description:"-";return e.jsx(K,{title:i,children:e.jsx(q,{text:i,maxLength:20})},i)}}],[l,d]),z=a=>{const s=B(j);s.pageIndex=a,r(L(s))},E=a=>{const s=B(j);s.pageSize=Number(a),s.pageIndex=1,r(L(s))},k=a=>{const s=B(j);s.sort=a,r(L(s))};return e.jsxs("div",{children:[e.jsx(ce,{columns:A,data:c,loading:u,pagingData:{total:j.total,pageIndex:j.pageIndex,pageSize:j.pageSize},onPaginationChange:z,onSelectChange:E,onSort:k}),e.jsx(Qe,{}),e.jsx(Ze,{})]})},re=h.forwardRef((r,c)=>{const{onInputChange:t}=r,l=We(d,500);function d(u){t==null||t(u)}const o=u=>{l(u.target.value)};return e.jsx(F,{ref:c,className:"max-w-md md:w-52 mb-4",size:"sm",placeholder:"Search by name or email",prefix:e.jsx(xe,{className:"text-lg"}),onChange:o})});re.displayName="ContactTableSearch";const Ve=()=>{const r=M(),c=h.useRef(null),t=C(m=>m.crmContact.data.tableData),l=Z("contacts","canCreate"),d=m=>{const x=B(t);x.query=m,x.pageIndex=1,typeof m=="string"&&m.length>1&&o(x),typeof m=="string"&&m.length===0&&o(x)},o=m=>{r(m?L(m):P())},u=()=>{r(ee()),r(O({}))};return h.useEffect(()=>{c.current&&(c.current.value=t.query||"",r(L(t)))},[t==null?void 0:t.query]),e.jsxs("div",{className:"md:flex items-center justify-between",children:[e.jsx("div",{className:"md:flex items-center gap-4",children:e.jsx(re,{ref:c,onInputChange:d})}),e.jsx("div",{className:"mb-4",children:l&&e.jsx(U,{size:"sm",onClick:u,children:"Add New"})})]})};ie("crmContact",ve);const Xe=()=>{const r=C(c=>c.crmContact.data.tableData);return e.jsx(e.Fragment,{children:e.jsxs(ne,{bodyClass:"h-full",children:[e.jsx(W,{title:`Contacts (${(r==null?void 0:r.total)||0})`,desc:"",className:"mb-2"}),e.jsx(Ve,{}),e.jsx(Je,{})]})})},za=Xe;export{za as default};
