import{a as D,j as e,r as x,ap as je,as as be,ah as Le,aq as Ce}from"./index-212e59d9.js";import{A as ye}from"./AdaptableCard-7132adf3.js";import{D as De}from"./DataTable-c955301a.js";import{S as Ne}from"./StatusCapsule-2a1988f7.js";import{T as ve}from"./TagsList-fd9127a6.js";import{T as I}from"./TextTruncate-2138ab38.js";import{u as K}from"./checkEditUpdate-27de746a.js";import{u as we}from"./useThemeClass-27ed393b.js";import{c as P}from"./cloneDeep-ab34220c.js";import{u as h,t as Y,d as Se,g as T,a as Z,b as Te,f as Ie,c as Ae,e as ee,h as Fe,s as ie,i as Re,j as S,k as O,l as H,m as ne,r as ke}from"./index-28319e1a.js";import{t as E,N as z}from"./toast-b0ba240d.js";import{C as Oe}from"./ConfirmDialog-d9ed0e74.js";import{B as $}from"./Button-5108a1e9.js";import{D as Me}from"./Drawer-17d3b1a4.js";import{a as F,F as ce}from"./FormItem-a926e6de.js";import{T as le}from"./index-669f1295.js";import{u as Ee,b as R,F as de,a as me}from"./formik.esm-4fba5feb.js";import{c as pe,a as G,d as ze,e as $e}from"./index.esm-9e853d59.js";import{I as M}from"./Input-34e936b1.js";/* empty css              */import"./Alert-5e3bd2c1.js";import{A as qe}from"./index-8c729f40.js";import"./Badge-3f18ce6d.js";import"./RangeCalendar-0895addf.js";import{C as Be}from"./Card-19ccdde4.js";import"./index-bf1b9c91.js";import"./index-0f6bf549.js";import{D as Ve}from"./Dialog-e71f3caf.js";import"./index-55739320.js";import"./toString-772abf6a.js";import"./index-2ac45c4d.js";import"./index-68fd43c8.js";import"./index-73f43143.js";import"./Pagination-dcbb77ac.js";import"./Progress-3d61e81c.js";import"./index-04c21f2b.js";import"./ScrollBar-265d1f72.js";import"./index-98d785c8.js";import{S as re}from"./Select-0a00ed0b.js";import"./Skeleton-5bbb4668.js";import"./index-13100f2f.js";import"./Switcher-d7824352.js";import"./index-d86c5414.js";import"./Tag-52bd158f.js";import"./index-476eb339.js";import"./index-4f0614be.js";import{T as A}from"./Tooltip-97f8dea2.js";import"./Upload-c11e28b6.js";import{t as We}from"./tagAndCategory-71f2dbbd.js";import{B as Ke}from"./index.esm-179a66ff.js";import{G as Pe}from"./index.esm-463bf3cc.js";import{M as He}from"./index.esm-82e050da.js";import{T as Ge,a as Ue}from"./index.esm-476e8f48.js";import{N as _e,O as Je,b as Qe,o as Xe,P as Ye,C as Ze}from"./index.esm-479f1ca8.js";import{A as et,a as tt}from"./index.esm-cd80b45e.js";import"./Views-148dac6a.js";import"./chart.constant-1f8310eb.js";import"./chart.config-f71bed06.js";import"./GrowShrinkTag-2538e172.js";import"./react-tooltip.min-c7303514.js";import"./RichTextEditor-02dbe0c0.js";import"./SegmentItemOption-e4992ddb.js";import{S as at}from"./StickyFooter-95dc5999.js";import"./SvgIcon-f63f0d76.js";import{G as st}from"./index.esm-ce0cbbd3.js";import{d as ot}from"./debounce-74ff89d0.js";import{g as rt}from"./index-81eb6f33.js";import{s as it}from"./index-7b8c96c1.js";import{F as nt}from"./FormDesription-00159a58.js";import{M as ct}from"./MediaSkeleton-6019234f.js";import{N as lt}from"./react-number-format.es-13180262.js";import"./index-c71cad45.js";import"./_MapCache-16007607.js";import"./_getPrototype-2834de0b.js";import"./CrmService-3b04f7f1.js";import"./useTimeout-25f63a1e.js";import"./CloseButton-13563c79.js";import"./StatusIcon-54b06855.js";import"./chainedFunction-070f832c.js";import"./index-5fb703df.js";import"./index-fa5e85bc.js";import"./useControllableState-eb3e3b7e.js";import"./isNil-fdf5aed7.js";import"./get-6ac9f60c.js";import"./useMergeRef-788c4cb0.js";import"./_baseIsEqual-575720af.js";import"./useRootClose-c9c002ff.js";import"./usePopper-35198492.js";import"./TimeInput-19e71c5c.js";import"./useUniqueId-3ef42274.js";import"./useDidUpdate-d264bf70.js";import"./useUncertainRef-c52be0c4.js";import"./slicedToArray-098c0090.js";import"./objectWithoutProperties-8809bfcf.js";import"./toConsumableArray-f891a5c4.js";import"./floating-ui.dom-bef9cea3.js";import"./mapCloneElement-866113ac.js";import"./index.esm-c089df14.js";import"./index.esm-59862d7f.js";import"./index-6c0150d6.js";import"./index-4c387525.js";const dt=()=>{const s=D(),r=h(c=>c.crmLeads.data.deleteConfirmation),a=h(c=>c.crmLeads.data.selectedLeads),g=()=>{s(Y(!1))},d=async()=>{var m,l,t;s(Y(!1));const c=await s(Se(a.id));await s(T()),(m=c==null?void 0:c.payload)!=null&&m.success?E.push(e.jsx(z,{title:"Successfuly Deleted",type:"success",duration:2500,children:(l=c==null?void 0:c.payload)==null?void 0:l.message}),{placement:"top-end"}):E.push(e.jsx(z,{title:"Something Went Wrong !!!",type:"danger",duration:2500,children:(t=c==null?void 0:c.error)==null?void 0:t.message}),{placement:"top-end"}),await s(T()),await s(Z())};return e.jsx(Oe,{isOpen:r,type:"danger",title:"Delete Lead",confirmButtonColor:"red-600",onClose:g,onRequestClose:g,onCancel:g,onConfirm:d,children:e.jsx("p",{children:"Are you sure you want to delete this Lead? All record related to this lead will be deleted as well. This action cannot be undone."})})},k=[],mt=s=>{const{touched:r,errors:a,setFieldValue:g,values:d}=s,c=D(),m=Ee(),[l,t]=x.useState([]),f=h(n=>n.crmLeads.data.contactList);k.length=0,f==null||f.forEach(n=>{k.push({value:n==null?void 0:n.id,label:`${n==null?void 0:n.firstName} ${n==null?void 0:n.lastName}`})}),x.useEffect(()=>{(async()=>{var L,y;try{const{payload:j}=await c(Ie()),C=(L=j==null?void 0:j.data)==null?void 0:L.find(N=>(N==null?void 0:N.moduleName)==="leads");if(C){const{payload:N}=await c(Ae({id:(y=C==null?void 0:C.id)==null?void 0:y.toString()})),U=We(N.data);t(U)}}catch(j){console.error("Error fetching module data:",j)}})(),c(Te())},[c]);const p=h(n=>n.crmLeads.data.selectedLeads);h(n=>n.crmLeads.data.productList),x.useState(p?p.tags||[]:[]);const b=n=>{m.setFieldValue("tagId",n)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"col-span-1",children:e.jsx(F,{label:"Contact Name",invalid:a.contactsDataId&&r.contactsDataId,errorMessage:a.contactsDataId,children:e.jsx(re,{name:"contactsDataId",placeholder:"Contact Name",options:k,id:"contactsDataId",value:k.find(n=>(n==null?void 0:n.value)===(d==null?void 0:d.contactsDataId)),onChange:n=>{const L=n.value;g("contactsDataId",L)}})})}),e.jsx("div",{className:"col-span-1",children:e.jsx(F,{label:"Title",invalid:a.title&&r.title,errorMessage:a.title,children:e.jsx(R,{type:"text",autoComplete:"off",name:"title",placeholder:"Title",component:M,prefix:e.jsx(He,{className:"text-xl"})})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"col-span-1",children:e.jsx(F,{label:"Budget",invalid:a.budget&&r.budget,errorMessage:a.budget,children:e.jsx(R,{type:"number",autoComplete:"off",name:"budget",placeholder:"Budget",component:M,prefix:e.jsx(Ke,{className:"text-xl"})})})}),e.jsx("div",{className:"col-span-1",children:e.jsx(F,{label:"Tag",children:e.jsx(R,{isClearable:!0,isMulti:!0,type:"text",autoComplete:"off",name:"tagId",placeholder:"Select tags",component:re,options:l,prefix:e.jsx(Pe,{className:"text-xl"}),closeMenuOnSelect:!1,onChange:b})})})]}),e.jsx(F,{label:"Notes",invalid:a.notes&&r.notes,errorMessage:a.notes,children:e.jsx(R,{textArea:!0,type:"text",autoComplete:"off",name:"notes",placeholder:"Notes",component:M,prefix:e.jsx(Ge,{className:"text-xl"})})})]})},pt=pe().shape({title:G().required("Title is required"),notes:G(),budget:ze().test("greaterThanOne","Budget must be greater than 1",s=>s>0).required("Budget is required"),tagId:$e(),contactsDataId:G().test("is-valid-contact","Invalid contact selected",function(s){return this.parent.contactsDataId&&this.parent.contactsDataId.length>0?!!k.find(r=>r.value===s):!0})}),{TabNav:ut,TabList:gt,TabContent:ht}=le,ue=x.forwardRef((s,r)=>{var l;const a=h(t=>t.crmLeads.data.selectedLeads),g=!!a.id,d=D(),c=async(t,f,p)=>{var L,y,j,C;const b=(L=t==null?void 0:t.payload)!=null&&L.success?f:"Something went wrong !!!",n=(y=t==null?void 0:t.payload)!=null&&y.success?(j=t==null?void 0:t.payload)==null?void 0:j.message:p;E.push(e.jsx(z,{title:b,type:(C=t==null?void 0:t.payload)!=null&&C.success?"success":"danger",duration:2500,children:n}),{placement:"top-end"})},m=async(t,{setSubmitting:f})=>{try{const p={title:t.title,contactsDataId:t.contactsDataId,budget:t.budget.toString(),description:t.notes,tagId:t==null?void 0:t.tagId.map(N=>N.value)},{name:b,tagName:n,...L}=t,y=g?await d(ee({leadsId:(a==null?void 0:a.id)||"",updatedData:p})):await d(Fe(p));await c(y,g?"Successfully Updated":"Successfully Added","An error occurred."),d(ie()),await Promise.all([d(T()),d(Z())])}catch(p){console.error("An error occurred:",p)}finally{f(!1)}};return e.jsx(de,{innerRef:r,initialValues:{contactsDataId:a.contactsDataId||"",title:(a==null?void 0:a.title)||"",notes:(a==null?void 0:a.description)||"",tagId:((l=a==null?void 0:a.tags)==null?void 0:l.map(t=>({label:t.tagName,value:t.id})))||[],budget:(a==null?void 0:a.budget)||""},validationSchema:pt,onSubmit:m,children:({touched:t,errors:f,values:p,setFieldValue:b})=>e.jsx(me,{children:e.jsx(ce,{children:e.jsxs(le,{defaultValue:"leadsInfo",children:[e.jsx(gt,{children:e.jsx(ut,{value:"leadsInfo",children:"Leads Detail"})}),e.jsx("div",{className:"p-6",children:e.jsx(ht,{value:"leadsInfo",children:e.jsx(mt,{touched:t,errors:f,setFieldValue:b,values:p})})})]})})})})});ue.displayName="LeadsForm";const ge=x.forwardRef((s,r)=>{D();const a=h(d=>d.crmLeads.data.selectedLeads);h(d=>d.crmLeads.data.leadsList);const g=async d=>{};return e.jsx(ue,{ref:r,leads:a,onFormSubmit:g})});ge.displayName="LeadsEditContent";const xt=({onSaveClick:s,onCancel:r})=>e.jsxs("div",{className:"text-right w-full",children:[e.jsx($,{size:"sm",className:"mr-2",onClick:r,children:"Cancel"}),e.jsx($,{size:"sm",variant:"solid",onClick:s,children:"Save"})]}),ft=()=>{const s=D(),r=h(t=>t.crmLeads.data.drawerOpen),[a,g]=x.useState(window.innerWidth/2),d=()=>{s(ie()),s(S({}))},c=x.useRef(null),m=()=>{var t;(t=c.current)==null||t.submitForm()};x.useEffect(()=>(window.addEventListener("resize",l),s(Re()),()=>{window.removeEventListener("resize",l)}),[]);const l=()=>{g(window.innerWidth/2)};return e.jsx(Me,{isOpen:r,closable:!1,bodyClass:"p-0",width:a,footer:e.jsx(xt,{onCancel:d,onSaveClick:m}),onClose:d,onRequestClose:d,children:e.jsx(ge,{ref:c})})},jt=pe().shape({reason:G().required("Reason is required")}),he=x.forwardRef((s,r)=>{const a=D(),g=h(m=>m.crmLeads.data.selectedLeads),d=()=>{a(O(!1))},c=async(m,l,t,f)=>{var y,j,C;const p=await t(ee({leadsId:l==null?void 0:l.id,updatedData:{reason:m.reason,status:m.status}}));let b="",n="",L="danger";(y=p==null?void 0:p.payload)!=null&&y.success?(b="Successfully Added",n=(j=p==null?void 0:p.payload)==null?void 0:j.message,L="success"):(b="Something went wrong !!!",n=(C=p==null?void 0:p.error)==null?void 0:C.message),f.push(e.jsx(z,{title:b,type:L,duration:2500,children:n}),{placement:"top-end"}),t(O(!1)),await t(T())};return e.jsx(de,{innerRef:r,initialValues:{reason:"",status:"closed_lost"},validationSchema:jt,onSubmit:async(m,{setSubmitting:l})=>{await c(m,g,a,E),l(!1)},children:({touched:m,errors:l,values:t,setFieldValue:f})=>e.jsxs(me,{children:[e.jsx(ce,{children:e.jsx(F,{label:"Reason",invalid:l.reason&&m.reason,errorMessage:l.reason,children:e.jsx(R,{type:"text",autoComplete:"off",name:"reason",placeholder:"Reason",component:M,prefix:e.jsx(Ue,{className:"text-xl"})})})}),e.jsx(at,{className:"flex items-center justify-end py-2",stickyClass:"border-t bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"md:flex items-center",children:[e.jsx($,{size:"sm",className:"ltr:mr-3 rtl:ml-3",type:"button",onClick:d,children:"Cancel"}),e.jsx($,{size:"sm",type:"submit",variant:"solid",icon:e.jsx(et,{}),children:"Save"})]})})]})})});he.displayName="LeadForm";const bt=()=>{const s=D(),r=h(o=>o.crmLeads.data.displayedLeadsList),a=h(o=>o.crmLeads.data.loading),g=h(o=>o.crmLeads.data.isDialogOpen),{pageIndex:d,pageSize:c,sort:m,query:l,total:t}=h(o=>o.crmLeads.data.tableData),f=x.useCallback(()=>{s(T())},[s]);x.useEffect(()=>{f()},[f]);const p=x.useMemo(()=>({pageIndex:d,pageSize:c,sort:m,query:l,total:t}),[d,c,m,l,t]);h(o=>o.crmLeads.data.selectedLeads);const b=K("leads","canDelete"),n=K("leads","canModify"),L=K("leads","canView"),y=je(),j=({row:o})=>{const i=D();we();const u=()=>{i(ne()),i(S(o))},w=async()=>{await i(S(o)),i(Y(!0))},q=()=>{i(S(o));const _=`/app/crm/lead-details/${o.id}`;y(_)},B=()=>{i(S(o)),i(O(!0))},V=async()=>{await i(S(o)),await W(o==null?void 0:o.id)},W=async _=>{var ae,se,oe;const v=await i(ee({leadsId:_,updatedData:{status:"closed_won"}}));let J="",Q="",te="danger";(ae=v==null?void 0:v.payload)!=null&&ae.success?(J="Successfully Added",Q=(se=v==null?void 0:v.payload)==null?void 0:se.message,te="success"):(J="Something went wrong !!!",Q=(oe=v==null?void 0:v.error)==null?void 0:oe.message),E.push(e.jsx(z,{title:J,type:te,duration:2500,children:Q}),{placement:"top-end"}),i(O(!1)),await i(T())};return e.jsxs("div",{className:"flex text-base items-center",children:[n&&e.jsx("button",{disabled:(o==null?void 0:o.status)!=="open",className:`circle items-center mx-1 ${(o==null?void 0:o.status)!=="open"?"!cursor-not-allowed":"cursor-pointer hover:text-indigo-500"}`,onClick:u,children:e.jsx(_e,{})}),b&&e.jsx("span",{className:"cursor-pointer hover:text-red-500 circle items-center",onClick:w,children:e.jsx(Je,{})}),L&&e.jsx("span",{className:"cursor-pointer hover:text-green-500 circle mx-1 items-center text-lg",onClick:q,children:e.jsx(tt,{})}),n&&e.jsx(A,{title:"Close To Won",children:e.jsx("button",{className:` circle items-center ${(o==null?void 0:o.status)!=="open"?"!cursor-not-allowed":"cursor-pointer hover:text-indigo-500"}`,disabled:(o==null?void 0:o.status)!=="open",onClick:V,children:e.jsx(st,{})})},o.id+"won"),n&&e.jsx(A,{title:"Close To Lost",children:e.jsx("button",{className:`${(o==null?void 0:o.status)!=="open"?"!cursor-not-allowed":"cursor-pointer hover:text-orange-500"} mx-1 circle items-center `,disabled:(o==null?void 0:o.status)!=="open",onClick:B,children:e.jsx(be,{})})},o.id+"lost")]})},C=x.useMemo(()=>[{header:"Action",id:"action",cell:i=>e.jsx(j,{row:i.row.original})},{header:"Contact Name",accessorKey:"contactName",cell:i=>{var w,q,B,V,W;const u=(w=i.row.original)!=null&&w.contactData?((B=(q=i.row.original)==null?void 0:q.contactData)==null?void 0:B.firstName)+" "+((W=(V=i.row.original)==null?void 0:V.contactData)==null?void 0:W.lastName):"-";return e.jsx(I,{text:u,maxLength:20})}},{header:"Title",accessorKey:"title",cell:i=>{const u=i.row.original.title;return e.jsx(A,{title:u,children:e.jsx(I,{text:u,maxLength:20})},u)}},{header:"Budget",accessorKey:"budget",cell:i=>{const u=i.row.original;return e.jsx(I,{text:u.budget,maxLength:20})}},{header:"Status",accessorKey:"status",cell:i=>{const u=i.row.original;return e.jsx(Ne,{status:u.status})}},{header:"Tag Name",accessorKey:"tagName",cell:i=>{const u=i.row.original.tags;return u!=null&&u.length>0?e.jsx(ve,{tags:u}):"-"}},{header:"Notes",accessorKey:"description",cell:i=>{const u=i.row.original.description?i.row.original.description:"-";return e.jsx(A,{title:u,children:e.jsx(I,{text:u,maxLength:20})},u)}},{header:"Reason",accessorKey:"reason",cell:i=>{var w;const u=(w=i.row.original)==null?void 0:w.reason;return u?e.jsx(A,{title:u,children:e.jsx(I,{text:u,maxLength:20})},u):e.jsx(A,{title:u,children:e.jsx(I,{text:"NA",maxLength:20})},u)}}],[n,b]),N=o=>{const i=P(p);i.pageIndex=o,s(H(i))},U=o=>{const i=P(p);i.pageSize=Number(o),i.pageIndex=1,s(H(i))},fe=o=>{const i=P(p);i.sort=o,s(H(i))};return e.jsxs("div",{children:[e.jsx(De,{columns:C,data:r,skeletonAvatarColumns:[0],skeletonAvatarProps:{width:28,height:28},loading:a,pagingData:{total:p.total,pageIndex:p.pageIndex,pageSize:p.pageSize},onPaginationChange:N,onSelectChange:U,onSort:fe}),e.jsx(ft,{}),e.jsx(dt,{}),e.jsxs(Ve,{isOpen:g,onClose:()=>s(O(!1)),children:[e.jsx("h5",{className:"mb-4",children:"Enter Reason"}),e.jsx(he,{})]})]})},xe=x.forwardRef((s,r)=>{const{onInputChange:a}=s,g=ot(d,500);function d(m){a==null||a(m)}const c=m=>{g(m.target.value)};return e.jsx(M,{ref:r,className:"max-w-md md:w-52 mb-4",size:"sm",placeholder:"Search",prefix:e.jsx(Qe,{className:"text-lg"}),onChange:c})});xe.displayName="LeadsTableSearch";const Lt=()=>{const s=D(),r=x.useRef(null),a=h(l=>l.crmLeads.data.tableData),g=K("leads","canCreate"),d=l=>{const t=P(a);t.query=l,t.pageIndex=1,typeof l=="string"&&l.length>1&&c(t),typeof l=="string"&&l.length===0&&c(t)},c=l=>{s(l?H(l):T())},m=()=>{s(ne()),s(S({})),s(it("Add"))};return x.useEffect(()=>{async function l(){await s(rt())}l()},[s]),e.jsxs("div",{className:"md:flex items-center justify-between",children:[e.jsx("div",{className:"md:flex items-center gap-4",children:e.jsx(xe,{ref:r,onInputChange:d})}),e.jsx("div",{className:"mb-4",children:g&&e.jsx($,{size:"sm",onClick:m,children:"Add New"})})]})},X=s=>{const{icon:r,avatarClass:a,label:g,value:d,loading:c}=s,m=55;return e.jsx(Be,{bordered:!0,children:e.jsx(Le,{loading:c,customLoader:e.jsx(ct,{avatarProps:{className:"rounded",width:m,height:m}}),children:e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(qe,{className:a,size:m,icon:r}),e.jsxs("div",{children:[e.jsx("span",{children:g}),e.jsx("h3",{children:e.jsx(lt,{thousandSeparator:!0,displayType:"text",value:d})})]})]})})})})},Ct=()=>{const s=D(),r=h(g=>g.crmLeads.data.statisticData),a=h(g=>g.crmLeads.data.statisticLoading);return x.useEffect(()=>{s(Z())},[]),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4 mb-6",children:[e.jsx(X,{icon:e.jsx(Xe,{}),avatarClass:"!bg-indigo-600",label:"Total Leads",value:r.totalLeads,growthRate:r==null?void 0:r.totalLeads,loading:a}),e.jsx(X,{icon:e.jsx(Ye,{}),avatarClass:"!bg-blue-500",label:"Open Leads",value:r.openLeads,growthRate:r.openLeads,loading:a}),e.jsx(X,{icon:e.jsx(Ze,{}),avatarClass:"!bg-emerald-500",label:"This Week's New Leads",value:r==null?void 0:r.newLeads,growthRate:r==null?void 0:r.newLeads,loading:a})]})};Ce("crmLeads",ke);const yt=()=>{const s=h(r=>r.crmLeads.data.tableData);return e.jsxs(e.Fragment,{children:[e.jsx(Ct,{}),e.jsxs(ye,{bodyClass:"h-full",children:[e.jsx(nt,{title:`Leads (${(s==null?void 0:s.total)||0})`,desc:"",className:"mb-2"}),e.jsx(Lt,{}),e.jsx(bt,{})]})]})},xs=yt;export{xs as default};
