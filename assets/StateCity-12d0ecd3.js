import{am as N,an as X,ao as Y,ap as Z,a as S,j as a,r as x,aq as ee}from"./index-f0c7b593.js";import{T as te}from"./index-0fbd5995.js";import"./Alert-6365923a.js";import"./index-e46ae74f.js";import"./Badge-eb9394bd.js";import{B as I}from"./Button-7f5aeb19.js";import"./RangeCalendar-4446a681.js";import"./Card-d2bb7bb1.js";import"./index-3454c4af.js";import"./index-7fb568e6.js";import{D as ae}from"./Dialog-863f25dc.js";import"./Drawer-3213f845.js";import"./index-096ca5d8.js";import{F as se,a as q}from"./FormItem-39c4f499.js";import"./toString-15315b0c.js";import{I as O}from"./Input-b0936f40.js";import"./index-cae4e5da.js";import"./index-cd4a639d.js";import"./index-e9f2e738.js";import{N as R,t as A}from"./toast-98ab077b.js";import"./Pagination-4451079e.js";import"./Progress-c215b6a7.js";import"./index-aa5943b4.js";import"./ScrollBar-af66e651.js";import"./index-2d35600c.js";import{S as we}from"./Select-20b819a9.js";import"./Skeleton-3fb87948.js";import"./index-681acbb6.js";import"./Switcher-52adaf57.js";import"./index-b0e56b87.js";import"./Tag-c0e1c031.js";import"./index-11547d1a.js";import"./index-ff0fc04f.js";import"./Tooltip-c002e367.js";import"./Upload-652ef9c2.js";import{C as oe}from"./ConfirmDialog-a2f5c181.js";import{as as Ne,at as Te,au as Ie,av as Ae,aw as Me,ax as ve,ay as Ee,az as ze}from"./CrmService-dbe6e33f.js";import"./Views-f075be69.js";import"./chart.constant-02b58366.js";import"./GrowShrinkTag-527a2d3f.js";import{D as ie}from"./DataTable-b0d71643.js";import"./react-tooltip.min-71b0b431.js";import"./RichTextEditor-5416da31.js";import"./SegmentItemOption-59370a59.js";import{S as ne}from"./StickyFooter-e5abd172.js";import"./SvgIcon-586bfa82.js";import{F as le,a as re,b as $}from"./formik.esm-251b655f.js";import{A as ce}from"./index.esm-08433e05.js";import{a as P}from"./index.esm-648d214b.js";import{c as B,a as de}from"./index.esm-36ab1692.js";import{u as F}from"./checkEditUpdate-a8d8ed64.js";import{u as me}from"./useThemeClass-a90261c9.js";import{c as w}from"./cloneDeep-a7f8bdaf.js";import{O as pe,P as ge,b as ye}from"./index.esm-e5bc54ff.js";import{d as ue}from"./debounce-cfdc19d0.js";const Le="crmCity",ke={total:0,pageIndex:1,pageSize:10,query:"",sort:{order:"",key:""}},Fe={loading:!1,tableData:ke,displayedCityList:[],cityList:[],stateList:[],isDialogOpen:!1,dialogMode:"Add",selectedCity:null,deleteConfirmation:!1},W=N("crmCity/data/createCity",async t=>{var e,s;try{return(await Ne(t)).data}catch(o){throw new Error((s=(e=o==null?void 0:o.response)==null?void 0:e.data)==null?void 0:s.message)}}),M=N("crmCity/data/getCity",async()=>{var t,e;try{return(await Te()).data}catch(s){throw new Error((e=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:e.message)}}),Oe=N("crmCity/data/editCity",async({id:t,updatedData:e})=>{var s,o;try{return(await Ie(t,e)).data}catch(n){throw new Error((o=(s=n==null?void 0:n.response)==null?void 0:s.data)==null?void 0:o.message)}}),Re=N("crmCity/data/deleteCity",async t=>{var e,s;try{return await Ae(t)}catch(o){throw new Error((s=(e=o==null?void 0:o.response)==null?void 0:e.data)==null?void 0:s.message)}}),he=X({name:`${Le}/state`,initialState:Fe,reducers:{setTableData:(t,e)=>{t.tableData=e.payload;const s=t.cityList.filter(o=>{var n,l,i;return((n=o.cityName)==null?void 0:n.toLowerCase().includes(e.payload.query.toLowerCase()))||((i=(l=o==null?void 0:o.state)==null?void 0:l.stateName)==null?void 0:i.toLowerCase().includes(e.payload.query.toLowerCase()))});t.tableData.total=s.length,t.displayedCityList=s.slice(e.payload.pageSize*(e.payload.pageIndex-1),e.payload.pageSize*e.payload.pageIndex)},setSelectedCity:(t,e)=>{t.selectedCity=e.payload},setDialogToggle:(t,e)=>{t.isDialogOpen=e.payload},setDialogMode:(t,e)=>{t.dialogMode=e.payload},toggleDeleteConfirmation:(t,e)=>{t.deleteConfirmation=e.payload}},extraReducers:t=>{t.addCase(W.fulfilled,(e,s)=>{e.loading=!1}).addCase(W.pending,e=>{e.loading=!0}).addCase(M.fulfilled,(e,s)=>{var o,n,l,i,p;e.loading=!1,e.cityList=s==null?void 0:s.payload.data,e.tableData.total=(o=s.payload.data)==null?void 0:o.length,e.displayedCityList=s==null?void 0:s.payload.data.slice(((n=e==null?void 0:e.tableData)==null?void 0:n.pageSize)*(((l=e==null?void 0:e.tableData)==null?void 0:l.pageIndex)-1),((i=e==null?void 0:e.tableData)==null?void 0:i.pageSize)*((p=e==null?void 0:e.tableData)==null?void 0:p.pageIndex))}).addCase(M.pending,e=>{e.loading=!0})}}),{setTableData:L,setSelectedCity:U,setDialogToggle:E,setDialogMode:fe,toggleDeleteConfirmation:_}=he.actions,qe=he.reducer,$e=Y({data:qe}),b=Z,Pe=()=>{const t=S(),e=b(i=>i.crmCity.data.deleteConfirmation),s=b(i=>i.crmCity.data.selectedCity),o=()=>{t(_(!1))},n=(i,p,u,m)=>{var y,g,h;const d=(y=i==null?void 0:i.payload)==null?void 0:y.success;p.push(a.jsx(R,{title:d?u:m,type:d?"success":"danger",duration:2500,children:d?(g=i==null?void 0:i.payload)==null?void 0:g.message:(h=i==null?void 0:i.error)==null?void 0:h.message}),{placement:"top-end"})},l=async()=>{t(_(!1));const i=await t(Re(s==null?void 0:s.id));n(i,A,"Successfully Deleted","Something Went Wrong !!!"),await t(M())};return a.jsx(oe,{isOpen:e,type:"danger",title:"Delete City",confirmButtonColor:"red-600",onClose:o,onRequestClose:o,onCancel:o,onConfirm:l,children:a.jsx("p",{children:"Are you sure you want to delete this City? All record related to this City will be deleted as well. This action cannot be undone."})})},Be=B().shape({stateId:B().required("State is required"),cityName:de().required("City is required")}),xe=x.forwardRef((t,e)=>{const s=S(),o=b(m=>m.crmCity.data.dialogMode),n=b(m=>m.crmCity.data.selectedCity),l=b(m=>m.crmState.data.displayedStateList),i=x.useMemo(()=>(console.log({stateList:l}),l==null?void 0:l.map(d=>({label:d.stateName,value:d.id}))),[l]),p=()=>{s(E(!1))},u=async(m,d,y,g,h)=>{var T,V,G;const D={cityName:d.cityName,stateId:d.stateId.value},f=await g(m==="Add"?W(D):Oe({id:y==null?void 0:y.id,updatedData:D}));let c="",r="",C="danger";(T=f==null?void 0:f.payload)!=null&&T.success?(c="Successfully Added",r=(V=f==null?void 0:f.payload)==null?void 0:V.message,C="success"):(c="Something went wrong !!!",r=(G=f==null?void 0:f.error)==null?void 0:G.message),h.push(a.jsx(R,{title:c,type:C,duration:2500,children:r}),{placement:"top-end"}),g(E(!1)),await g(M())};return console.log({selectedCity:n}),a.jsx(le,{innerRef:e,initialValues:{cityName:o==="Edit"?n==null?void 0:n.cityName:"",stateId:o==="Edit"?i.find(m=>m.value===(n==null?void 0:n.stateId)):""},validationSchema:Be,onSubmit:async(m,{setSubmitting:d})=>{console.log({values:m}),o==="Add"?await u("Add",m,null,s,A):await u("Edit",m,n,s,A),d(!1)},children:({touched:m,errors:d,values:y,setFieldValue:g})=>a.jsxs(re,{children:[a.jsxs(se,{children:[a.jsx(q,{label:"State",invalid:d.stateId&&m.stateId,errorMessage:d.stateId,children:a.jsx($,{type:"text",autoComplete:"off",name:"stateId",placeholder:"State",options:i,component:we,prefix:a.jsx(P,{className:"text-xl"}),onChange:h=>{g("stateId",h)}})}),a.jsx(q,{label:"City",invalid:d.cityName&&m.cityName,errorMessage:d.cityName,children:a.jsx($,{type:"text",autoComplete:"off",name:"cityName",placeholder:"City",component:O,prefix:a.jsx(P,{className:"text-xl"})})})]}),a.jsx(ne,{className:"flex items-center justify-end py-2",stickyClass:"border-t bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700",children:a.jsxs("div",{className:"md:flex items-center",children:[a.jsx(I,{size:"sm",className:"ltr:mr-3 rtl:ml-3",type:"button",onClick:p,children:"Cancel"}),a.jsx(I,{size:"sm",type:"submit",variant:"solid",icon:a.jsx(ce,{}),children:"Save"})]})})]})})});xe.displayName="CityForm";const We=()=>{const t=S(),e=b(c=>c.crmCity.data.loading),s=b(c=>c.crmCity.data.displayedCityList),o=F("roles","canModify"),n=F("roles","canDelete"),{pageIndex:l,pageSize:i,sort:p,query:u,total:m}=b(c=>c.crmCity.data.tableData),d=x.useMemo(()=>({pageIndex:l,pageSize:i,sort:p,query:u,total:m}),[l,i,p,u,m]),y=({row:c})=>{const r=S();me();const C=()=>{r(U(c)),r(E(!0)),r(fe("Edit"))},T=async()=>{await r(U(c)),r(_(!0))};return a.jsxs("div",{className:"flex justify-start text-base",children:[a.jsx("button",{className:"circle items-center  cursor-pointer hover:text-indigo-500",onClick:C,children:a.jsx(pe,{})}),a.jsx("button",{className:"cursor-pointer hover:text-red-500 mx-1 circle items-center",onClick:T,children:a.jsx(ge,{})})]})},g=x.useMemo(()=>[{header:"Action",id:"action",cell:r=>a.jsx(y,{row:r.row.original})},{header:"City",accessorKey:"cityName",cell:r=>r.row.original.cityName},{header:"State",accessorKey:"state",cell:r=>{var C;return(C=r.row.original.state)==null?void 0:C.stateName}}],[o,n]),h=c=>{console.log({page:c});const r=w(d);r.pageIndex=c,t(L(r))},D=c=>{const r=w(d);r.pageSize=Number(c),r.pageIndex=1,t(L(r))},f=c=>{const r=w(d);r.sort=c,t(L(r))};return a.jsx("div",{children:a.jsx(ie,{columns:g,data:s,skeletonAvatarColumns:[0],skeletonAvatarProps:{width:28,height:28},loading:e,pagingData:{total:d.total,pageIndex:d.pageIndex,pageSize:d.pageSize},onPaginationChange:h,onSelectChange:D,onSort:f})})},Ce=x.forwardRef((t,e)=>{const{onInputChange:s}=t,o=ue(n,500);function n(i){s==null||s(i)}const l=i=>{o(i.target.value)};return a.jsx(O,{ref:e,className:"max-w-md md:w-52 mb-4",size:"sm",placeholder:"Search",prefix:a.jsx(ye,{className:"text-lg"}),onChange:l})});Ce.displayName="SubCategoryTableSearch";const _e=()=>{const t=S(),e=x.useRef(null),s=b(l=>l.crmCity.data.tableData),o=l=>{const i=w(s);i.query=l,i.pageIndex=1,typeof l=="string"&&l.length>1&&n(i),typeof l=="string"&&l.length===0&&n(i)},n=l=>{t(l?L(l):M())};return a.jsxs("div",{className:"md:flex items-center justify-between",children:[a.jsx("div",{className:"md:flex items-center gap-4",children:a.jsx(Ce,{ref:e,onInputChange:o})}),a.jsx("div",{className:"mb-4",children:a.jsx(I,{size:"sm",onClick:()=>{t(E(!0)),t(fe("Add"))},children:"Add New"})})]})};ee("crmCity",$e);const He=()=>{const t=S(),e=b(n=>n.crmCity.data.isDialogOpen),s=b(n=>n.crmCity.data.dialogMode),o=()=>{t(E(!1))};return x.useEffect(()=>{t(M())},[]),a.jsxs(a.Fragment,{children:[a.jsx(_e,{}),a.jsx(We,{}),a.jsxs(ae,{isOpen:e,onClose:o,children:[a.jsxs("h5",{className:"mb-4",children:[s==="Edit"?"Edit":"Add New"," City"]}),a.jsx(xe,{})]}),a.jsx(Pe,{})]})},Ke="crmState",H=N("crmState/data/createState",async t=>{var e,s;try{return(await Me(t)).data}catch(o){throw new Error((s=(e=o==null?void 0:o.response)==null?void 0:e.data)==null?void 0:s.message)}}),v=N("crmState/data/getState",async()=>{var t,e;try{return(await ve()).data}catch(s){throw new Error((e=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:e.message)}}),Ve=N("crmState/data/editState",async({id:t,updatedData:e})=>{var s,o;try{return(await Ee(t,e)).data}catch(n){throw new Error((o=(s=n==null?void 0:n.response)==null?void 0:s.data)==null?void 0:o.message)}}),Ge=N("crmLeads/data/deleteState",async t=>{var e,s;try{return await ze(t)}catch(o){throw new Error((s=(e=o==null?void 0:o.response)==null?void 0:e.data)==null?void 0:s.message)}}),Ue={total:0,pageIndex:1,pageSize:10,query:"",sort:{order:"",key:""}},Je={loading:!1,tableData:Ue,displayedStateList:[],categoryList:[],isDialogOpen:!1,dialogMode:"Add",selectedState:null,deleteConfirmation:!1},Se=X({name:`${Ke}/state`,initialState:Je,reducers:{setTableData:(t,e)=>{t.tableData=e.payload;const s=t.categoryList.filter(o=>o.stateName.toLowerCase().includes(e.payload.query.toLowerCase()));t.tableData.total=s.length,t.displayedStateList=s.slice(e.payload.pageSize*(e.payload.pageIndex-1),e.payload.pageSize*e.payload.pageIndex)},setSelectedState:(t,e)=>{t.selectedState=e.payload},setDialogToggle:(t,e)=>{t.isDialogOpen=e.payload},setDialogMode:(t,e)=>{t.dialogMode=e.payload},toggleDeleteConfirmation:(t,e)=>{t.deleteConfirmation=e.payload}},extraReducers:t=>{t.addCase(H.fulfilled,(e,s)=>{e.loading=!1}).addCase(H.pending,e=>{e.loading=!0}).addCase(v.fulfilled,(e,s)=>{var o,n,l,i,p;e.loading=!1,e.categoryList=s==null?void 0:s.payload.data,e.tableData.total=(o=s.payload.data)==null?void 0:o.length,e.displayedStateList=s==null?void 0:s.payload.data.slice(((n=e==null?void 0:e.tableData)==null?void 0:n.pageSize)*(((l=e==null?void 0:e.tableData)==null?void 0:l.pageIndex)-1),((i=e==null?void 0:e.tableData)==null?void 0:i.pageSize)*((p=e==null?void 0:e.tableData)==null?void 0:p.pageIndex))}).addCase(v.pending,e=>{e.loading=!0})}}),{setTableData:k,setDialogToggle:z,setDialogMode:be,setSelectedState:J,toggleDeleteConfirmation:K}=Se.actions,Qe=Se.reducer,Xe=Y({data:Qe}),j=Z,De=x.forwardRef((t,e)=>{const{onInputChange:s}=t,o=ue(n,500);function n(i){s==null||s(i)}const l=i=>{o(i.target.value)};return a.jsx(O,{ref:e,className:"max-w-md md:w-52 mb-4",size:"sm",placeholder:"Search",prefix:a.jsx(ye,{className:"text-lg"}),onChange:l})});De.displayName="StateTableSearch";const Ye=()=>{const t=S(),e=x.useRef(null),s=j(l=>l.crmState.data.tableData),o=l=>{const i=w(s);i.query=l,i.pageIndex=1,typeof l=="string"&&l.length>1&&n(i),typeof l=="string"&&l.length===0&&n(i)},n=l=>{t(l?k(l):v())};return a.jsxs("div",{className:"md:flex items-center justify-between",children:[a.jsx("div",{className:"md:flex items-center gap-4",children:a.jsx(De,{ref:e,onInputChange:o})}),a.jsx("div",{className:"mb-4",children:a.jsx(I,{size:"sm",onClick:()=>{t(z(!0)),t(be("Add"))},children:"Add New"})})]})},Ze=()=>{const t=S(),e=j(c=>c.crmState.data.loading),s=F("roles","canModify"),o=F("roles","canDelete"),{pageIndex:n,pageSize:l,sort:i,query:p,total:u}=j(c=>c.crmState.data.tableData),m=j(c=>c.crmState.data.displayedStateList);console.log({data:m});const d=({row:c})=>{const r=S();me();const C=()=>{r(J(c)),r(z(!0)),r(be("Edit"))},T=async()=>{await r(J(c)),r(K(!0))};return a.jsxs("div",{className:"flex justify-start text-base",children:[a.jsx("button",{className:"circle items-center  cursor-pointer hover:text-indigo-500",onClick:C,children:a.jsx(pe,{})}),a.jsx("button",{className:"cursor-pointer hover:text-red-500 mx-1 circle items-center",onClick:T,children:a.jsx(ge,{})})]})},y=x.useMemo(()=>({pageIndex:n,pageSize:l,sort:i,query:p,total:u}),[n,l,i,p,u]),g=x.useMemo(()=>[{header:"Action",id:"action",cell:r=>a.jsx(d,{row:r.row.original})},{header:"State",accessorKey:"name",cell:r=>r.row.original.stateName}],[s,o]),h=c=>{const r=w(y);r.pageIndex=c,t(k(r))},D=c=>{const r=w(y);r.pageSize=Number(c),r.pageIndex=1,t(k(r))},f=c=>{const r=w(y);r.sort=c,t(k(r))};return a.jsx("div",{children:a.jsx(ie,{columns:g,data:m,skeletonAvatarColumns:[0],skeletonAvatarProps:{width:28,height:28},loading:e,pagingData:{total:y.total,pageIndex:y.pageIndex,pageSize:y.pageSize},onPaginationChange:h,onSelectChange:D,onSort:f})})},et=B().shape({stateName:de().required("State name is required")}),je=x.forwardRef((t,e)=>{const s=S(),o=j(p=>p.crmState.data.dialogMode),n=j(p=>p.crmState.data.selectedState),l=()=>{s(z(!1))};console.log(o);const i=async(p,u,m,d,y)=>{var c,r,C;const g=await d(p==="Add"?H(u):Ve({id:m==null?void 0:m.id,updatedData:u}));let h="",D="",f="danger";(c=g==null?void 0:g.payload)!=null&&c.success?(h="Successfully Added",D=(r=g==null?void 0:g.payload)==null?void 0:r.message,f="success"):(h="Something went wrong !!!",D=(C=g==null?void 0:g.error)==null?void 0:C.message),y.push(a.jsx(R,{title:h,type:f,duration:2500,children:D}),{placement:"top-end"}),d(z(!1)),await d(v())};return a.jsx(le,{innerRef:e,initialValues:{stateName:o==="Edit"?n==null?void 0:n.stateName:""},validationSchema:et,onSubmit:async(p,{setSubmitting:u})=>{o==="Add"?await i("Add",p,null,s,A):await i("Edit",p,n,s,A),u(!1)},children:({touched:p,errors:u,values:m,setFieldValue:d})=>a.jsxs(re,{children:[a.jsx(se,{children:a.jsx(q,{label:"State Name",invalid:u.stateName&&p.stateName,errorMessage:u.stateName,children:a.jsx($,{type:"text",autoComplete:"off",name:"stateName",placeholder:"State Name",component:O,prefix:a.jsx(P,{className:"text-xl"})})})}),a.jsx(ne,{className:"flex items-center justify-end py-2",stickyClass:"border-t bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700",children:a.jsxs("div",{className:"md:flex items-center",children:[a.jsx(I,{size:"sm",className:"ltr:mr-3 rtl:ml-3",type:"button",onClick:l,children:"Cancel"}),a.jsx(I,{size:"sm",type:"submit",variant:"solid",icon:a.jsx(ce,{}),children:"Save"})]})})]})})});je.displayName="StateForm";const tt=()=>{const t=S(),e=j(i=>i.crmState.data.deleteConfirmation),s=j(i=>i.crmState.data.selectedState),o=()=>{t(K(!1))},n=(i,p,u,m)=>{var y,g,h;const d=(y=i==null?void 0:i.payload)==null?void 0:y.success;p.push(a.jsx(R,{title:d?u:m,type:d?"success":"danger",duration:2500,children:d?(g=i==null?void 0:i.payload)==null?void 0:g.message:(h=i==null?void 0:i.error)==null?void 0:h.message}),{placement:"top-end"})},l=async()=>{t(K(!1));const i=await t(Ge(s==null?void 0:s.id));n(i,A,"Successfully Deleted","Something Went Wrong !!!"),await t(v())};return a.jsx(oe,{isOpen:e,type:"danger",title:"Delete State",confirmButtonColor:"red-600",onClose:o,onRequestClose:o,onCancel:o,onConfirm:l,children:a.jsx("p",{children:"Are you sure you want to delete this State? All record related to this State will be deleted as well. This action cannot be undone."})})};ee("crmState",Xe);const at=()=>{const t=S(),e=j(n=>n.crmState.data.isDialogOpen),s=j(n=>n.crmState.data.dialogMode),o=()=>{t(z(!1))};return x.useEffect(()=>{t(v())},[]),a.jsxs(a.Fragment,{children:[a.jsx(Ye,{}),a.jsx(Ze,{}),a.jsxs(ae,{isOpen:e,onClose:o,children:[a.jsxs("h5",{className:"mb-4",children:[s==="Edit"?"Edit":"Add New"," State"]}),a.jsx(je,{})]}),a.jsx(tt,{})]})},{TabNav:st,TabList:ot}=te,Q={state:{label:"State",path:"state"},city:{label:"City",path:"city"}},it=()=>{const[t,e]=x.useState("state"),s=o=>{e(o)};return a.jsxs(a.Fragment,{children:[a.jsx(te,{value:t,variant:"pill",onChange:o=>s(o),children:a.jsx(ot,{children:Object.keys(Q).map(o=>a.jsx(st,{value:o,children:Q[o].label},o))})}),a.jsx("div",{className:"py-4",children:a.jsxs(x.Suspense,{fallback:a.jsx(a.Fragment,{children:"loading..."}),children:[t==="state"&&a.jsx(at,{}),t==="city"&&a.jsx(He,{})]})})]})},la=it;export{la as S};
