import{a as D,j as e,r as f,p as X,aq as ee}from"./index-82a4cdcd.js";import{D as te}from"./DataTable-a2b72651.js";import"./Alert-62262f10.js";import"./index-c281b544.js";import"./Badge-df87bdc2.js";import{B as R}from"./Button-0e96ba54.js";import"./RangeCalendar-823e8aaa.js";import"./Card-6707ff6e.js";import"./index-c91d029f.js";import"./index-320abfaa.js";import"./Dialog-992e1d56.js";import{D as se}from"./Drawer-4bb376d7.js";import"./index-0428064e.js";import{a as w,F as ae}from"./FormItem-f5087afb.js";import"./toString-b2e07e9a.js";import{I as v}from"./Input-8b535fd4.js";import"./index-c11d92d4.js";import"./index-d64ec43f.js";import"./index-971eae45.js";import{t as A,N as O}from"./toast-4eea8663.js";import"./Pagination-7722c7db.js";import"./Progress-7d1211e0.js";import"./index-7a0e0b9f.js";import"./ScrollBar-b2904e17.js";import"./index-7b9d9e5f.js";import{f as B}from"./Select-eb8671ae.js";import"./Skeleton-d36fd097.js";import"./index-04da13bb.js";import"./Switcher-a7e522ef.js";import"./index-4baab89c.js";import{T as V}from"./index-b111a719.js";import{T as H}from"./Tag-d5568307.js";import"./index-c63c62bb.js";import"./index-30e041a1.js";import"./Tooltip-5f04ccef.js";import"./Upload-341a9a0e.js";import{u as z}from"./checkEditUpdate-b8787a18.js";import{u as re}from"./useThemeClass-38f80a2c.js";import{c as U}from"./cloneDeep-914ca532.js";import{Q as Y,O as oe,P as ie,b as ne}from"./index.esm-9eb3698a.js";import{g as le}from"./index-1e8f0773.js";import{u as p,t as L,d as ce,g as K,p as Z,a as me,s as $,b as de,e as P,f as F,h as _,i as W,r as pe}from"./index-7e7c2465.js";import{C as ue}from"./ConfirmDialog-4e779e5f.js";import{i as fe}from"./Views-5e6cd1d6.js";import{b as I,F as he,a as xe}from"./formik.esm-fbd7cbeb.js";import{c as ge,a as y}from"./index.esm-f6409e84.js";/* empty css              */import{t as be}from"./index.esm-e60cf8ff.js";import{n as je}from"./index.esm-ca8acdf3.js";import{d as Ne}from"./debounce-2ded1513.js";import"./index-6801b2e9.js";import"./useTimeout-da6ce9b0.js";import"./CloseButton-d6bfe260.js";import"./StatusIcon-5a72f149.js";import"./useMergeRef-788c4cb0.js";import"./useControllableState-3caf27a6.js";import"./_baseIsEqual-2b2683ef.js";import"./_MapCache-54b9aafe.js";import"./get-71f6a308.js";import"./useRootClose-ca0d0d80.js";import"./usePopper-150e7e1f.js";import"./TimeInput-10fd264b.js";import"./useUniqueId-cc8af61f.js";import"./useDidUpdate-f06e2487.js";import"./index-5ca2f98c.js";import"./useUncertainRef-0553f5d8.js";import"./isNil-ad4b9ef6.js";import"./index-dff75ec8.js";import"./chainedFunction-070f832c.js";import"./slicedToArray-d75d4238.js";import"./objectWithoutProperties-8809bfcf.js";import"./toConsumableArray-26dffdfb.js";import"./floating-ui.dom-4bc0055b.js";import"./mapCloneElement-c79fb68e.js";import"./index.esm-4533a1af.js";import"./index.esm-bb858611.js";import"./moment-fbc5633a.js";import"./_getPrototype-b764c861.js";import"./CrmService-a7ee7c84.js";const Ce=()=>{const r=D(),c=p(a=>a.crmUsers.data.deleteConfirmation),s=p(a=>a.crmUsers.data.selectedUser),o=()=>{r(L(!1))},n=async()=>{var l,t,d;r(L(!1));const a=await r(ce(s.id));(l=a==null?void 0:a.payload)!=null&&l.success?A.push(e.jsx(O,{title:"Successfuly Deleted",type:"success",duration:2500,children:(t=a==null?void 0:a.payload)==null?void 0:t.message}),{placement:"top-end"}):A.push(e.jsx(O,{title:"Something Went Wrong !!!",type:"danger",duration:2500,children:(d=a==null?void 0:a.error)==null?void 0:d.message}),{placement:"top-end"}),await r(K())};return e.jsx(ue,{isOpen:c,type:"danger",title:"Delete User",confirmButtonColor:"red-600",onClose:o,onRequestClose:o,onCancel:o,onConfirm:n,children:e.jsx("p",{children:"Are you sure you want to delete this user? All record related to this user will be deleted as well. This action cannot be undone."})})},S=[],we=r=>{const{touched:c,errors:s,setFieldValue:o,values:n}=r,a=p(t=>t.crmUsers.data.rolesList);S.length=0,a.forEach(t=>{S.push({label:t.roleName,value:t.id})});const l=[{label:"active",value:"active"},{label:"inactive",value:"inactive"}];return e.jsxs(e.Fragment,{children:[e.jsx(w,{label:"First Name",invalid:s.firstName&&c.firstName,errorMessage:s.firstName,children:e.jsx(I,{type:"text",autoComplete:"off",name:"firstName",component:v,prefix:e.jsx(Y,{className:"text-xl"})})}),e.jsx(w,{label:"Last Name",invalid:s.lastName&&c.lastName,errorMessage:s.lastName,children:e.jsx(I,{type:"text",autoComplete:"off",name:"lastName",component:v,prefix:e.jsx(Y,{className:"text-xl"})})}),e.jsx(w,{label:"Email",invalid:s.email&&c.email,errorMessage:s.email,children:e.jsx(I,{type:"text",autoComplete:"off",name:"email",component:v,prefix:e.jsx(je,{className:"text-xl"})})}),e.jsx(w,{label:"Phone",invalid:s.phone&&c.phone,errorMessage:s.phone,children:e.jsx(I,{type:"text",autoComplete:"off",name:"phone",component:v,prefix:e.jsx(be,{className:"text-xl"})})}),e.jsx(w,{label:"Role",invalid:s.roleId&&c.roleId,errorMessage:s.roleId,children:e.jsx(B,{name:"roleId",id:"roleId",value:S.find(t=>(t==null?void 0:t.value)===(n==null?void 0:n.roleId)),options:S,onChange:t=>{o("roleId",t.value||"")}})}),e.jsx(w,{label:"Status",invalid:s.status&&c.status,errorMessage:s.status,children:e.jsx(B,{name:"status",id:"status",value:l.find(t=>(t==null?void 0:t.value)===(n==null?void 0:n.status)),options:l,onChange:t=>{o("status",t.value||"")}})})]})},ye=ge().shape({firstName:y().required("First name is required"),lastName:y().required("Last name is required"),email:y().matches(/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/i,"Invalid email").required("Email is required"),phone:y().matches(/^\d{10}$/,"Phone number must be 10 digits").required("Phone is required"),status:y().required("Status is required").oneOf(["active","inactive"]),roleId:y().required("Role is required")}),{TabNav:De,TabList:ve,TabContent:Ue}=V,Q=f.forwardRef((r,c)=>{const s=p(a=>a.crmUsers.data.selectedUser),o=p(a=>a.crmUsers.data.drawerMode),n=D();return e.jsx(he,{innerRef:c,initialValues:{firstName:o==="Edit"&&(s==null?void 0:s.firstName)||"",lastName:o==="Edit"&&(s==null?void 0:s.lastName)||"",email:o==="Edit"&&(s==null?void 0:s.email)||"",phone:o==="Edit"&&(s==null?void 0:s.phone)||"",status:o==="Add"?"inactive":(s==null?void 0:s.status)||"",roleId:o==="Edit"&&(s==null?void 0:s.roleId)||""},validationSchema:ye,onSubmit:async(a,{setSubmitting:l})=>{var h,x,g,u;const t=o==="Edit"?await n(Z({id:s.id,data:a})):await n(me(a)),d=(h=t==null?void 0:t.payload)!=null&&h.success?"Successfully Updated":"Something went wrong !!!";A.push(e.jsx(O,{title:d,type:(x=t==null?void 0:t.payload)!=null&&x.success?"success":"danger",duration:2500,children:((g=t==null?void 0:t.payload)==null?void 0:g.message)||((u=t==null?void 0:t.error)==null?void 0:u.message)}),{placement:"top-end"}),n($()),await n(K()),l(!1)},children:({touched:a,errors:l,setFieldValue:t,values:d})=>e.jsx(xe,{children:e.jsx(ae,{children:e.jsxs(V,{defaultValue:"usersInfo",children:[e.jsx(ve,{children:e.jsx(De,{value:"usersInfo",children:"Users Info"})}),e.jsx("div",{className:"p-6",children:e.jsx(Ue,{value:"usersInfo",children:e.jsx(we,{touched:a,errors:l,setFieldValue:t,values:d})})})]})})})})});Q.displayName="UsersForm";const G=f.forwardRef((r,c)=>{const s=D(),o=p(t=>t.crmUsers.data.selectedUser),n=p(t=>t.crmUsers.data.usersList),{id:a}=o,l=t=>{const{name:d,birthday:h,email:x,img:g,location:u,title:E,phoneNumber:T,facebook:k,twitter:M,pinterest:q,linkedIn:m}=t,i={name:d,email:x,img:g},N={location:u,title:E,birthday:X(h).format("DD/MM/YYYY"),phoneNumber:T,facebook:k,twitter:M,pinterest:q,linkedIn:m};let C=U(n),b={};C=C.map(j=>(j.id===a&&(j={...j,...i},j.personalInfo={...j.personalInfo,...N},b=j),j)),fe(b)||s(Z(b)),s($()),s(de(C))};return e.jsx(Q,{ref:c,users:o,onFormSubmit:l})});G.displayName="UsersEditContent";const Ie=({onSaveClick:r,onCancel:c})=>e.jsxs("div",{className:"text-right w-full",children:[e.jsx(R,{size:"sm",className:"mr-2",onClick:c,children:"Cancel"}),e.jsx(R,{size:"sm",variant:"solid",onClick:r,children:"Save"})]}),Se=()=>{const r=D(),c=p(a=>a.crmUsers.data.drawerOpen),s=()=>{r($()),r(P({}))},o=f.useRef(null),n=async()=>{var a,l;(a=o.current)==null||a.values,(l=o.current)==null||l.submitForm()};return e.jsx(se,{isOpen:c,closable:!1,bodyClass:"p-0",footer:e.jsx(Ie,{onCancel:s,onSaveClick:n}),onClose:s,onRequestClose:s,children:e.jsx(G,{ref:o})})},Fe=({status:r})=>{switch(r){case"active":return e.jsx(H,{className:"bg-emerald-100 text-emerald-600 dark:bg-emerald-500/20 dark:text-emerald-100  border-0 rounded",children:"Active"});case"inactive":return e.jsx(H,{className:"text-amber-600 bg-amber-100 dark:text-amber-100 dark:bg-amber-500/20  border-0 rounded",children:"Inactive"});default:return e.jsx(e.Fragment,{})}},Ee=()=>{const r=D(),c=p(m=>m.crmUsers.data.displayedUsersList),s=p(m=>m.crmUsers.data.loading),o=p(m=>m.crmUsers.data.rolesList),n=z("users","canModify"),a=z("users","canDelete");f.useEffect(()=>{async function m(){await r(le())}m()},[r]);const{pageIndex:l,pageSize:t,sort:d,query:h,total:x}=p(m=>m.crmUsers.data.tableData),g=f.useCallback(()=>{r(K())},[r]);f.useEffect(()=>{g()},[g]);const u=f.useMemo(()=>({pageIndex:l,pageSize:t,sort:d,query:h,total:x}),[l,t,d,h,x]),E=({row:m})=>{re();const i=()=>{r(_()),r(P(m)),r(W("Edit"))},N=async()=>{await r(P(m)),r(L(!0))};return e.jsxs("div",{className:"flex text-base items-center",children:[n&&e.jsx("button",{className:"circle items-center  cursor-pointer hover:text-indigo-500",onClick:i,children:e.jsx(oe,{})}),a&&e.jsx("span",{className:"cursor-pointer hover:text-red-500 mx-1 circle items-center",onClick:N,children:e.jsx(ie,{})})]})},T=f.useMemo(()=>[{header:"Action",id:"action",cell:i=>e.jsx(E,{row:i.row.original})},{header:"First Name",accessorKey:"firstName",cell:i=>i.row.original.firstName},{header:"Last Name",accessorKey:"lastName",cell:i=>i.row.original.lastName},{header:"Role",accessorKey:"role",cell:i=>{var C;return((C=o==null?void 0:o.find(b=>(b==null?void 0:b.id)===(i==null?void 0:i.row.original.roleId)))==null?void 0:C.roleName)||"-"}},{header:"Email",accessorKey:"email",cell:i=>i.row.original.email},{header:"Phone",accessorKey:"phone",cell:i=>i.row.original.phone},{header:"Status",accessorKey:"status",cell:i=>{const N=i.row.original;return e.jsx(Fe,{status:N.status})}}],[n,a,o]),k=m=>{const i=U(u);i.pageIndex=m,r(F(i))},M=m=>{const i=U(u);i.pageSize=Number(m),i.pageIndex=1,r(F(i))},q=m=>{const i=U(u);i.sort=m,r(F(i))};return e.jsxs("div",{children:[e.jsx(te,{columns:T,data:c,skeletonAvatarColumns:[0],skeletonAvatarProps:{width:28,height:28},loading:s,pagingData:{total:u.total,pageIndex:u.pageIndex,pageSize:u.pageSize},onPaginationChange:k,onSelectChange:M,onSort:q}),e.jsx(Se,{}),e.jsx(Ce,{})]})},J=f.forwardRef((r,c)=>{const{onInputChange:s}=r,o=Ne(n,500);function n(l){s==null||s(l)}const a=l=>{o(l.target.value)};return e.jsx(v,{ref:c,className:"max-w-md md:w-52 mb-4",size:"sm",placeholder:"Search",prefix:e.jsx(ne,{className:"text-lg"}),onChange:a})});J.displayName="UsersTableSearch";const Te=()=>{const r=D(),c=f.useRef(null),s=p(t=>t.crmUsers.data.tableData),o=z("users","canCreate"),n=t=>{const d=U(s);d.query=t,d.pageIndex=1,typeof t=="string"&&t.length>1&&a(d),typeof t=="string"&&t.length===0&&a(d)},a=t=>{r(F(t))},l=()=>{r(_()),r(W("ADD"))};return e.jsxs("div",{className:"md:flex items-center justify-between",children:[e.jsx("div",{className:"md:flex items-center gap-4",children:e.jsx(J,{ref:c,onInputChange:n})}),e.jsx("div",{className:"mb-4",children:o&&e.jsx(R,{size:"sm",onClick:l,children:"Add New"})})]})};ee("crmUsers",pe);const as=()=>e.jsxs(e.Fragment,{children:[e.jsx(Te,{}),e.jsx(Ee,{})]});export{as as default};
