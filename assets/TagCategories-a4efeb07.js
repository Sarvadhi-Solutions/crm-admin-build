import{r as j,a as S,j as e,ah as ye,aq as Ce}from"./index-23438ae7.js";import{u as te}from"./useThemeClass-ff7f30ed.js";import"./Card-f69b93fe.js";import"./Views-9f1346e4.js";import{B as fe}from"./Badge-d8b21e8e.js";import"./chart.constant-eb382ed3.js";import"./GrowShrinkTag-8e63939a.js";import{aa as Ne,ab as Te,ac as be,O as se,P as oe}from"./index.esm-abf109fc.js";import"./index-0f4eb207.js";import{B as A}from"./Button-6151e38d.js";import{D as U}from"./Dialog-dadf7059.js";import{T as we}from"./DataTable-eaf5954b.js";import{I as z}from"./Input-56c39592.js";import"./Skeleton-a15387d3.js";import"./react-tooltip.min-9100f526.js";import"./RichTextEditor-5e0a78e4.js";import"./SegmentItemOption-8600fd0d.js";import"./SvgIcon-be2d5fdd.js";import{T as Se}from"./Tooltip-7ead0d1d.js";import{T as O}from"./index-bc82ff52.js";import{u as re,f as $,g as ie,e as ve,d as Fe}from"./index-e62ff1a1.js";import"./Alert-2ee7f6ed.js";import"./RangeCalendar-241f4707.js";import"./index-58319d48.js";import"./index-88435c39.js";import"./Drawer-91500bd4.js";import{a as De}from"./index-0225ab21.js";import{F as Y,a as I}from"./FormItem-81d96ba6.js";import"./toString-43f8d781.js";import"./index-bd0ae7e4.js";import"./index-e115d598.js";import"./index-3e7750c4.js";import{t as D,N as M}from"./toast-dce6e6a9.js";import{P as Me}from"./Pagination-d8250938.js";import"./Progress-8255b424.js";import"./index-9b7c753a.js";import"./ScrollBar-85bd4202.js";import"./index-b55caea5.js";import{S as ne}from"./Select-95f0cb48.js";import"./index-be5eba8a.js";import"./Switcher-4e23edc7.js";import"./index-05c2f418.js";import"./Tag-1f728080.js";import"./index-6e98d156.js";import"./index-c9a86e91.js";import"./Upload-2033c099.js";import{F as _,a as G,b as R,c as Ie,g as J}from"./formik.esm-88d9cb0a.js";import{c as q,a as v,e as ke}from"./index.esm-c939c475.js";import{u as f,e as Ee,t as V,g as k,T as Ae,a as K,d as Re,m as F,c as $e,b as W,f as le,h as qe,i as Be,j as B,s as H,k as ce,l as Q,n as L,o as Oe,p as X,r as He}from"./TagCategoryDetailsForm-9f1df65b.js";import{C as de}from"./ConfirmDialog-e5b27e51.js";import{c as Z}from"./cloneDeep-1b943ce1.js";import{u as Pe}from"./checkEditUpdate-244f1091.js";import{d as ze}from"./index.esm-2309465f.js";const Ve=q().shape({categoryName:v().required("Field is required")}),me=j.forwardRef((r,d)=>{var c;const l=S(),m=f(o=>o.crmTagCategories.data.formToggle),p=()=>{l(V(!1))},a=f(o=>o.crmTagCategories.data.selectedTagCategory);return e.jsx(U,{isOpen:m,onClose:p,children:e.jsx(_,{innerRef:d,initialValues:{categoryName:(a==null?void 0:a.categoryName)||"",master:((c=a==null?void 0:a.master)==null?void 0:c.id)||"",tags:(a==null?void 0:a.tags)||[]},validationSchema:Ve,onSubmit:async(o,{setSubmitting:s})=>{var x,T,C,b;s(!1);const t={...o,masterId:o==null?void 0:o.master,tagId:((x=o==null?void 0:o.tags)==null?void 0:x.map(w=>w==null?void 0:w.id))||[]};delete t.master,delete t.tags;const n=await l(Ee({tagCategoryId:(a==null?void 0:a.id)||"",updatedData:t}));let h="",y="",N="";(T=n==null?void 0:n.payload)!=null&&T.success?(h="Successfully Update",y=(C=n==null?void 0:n.payload)==null?void 0:C.message,N="success"):(h="Something went wrong !!!",y=(b=n==null?void 0:n.error)==null?void 0:b.message,N="danger"),D.push(e.jsx(M,{title:h,type:N,duration:2500,children:y}),{placement:"top-end"}),l(V(!1)),await l(k())},children:({touched:o,errors:s,values:t,setFieldValue:n})=>e.jsx(G,{children:e.jsx(Y,{children:e.jsx(Ae,{touched:o,errors:s,values:t,setFieldValue:n})})})})})});me.displayName="TagCategoryForm";const Ke=()=>{const r=S(),d=f(a=>a.crmTagCategories.data.deleteConfirmation),l=f(a=>a.crmTagCategories.data.selectedTagCategory),m=()=>{r(K(!1))},p=async()=>{var c,o,s;r(K(!1));const a=await r(Re(l.id));(c=a==null?void 0:a.payload)!=null&&c.success?D.push(e.jsx(M,{title:"Successfuly Deleted",type:"success",duration:2500,children:(o=a==null?void 0:a.payload)==null?void 0:o.message}),{placement:"top-end"}):D.push(e.jsx(M,{title:"Something Went Wrong !!!",type:"danger",duration:2500,children:(s=a==null?void 0:a.error)==null?void 0:s.message}),{placement:"top-end"}),await r(k())};return e.jsx(de,{isOpen:d,type:"danger",title:"Delete Tag Category",confirmButtonColor:"red-600",onClose:m,onRequestClose:m,onCancel:m,onConfirm:p,children:e.jsx("p",{children:"Are you sure you want to delete this Tag Category? All record related to this tag category will be deleted as well. This action cannot be undone."})})},ge=({field:r})=>{const d=["#FF5733","#33FF57","#5733FF","#FFFF33","#33FFFF","#FF33FF","#FF3366","#FF6666","#6699FF"],[l,m]=j.useState(!1),p=()=>{m(!l)},a=c=>{const o={target:{name:r.name,value:c}};r.onChange(o),m(!1)};return e.jsxs("div",{style:{position:"relative",display:"inline-block",top:"9px"},children:[e.jsx("div",{style:{width:"30px",height:"30px",backgroundColor:r.value,border:"1px solid #000",borderRadius:"50%"},onClick:p}),l&&e.jsx("div",{className:"absolute",children:e.jsx(De,{className:"grid grid-cols-3 gap-1 hover mt-1 custom-scrollbar",children:d.map((c,o)=>e.jsx("div",{style:{width:"30px",height:"30px",backgroundColor:c,margin:"5px",cursor:"pointer",borderRadius:"50%",transition:"background 0.3s ease",border:r.value===c?"1px solid #000":"none"},onClick:()=>a(c)},o))})})]})};const We=q({categoryName:v().required("Category Name is required"),masterId:v().required("This field is required").test("is-valid-module","Invalid module selected",r=>!!F.find(d=>d.value==r)),tags:ke().of(q().shape({tagName:v().required("Name required"),colorName:v().required("Color required")}))}),ee=(r,d)=>{const l=J(r.errors,d),m=J(r.touched,d);return{errorMessage:l||"",invalid:typeof m>"u"?!1:l&&m}},Le=()=>{const r=S(),[d,l]=j.useState([]);j.useEffect(()=>{(async()=>{var o;const c=await r(le());l((o=c==null?void 0:c.payload)==null?void 0:o.data)})()},[r]),F.length=0,d==null||d.forEach(a=>{F.push({value:a.id,label:a.moduleName})});const m=f(a=>a.crmTagCategories.data.addForm),p=()=>{r(W(!1))};return e.jsx("div",{children:e.jsx(U,{isOpen:m,onClose:p,children:e.jsx(_,{validationSchema:We,initialValues:{tags:[{tagName:"",colorName:""}],categoryName:"",masterId:""},onSubmit:async a=>{var n,h,y;let c="",o="",s="";const t=await r($e(a));(n=t==null?void 0:t.payload)!=null&&n.success?(c="Successfully Added",o=(h=t==null?void 0:t.payload)==null?void 0:h.message,s="success"):(c="Something went wrong !!!",o=(y=t==null?void 0:t.error)==null?void 0:y.message,s="danger"),D.push(e.jsx(M,{title:c,type:s,duration:2500,children:o}),{placement:"top-end"}),r(W(!1)),await r(k())},children:({touched:a,errors:c,values:o,setFieldValue:s})=>{const t=o.tags;return e.jsx(G,{children:e.jsx(Y,{layout:"inline",children:e.jsxs("div",{className:"w-full custom-scrollbar",style:{maxHeight:"75vh",overflowY:"auto"},children:[e.jsxs("div",{className:"mb-10",children:[e.jsx("h5",{className:"mb-4",children:"Add Tag Category"}),e.jsx(I,{layout:"vertical",label:"Category Name",invalid:c.categoryName&&a.categoryName,errorMessage:c.categoryName,children:e.jsx(R,{placeholder:"Category Name",name:"categoryName",component:z})}),e.jsx(I,{layout:"vertical",label:"Module Name",invalid:c.masterId&&a.masterId,errorMessage:c.masterId,children:e.jsx(ne,{name:"masterId",placeholder:"Module Name",options:F,id:"masterId",value:F.find(n=>(n==null?void 0:n.value)==(o==null?void 0:o.masterId)),onChange:n=>{const h=n.value;s("masterId",h||"")}})})]}),e.jsx(Ie,{name:"tags",children:({form:n,remove:h,push:y})=>e.jsxs("div",{children:[t&&t.length>0?t.map((N,x)=>{const T=ee(n,`tags[${x}].tagName`),C=ee(n,`tags[${x}].colorName`);return e.jsxs("div",{children:[e.jsx(I,{label:"Name",invalid:T.invalid,errorMessage:T.errorMessage,children:e.jsx(R,{invalid:T.invalid,placeholder:"Tag Name",name:`tags[${x}].tagName`,type:"text",component:z})}),e.jsx(I,{invalid:C.invalid,children:e.jsx(R,{invalid:C.invalid,placeholder:"Color",name:`tags[${x}].colorName`,render:({field:b})=>e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:0},children:[e.jsx(ge,{field:b}),C.invalid&&e.jsx("div",{style:{marginTop:15,marginLeft:5,color:"red"},children:C.errorMessage})]})})}),e.jsx(A,{shape:"circle",size:"sm",icon:e.jsx(Ne,{}),onClick:()=>h(x)})]},x)}):null,e.jsxs("div",{children:[e.jsx(A,{type:"button",className:"ltr:mr-2 rtl:ml-2",onClick:()=>{y({tagName:"",colorName:""})},children:"Add tags"}),e.jsx(A,{type:"submit",variant:"solid",children:"Submit"})]})]})})]})})})}})})})},Ue=q({tagName:v().required("Tag Name is required"),colorName:v().required("Color required")}),ue=()=>{const r=S(),[d,l]=j.useState([]);j.useEffect(()=>{(async()=>{var n;const t=await r(le());l((n=t==null?void 0:t.payload)==null?void 0:n.data)})()},[r]),F.length=0,d==null||d.forEach(s=>{F.push({value:s.id,label:s.moduleName})});const m=f(s=>s.crmTagCategories.data.editForm),p=f(s=>{var t,n;return(n=(t=s==null?void 0:s.crmTagCategories)==null?void 0:t.data)==null?void 0:n.dialogMode}),a=f(s=>s.crmTagCategories.data.selectedTag),c=()=>{r(B(!1))},o=f(s=>s.crmTagCategories.data.selectedTagCategory);return e.jsx("div",{children:e.jsx(U,{isOpen:m,onClose:c,children:e.jsx(_,{validationSchema:Ue,initialValues:{tagName:p==="Edit"?a==null?void 0:a.tagName:"",colorName:p==="Edit"?a==null?void 0:a.colorName:"",masterId:p==="Edit"?a==null?void 0:a.masterId:""},onSubmit:async s=>{var N,x,T,C,b,w;let t="",n="",h="";const y={...s};if(p==="Add"){const g=await r(qe({masterId:o==null?void 0:o.masterId,tagName:s==null?void 0:s.tagName,colorName:s==null?void 0:s.colorName,tagCategoryId:o==null?void 0:o.id}));(N=g==null?void 0:g.payload)!=null&&N.success?(t="Successfully Added",n=(x=g==null?void 0:g.payload)==null?void 0:x.message,h="success"):(t="Something went wrong !!!",n=(T=g==null?void 0:g.error)==null?void 0:T.message,h="danger")}else{const g=await r(Be({tagId:(a==null?void 0:a.id)||"",data:y}));(C=g==null?void 0:g.payload)!=null&&C.success?(t="Successfully Added",n=(b=g==null?void 0:g.payload)==null?void 0:b.message,h="success"):(t="Something went wrong !!!",n=(w=g==null?void 0:g.error)==null?void 0:w.message,h="danger")}D.push(e.jsx(M,{title:t,type:h,duration:2500,children:n}),{placement:"top-end"}),r(B(!1)),await r(k())},children:({touched:s,errors:t,values:n,setFieldValue:h})=>e.jsx(G,{children:e.jsx(Y,{layout:"inline",children:e.jsxs("div",{className:"w-full custom-scrollbar",style:{maxHeight:"75vh",overflowY:"auto"},children:[e.jsx("div",{className:"mb-10",children:e.jsx("h5",{className:"mb-4",children:p==="Edit"?"Edit Tag Category":"Add Tag Category"})}),e.jsx(I,{label:"Name",invalid:t.tagName&&s.tagName,errorMessage:t.tagName,children:e.jsx(R,{placeholder:"Tag Name",name:"tagName",type:"text",component:z})}),e.jsx(I,{invalid:t.colorName&&s.colorName,children:e.jsx(R,{invalid:t.colorName&&s.colorName,placeholder:"Color",name:"colorName",render:({field:y})=>e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:0},children:[e.jsx(ge,{field:y}),t.colorName&&e.jsx("div",{style:{marginTop:15,marginLeft:5,color:"red"},children:t.colorName})]})})}),e.jsx("div",{children:e.jsx(A,{type:"submit",variant:"solid",children:"Submit"})})]})})})})})})},{Tr:P,Th:Ye,Td:_e,THead:Ge,TBody:Je}=O,Qe=({renderRowSubComponent:r,getRowCanExpand:d})=>{const l=S(),m=({row:i})=>{te();const u=()=>{l(V(!0)),l(H(i))},E=async()=>{await l(H(i)),l(K(!0))},je=async()=>{l(ce("Add")),l(B(!0)),l(H(i))};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex text-base items-center",children:[e.jsx(Se,{title:"Add Tag",children:e.jsx("button",{className:" cursor-pointer circle items-center hover:text-green-500 mr-1",onClick:je,children:e.jsx(ze,{})})}),e.jsx("button",{className:" cursor-pointer circle items-center hover:text-blue-500 ",onClick:u,children:e.jsx(se,{})}),e.jsx("span",{className:"cursor-pointer hover:text-red-500 mx-1 circle items-center",onClick:E,children:e.jsx(oe,{})})]})})},p=[10,25,50,100],a=f(i=>i.crmTagCategories.data.displayedTagCategoriesList),c=f(i=>i.crmTagCategories.data.loading),{pageIndex:o,pageSize:s,sort:t,query:n,total:h}=f(i=>i.crmTagCategories.data.tableData),y=j.useMemo(()=>({pageIndex:o,pageSize:s,sort:t,query:n,total:h}),[o,s,t,n,h]),N=j.useMemo(()=>[{header:()=>null,id:"expander",cell:({row:i})=>e.jsx(e.Fragment,{children:i.getCanExpand()?e.jsx("button",{className:"text-lg",onClick:i.getToggleExpandedHandler(),children:i.getIsExpanded()?e.jsx(Te,{}):e.jsx(be,{})}):null}),subCell:()=>null},{header:"Actions",id:"action",cell:i=>e.jsx(m,{row:i.row.original})},{header:"Category Name",accessorKey:"categoryName"},{header:"Module Name",accessorKey:"master.moduleName"},{header:"Created By",accessorKey:"createdBy",cell:i=>{var u,E;return`${(u=i.row.original.createdData)==null?void 0:u.firstName} ${(E=i.row.original.createdData)==null?void 0:E.lastName}`}}],[]),[x,T]=j.useState(a),C=j.useMemo(()=>p.map(i=>({value:i,label:`${i} / page`})),[p]);j.useEffect(()=>{const i=a==null?void 0:a.map(u=>({...u,subRows:u.tags}));T(i)},[a]);const b=re({data:x,columns:N,getRowCanExpand:d,getCoreRowModel:ie(),getExpandedRowModel:ve(),manualPagination:!0,manualSorting:!0}),w=i=>{const u=Z(y);u.pageIndex=i,l(Q(u))},g=i=>{const u=Z(y);u.pageSize=Number(i),u.pageIndex=1,l(Q(u))},he=i=>{c||g==null||g(Number(i))},pe=i=>{c||w==null||w(i)};Pe("tagcategory","canCreate");const xe=()=>{l(W(!0))};return e.jsxs(e.Fragment,{children:[e.jsxs(ye,{loading:c&&(x==null?void 0:x.length)!==0,type:"cover",children:[e.jsx("div",{className:"md:flex items-center justify-end",children:e.jsx("div",{className:"mb-4",children:e.jsx(A,{size:"sm",onClick:xe,children:"Add New"})})}),e.jsxs(O,{children:[e.jsx(Ge,{children:b.getHeaderGroups().map(i=>e.jsx(P,{children:i.headers.map(u=>e.jsx(Ye,{colSpan:u.colSpan,children:$(u.column.columnDef.header,u.getContext())},u.id))},i.id))}),c&&(x==null?void 0:x.length)===0?e.jsx(we,{columns:N==null?void 0:N.length,avatarInColumns:[0],avatarProps:{width:28,height:28}}):e.jsx(Je,{children:b.getRowModel().rows.map(i=>e.jsxs(j.Fragment,{children:[e.jsx(P,{children:i.getVisibleCells().map(u=>e.jsx("td",{children:$(u.column.columnDef.cell,u.getContext())},u.id))}),i.getIsExpanded()&&e.jsx(P,{children:e.jsx(_e,{colSpan:i.getVisibleCells().length,children:r({row:i})})})]},i.id))})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx(Me,{pageSize:s,currentPage:o,total:h,onChange:pe}),e.jsx("div",{style:{minWidth:130},children:e.jsx(ne,{size:"sm",menuPlacement:"top",isSearchable:!1,value:C==null?void 0:C.filter(i=>i.value===s),options:C,onChange:i=>he(i==null?void 0:i.value)})})]})]}),e.jsx(Ke,{}),e.jsx(me,{}),e.jsx(Le,{}),e.jsx(ue,{})]})},Xe=()=>{const r=S(),d=f(a=>a.crmTagCategories.data.deleteSubTagConfirmation),l=f(a=>a.crmTagCategories.data.selectedTag),m=()=>{r(L(!1))},p=async()=>{var c,o,s;r(L(!1));const a=await r(Oe(l.id));(c=a==null?void 0:a.payload)!=null&&c.success?D.push(e.jsx(M,{title:"Successfuly Deleted",type:"success",duration:2500,children:(o=a==null?void 0:a.payload)==null?void 0:o.message}),{placement:"top-end"}):D.push(e.jsx(M,{title:"Something Went Wrong !!!",type:"danger",duration:2500,children:(s=a==null?void 0:a.error)==null?void 0:s.message}),{placement:"top-end"}),await r(k())};return e.jsx(de,{isOpen:d,type:"danger",title:"Delete Tag",confirmButtonColor:"red-600",onClose:m,onRequestClose:m,onCancel:m,onConfirm:p,children:e.jsx("p",{children:"Are you sure you want to delete this Tag? All record related to this tag will be deleted as well. This action cannot be undone."})})},{Tr:ae,Th:Ze,Td:ea,THead:aa,TBody:ta,Sorter:sa}=O,oa=({row:r})=>{te();const d=()=>{l(ce("Edit")),l(B(!0)),l(X(r))},l=S(),m=async()=>{await l(X(r)),await l(L(!0))};return e.jsxs("div",{className:"flex text-base items-center",children:[e.jsx("button",{className:"circle items-center hover:text-blue-500",onClick:d,children:e.jsx(se,{})}),e.jsx("span",{className:"cursor-pointer hover:text-red-500 mx-1 circle items-center",onClick:m,children:e.jsx(oe,{})})]})},ra=r=>{const{tableData:d}=r,[l,m]=j.useState([]),[p,a]=j.useState(d),c=[{header:"Actions",id:"action",cell:s=>e.jsx(oa,{row:s.row.original})},{header:"Tag Name",accessorKey:"tagName"},{header:"Color",accessorKey:"colorName",cell:s=>{const t=s.row.original;return e.jsxs("div",{className:"flex items-center",children:[e.jsx(fe,{style:{backgroundColor:`${t.colorName}`}}),e.jsx("span",{className:"ml-2 rtl:mr-2 capitalize",children:t.colorName})]})}}];j.useEffect(()=>{a(d)},[d]);const o=re({data:p,columns:c,state:{sorting:l},onSortingChange:m,getCoreRowModel:ie(),getSortedRowModel:Fe()});return e.jsxs(e.Fragment,{children:[e.jsxs(O,{children:[e.jsx(aa,{children:o.getHeaderGroups().map(s=>e.jsx(ae,{children:s.headers.map(t=>e.jsx(Ze,{colSpan:t.colSpan,children:t.isPlaceholder?null:e.jsxs("div",{className:t.column.getCanSort()?"cursor-pointer select-none":"",onClick:t.column.getToggleSortingHandler(),children:[$(t.column.columnDef.header,t.getContext()),e.jsx(sa,{sort:t.column.getIsSorted()})]})},t.id))},s.id))}),e.jsx(ta,{children:o.getRowModel().rows.slice(0,10).map(s=>e.jsx(ae,{children:s.getVisibleCells().map(t=>e.jsx(ea,{children:$(t.column.columnDef.cell,t.getContext())},t.id))},s.id))})]}),e.jsx(Xe,{}),e.jsx(ue,{})]})},ia=({row:r})=>e.jsx("pre",{style:{fontSize:"10px"},children:e.jsx(ra,{tableData:r.original.tags})});Ce("crmTagCategories",He);const na=()=>{const r=S(),d=async()=>{await r(k())};return j.useEffect(()=>{d()},[r]),e.jsxs(e.Fragment,{children:[e.jsx("h5",{className:"mb-2",children:"Manage Tags"}),e.jsx(Qe,{renderRowSubComponent:ia,getRowCanExpand:()=>!0})]})},nt=na;export{nt as T};
