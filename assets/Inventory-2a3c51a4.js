import{am as S,an as ne,ao as le,ap as de,r as f,j as o,a as j,aq as ie}from"./index-82a4cdcd.js";import{T as Me}from"./index-b111a719.js";import{aj as He,s as ce,ak as Ve,al as Qe,am as Ue,an as Ee,ao as Je,ap as Xe,aq as Ye,ar as Ze,as as ea,at as aa,r as ta}from"./CrmService-a7ee7c84.js";import{B as A}from"./Button-0e96ba54.js";import{I as L}from"./Input-8b535fd4.js";import{b as ge,O as me,P as ue}from"./index.esm-9eb3698a.js";import{d as pe}from"./debounce-2ded1513.js";import{c as N}from"./cloneDeep-914ca532.js";import{D as ye}from"./DataTable-a2b72651.js";import{u as $}from"./checkEditUpdate-b8787a18.js";import{u as Ce}from"./useThemeClass-38f80a2c.js";import"./Alert-62262f10.js";import"./index-c281b544.js";import"./Badge-df87bdc2.js";import"./RangeCalendar-823e8aaa.js";import"./Card-6707ff6e.js";import"./index-c91d029f.js";import"./index-320abfaa.js";import{D as he}from"./Dialog-992e1d56.js";import"./Drawer-4bb376d7.js";import"./index-0428064e.js";import{F as fe,a as M}from"./FormItem-f5087afb.js";import"./toString-b2e07e9a.js";import"./index-c11d92d4.js";import"./index-d64ec43f.js";import"./index-971eae45.js";import{N as q,t as v}from"./toast-4eea8663.js";import"./Pagination-7722c7db.js";import"./Progress-7d1211e0.js";import"./index-7a0e0b9f.js";import"./ScrollBar-b2904e17.js";import"./index-7b9d9e5f.js";import{S as U}from"./Select-eb8671ae.js";import"./Skeleton-d36fd097.js";import"./index-04da13bb.js";import"./Switcher-a7e522ef.js";import"./index-4baab89c.js";import"./Tag-d5568307.js";import"./index-c63c62bb.js";import"./index-30e041a1.js";import"./Tooltip-5f04ccef.js";import"./Upload-341a9a0e.js";import"./Views-5e6cd1d6.js";import"./chart.constant-af606830.js";import"./GrowShrinkTag-eea444bd.js";import"./react-tooltip.min-b828bcbe.js";import"./RichTextEditor-ac808d95.js";import"./SegmentItemOption-4c0660d9.js";import{S as xe}from"./StickyFooter-3b624d91.js";import"./SvgIcon-d14f51e5.js";import{F as be,a as je,b as E}from"./formik.esm-fbd7cbeb.js";import{A as Se}from"./index.esm-c1a3c0a2.js";import{a as F,g as oa}from"./index.esm-f3449157.js";import{c as k,a as Q,d as sa}from"./index.esm-f6409e84.js";import{C as we}from"./ConfirmDialog-4e779e5f.js";import{a as ra}from"./index.esm-e60cf8ff.js";import{c as na}from"./index.esm-ca8acdf3.js";import{T as la}from"./TextTruncate-c40fceb4.js";const da="crmCategory",J=S("crmCategory/data/createCategory",async t=>{var e,a;try{return(await He(t)).data}catch(s){throw new Error((a=(e=s==null?void 0:s.response)==null?void 0:e.data)==null?void 0:a.message)}}),z=S("crmCategory/data/getCategory",async()=>{var t,e;try{return(await ce()).data}catch(a){throw new Error((e=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:e.message)}}),ia=S("crmLeads/data/editCategory",async({id:t,updatedData:e})=>{var a,s;try{return(await Ve(t,e)).data}catch(l){throw new Error((s=(a=l==null?void 0:l.response)==null?void 0:a.data)==null?void 0:s.message)}}),ca=S("crmLeads/data/deleteCategory",async t=>{var e,a;try{return await Qe(t)}catch(s){throw new Error((a=(e=s==null?void 0:s.response)==null?void 0:e.data)==null?void 0:a.message)}}),ga={total:0,pageIndex:1,pageSize:10,query:"",sort:{order:"",key:""}},ma={loading:!1,tableData:ga,displayedCategoryList:[],categoryList:[],isDialogOpen:!1,dialogMode:"Add",selectedCategory:null,deleteConfirmation:!1},Le=ne({name:`${da}/state`,initialState:ma,reducers:{setTableData:(t,e)=>{t.tableData=e.payload;const a=t.categoryList.filter(s=>s.name.toLowerCase().includes(e.payload.query.toLowerCase()));t.displayedCategoryList=a.slice(e.payload.pageSize*(e.payload.pageIndex-1),e.payload.pageSize*e.payload.pageIndex)},setSelectedCategory:(t,e)=>{t.selectedCategory=e.payload},setDialogToggle:(t,e)=>{t.isDialogOpen=e.payload},setDialogMode:(t,e)=>{t.dialogMode=e.payload},toggleDeleteConfirmation:(t,e)=>{t.deleteConfirmation=e.payload}},extraReducers:t=>{t.addCase(J.fulfilled,(e,a)=>{e.loading=!1}).addCase(J.pending,e=>{e.loading=!0}).addCase(z.fulfilled,(e,a)=>{var s;e.loading=!1,e.categoryList=a==null?void 0:a.payload.data,e.tableData.total=(s=a.payload.data)==null?void 0:s.length,e.displayedCategoryList=a==null?void 0:a.payload.data.slice(0,10)}).addCase(z.pending,e=>{e.loading=!0})}}),{setTableData:G,setDialogToggle:B,setDialogMode:ke,setSelectedCategory:Ie,toggleDeleteConfirmation:X}=Le.actions,ua=Le.reducer,pa=le({data:ua}),P=de,$e=f.forwardRef((t,e)=>{const{onInputChange:a}=t,s=pe(l,500);function l(r){a==null||a(r)}const d=r=>{s(r.target.value)};return o.jsx(L,{ref:e,className:"max-w-md md:w-52 mb-4",size:"sm",placeholder:"Search",prefix:o.jsx(ge,{className:"text-lg"}),onChange:d})});$e.displayName="CategoryTableSearch";const ya=()=>{const t=j(),e=f.useRef(null),a=P(d=>d.crmCategory.data.tableData),s=d=>{const r=N(a);r.query=d,r.pageIndex=1,typeof d=="string"&&d.length>1&&l(r),typeof d=="string"&&d.length===0&&l(r)},l=d=>{t(d?G(d):z())};return o.jsxs("div",{className:"md:flex items-center justify-between",children:[o.jsx("div",{className:"md:flex items-center gap-4",children:o.jsx($e,{ref:e,onInputChange:s})}),o.jsx("div",{className:"mb-4",children:o.jsx(A,{size:"sm",onClick:()=>{t(B(!0)),t(ke("Add"))},children:"Add New"})})]})},Ca=()=>{const t=j(),e=P(i=>i.crmCategory.data.loading),a=$("roles","canModify"),s=$("roles","canDelete"),{pageIndex:l,pageSize:d,sort:r,query:p,total:y}=P(i=>i.crmCategory.data.tableData),u=P(i=>i.crmCategory.data.displayedCategoryList),m=({row:i})=>{const n=j(),{textTheme:b}=Ce(),w=()=>{n(Ie(i)),n(B(!0)),n(ke("Edit"))},I=async()=>{await n(Ie(i)),n(X(!0))};return o.jsxs("div",{className:"flex justify-start text-lg",children:[o.jsx("span",{className:`cursor-pointer p-2 hover:${b}`,onClick:w,children:o.jsx(me,{})}),o.jsx("span",{className:"cursor-pointer p-2 hover:text-red-500",onClick:I,children:o.jsx(ue,{})})]})},g=f.useMemo(()=>({pageIndex:l,pageSize:d,sort:r,query:p,total:y}),[l,d,r,p,y]),c=f.useMemo(()=>[{header:"Action",id:"action",cell:n=>o.jsx(m,{row:n.row.original})},{header:"Category",accessorKey:"name",cell:n=>n.row.original.name}],[a,s]),C=i=>{const n=N(g);n.pageIndex=i,t(G(n))},x=i=>{const n=N(g);n.pageSize=Number(i),n.pageIndex=1,t(G(n))},h=i=>{const n=N(g);n.sort=i,t(G(n))};return o.jsx("div",{children:o.jsx(ye,{columns:c,data:u,skeletonAvatarColumns:[0],skeletonAvatarProps:{width:28,height:28},loading:e,pagingData:{total:g.total,pageIndex:g.pageIndex,pageSize:g.pageSize},onPaginationChange:C,onSelectChange:x,onSort:h})})},ha=k().shape({name:Q().required("Category name is required")}),ze=f.forwardRef((t,e)=>{const a=j(),s=P(p=>p.crmCategory.data.dialogMode),l=P(p=>p.crmCategory.data.selectedCategory),d=()=>{a(B(!1))},r=async(p,y,u,m,g)=>{var i,n,b;const c=await m(p==="Add"?J(y):ia({id:u==null?void 0:u.id,updatedData:{name:y.name}}));let C="",x="",h="danger";(i=c==null?void 0:c.payload)!=null&&i.success?(C="Successfully Added",x=(n=c==null?void 0:c.payload)==null?void 0:n.message,h="success"):(C="Something went wrong !!!",x=(b=c==null?void 0:c.error)==null?void 0:b.message),g.push(o.jsx(q,{title:C,type:h,duration:2500,children:x}),{placement:"top-end"}),m(B(!1)),await m(z())};return o.jsx(be,{innerRef:e,initialValues:{name:s==="Edit"?l==null?void 0:l.name:""},validationSchema:ha,onSubmit:async(p,{setSubmitting:y})=>{s==="Add"?await r("Add",p,null,a,v):await r("Edit",p,l,a,v),y(!1)},children:({touched:p,errors:y,values:u,setFieldValue:m})=>o.jsxs(je,{children:[o.jsx(fe,{children:o.jsx(M,{label:"Category Name",invalid:y.name&&p.name,errorMessage:y.name,children:o.jsx(E,{type:"text",autoComplete:"off",name:"name",placeholder:"Category Name",component:L,prefix:o.jsx(F,{className:"text-xl"})})})}),o.jsx(xe,{className:"flex items-center justify-end py-2",stickyClass:"border-t bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700",children:o.jsxs("div",{className:"md:flex items-center",children:[o.jsx(A,{size:"sm",className:"ltr:mr-3 rtl:ml-3",type:"button",onClick:d,children:"Cancel"}),o.jsx(A,{size:"sm",type:"submit",variant:"solid",icon:o.jsx(Se,{}),children:"Save"})]})})]})})});ze.displayName="CategoryForm";const fa=()=>{const t=j(),e=P(r=>r.crmCategory.data.deleteConfirmation),a=P(r=>r.crmCategory.data.selectedCategory),s=()=>{t(X(!1))},l=(r,p,y,u)=>{var g,c,C;const m=(g=r==null?void 0:r.payload)==null?void 0:g.success;p.push(o.jsx(q,{title:m?y:u,type:m?"success":"danger",duration:2500,children:m?(c=r==null?void 0:r.payload)==null?void 0:c.message:(C=r==null?void 0:r.error)==null?void 0:C.message}),{placement:"top-end"})},d=async()=>{t(X(!1));const r=await t(ca(a==null?void 0:a.id));l(r,v,"Successfully Deleted","Something Went Wrong !!!"),await t(z())};return o.jsx(we,{isOpen:e,type:"danger",title:"Delete Category",confirmButtonColor:"red-600",onClose:s,onRequestClose:s,onCancel:s,onConfirm:d,children:o.jsx("p",{children:"Are you sure you want to delete this Category? All record related to this Category will be deleted as well. This action cannot be undone."})})};ie("crmCategory",pa);const xa=()=>{const t=j(),e=P(l=>l.crmCategory.data.isDialogOpen),a=P(l=>l.crmCategory.data.dialogMode),s=()=>{t(B(!1))};return f.useEffect(()=>{t(z())},[]),o.jsxs(o.Fragment,{children:[o.jsx(ya,{}),o.jsx(Ca,{}),o.jsxs(he,{isOpen:e,onClose:s,children:[o.jsxs("h5",{className:"mb-4",children:[a==="Edit"?"Edit":"Add New"," Category"]}),o.jsx(ze,{})]}),o.jsx(fa,{})]})},ba="crmSubCategory",ja={total:0,pageIndex:1,pageSize:10,query:"",sort:{order:"",key:""}},Sa={loading:!1,tableData:ja,displayedSubCategoryList:[],subCategoryList:[],categoryList:[],isDialogOpen:!1,dialogMode:"Add",selectedSubCategory:null,deleteConfirmation:!1},Y=S("crmSubCategory/data/createSubCategory",async t=>{var e,a;try{return(await Ue(t)).data}catch(s){throw new Error((a=(e=s==null?void 0:s.response)==null?void 0:e.data)==null?void 0:a.message)}}),R=S("crmSubCategory/data/getSubCategory",async()=>{var t,e;try{return(await Ee()).data}catch(a){throw new Error((e=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:e.message)}}),Re=S("crmSubCategory/data/getCategory",async()=>{var t,e;try{return(await ce()).data}catch(a){throw new Error((e=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:e.message)}}),wa=S("crmSubCategory/data/editSubCategory",async({id:t,updatedData:e})=>{var a,s;try{return(await Je(t,e)).data}catch(l){throw new Error((s=(a=l==null?void 0:l.response)==null?void 0:a.data)==null?void 0:s.message)}}),Da=S("crmSubCategory/data/deleteSubCategory",async t=>{var e,a;try{return await Xe(t)}catch(s){throw new Error((a=(e=s==null?void 0:s.response)==null?void 0:e.data)==null?void 0:a.message)}}),qe=ne({name:`${ba}/state`,initialState:Sa,reducers:{setTableData:(t,e)=>{t.tableData=e.payload;const a=t.subCategoryList.filter(s=>s.name.toLowerCase().includes(e.payload.query.toLowerCase()));t.displayedSubCategoryList=a.slice(e.payload.pageSize*(e.payload.pageIndex-1),e.payload.pageSize*e.payload.pageIndex)},setSelectedSubCategory:(t,e)=>{t.selectedSubCategory=e.payload},setDialogToggle:(t,e)=>{t.isDialogOpen=e.payload},setDialogMode:(t,e)=>{t.dialogMode=e.payload},toggleDeleteConfirmation:(t,e)=>{t.deleteConfirmation=e.payload}},extraReducers:t=>{t.addCase(Y.fulfilled,(e,a)=>{e.loading=!1}).addCase(Y.pending,e=>{e.loading=!0}).addCase(R.fulfilled,(e,a)=>{var s;e.loading=!1,e.subCategoryList=a==null?void 0:a.payload.data,e.tableData.total=(s=a.payload.data)==null?void 0:s.length,e.displayedSubCategoryList=a==null?void 0:a.payload.data.slice(0,10)}).addCase(Re.fulfilled,(e,a)=>{e.categoryList=a==null?void 0:a.payload.data}).addCase(R.pending,e=>{e.loading=!0})}}),{setTableData:H,setSelectedSubCategory:Te,setDialogToggle:K,setDialogMode:Oe,toggleDeleteConfirmation:Z}=qe.actions,Na=qe.reducer,Ia=le({data:Na}),T=de,Ta=()=>{const t=j(),e=T(r=>r.crmSubCategory.data.deleteConfirmation),a=T(r=>r.crmSubCategory.data.selectedSubCategory),s=()=>{t(Z(!1))},l=(r,p,y,u)=>{var g,c,C;const m=(g=r==null?void 0:r.payload)==null?void 0:g.success;p.push(o.jsx(q,{title:m?y:u,type:m?"success":"danger",duration:2500,children:m?(c=r==null?void 0:r.payload)==null?void 0:c.message:(C=r==null?void 0:r.error)==null?void 0:C.message}),{placement:"top-end"})},d=async()=>{t(Z(!1));const r=await t(Da(a==null?void 0:a.id));l(r,v,"Successfully Deleted","Something Went Wrong !!!"),await t(R())};return o.jsx(we,{isOpen:e,type:"danger",title:"Delete Sub Category",confirmButtonColor:"red-600",onClose:s,onRequestClose:s,onCancel:s,onConfirm:d,children:o.jsx("p",{children:"Are you sure you want to delete this Sub Category? All record related to this Sub Category will be deleted as well. This action cannot be undone."})})},Pa=k().shape({categoryId:k().required("Category is required"),name:Q().required("Sub Category name is required")}),Fe=f.forwardRef((t,e)=>{const a=j(),s=T(u=>u.crmSubCategory.data.dialogMode),l=T(u=>u.crmSubCategory.data.selectedSubCategory),d=T(u=>u.crmSubCategory.data.categoryList),r=f.useMemo(()=>d.map(m=>({label:m.name,value:m.id})),[d]),p=()=>{a(K(!1))},y=async(u,m,g,c,C)=>{var w,I,O;const x={name:m.name,categoryId:m.categoryId.value},h=await c(u==="Add"?Y(x):wa({id:g==null?void 0:g.id,updatedData:x}));let i="",n="",b="danger";(w=h==null?void 0:h.payload)!=null&&w.success?(i="Successfully Added",n=(I=h==null?void 0:h.payload)==null?void 0:I.message,b="success"):(i="Something went wrong !!!",n=(O=h==null?void 0:h.error)==null?void 0:O.message),C.push(o.jsx(q,{title:i,type:b,duration:2500,children:n}),{placement:"top-end"}),c(K(!1)),await c(R())};return o.jsx(be,{innerRef:e,initialValues:{name:s==="Edit"?l==null?void 0:l.name:"",categoryId:s==="Edit"?r.find(u=>u.value===(l==null?void 0:l.category.id)):""},validationSchema:Pa,onSubmit:async(u,{setSubmitting:m})=>{s==="Add"?await y("Add",u,null,a,v):await y("Edit",u,l,a,v),m(!1)},children:({touched:u,errors:m,values:g,setFieldValue:c})=>o.jsxs(je,{children:[o.jsxs(fe,{children:[o.jsx(M,{label:"Category Name",invalid:m.categoryId&&u.categoryId,errorMessage:m.categoryId,children:o.jsx(E,{isClearable:!0,type:"text",autoComplete:"off",name:"categoryId",placeholder:"Category",options:r,component:U,prefix:o.jsx(F,{className:"text-xl"}),onChange:C=>{c("categoryId",C)}})}),o.jsx(M,{label:"Sub Category Name",invalid:m.name&&u.name,errorMessage:m.name,children:o.jsx(E,{type:"text",autoComplete:"off",name:"name",placeholder:"Sub Category Name",component:L,prefix:o.jsx(F,{className:"text-xl"})})})]}),o.jsx(xe,{className:"flex items-center justify-end py-2",stickyClass:"border-t bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700",children:o.jsxs("div",{className:"md:flex items-center",children:[o.jsx(A,{size:"sm",className:"ltr:mr-3 rtl:ml-3",type:"button",onClick:p,children:"Cancel"}),o.jsx(A,{size:"sm",type:"submit",variant:"solid",icon:o.jsx(Se,{}),children:"Save"})]})})]})})});Fe.displayName="SubCategoryForm";const Aa=()=>{const t=j(),e=T(i=>i.crmSubCategory.data.loading),a=T(i=>i.crmSubCategory.data.displayedSubCategoryList),s=$("roles","canModify"),l=$("roles","canDelete"),{pageIndex:d,pageSize:r,sort:p,query:y,total:u}=T(i=>i.crmSubCategory.data.tableData),m=f.useMemo(()=>({pageIndex:d,pageSize:r,sort:p,query:y,total:u}),[d,r,p,y,u]),g=({row:i})=>{const n=j(),{textTheme:b}=Ce(),w=()=>{n(Te(i)),n(K(!0)),n(Oe("Edit"))},I=async()=>{await n(Te(i)),n(Z(!0))};return o.jsxs("div",{className:"flex justify-start text-lg",children:[o.jsx("span",{className:`cursor-pointer p-2 hover:${b}`,onClick:w,children:o.jsx(me,{})}),o.jsx("span",{className:"cursor-pointer p-2 hover:text-red-500",onClick:I,children:o.jsx(ue,{})})]})},c=f.useMemo(()=>[{header:"Action",id:"action",cell:n=>o.jsx(g,{row:n.row.original})},{header:"Sub Category",accessorKey:"name",cell:n=>n.row.original.name},{header:"Category",accessorKey:"name",cell:n=>n.row.original.category.name}],[s,l]),C=i=>{const n=N(m);n.pageIndex=i,t(H(n))},x=i=>{const n=N(m);n.pageSize=Number(i),n.pageIndex=1,t(H(n))},h=i=>{const n=N(m);n.sort=i,t(H(n))};return o.jsx("div",{children:o.jsx(ye,{columns:c,data:a,skeletonAvatarColumns:[0],skeletonAvatarProps:{width:28,height:28},loading:e,pagingData:{total:m.total,pageIndex:m.pageIndex,pageSize:m.pageSize},onPaginationChange:C,onSelectChange:x,onSort:h})})},Be=f.forwardRef((t,e)=>{const{onInputChange:a}=t,s=pe(l,500);function l(r){a==null||a(r)}const d=r=>{s(r.target.value)};return o.jsx(L,{ref:e,className:"max-w-md md:w-52 mb-4",size:"sm",placeholder:"Search",prefix:o.jsx(ge,{className:"text-lg"}),onChange:d})});Be.displayName="SubCategoryTableSearch";const va=()=>{const t=j(),e=f.useRef(null),a=T(d=>d.crmSubCategory.data.tableData),s=d=>{const r=N(a);r.query=d,r.pageIndex=1,typeof d=="string"&&d.length>1&&l(r),typeof d=="string"&&d.length===0&&l(r)},l=d=>{t(d?H(d):R())};return o.jsxs("div",{className:"md:flex items-center justify-between",children:[o.jsx("div",{className:"md:flex items-center gap-4",children:o.jsx(Be,{ref:e,onInputChange:s})}),o.jsx("div",{className:"mb-4",children:o.jsx(A,{size:"sm",onClick:()=>{t(K(!0)),t(Oe("Add"))},children:"Add New"})})]})};ie("crmSubCategory",Ia);const Ma=()=>{const t=j(),e=T(l=>l.crmSubCategory.data.isDialogOpen),a=T(l=>l.crmSubCategory.data.dialogMode),s=()=>{t(K(!1))};return f.useEffect(()=>{t(R()),t(Re())},[]),o.jsxs(o.Fragment,{children:[o.jsx(va,{}),o.jsx(Aa,{}),o.jsxs(he,{isOpen:e,onClose:s,children:[o.jsxs("h5",{className:"mb-4",children:[a==="Edit"?"Edit":"Add New"," Sub Category"]}),o.jsx(Fe,{})]}),o.jsx(Ta,{})]})},Ea="crmProduct",La={total:0,pageIndex:1,pageSize:10,query:"",sort:{order:"",key:""}},ka={loading:!1,tableData:La,displayedProductList:[],productList:[],categoryList:[],subCategoryList:[],selectedProduct:null,isDialogOpen:!1,dialogMode:"Add",deleteConfirmation:!1},ee=S("crmProduct/data/createProduct",async t=>{var e,a;try{return(await Ye(t)).data}catch(s){throw new Error((a=(e=s==null?void 0:s.response)==null?void 0:e.data)==null?void 0:a.message)}}),_=S("crmProduct/data/getProduct",async()=>{var t,e;try{return(await Ze()).data}catch(a){throw new Error((e=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:e.message)}}),ae=S("crmProduct/data/editProduct",async({id:t,updatedData:e})=>{var a,s;try{return(await ea(t,e)).data}catch(l){throw new Error((s=(a=l==null?void 0:l.response)==null?void 0:a.data)==null?void 0:s.message)}}),te=S("crmProduct/data/deleteProduct",async t=>{var e,a;try{return await aa(t)}catch(s){throw new Error((a=(e=s==null?void 0:s.response)==null?void 0:e.data)==null?void 0:a.message)}}),oe=S("crmProduct/data/getSubByIdCategory",async t=>{var e,a;try{return(await ta(t)).data}catch(s){throw new Error((a=(e=s==null?void 0:s.response)==null?void 0:e.data)==null?void 0:a.message)}}),Pe=S("crmProduct/data/getSubCategory",async()=>{var t,e;try{return(await Ee()).data}catch(a){throw new Error((e=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:e.message)}}),se=S("crmProduct/data/getCategory",async()=>{var t,e;try{return(await ce()).data}catch(a){throw new Error((e=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:e.message)}}),Ke=ne({name:`${Ea}/state`,initialState:ka,reducers:{setTableData:(t,e)=>{t.tableData=e.payload;const a=t.productList.filter(s=>s.name.toLowerCase().includes(e.payload.query.toLowerCase()));t.displayedProductList=a.slice(e.payload.pageSize*(e.payload.pageIndex-1),e.payload.pageSize*e.payload.pageIndex)},setSelectedProduct:(t,e)=>{t.selectedProduct=e.payload},setDialogToggle:(t,e)=>{t.isDialogOpen=e.payload},setDialogMode:(t,e)=>{t.dialogMode=e.payload},toggleDeleteConfirmation:(t,e)=>{t.deleteConfirmation=e.payload}},extraReducers:t=>{t.addCase(ee.fulfilled,(e,a)=>{e.loading=!1}).addCase(ee.pending,e=>{e.loading=!0}).addCase(_.fulfilled,(e,a)=>{var s;e.loading=!1,e.productList=a==null?void 0:a.payload.data,e.tableData.total=(s=a.payload.data)==null?void 0:s.length,e.displayedProductList=a==null?void 0:a.payload.data.slice(0,10)}).addCase(oe.fulfilled,(e,a)=>{e.loading=!1,e.subCategoryList=a==null?void 0:a.payload.data}).addCase(Pe.fulfilled,(e,a)=>{e.loading=!1,e.subCategoryList=a==null?void 0:a.payload.data}).addCase(se.fulfilled,(e,a)=>{e.categoryList=a==null?void 0:a.payload.data}).addCase(se.pending,e=>{e.loading=!0}).addCase(oe.pending,e=>{e.loading=!0}).addCase(Pe.pending,e=>{e.loading=!0}).addCase(te.pending,e=>{e.loading=!0}).addCase(te.fulfilled,e=>{e.loading=!1}).addCase(ae.pending,e=>{e.loading=!0}).addCase(ae.fulfilled,e=>{e.loading=!1})}}),{setTableData:V,setSelectedProduct:Ae,setDialogToggle:W,setDialogMode:We,toggleDeleteConfirmation:re}=Ke.actions,$a=Ke.reducer,za=le({data:$a}),D=de,Ra=()=>{const t=j(),e=D(r=>r.crmProduct.data.deleteConfirmation),a=D(r=>r.crmProduct.data.selectedProduct),s=()=>{t(re(!1))},l=(r,p,y,u)=>{var g,c,C;const m=(g=r==null?void 0:r.payload)==null?void 0:g.success;p.push(o.jsx(q,{title:m?y:u,type:m?"success":"danger",duration:2500,children:m?(c=r==null?void 0:r.payload)==null?void 0:c.message:(C=r==null?void 0:r.error)==null?void 0:C.message}),{placement:"top-end"})},d=async()=>{t(re(!1));const r=await t(te(a==null?void 0:a.id));l(r,v,"Successfully Deleted","Something Went Wrong !!!"),await t(_())};return o.jsx(we,{isOpen:e,type:"danger",title:"Delete Product",confirmButtonColor:"red-600",onClose:s,onRequestClose:s,onCancel:s,onConfirm:d,children:o.jsx("p",{children:"Are you sure you want to delete this Product? All record related to this Product will be deleted as well. This action cannot be undone."})})},qa=k().shape({categoryId:k().required("Category is required"),subCategoryId:k().notRequired(),name:Q().required("Product name is required"),price:sa().test("greaterThanOne","Price must be greater than 1",t=>t>1).required("Price is required"),description:Q().notRequired()}),_e=f.forwardRef((t,e)=>{const a=j(),s=D(g=>g.crmProduct.data.dialogMode),l=D(g=>g.crmProduct.data.selectedProduct),d=D(g=>g.crmProduct.data.categoryList),r=D(g=>g.crmProduct.data.subCategoryList),p=f.useMemo(()=>d.map(c=>({label:c.name,value:c.id})),[d]),y=f.useMemo(()=>r.map(c=>({label:c.name,value:c.id})),[r]),u=()=>{a(W(!1))},m=async(g,c,C,x,h)=>{var O,De,Ne;const i={name:c.name,categoryId:c.categoryId.value,subCategoryId:c.subCategoryId.value,price:c.price,description:c.description},n=await x(g==="Add"?ee(i):ae({id:C==null?void 0:C.id,updatedData:i}));let b="",w="",I="danger";(O=n==null?void 0:n.payload)!=null&&O.success?(b="Successfully Added",w=(De=n==null?void 0:n.payload)==null?void 0:De.message,I="success"):(b="Something went wrong !!!",w=(Ne=n==null?void 0:n.error)==null?void 0:Ne.message),h.push(o.jsx(q,{title:b,type:I,duration:2500,children:w}),{placement:"top-end"}),x(W(!1)),await x(_())};return o.jsx(be,{innerRef:e,initialValues:{name:s==="Edit"?l==null?void 0:l.name:"",categoryId:s==="Edit"?p.find(g=>g.value===(l==null?void 0:l.categoryId)):"",subCategoryId:s==="Edit"?y.find(g=>g.value===(l==null?void 0:l.subCategoryId)):"",price:s==="Edit"?l==null?void 0:l.price:0,description:s==="Edit"?l==null?void 0:l.description:""},validationSchema:qa,onSubmit:async(g,{setSubmitting:c})=>{s==="Add"?await m("Add",g,null,a,v):await m("Edit",g,l,a,v),c(!1)},children:({touched:g,errors:c,values:C,setFieldValue:x})=>o.jsxs(je,{children:[o.jsxs(fe,{children:[o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsx("div",{className:"col-span-1",children:o.jsx(M,{label:"Category",invalid:c.categoryId&&g.categoryId,errorMessage:c.categoryId,children:o.jsx(E,{type:"text",autoComplete:"off",name:"categoryId",placeholder:"Category",options:p,component:U,prefix:o.jsx(F,{className:"text-xl"}),onChange:async h=>{await a(oe(h.value)),x("categoryId",h)}})})}),o.jsx("div",{className:"col-span-1",children:o.jsx(M,{label:"Sub Category",invalid:c.subCategoryId&&g.subCategoryId,errorMessage:c.subCategoryId,children:o.jsx(E,{type:"text",autoComplete:"off",name:"subCategoryId",placeholder:"Sub Category",options:y,component:U,prefix:o.jsx(F,{className:"text-xl"}),onChange:h=>{x("subCategoryId",h)}})})})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsx("div",{className:"col-span-1",children:o.jsx(M,{label:"Product Name",invalid:c.name&&g.name,errorMessage:c.name,children:o.jsx(E,{type:"text",autoComplete:"off",name:"name",placeholder:"Product Name",component:L,prefix:o.jsx(na,{className:"text-xl"})})})}),o.jsx("div",{className:"col-span-1",children:o.jsx(M,{label:"Price",invalid:c.price&&g.price,errorMessage:c.price,children:o.jsx(E,{type:"number",autoComplete:"off",name:"price",placeholder:"Price",component:L,prefix:o.jsx(ra,{className:"text-xl"})})})})]}),o.jsx(M,{label:"Description",invalid:c.description&&g.description,errorMessage:c.description,children:o.jsx(E,{type:"text",autoComplete:"off",name:"description",placeholder:"Description",component:L,prefix:o.jsx(oa,{className:"text-xl"})})})]}),o.jsx(xe,{className:"flex items-center justify-end py-2",stickyClass:"border-t bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700",children:o.jsxs("div",{className:"md:flex items-center",children:[o.jsx(A,{size:"sm",className:"ltr:mr-3 rtl:ml-3",type:"button",onClick:u,children:"Cancel"}),o.jsx(A,{size:"sm",type:"submit",variant:"solid",icon:o.jsx(Se,{}),children:"Save"})]})})]})})});_e.displayName="ProductForm";const Oa=()=>{const t=j(),e=D(i=>i.crmProduct.data.loading),a=$("roles","canModify"),s=$("roles","canDelete"),{pageIndex:l,pageSize:d,sort:r,query:p,total:y}=D(i=>i.crmProduct.data.tableData),u=f.useMemo(()=>({pageIndex:l,pageSize:d,sort:r,query:p,total:y}),[l,d,r,p,y]),m=D(i=>i.crmProduct.data.displayedProductList),g=({row:i})=>{const n=j(),{textTheme:b}=Ce(),w=()=>{n(Ae(i)),n(W(!0)),n(We("Edit"))},I=async()=>{await n(Ae(i)),n(re(!0))};return o.jsxs("div",{className:"flex justify-start text-lg",children:[o.jsx("span",{className:`cursor-pointer p-2 hover:${b}`,onClick:w,children:o.jsx(me,{})}),o.jsx("span",{className:"cursor-pointer p-2 hover:text-red-500",onClick:I,children:o.jsx(ue,{})})]})},c=f.useMemo(()=>[{header:"Action",id:"action",cell:n=>o.jsx(g,{row:n.row.original})},{header:"Product",accessorKey:"name",cell:n=>n.row.original.name},{header:"Category",accessorKey:"category.name",cell:n=>n.row.original.category.name},{header:"Sub Category",accessorKey:"subCategory.name",cell:n=>{var b;return((b=n.row.original.subCategory)==null?void 0:b.name)||"-"}},{header:"Price",accessorKey:"price",cell:n=>n.row.original.price},{header:"Description",accessorKey:"description",cell:n=>{const b=n.row.original.description;return o.jsx(la,{text:b,maxLength:20})}}],[a,s]),C=i=>{const n=N(u);n.pageIndex=i,t(V(n))},x=i=>{const n=N(u);n.pageSize=Number(i),n.pageIndex=1,t(V(n))},h=i=>{const n=N(u);n.sort=i,t(V(n))};return o.jsx("div",{children:o.jsx(ye,{columns:c,data:m,skeletonAvatarColumns:[0],skeletonAvatarProps:{width:28,height:28},loading:e,pagingData:{total:u.total,pageIndex:u.pageIndex,pageSize:u.pageSize},onPaginationChange:C,onSelectChange:x,onSort:h})})},Ge=f.forwardRef((t,e)=>{const{onInputChange:a}=t,s=pe(l,500);function l(r){a==null||a(r)}const d=r=>{s(r.target.value)};return o.jsx(L,{ref:e,className:"max-w-md md:w-52 mb-4",size:"sm",placeholder:"Search",prefix:o.jsx(ge,{className:"text-lg"}),onChange:d})});Ge.displayName="ProductTableSearch";const Fa=()=>{const t=j(),e=f.useRef(null),a=D(d=>d.crmProduct.data.tableData),s=d=>{const r=N(a);r.query=d,r.pageIndex=1,typeof d=="string"&&d.length>1&&l(r),typeof d=="string"&&d.length===0&&l(r)},l=d=>{t(d?V(d):_())};return o.jsxs("div",{className:"md:flex items-center justify-between",children:[o.jsx("div",{className:"md:flex items-center gap-4",children:o.jsx(Ge,{ref:e,onInputChange:s})}),o.jsx("div",{className:"mb-4",children:o.jsx(A,{size:"sm",onClick:()=>{t(W(!0)),t(We("Add"))},children:"Add New"})})]})};ie("crmProduct",za);const Ba=()=>{const t=j(),e=D(l=>l.crmProduct.data.isDialogOpen),a=D(l=>l.crmProduct.data.dialogMode),s=()=>{t(W(!1))};return f.useEffect(()=>{t(_()),t(se())},[]),o.jsxs(o.Fragment,{children:[o.jsx(Fa,{}),o.jsx(Oa,{}),o.jsxs(he,{isOpen:e,onClose:s,children:[o.jsxs("h5",{className:"mb-4",children:[a==="Edit"?"Edit":"Add New"," Product"]}),o.jsx(_e,{})]}),o.jsx(Ra,{})]})},{TabNav:Ka,TabList:Wa}=Me,ve={category:{label:"Category",path:"category"},subCategory:{label:"SubCategory",path:"subCategory"},product:{label:"Product",path:"product"}},_a=()=>{const[t,e]=f.useState("category"),a=s=>{e(s)};return o.jsxs(o.Fragment,{children:[o.jsx(Me,{value:t,variant:"pill",onChange:s=>a(s),children:o.jsx(Wa,{children:Object.keys(ve).map(s=>o.jsx(Ka,{value:s,children:ve[s].label},s))})}),o.jsx("div",{className:"py-4",children:o.jsxs(f.Suspense,{fallback:o.jsx(o.Fragment,{children:"loading..."}),children:[t==="category"&&o.jsx(xa,{}),t==="subCategory"&&o.jsx(Ma,{}),t==="product"&&o.jsx(Ba,{})]})})]})},Ut=_a;export{Ut as I};
