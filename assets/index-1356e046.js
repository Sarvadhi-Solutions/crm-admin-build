import{a as A,j as e,r as g,ap as oe,aq as re}from"./index-9bc8ff5f.js";import{A as ie}from"./AdaptableCard-b7f5cc28.js";import{F as z}from"./FormDesription-0eeb24da.js";import{D as ne}from"./DataTable-59b3bbba.js";import{T as ce}from"./TagsList-b7e10323.js";import{T as L}from"./TextTruncate-cfc7e88e.js";import{u as E}from"./checkEditUpdate-b9057d3b.js";import{u as le}from"./useThemeClass-ff7aa3c0.js";import{c as O}from"./cloneDeep-2bc60bb0.js";import{U as me,N as de,O as pe,b as ue}from"./index.esm-022f21f4.js";import{u as C,t as W,d as xe,g as R,a as _,b as he,f as ge,c as fe,e as Ce,h as J,i as je,j as Ne,s as Q,k as B,l as k,m as V,r as be}from"./index-d2a383b3.js";import{t as Z,N as H}from"./toast-fc8f3d37.js";import{C as ye}from"./ConfirmDialog-9b886e68.js";import{B as P}from"./Button-0656771e.js";import{D as we}from"./Drawer-34c712fe.js";import{a as N,F as ve}from"./FormItem-cb878918.js";import{T as X}from"./index-c58200b2.js";import{u as De,b as y,F as Ie,a as Se}from"./formik.esm-ef991825.js";import{c as Te,a as b,e as Fe}from"./index.esm-754aeb65.js";import{I as D}from"./Input-87dd5f52.js";/* empty css              */import{T as Me,d as Ae}from"./index.esm-ca23c10c.js";import"./Alert-7014a5a7.js";import"./index-2949a7c8.js";import"./Badge-f912401f.js";import"./RangeCalendar-b0660c39.js";import"./Card-d62a742e.js";import"./index-913ac9eb.js";import"./index-bb1899de.js";import"./Dialog-9c0a8ca3.js";import"./index-747645f6.js";import"./toString-0fe6d881.js";import"./index-7b2faf23.js";import"./index-6657ac06.js";import"./index-a514ef4b.js";import"./Pagination-c79970da.js";import"./Progress-d84af474.js";import"./index-4b3ecacd.js";import"./ScrollBar-c454ac27.js";import"./index-14854959.js";import{S as $}from"./Select-7a37953f.js";import"./Skeleton-dae4b943.js";import"./index-c8e1d4bf.js";import"./Switcher-69418dd6.js";import"./index-fe4d885a.js";import"./Tag-8c20b4ad.js";import"./index-cee5027b.js";import"./index-6d3b4cc2.js";import{T as K}from"./Tooltip-c62f62f0.js";import"./Upload-77748ca9.js";import{t as Le}from"./tagAndCategory-0975d9d9.js";import{a as ze}from"./index.esm-6f9dbd5a.js";import{F as Ee}from"./index.esm-4632f909.js";import{a as G}from"./index.esm-2b8422f6.js";import{b as Oe,G as U}from"./index.esm-ab8fbfd7.js";import{I as ke}from"./index.esm-00a67982.js";import{M as Re}from"./index.esm-3a6c327a.js";import{C as qe}from"./react-select-creatable.esm-0f5e3343.js";import{a as $e}from"./index.esm-33724eb7.js";import{d as Ke}from"./debounce-5190714d.js";import"./index-6eee240b.js";import"./_MapCache-011fd77e.js";import"./Views-f23c0524.js";import"./_getPrototype-400d6e78.js";import"./CrmService-9a7ea8f7.js";import"./useTimeout-1f69dd99.js";import"./CloseButton-8f91face.js";import"./StatusIcon-d84be5ba.js";import"./chainedFunction-070f832c.js";import"./index-297486ca.js";import"./index-c69bc431.js";import"./useControllableState-0698e55e.js";import"./isNil-f55a9f9f.js";import"./get-4c9a6acd.js";import"./useMergeRef-788c4cb0.js";import"./_baseIsEqual-75947cbf.js";import"./useRootClose-378cbccb.js";import"./usePopper-e8c1fe06.js";import"./TimeInput-fc9aceed.js";import"./useUniqueId-64d4794a.js";import"./useDidUpdate-79b4d052.js";import"./useUncertainRef-869801ae.js";import"./slicedToArray-e7cae6dc.js";import"./objectWithoutProperties-8809bfcf.js";import"./toConsumableArray-2e5ad46e.js";import"./floating-ui.dom-bef9cea3.js";import"./mapCloneElement-ff8297c4.js";import"./index.esm-995fda35.js";const We=()=>{const s=A(),r=C(o=>o.crmContact.data.deleteConfirmation),t=C(o=>o.crmContact.data.selectedContact),p=()=>{s(W(!1))},d=async()=>{var x,l,u;s(W(!1));const o=await s(xe(t==null?void 0:t.id));(x=o==null?void 0:o.payload)!=null&&x.success?Z.push(e.jsx(H,{title:"Successfuly Deleted",type:"success",duration:2500,children:(l=o==null?void 0:o.payload)==null?void 0:l.message}),{placement:"top-end"}):Z.push(e.jsx(H,{title:"Something Went Wrong !!!",type:"danger",duration:2500,children:(u=o==null?void 0:o.error)==null?void 0:u.message}),{placement:"top-end"}),await s(R()),await s(_())};return e.jsx(ye,{isOpen:r,type:"danger",title:"Delete Contact",confirmButtonColor:"red-600",onClose:p,onRequestClose:p,onCancel:p,onConfirm:d,children:e.jsx("p",{children:"Are you sure you want to delete this Contact? All record related to this contact will be deleted as well. This action cannot be undone."})})},Be=s=>{const{touched:r,errors:t,values:p,setFieldValue:d}=s,o=A(),[x,l]=g.useState([]),u=C(i=>i.crmContact.data.companyList),w=C(i=>i.crmContact.data.sources),T=g.useMemo(()=>u.map(i=>({value:i.id,label:i.companyName})),[u]),h=g.useMemo(()=>w.map(f=>({label:f.sources,value:f.id})),[w]);g.useEffect(()=>{(async()=>{var f,S;try{const{payload:I}=await o(ge()),m=(f=I==null?void 0:I.data)==null?void 0:f.find(a=>(a==null?void 0:a.moduleName)==="contacts");if(m){const{payload:a}=await o(fe({id:(S=m==null?void 0:m.id)==null?void 0:S.toString()})),n=Le(a.data);l(n)}}catch(I){console.error("Error fetching module data:",I)}})(),o(he())},[o]);const v=De(),j=i=>{v.setFieldValue("tagId",i)},F=async(i,f)=>{const S={sources:i==null?void 0:i.label};switch(f.action){case"create-option":await o(Ce(S)),await o(J());break;case"select-option":d("sourceId",i);break;case"clear":d("sourceId",null);break}};return e.jsxs(e.Fragment,{children:[e.jsx(z,{title:"Contact Basic Information",desc:"",className:"mb-2"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"col-span-1",children:e.jsx(N,{label:"First Name *",invalid:t.firstName&&r.firstName,errorMessage:t.firstName,children:e.jsx(y,{type:"text",autoComplete:"off",name:"firstName",placeholder:"First Name",component:D,prefix:e.jsx(G,{className:"text-xl"})})})}),e.jsx("div",{className:"col-span-1",children:e.jsx(N,{label:"Last Name *",invalid:t.lastName&&r.lastName,errorMessage:t.lastName,children:e.jsx(y,{type:"text",autoComplete:"off",name:"lastName",placeholder:"Last Name",component:D,prefix:e.jsx(G,{className:"text-xl"})})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"col-span-1",children:e.jsx(N,{label:"Email *",invalid:t.email&&r.email,errorMessage:t.email,children:e.jsx(y,{type:"text",autoComplete:"off",name:"email",placeholder:"Email",component:D,prefix:e.jsx(me,{className:"text-xl"})})})}),e.jsx("div",{className:"col-span-1",children:e.jsx(N,{label:"Contact Number *",invalid:t.contactNumber&&r.contactNumber,errorMessage:t.contactNumber,children:e.jsx(y,{type:"tel",autoComplete:"off",name:"contactNumber",placeholder:"Contact Number",component:D,prefix:e.jsx(ze,{className:"text-xl"})})})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsx("div",{className:"col-span-1",children:e.jsx(N,{label:"Title",invalid:t.title&&r.title,errorMessage:t.title,children:e.jsx(y,{type:"text",autoComplete:"off",name:"title",placeholder:"Title",component:D,prefix:e.jsx(Re,{className:"text-xl"})})})})}),e.jsx(N,{label:"Notes",invalid:t.description&&r.description,errorMessage:t.description,children:e.jsx(y,{textArea:!0,type:"text",autoComplete:"off",name:"description",placeholder:"Notes",component:D,prefix:e.jsx(Me,{className:"text-xl"})})}),e.jsx(z,{title:"Address",desc:"",className:"mb-2"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"col-span-1",children:e.jsx(N,{label:"Address",invalid:t.address&&r.address,errorMessage:t.address,children:e.jsx(y,{type:"text",autoComplete:"off",name:"address",placeholder:"Address",component:D,prefix:e.jsx(Ee,{className:"text-xl"})})})}),e.jsx("div",{className:"col-span-1",children:e.jsx("div",{className:"col-span-1",children:e.jsx(N,{label:"State",invalid:t.state&&r.state,errorMessage:t.state,children:e.jsx(y,{type:"text",autoComplete:"off",name:"state",placeholder:"State",component:D,prefix:e.jsx(ke,{className:"text-xl"})})})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"col-span-1",children:e.jsx("div",{className:"col-span-1",children:e.jsx(N,{label:"City",invalid:t.city&&r.city,errorMessage:t.city,children:e.jsx(y,{type:"text",autoComplete:"off",name:"city",placeholder:"City",component:D,prefix:e.jsx(Oe,{className:"text-xl"})})})})}),e.jsx("div",{className:"col-span-1",children:e.jsx("div",{style:{position:"relative"},children:e.jsx("div",{className:"col-span-1",children:e.jsx(N,{label:"ZipCode",invalid:t.zipcode&&r.zipcode,errorMessage:t.zipcode,children:e.jsx(y,{type:"text",autoComplete:"off",name:"zipcode",placeholder:"ZipCode",component:D,prefix:e.jsx(Ae,{className:"text-xl"})})})})})})]}),e.jsx(z,{title:"Contact Others Details",desc:"",className:"mb-2"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"col-span-1",children:e.jsx(N,{label:"Company Name",invalid:t.companiesId&&r.companiesId,errorMessage:t.companiesId,children:e.jsx($,{name:"companiesId",placeholder:"Company Name",options:T,id:"companiesId",value:T.find(i=>(i==null?void 0:i.value)==(p==null?void 0:p.companiesId)),onChange:i=>{const f=i.value;d("companiesId",f||"")}})})}),e.jsx("div",{className:"col-span-1",children:e.jsx(N,{label:"Source",invalid:t.source&&r.source,errorMessage:t.source,children:e.jsx(y,{isClearable:!0,type:"text",autoComplete:"off",name:"sourceId",placeholder:"Source",component:$,componentAs:qe,options:h,prefix:e.jsx(U,{className:"text-xl"}),onChange:F})})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsx("div",{className:"col-span-1",children:e.jsx(N,{label:"Tag",children:e.jsx(y,{isClearable:!0,isMulti:!0,type:"text",autoComplete:"off",name:"tagId",placeholder:"Select tags",component:$,options:x,prefix:e.jsx(U,{className:"text-xl"}),closeMenuOnSelect:!1,onChange:j})})})})]})},Ze=Te().shape({firstName:b().required("First Name is required"),lastName:b().required("Last Name is required"),title:b(),contactNumber:b().typeError("Contact must be a number").required("Contact is required").test("is-number","Contact must be a number",s=>!isNaN(s)).test("is-ten-digits","Contact must be exactly 10 digits",s=>{if(s){const r=Number(s);return/^\d{10}$/.test(r.toString())}return!0}).test("is-ten-digits","Contact number cannot start with 0",s=>s?!s.startsWith("0"):!0),email:b().matches(/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/i,"Invalid email").required("Email is required"),address:b(),state:b(),city:b(),zipcode:b(),companiesId:b().nullable(),companyName:b(),source:b().nullable(),description:b(),tagId:Fe()}),{TabNav:He,TabList:Pe,TabContent:Ge}=X,Y=g.forwardRef((s,r)=>{var l,u,w,T;const t=C(h=>h.crmContact.data.selectedContact),p=C(h=>h.crmContact.data.sources),d=g.useMemo(()=>p.map(v=>({label:v.sources,value:v.id})),[p]),o=!!t.id,x=A();return e.jsx(Ie,{innerRef:r,initialValues:{firstName:(t==null?void 0:t.firstName)||"",lastName:(t==null?void 0:t.lastName)||"",title:(t==null?void 0:t.title)||"",email:(t==null?void 0:t.email)||"",contactNumber:(t==null?void 0:t.contactNumber)||"",description:(t==null?void 0:t.description)||"",companyName:((l=t==null?void 0:t.company)==null?void 0:l.companyName)||"",sourceId:t!=null&&t.sourceId?d.find(h=>h.value===(t==null?void 0:t.sourceId)):null,address:(t==null?void 0:t.address)||"",state:(t==null?void 0:t.state)||"",city:(t==null?void 0:t.city)||"",zipcode:(t==null?void 0:t.zipcode)||"",tagName:((w=(u=t==null?void 0:t.tags)==null?void 0:u[0])==null?void 0:w.tagName)||"",tagId:((T=t==null?void 0:t.tags)==null?void 0:T.map(h=>({label:h.tagName,value:h.id})))||[],companiesId:(t==null?void 0:t.companiesId)||""},validationSchema:Ze,onSubmit:async(h,{setSubmitting:v})=>{var j,F,i,f,S,I;try{const{tagName:m,...a}=h,n={...a,sourceId:(j=a==null?void 0:a.sourceId)==null?void 0:j.value,tagId:a==null?void 0:a.tagId.map(se=>se.value)},c=o?await x(je({contactId:(t==null?void 0:t.id)||"",updatedData:n})):await x(Ne(n)),M=(F=c==null?void 0:c.payload)!=null&&F.success?"Successfully Added":"Something went wrong !!!",q=(i=c==null?void 0:c.payload)!=null&&i.success?"success":"danger",ae=(f=c==null?void 0:c.payload)!=null&&f.success?(S=c==null?void 0:c.payload)==null?void 0:S.message:(I=c==null?void 0:c.error)==null?void 0:I.message;Z.push(e.jsx(H,{title:M,type:q,duration:2500,children:ae}),{placement:"top-end"}),x(Q()),await x(R()),await x(_())}catch(m){console.error(m)}finally{v(!1)}},children:({touched:h,errors:v,values:j,setFieldValue:F})=>e.jsx(Se,{children:e.jsx(ve,{children:e.jsxs(X,{defaultValue:"personalInfo",children:[e.jsx(Pe,{children:e.jsx(He,{value:"personalInfo",children:"Contact Details"})}),e.jsx("div",{className:"p-6",children:e.jsx(Ge,{value:"personalInfo",children:e.jsx(Be,{touched:h,errors:v,values:j,setFieldValue:F})})})]})})})})});Y.displayName="ContactForm";const ee=g.forwardRef((s,r)=>{A();const t=C(d=>d.crmContact.data.selectedContact);C(d=>d.crmContact.data.contactList);const p=async d=>{};return e.jsx(Y,{ref:r,contact:t,onFormSubmit:p})});ee.displayName="ContactEditContent";const Ue=({onSaveClick:s,onCancel:r})=>e.jsxs("div",{className:"text-right w-full",children:[e.jsx(P,{size:"sm",className:"mr-2",onClick:r,children:"Cancel"}),e.jsx(P,{size:"sm",variant:"solid",onClick:s,children:"Save"})]}),_e=()=>{const s=A(),[r,t]=g.useState(window.innerWidth/2),p=C(u=>u.crmContact.data.drawerOpen),d=()=>{s(Q()),s(B({}))},o=g.useRef(null),x=()=>{var u,w;console.log("formSubmit function called",(u=o.current)==null?void 0:u.values),(w=o.current)==null||w.submitForm()},l=()=>{t(window.innerWidth/2)};return g.useEffect(()=>(window.addEventListener("resize",l),()=>{window.removeEventListener("resize",l)}),[]),e.jsx(we,{isOpen:p,closable:!1,bodyClass:"p-0",width:r,footer:e.jsx(Ue,{onCancel:d,onSaveClick:x}),onClose:d,onRequestClose:d,children:e.jsx(ee,{ref:o})})},Je=()=>{const s=A(),r=C(m=>m.crmContact.data.displayedContactList),t=E("contacts","canModify"),p=E("contacts","canDelete"),d=E("contacts","canView"),o=C(m=>m.crmContact.data.loading),x=oe(),{pageIndex:l,pageSize:u,sort:w,query:T,total:h}=C(m=>m.crmContact.data.tableData),v=g.useCallback(()=>{s(R()),s(J())},[s]);g.useEffect(()=>{v()},[v]);const j=g.useMemo(()=>({pageIndex:l,pageSize:u,sort:w,query:T,total:h}),[l,u,w,T,h]),F=({row:m})=>{const a=A();le();const n=()=>{a(V()),a(B(m))},c=async()=>{a(B(m)),a(W(!0))},M=()=>{const q=`/app/crm/contact-details/${m.id}`;x(q)};return e.jsxs("div",{className:"flex text-base items-center",children:[t&&e.jsx("span",{className:"cursor-pointer hover:text-indigo-500 circle items-center",onClick:n,children:e.jsx(de,{})}),p&&e.jsx("span",{className:"cursor-pointer hover:text-red-500 circle mx-1 items-center",onClick:c,children:e.jsx(pe,{})}),d&&e.jsx("span",{className:"cursor-pointer hover:text-green-500 circle items-center text-lg",onClick:M,children:e.jsx($e,{})})]})},i=g.useMemo(()=>[{header:"Action",id:"action",cell:a=>e.jsx(F,{row:a.row.original})},{header:"Name",accessorKey:"firstName",cell:a=>{const{firstName:n,lastName:c}=a.row.original,M=`${n} ${c}`;return e.jsx(L,{text:M,maxLength:20})}},{header:"email",accessorKey:"email",cell:a=>a.row.original.email},{header:"Number",accessorKey:"contactNumber",cell:a=>a.row.original.contactNumber},{header:"source",accessorKey:"sourceId",cell:a=>{var c,M;const n=(M=(c=a.row.original)==null?void 0:c.source)==null?void 0:M.sources;return e.jsx(L,{text:n,maxLength:15})}},{header:"Tags",accessorKey:"tagName",cell:a=>{const n=a.row.original.tags||[];return e.jsx(ce,{tags:n})}},{header:"Title",accessorKey:"title",cell:a=>{const n=a.row.original.title;return e.jsx(K,{title:n,children:e.jsx(L,{text:n,maxLength:15})},n)}},{header:"Company",accessorKey:"companyName",cell:a=>{const n=a.row.original.company?a.row.original.company.companyName:"";return e.jsx(L,{text:n,maxLength:15})}},{header:"address",accessorKey:"address",cell:a=>{const n=[a.row.original.address,a.row.original.city,a.row.original.state,a.row.original.pincode].filter(c=>c!=null).join(" ");return e.jsx(K,{title:n,children:e.jsx(L,{text:n,maxLength:20})},n)}},{header:"Notes",accessorKey:"description",cell:a=>{const n=a.row.original.description;return e.jsx(K,{title:n,children:e.jsx(L,{text:n,maxLength:20})},n)}}],[t,p]),f=m=>{const a=O(j);a.pageIndex=m,s(k(a))},S=m=>{const a=O(j);a.pageSize=Number(m),a.pageIndex=1,s(k(a))},I=m=>{const a=O(j);a.sort=m,s(k(a))};return e.jsxs("div",{children:[e.jsx(ne,{columns:i,data:r,loading:o,pagingData:{total:j.total,pageIndex:j.pageIndex,pageSize:j.pageSize},onPaginationChange:f,onSelectChange:S,onSort:I}),e.jsx(_e,{}),e.jsx(We,{})]})},te=g.forwardRef((s,r)=>{const{onInputChange:t}=s,p=Ke(d,500);function d(x){t==null||t(x)}const o=x=>{p(x.target.value)};return e.jsx(D,{ref:r,className:"max-w-md md:w-52 mb-4",size:"sm",placeholder:"Search",prefix:e.jsx(ue,{className:"text-lg"}),onChange:o})});te.displayName="ContactTableSearch";const Qe=()=>{const s=A(),r=g.useRef(null),t=C(l=>l.crmContact.data.tableData),p=E("contacts","canCreate"),d=l=>{const u=O(t);u.query=l,u.pageIndex=1,typeof l=="string"&&l.length>1&&o(u),typeof l=="string"&&l.length===0&&o(u)},o=l=>{s(l?k(l):R())},x=()=>{s(V())};return e.jsxs("div",{className:"md:flex items-center justify-between",children:[e.jsx("div",{className:"md:flex items-center gap-4",children:e.jsx(te,{ref:r,onInputChange:d})}),e.jsx("div",{className:"mb-4",children:p&&e.jsx(P,{size:"sm",onClick:x,children:"Add New"})})]})};re("crmContact",be);const Ve=()=>{const s=C(r=>r.crmContact.data.tableData);return e.jsx(e.Fragment,{children:e.jsxs(ie,{bodyClass:"h-full",children:[e.jsx(z,{title:`Contacts (${s==null?void 0:s.total})`,desc:"",className:"mb-2"}),e.jsx(Qe,{}),e.jsx(Je,{})]})})},La=Ve;export{La as default};
