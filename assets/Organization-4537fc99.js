import{al as F,am as ra,an as ia,ao as na,a as q,r as R,j as a,c as oa,aq as ca}from"./index-3da8ab78.js";import{S as Y}from"./StickyFooter-2f13b428.js";import"./Alert-ceb6abb1.js";import"./index-74cf1be4.js";import"./Badge-f2e142b8.js";import{B as I}from"./Button-8579f7ca.js";import"./RangeCalendar-ef5337d8.js";import"./Card-7380f9b9.js";import"./index-58062901.js";import"./index-36e58418.js";import{D as da}from"./Dialog-f71c0e0d.js";import"./Drawer-e8e52de5.js";import"./index-2a18aa2a.js";import{a as h,F as J}from"./FormItem-7755f9c3.js";import"./toString-9fd50606.js";import{I as z}from"./Input-50869ece.js";import"./index-a1237748.js";import"./index-2b7cf886.js";import"./index-01299703.js";import{t as $,N as H}from"./toast-3574e37c.js";import"./Pagination-423791d4.js";import"./Progress-547ea6f2.js";import"./index-4de279b6.js";import"./ScrollBar-72517c7e.js";import"./index-7b99a021.js";import{S as la}from"./Select-5300a5e5.js";import"./Skeleton-a9909653.js";import"./index-d17a46fb.js";import{S as ma}from"./Switcher-a110a9cd.js";import"./index-2f843102.js";import"./index-d1a7ee08.js";import{T as pa}from"./Tag-ef060f80.js";import"./index-52e3c01e.js";import"./index-2e6281ce.js";import"./Tooltip-d01527b7.js";import"./Upload-b8cdff70.js";import{F as ga}from"./FormDesription-084527de.js";import{F as ua}from"./FormRow-f42e77a0.js";import{u as ha,b as j,F as K,a as X}from"./formik.esm-534fe9e3.js";import{c as xa}from"./cloneDeep-df62328b.js";import{A as Z,c as fa}from"./index.esm-8ad44035.js";import{S as ba,ad as ya}from"./index.esm-4107b49d.js";import{c as U,a as S,d as ja}from"./index.esm-e5b5f2b0.js";import{a6 as Na,a7 as wa,a8 as Oa,a9 as Ca,aa as za,Q as va}from"./CrmService-0c8f2380.js";/* empty css              */import{B as Ea}from"./index.esm-ddf990fb.js";import{R as aa}from"./index.esm-92a48ceb.js";import"./Views-ac495012.js";import"./chart.constant-8b4828b9.js";import"./chart.config-97bb4020.js";import"./DataTable-9f0fb930.js";import"./GrowShrinkTag-c55d1769.js";import"./react-tooltip.min-bd173d61.js";import{R as Sa}from"./RichTextEditor-2673e8da.js";import"./SegmentItemOption-5098e875.js";import"./SvgIcon-2300e574.js";import{G as Ia}from"./index.esm-a0a87af3.js";import{b as Da}from"./index.esm-7cf09153.js";import{T as ka}from"./index.esm-7cf3c163.js";import{i as Ma}from"./isLastChild-83eb4c23.js";const Fa="crmOrganizations",k=F("crmOrganizations/data/organization",async()=>(await Na()).data),M=F("crmOrganizations/data/organization-branches",async()=>(await wa()).data),Aa=F("crmOrganizations/data/editBranch",async({branchId:s,updatedData:t})=>{var e,r;try{return(await Oa(s,t)).data}catch(i){throw new Error((r=(e=i==null?void 0:i.response)==null?void 0:e.data)==null?void 0:r.message)}}),Ba=F("crmOrganizations/data/createBranch",async s=>{var t,e;try{return(await Ca(s)).data}catch(r){throw new Error((e=(t=r==null?void 0:r.response)==null?void 0:t.data)==null?void 0:e.message)}}),Ra=F("crmOrganizations/data/organization",async s=>{var t,e;try{return(await za(s)).data}catch(r){throw new Error((e=(t=r==null?void 0:r.response)==null?void 0:t.data)==null?void 0:e.message)}}),T=F("crmOrganizations/data/getUsers",async()=>{var s,t;try{return(await va()).data}catch(e){throw new Error((t=(s=e==null?void 0:e.response)==null?void 0:s.data)==null?void 0:t.message)}}),La={organizationData:[],loading:!1,statisticLoading:!1,branchList:[],isDialogOpen:!1,selectedBranch:{},deleteConfirmation:!1,usersList:[],dialogMode:"Add"},ea=ra({name:`${Fa}/state`,initialState:La,reducers:{setBranchList:(s,t)=>{s.branchList=t.payload},setSelectedBranch:(s,t)=>{s.selectedBranch=t.payload},setDialogToggle:(s,t)=>{s.isDialogOpen=t.payload},toggleDeleteConfirmation:(s,t)=>{s.deleteConfirmation=t.payload},setUsersList:(s,t)=>{s.usersList=t.payload},setDialogMode:(s,t)=>{s.dialogMode=t.payload}},extraReducers:s=>{s.addCase(k.fulfilled,(t,e)=>{t.organizationData=e.payload.data,t.loading=!1}).addCase(k.pending,t=>{t.loading=!0}).addCase(T.fulfilled,(t,e)=>{t.usersList=e.payload.data,t.loading=!1}).addCase(M.fulfilled,(t,e)=>{t.branchList=e.payload.data,t.loading=!1}).addCase(M.pending,t=>{t.statisticLoading=!0})}}),{setBranchList:qa,setSelectedBranch:$a,setDialogToggle:D,setUsersList:Ue,setDialogMode:_,toggleDeleteConfirmation:at}=ea.actions,Ha=ea.reducer,Ta=ia({data:Ha}),v=na,w=[],Va=s=>{const{touched:t,errors:e,setFieldValue:r,values:i}=s,l=q();R.useEffect(()=>{(async()=>{await l(T())})()},[l]);const c=v(n=>{var N,E;return(E=(N=n.crmOrganizations)==null?void 0:N.data)==null?void 0:E.usersList});w.length=0,c==null||c.forEach(n=>{w==null||w.push({label:`${n==null?void 0:n.firstName} ${n==null?void 0:n.lastName}`,value:n.id})});const m=()=>{l(D(!1))},O=ha();return a.jsxs(a.Fragment,{children:[a.jsx(h,{label:"Branch Name",invalid:e.branchName&&t.branchName,errorMessage:e.branchName,children:a.jsx(j,{type:"text",autoComplete:"off",name:"branchName",placeholder:"Branch Name",component:z,prefix:a.jsx(aa,{className:"text-xl"})})}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsx("div",{className:"col-span-1",children:a.jsx(h,{label:"Branch Owner",invalid:e.branchOwnerId&&t.branchOwnerId,errorMessage:e.branchOwnerId,children:a.jsx(la,{name:"branchOwnerId",placeholder:"Branch Owner",options:w,id:"branchOwnerId",value:w==null?void 0:w.find(n=>(n==null?void 0:n.value)===(i==null?void 0:i.branchOwnerId)),onChange:n=>{const N=n==null?void 0:n.value;r("branchOwnerId",N)}})})}),a.jsx("div",{className:"col-span-1",children:a.jsx(h,{label:"Contact Number",invalid:e.contact&&t.contact,errorMessage:e.contact,children:a.jsx(j,{type:"text",autoComplete:"off",name:"contact",placeholder:"Contact",component:z,prefix:a.jsx(Ea,{className:"text-xl"})})})})]}),a.jsx(h,{children:a.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[a.jsx("label",{className:"form-label",style:{marginRight:"10px"},children:"Head Quarter"}),a.jsx(j,{autoComplete:"off",name:"isHeadQuarter",component:ma,checked:O.values.isHeadQuarter})]})}),a.jsx(h,{label:"Address",invalid:e.addressInformation&&t.addressInformation,errorMessage:e.addressInformation,children:a.jsx(j,{type:"text",autoComplete:"off",name:"addressInformation",placeholder:"Address",component:z,prefix:a.jsx(ba,{className:"text-xl"})})}),a.jsx(Y,{className:" px-8 flex items-center justify-between py-4",stickyClass:"border-t bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700",children:a.jsxs("div",{className:"md:flex items-center",children:[a.jsx(I,{size:"sm",className:"ltr:mr-3 rtl:ml-3",type:"button",onClick:m,children:"Cancel"}),a.jsx(I,{size:"sm",type:"submit",variant:"solid",icon:a.jsx(Z,{}),children:"Save"})]})})]})},Qa=U().shape({branchName:S().required("Details are required"),contact:S().typeError("Contact must be a number").required("Contact is required").test("is-number","Contact must be a number",s=>!isNaN(s)).test("is-ten-digits"," Contact must be exactly 10 digits",s=>{if(s){const t=Number(s);return/^\d{10}$/.test(t.toString())}return!0}).test("is-not-more-than-ten-digits","Contact must not exceed 10 digits",s=>s?Number(s).toString().length<=10:!0),addressInformation:S(),isHeadQuarter:S(),branchOwnerId:S().required("This field is required").test("is-valid-contact","Invalid contact selected",s=>!!w.find(t=>t.value==s))}),ta=R.forwardRef((s,t)=>{const e=q(),r=v(l=>l.crmOrganizations.data.dialogMode),i=v(l=>{var c,m;return(m=(c=l.crmOrganizations)==null?void 0:c.data)==null?void 0:m.selectedBranch});return a.jsx(K,{innerRef:t,initialValues:{branchName:r==="Edit"?i==null?void 0:i.branchName:"",branchOwnerId:r==="Edit"?i==null?void 0:i.branchOwnerId:"",addressInformation:r==="Edit"?i==null?void 0:i.addressInformation:"",contact:r==="Edit"?i==null?void 0:i.contact:null,isHeadQuarter:r==="Edit"?i==null?void 0:i.isHeadQuarter:!1},validationSchema:Qa,onSubmit:async(l,{setSubmitting:c})=>{var m,O,n,N,E,L;if(r==="Add"){const o=await e(Ba(l));let x="",f="",b="";(m=o==null?void 0:o.payload)!=null&&m.success?(x="Successfully Added",f=(O=o==null?void 0:o.payload)==null?void 0:O.message,b="success"):(x="Something went wrong !!!",f=(n=o==null?void 0:o.error)==null?void 0:n.message,b="danger"),$.push(a.jsx(H,{title:x,type:b,duration:2500,children:f}),{placement:"top-end"}),e(D(!1)),await e(k()),await e(M()),c(!1)}else{const o=await e(Aa({branchId:i==null?void 0:i.id,updatedData:l}));let x="",f="",b="";(N=o==null?void 0:o.payload)!=null&&N.success?(x="Successfully Added",f=(E=o==null?void 0:o.payload)==null?void 0:E.message,b="success"):(x="Something went wrong !!!",f=(L=o==null?void 0:o.error)==null?void 0:L.message,b="danger"),$.push(a.jsx(H,{title:x,type:b,duration:2500,children:f}),{placement:"top-end"}),e(D(!1)),await e(k()),await e(M()),c(!1)}},children:({touched:l,errors:c,values:m,setFieldValue:O})=>a.jsx(X,{children:a.jsx(J,{children:a.jsx(Va,{touched:l,errors:c,setFieldValue:O,values:m})})})})});ta.displayName="BranchesMainForm";const Ga=s=>{const{values:t,touched:e,errors:r}=s;return a.jsxs(a.Fragment,{children:[a.jsx("h5",{children:"Organizations"}),a.jsx("p",{className:"mb-6",children:"Section to config the organizations attribute"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsx("div",{className:"col-span-1",children:a.jsx(h,{label:"Organization Name",invalid:r.organizationName&&e.organizationName,errorMessage:r.organizationName,children:a.jsx(j,{type:"text",autoComplete:"off",name:"organizationName",placeholder:"Organization Name",component:z,prefix:a.jsx(Ia,{className:"text-xl"})})})}),a.jsx("div",{className:"col-span-1",children:a.jsx(h,{label:"Industry",invalid:r.industry&&e.industry,errorMessage:r.industry,children:a.jsx(j,{type:"text",autoComplete:"off",name:"industry",value:t.industry,placeholder:"Organization Industry",component:z})})})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsx("div",{className:"col-span-1",children:a.jsx(h,{label:"Contact",invalid:r.contact&&e.contact,errorMessage:r.contact,children:a.jsx(j,{type:"number",autoComplete:"off",name:"contact",placeholder:"Contact",component:z,prefix:a.jsx(ka,{className:"text-xl"})})})}),a.jsx("div",{className:"col-span-1",children:a.jsx(h,{label:"Website",invalid:r.website&&e.website,errorMessage:r.website,children:a.jsx(j,{type:"test",autoComplete:"off",name:"website",placeholder:"Website",component:z,prefix:a.jsx(Da,{className:"text-xl"})})})})]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:a.jsx("div",{className:"col-span-1",children:a.jsx(h,{label:"Number Of Employees",invalid:r.numberOfEmployees&&e.numberOfEmployees,errorMessage:r.numberOfEmployees,children:a.jsx(j,{type:"number",autoComplete:"off",name:"numberOfEmployees",placeholder:"Number Of Employees",component:z,prefix:a.jsx(fa,{className:"text-xl"})})})})}),a.jsx(h,{label:"Description",labelClass:"!justify-start",invalid:r.notes&&e.notes,errorMessage:r.notes,children:a.jsx(j,{name:"notes",children:({field:i,form:l})=>a.jsx(Sa,{value:i.value,onChange:c=>l.setFieldValue(i.name,c)})})})]})},Pa=U().shape({organizationName:S().required("Organization Name Required"),industry:S().required("Industry Required"),contact:ja().typeError("Contact must be a number").required("Contact is required").test("is-number","Contact must be a number",s=>!isNaN(s)).test("is-ten-digits"," Contact must be exactly 10 digits",s=>{if(s){const t=Number(s);return/^\d{10}$/.test(t.toString())}return!0}).test("is-not-more-than-ten-digits","Contact must not exceed 10 digits",s=>s?Number(s).toString().length<=10:!0)}),sa=R.forwardRef((s,t)=>{var x,f,b,V,Q,G;const e=q(),r=v(d=>{var p,y;return(y=(p=d.crmOrganizations)==null?void 0:p.data)==null?void 0:y.organizationData});R.useEffect(()=>{(async()=>{var y;const p=await e(M());e(qa((y=p==null?void 0:p.payload)==null?void 0:y.data)),await e(T()),await e(M())})()},[e]);const i=v(d=>d.crmOrganizations.data.usersList),{type:l,onFormSubmit:c,onDiscard:m}=s,O=v(d=>d.crmOrganizations.data.isDialogOpen),n=v(d=>d.crmOrganizations.data.branchList),N=v(d=>d.crmOrganizations.data.dialogMode),E=()=>{e(D(!1))},L=()=>{e(D(!0)),e(_("Add"))},o=d=>{e(D(!0)),e($a(d)),e(_("Edit"))};return a.jsxs(a.Fragment,{children:[a.jsx(K,{innerRef:t,initialValues:{organizationName:((x=r[0])==null?void 0:x.organizationName)||"",industry:((f=r[0])==null?void 0:f.industry)||"",contact:((b=r[0])==null?void 0:b.contact)||null,website:((V=r[0])==null?void 0:V.website)||"",numberOfEmployees:((Q=r[0])==null?void 0:Q.numberOfEmployees)||null,notes:((G=r[0])==null?void 0:G.notes)||""},validationSchema:Pa,onSubmit:async(d,{setSubmitting:p})=>{var C,P,W;const y=xa(d),g=await e(Ra(d));let A="",u="",B="";(C=g==null?void 0:g.payload)!=null&&C.success?(A="Successfully Added",u=(P=g==null?void 0:g.payload)==null?void 0:P.message,B="success"):(A="Something went wrong !!!",u=(W=g==null?void 0:g.error)==null?void 0:W.message,B="danger"),$.push(a.jsx(H,{title:A,type:B,duration:2500,children:u}),{placement:"top-end"}),await e(k()),c==null||c(y,p)},children:({values:d,touched:p,errors:y,isSubmitting:g})=>{const A={touched:p,errors:y};return a.jsx(X,{children:a.jsxs(J,{children:[a.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:a.jsx("div",{className:"lg:col-span-4",children:a.jsx(Ga,{touched:p,errors:y,values:d})})}),a.jsx(ga,{title:" Branches",desc:"You can update your branches information here"}),a.jsxs(ua,{name:"branches",alignCenter:!0,label:"",...A,children:[a.jsx("div",{className:"rounded-lg border border-gray-200 dark:border-gray-600",children:n==null?void 0:n.map((u,B)=>a.jsxs("div",{className:oa("flex items-center justify-between p-4",!Ma(n,B)&&"border-b border-gray-200 dark:border-gray-600"),children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx(aa,{}),a.jsx("div",{className:"ml-3 rtl:mr-3",children:a.jsxs("div",{className:"flex items-center",children:[a.jsxs("div",{className:"text-gray-900 dark:text-gray-100 font-semibold",children:[u.branchName," ",i!=null&&i.find(C=>C.id===u.branchOwnerId)?`${i.find(C=>C.id===u.branchOwnerId).firstName} ${i.find(C=>C.id===u.branchOwnerId).lastName}`:""]}),u.isHeadQuarter&&a.jsx(pa,{className:"bg-sky-100 text-sky-600 dark:bg-sky-500/20 dark:text-sky-100 rounded-md border-0 mx-2",children:a.jsxs("span",{className:"capitalize",children:[" ","Head Quarter"," "]})})]})})]}),a.jsx("div",{className:"flex",children:a.jsx(I,{size:"sm",type:"button",onClick:()=>o(u),children:"Edit"})})]},u.id))}),a.jsx("div",{className:"mt-2",children:a.jsx(I,{type:"button",variant:"plain",size:"sm",icon:a.jsx(ya,{className:"text-lg"}),onClick:()=>L(),children:a.jsx("span",{className:"font-semibold",children:"Add new branch"})})})]}),a.jsx(Y,{className:"-mx-8 px-8 flex items-center justify-between py-4",stickyClass:"border-t bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700",children:a.jsxs("div",{className:"md:flex items-center",children:[a.jsx(I,{size:"sm",className:"ltr:mr-3 rtl:ml-3",type:"button",onClick:()=>m==null?void 0:m(),children:"Discard"}),a.jsx(I,{size:"sm",variant:"solid",loading:g,icon:a.jsx(Z,{}),type:"submit",children:"Save"})]})})]})})}}),a.jsxs(da,{isOpen:O,onClose:E,children:[a.jsxs("h5",{className:"mb-4",children:[N==="Edit"?"Edit":"Add New"," Branch"]}),a.jsx(ta,{})]})]})});sa.displayName="OrganizationForm";ca("crmOrganizations",Ta);const Wa=()=>{const s=q();return R.useEffect(()=>{s(k())},[s]),a.jsx(a.Fragment,{children:a.jsx(sa,{type:"edit",onFormSubmit:function(t,e){e(!1)}})})},et=Wa;export{et as O};
