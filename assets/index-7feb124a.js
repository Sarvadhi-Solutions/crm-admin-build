import{r as d,i as O,j as e,al as v,am as M,an as F,ao as W,ap as _,ah as R,aq as G,a as K}from"./index-d1f55000.js";import{a as J,b as P,c as $,d as q}from"./CrmService-3f0fa95f.js";import{C as y}from"./Card-b6647cdf.js";import{i as V}from"./Views-27dec28c.js";import{B}from"./Badge-2e560773.js";import{_ as H,C as p}from"./chart.constant-ad6ca1b2.js";import{a as T,b as Q,c as U,d as X,e as Y}from"./GrowShrinkTag-ad14365e.js";import{A as b}from"./index-ac5acc09.js";import{B as Z}from"./Button-d10f25dd.js";import"./Dialog-012b8945.js";import{D as ee}from"./DataTable-6737e455.js";import"./Input-40502faa.js";import"./Skeleton-046fff23.js";import"./react-tooltip.min-a1c6e013.js";import"./RichTextEditor-8600bc97.js";import"./SegmentItemOption-a45281b6.js";import"./SvgIcon-24a96fd6.js";import"./Tooltip-e416896b.js";import{S as se}from"./StatusCapsule-e11d17bb.js";import{T as ae}from"./TextTruncate-b56f7760.js";import{S as u}from"./index-ce20e2d5.js";import{F as te,a as re,b as oe,c as ie}from"./index.esm-2718908d.js";import"./Alert-bc2bbe67.js";import"./RangeCalendar-d43d05d7.js";import"./index-b157f735.js";import"./index-2f8e95cb.js";import"./Drawer-0c18a381.js";import"./index-d072efef.js";import"./FormItem-4075ccd4.js";import"./toString-7b4f9ac7.js";import"./index-6b0c2b51.js";import"./index-7c8f45e7.js";import"./index-a10acbe3.js";import"./toast-4a408eff.js";import"./Pagination-ee6d6f94.js";import"./Progress-f11fb579.js";import"./index-0f803cf5.js";import"./ScrollBar-d7d05f7c.js";import"./Select-9e04c31f.js";import"./index-073298ad.js";import"./Switcher-ffa768b6.js";import"./index-354e9a00.js";import"./index-fdd0fce8.js";import"./Tag-68df4337.js";import"./index-2efca1fd.js";import"./index-8e63d0e1.js";import"./Upload-6df85b8e.js";import"./index.esm-a7f57555.js";import"./useMergeRef-788c4cb0.js";import"./index-e8290e1f.js";import"./CloseButton-865c8503.js";import"./index-56369f77.js";import"./isNil-a1b43ef7.js";import"./get-3fbe7aa4.js";import"./_MapCache-cbdf92c8.js";import"./floating-ui.dom-bef9cea3.js";import"./_baseIsEqual-cd9e2cb0.js";import"./cloneDeep-94f873f1.js";import"./_getPrototype-30a92b72.js";import"./useThemeClass-29fe42de.js";import"./usePopper-e4ac4eb1.js";import"./index.esm-5a580c59.js";import"./index-5744fde1.js";import"./useControllableState-2d8f7630.js";import"./useTimeout-8ae64f40.js";import"./StatusIcon-e78efbe0.js";import"./useRootClose-0334f01a.js";import"./TimeInput-75c92f6e.js";import"./useUniqueId-68699ef9.js";import"./useDidUpdate-f8015a0a.js";import"./useUncertainRef-b4892a52.js";import"./chainedFunction-070f832c.js";import"./slicedToArray-db6cc43d.js";import"./objectWithoutProperties-8809bfcf.js";import"./toConsumableArray-9938cdfc.js";import"./mapCloneElement-52c7d464.js";import"./index.esm-5c3c1ac6.js";import"./index.esm-7beb0e22.js";const A=["line","bar","area"],I=t=>{const{series:a=[],width:i="100%",height:s=300,xAxis:n,customOptions:l,type:o="line",direction:r,donutTitle:c,donutText:f,className:m,...z}=t,C=d.useRef(null),E=d.useMemo(()=>{switch(o){case"line":return T;case"bar":return Y;case"area":return X;case"donut":return U;case"radialBar":return Q;default:return T}},[o]);let x=JSON.parse(JSON.stringify(E));const L=window.innerWidth<768,S=d.useCallback(()=>{if(C.current){const g=C.current.querySelectorAll("div.apexcharts-legend")[0];r===O&&(g.style.right="auto",g.style.left="0"),L&&(g.style.position="relative",g.style.top="0",g.style.justifyContent="start",g.style.padding="0")}},[r,L]);return d.useEffect(()=>{A.includes(o)&&S()},[o,S]),A.includes(o)&&(x.xaxis.categories=n),l&&(x={...x,...l}),o==="donut"&&(c&&(x.plotOptions.pie.donut.labels.total.label=c),f&&(x.plotOptions.pie.donut.labels.total.formatter=()=>f)),e.jsx("div",{ref:C,style:r===O?{direction:"ltr"}:{},className:"chartRef",children:e.jsx(H,{options:x,type:o,series:a,width:i,height:s,className:m,...z})})},ne="crmDashboard",D=v("crmDashboard/data/dashboard",async()=>(await J()).data),w=v("crmDashboard/data/dashboard/tasks",async()=>(await P()).data),N=v("crmDashboard/data/getLeads",async()=>(await $()).data),k=v("crmDashboard/data/getLeadsAndDealChart",async()=>(await q()).data),le={loading:!0,dashboardData:{},tasksChartData:{},leadsList:[],convertedLeadDeal:{}},ce=M({name:`${ne}/state`,initialState:le,reducers:{},extraReducers:t=>{t.addCase(D.fulfilled,(a,i)=>{a.dashboardData=i.payload.crmDashboardData,a.loading=!1}).addCase(D.pending,a=>{a.loading=!0}).addCase(w.fulfilled,(a,i)=>{a.loading=!1,a.tasksChartData.chart=i.payload.data}).addCase(w.pending,a=>{a.loading=!0}).addCase(N.fulfilled,(a,i)=>{a.leadsList=i.payload.data,a.loading=!1}).addCase(N.pending,(a,i)=>{a.loading=!0}).addCase(k.fulfilled,(a,i)=>{a.convertedLeadDeal=i.payload.data,a.loading=!1}).addCase(k.pending,(a,i)=>{a.loading=!0})}}),de=ce.reducer,me=F({data:de}),h=W,pe=({data:t=[],className:a})=>{const i=_(),s=()=>{i("/app/crm/leads")},n=h(o=>{o.crmDashboard.data.loading}),l=d.useMemo(()=>[{header:"Associated Contact",accessorKey:"associatedContact",cell:r=>{var m;const c=(m=r.row.original)==null?void 0:m.contactData;return c?c.firstName+" "+c.lastName:"-"}},{header:"Title",accessorKey:"title",cell:r=>{const c=r.row.original;return e.jsx(ae,{text:c.title,maxLength:30})}},{header:"Budget",accessorKey:"budget",cell:r=>r.row.original.budget},{header:"status",accessorKey:"status",cell:r=>{const c=r.row.original;return e.jsx(se,{status:c.status})}}],[]);return e.jsxs(y,{className:a,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{children:"Leads"}),e.jsx(Z,{size:"sm",onClick:s,children:"View All Leads"})]}),e.jsx(ee,{columns:l,data:t,skeletonAvatarColumns:[0],skeletonAvatarProps:{width:28,height:28},loading:n,isPagination:!1})]})},j=({label:t,value:a,badgeClass:i,showBadge:s=!0})=>e.jsxs("div",{className:"flex gap-2",children:[s&&e.jsx(B,{className:"mt-2.5",innerClass:i}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-bold",children:a}),e.jsx("p",{children:t})]})]}),ue=({className:t})=>{const[a,i]=d.useState(["weekly"]),s=h(r=>r.crmDashboard.data.tasksChartData),[n,l]=d.useState(!1),o=h(r=>r.theme.layout.sideNavCollapse);return d.useEffect(()=>{l(!0);const r=setTimeout(()=>l(!1),300);return console.log(p[0],p[2],p[1]),()=>{clearTimeout(r)}},[s,o]),e.jsxs(y,{className:t,children:[e.jsxs("div",{className:"flex sm:flex-row flex-col md:items-center justify-between mb-6 gap-4",children:[e.jsx("h4",{children:"Tasks Overview"}),e.jsxs(u,{value:a,size:"sm",onChange:r=>i(r),children:[e.jsx(u.Item,{value:"monthly",children:"Monthly"}),e.jsx(u.Item,{value:"weekly",children:"Weekly"}),e.jsx(u.Item,{value:"daily",children:"Daily"})]})]}),!V(s)&&!n&&(s==null?void 0:s.chart)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{children:e.jsx(j,{showBadge:!1,label:"Total Tasks",value:s==null?void 0:s.chart[a[0]].total})}),e.jsxs("div",{className:"flex gap-x-6",children:[e.jsx(j,{badgeClass:"bg-emerald-500",label:s==null?void 0:s.chart[a[0]].series[0].name,value:s==null?void 0:s.chart[a[0]].completed}),e.jsx(j,{badgeClass:"bg-indigo-600",label:s==null?void 0:s.chart[a[0]].series[1].name,value:s==null?void 0:s.chart[a[0]].pending}),e.jsx(j,{badgeClass:"bg-amber-500",label:s==null?void 0:s.chart[a[0]].series[2].name,value:s==null?void 0:s.chart[a[0]].inProgress})]})]}),e.jsxs("div",{children:[e.jsx(I,{series:s==null?void 0:s.chart[a[0]].series,xAxis:s==null?void 0:s.chart[a[0]].range,type:"bar",customOptions:{colors:[p[2],p[0],p[3]],legend:{show:!1},plotOptions:{bar:{horizontal:!1,columnWidth:a[0]==="monthly"?"15px":"30px",borderRadius:2}}}}),e.jsx("div",{className:""})]})]}),e.jsx(R,{loading:n,type:"cover",children:n&&e.jsx("div",{className:"h-[300px]"})})]})},he=({type:t})=>{switch(t){case"newLeads":return e.jsx(b,{size:55,className:"bg-indigo-100 text-indigo-600 dark:bg-indigo-500/20 dark:text-indigo-100",icon:e.jsx(ie,{})});case"company":return e.jsx(b,{size:55,className:"bg-cyan-100 text-cyan-600 dark:bg-cyan-500/20 dark:text-cyan-100",icon:e.jsx(oe,{})});case"clients":return e.jsx(b,{size:55,className:"bg-emerald-100 text-emerald-600 dark:bg-emerald-500/20 dark:text-emerald-100",icon:e.jsx(re,{})});case"task":return e.jsx(b,{size:55,className:"bg-amber-100 text-amber-600 dark:bg-amber-500/20 dark:text-amber-100",icon:e.jsx(te,{})});default:return e.jsx("div",{})}},xe=({data:t={}})=>e.jsx(y,{children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(he,{type:t.key}),e.jsx("div",{children:e.jsxs("div",{className:"flex gap-1.5 items-end mb-2",children:[e.jsx("h3",{className:"font-bold leading-none",children:t.value}),e.jsx("p",{className:"font-semibold",children:t.label})]})})]})}),ge=({data:t=[]})=>e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-4 gap-4",children:t.map(a=>e.jsx(xe,{data:a},a.key))}),fe=({data:t={leadsCreated:{},convertedInDeal:{}}})=>{var n,l;const[a,i]=d.useState("week"),s=d.useMemo(()=>{if(console.log(JSON.stringify(t)),t!=null&&t.leadsCreated)return{series:[t==null?void 0:t.leadsCreated[a],t==null?void 0:t.convertedInDeal[a]],labels:["Leads","Converted Deal"]}},[t,a]);return e.jsxs(y,{children:[e.jsxs("div",{className:"flex sm:flex-row flex-col md:items-center justify-between mb-6 gap-4",children:[e.jsx("h4",{children:"Leads Overview"}),e.jsxs(u,{value:a,size:"sm",onChange:o=>{i(o)},children:[e.jsx(u.Item,{value:"month",children:"Monthly"}),e.jsx(u.Item,{value:"week",children:"Weekly"}),e.jsx(u.Item,{value:"day",children:"Daily"})]})]}),e.jsx("div",{className:"mt-6",children:(s==null?void 0:s.series)&&e.jsxs(e.Fragment,{children:[e.jsx(I,{donutTitle:`${s==null?void 0:s.series.reduce((o,r)=>o+r,0)}`,donutText:"Leads",series:s==null?void 0:s.series,customOptions:{labels:s==null?void 0:s.labels,colors:p,stroke:{lineCap:"round"},plotOptions:{radialBar:{dataLabels:{name:{show:!0,fontSize:"12px",fontWeight:600,color:p[0]},value:{show:!0,fontSize:"12px",fontWeight:400,color:p[0],formatter:function(o){return o+""}},total:{show:!0,label:"Total",formatter:function(o){var r;return((r=o==null?void 0:o.globals)==null?void 0:r.seriesTotals[0])||0}}}}}},type:"radialBar"}),((n=s==null?void 0:s.series)==null?void 0:n.length)===((l=s==null?void 0:s.labels)==null?void 0:l.length)&&e.jsx("div",{className:"mt-6 grid grid-cols-2 gap-4 w-[70%] mx-auto",children:s.labels.map((o,r)=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(B,{badgeStyle:{backgroundColor:p[r]}}),e.jsx("span",{className:"font-medium whitespace-nowrap",children:o})]},o))})]})})]})};G("crmDashboard",me);const be=()=>{const t=K(),{statisticData:a,recentLeadsData:i}=h(r=>r.crmDashboard.data.dashboardData),s=h(r=>r.crmDashboard.data.leadsList),n=h(r=>r.crmDashboard.data.convertedLeadDeal),l=h(r=>r.crmDashboard.data.loading);d.useEffect(()=>{o()},[]);const o=()=>{t(D()),t(w()),t(k()),t(N())};return d.useMemo(()=>{const r=(s==null?void 0:s.filter(m=>m.status==="open").length)||0,c=(s==null?void 0:s.filter(m=>m.status==="closed_lost").length)||0,f=(s==null?void 0:s.filter(m=>m.status==="closed_won").length)||0;return{labels:["Open","Lost","Won"],data:[r,c,f]}},[s]),e.jsx("div",{className:"flex flex-col gap-4 h-full",children:e.jsxs(R,{loading:l,children:[e.jsx(ge,{data:a}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsx(ue,{className:"col-span-2"}),e.jsx(fe,{data:n})]}),e.jsx(pe,{data:i})]})})},Js=be;export{Js as default};
