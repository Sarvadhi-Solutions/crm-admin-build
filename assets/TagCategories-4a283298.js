import{r as N,a as S,j as e,ah as je,aq as fe}from"./index-dd430329.js";import{u as te}from"./useThemeClass-c67d9527.js";import"./Card-7303f1d6.js";import"./Views-969b82ff.js";import{B as ye}from"./Badge-81ec6aad.js";import"./chart.constant-b89d4d9a.js";import"./GrowShrinkTag-7614f549.js";import{aa as Ce,ab as Ne,ac as Te,O as se,P as oe}from"./index.esm-8a75a52d.js";import"./index-1bec26b5.js";import{B as A}from"./Button-477f78d2.js";import{D as U}from"./Dialog-4e683d85.js";import{T as be}from"./DataTable-b28d1e98.js";import{I as z}from"./Input-2ae5f21f.js";import"./Skeleton-0435d2db.js";import"./react-tooltip.min-90b0da4a.js";import"./RichTextEditor-ab8d719f.js";import"./SegmentItemOption-4eb9f4d2.js";import"./SvgIcon-0e5d590b.js";import{T as Se}from"./Tooltip-4f6c910c.js";import{T as B}from"./index-03531cf7.js";import{u as re,f as k,g as ie,e as we,d as De}from"./index-387d3e60.js";import"./Alert-40c008c9.js";import"./RangeCalendar-c7dd44b3.js";import"./index-4953df19.js";import"./index-e8664bdc.js";import"./Drawer-851dfb0e.js";import"./index-273b73f2.js";import{F as _,a as M}from"./FormItem-c5d9f12d.js";import"./toString-45c45754.js";import"./index-ad4d109a.js";import"./index-1e6ea035.js";import"./index-5ad45768.js";import{t as v,N as I}from"./toast-7520b143.js";import{P as ve}from"./Pagination-a183170a.js";import"./Progress-65bff4d5.js";import"./index-9685374c.js";import"./ScrollBar-efe95462.js";import"./index-a7fee107.js";import{S as ne}from"./Select-a638e837.js";import"./index-0bd5fcc8.js";import"./Switcher-46a64a8e.js";import"./index-f4b545fd.js";import"./Tag-a01d1848.js";import"./index-c88fea13.js";import"./index-f57ef06e.js";import"./Upload-79efa750.js";import{F as G,a as J,b as R,c as Ie,g as Q}from"./formik.esm-97667c88.js";import{c as q,a as w,e as Me}from"./index.esm-27140c16.js";import{u as f,e as Fe,t as V,g as F,T as Ee,a as L,d as Ae,m as D,c as Re,b as K,f as ke,s as qe,h as $e,i as Be,j as $,k as H,l as le,n as X,o as W,p as Oe,q as Y,r as He}from"./TagCategoryDetailsForm-511dd81f.js";import{C as ce}from"./ConfirmDialog-fcfff7a2.js";import{c as Z}from"./cloneDeep-7dd50aa7.js";import{u as Pe}from"./checkEditUpdate-de727179.js";import{L as de}from"./colorPicker-7696eb08.js";import{d as ze}from"./index.esm-9e83db4a.js";const Ve=q().shape({categoryName:w().required("Field is required")}),me=N.forwardRef((i,g)=>{var c;const n=S(),u=f(t=>t.crmTagCategories.data.formToggle),l=()=>{n(V(!1))},a=f(t=>t.crmTagCategories.data.selectedTagCategory);return e.jsx(U,{isOpen:u,onClose:l,children:e.jsx(G,{innerRef:g,initialValues:{categoryName:(a==null?void 0:a.categoryName)||"",master:((c=a==null?void 0:a.master)==null?void 0:c.id)||"",tags:(a==null?void 0:a.tags)||[]},validationSchema:Ve,onSubmit:async(t,{setSubmitting:s})=>{var x,y,C,b;s(!1);const o={...t,masterId:t==null?void 0:t.master,tagId:((x=t==null?void 0:t.tags)==null?void 0:x.map(m=>m==null?void 0:m.id))||[]};delete o.master,delete o.tags;const d=await n(Fe({tagCategoryId:(a==null?void 0:a.id)||"",updatedData:o}));let j="",T="",p="";(y=d==null?void 0:d.payload)!=null&&y.success?(j="Successfully Update",T=(C=d==null?void 0:d.payload)==null?void 0:C.message,p="success"):(j="Something went wrong !!!",T=(b=d==null?void 0:d.error)==null?void 0:b.message,p="danger"),v.push(e.jsx(I,{title:j,type:p,duration:2500,children:T}),{placement:"top-end"}),n(V(!1)),await n(F())},children:({touched:t,errors:s,values:o,setFieldValue:d})=>e.jsx(J,{children:e.jsx(_,{children:e.jsx(Ee,{touched:t,errors:s,values:o,setFieldValue:d})})})})})});me.displayName="TagCategoryForm";const Le=()=>{const i=S(),g=f(a=>a.crmTagCategories.data.deleteConfirmation),n=f(a=>a.crmTagCategories.data.selectedTagCategory),u=()=>{i(L(!1))},l=async()=>{var c,t,s;i(L(!1));const a=await i(Ae(n.id));(c=a==null?void 0:a.payload)!=null&&c.success?v.push(e.jsx(I,{title:"Successfuly Deleted",type:"success",duration:2500,children:(t=a==null?void 0:a.payload)==null?void 0:t.message}),{placement:"top-end"}):v.push(e.jsx(I,{title:"Something Went Wrong !!!",type:"danger",duration:2500,children:(s=a==null?void 0:a.error)==null?void 0:s.message}),{placement:"top-end"}),await i(F())};return e.jsx(ce,{isOpen:g,type:"danger",title:"Delete Tag Category",confirmButtonColor:"red-600",onClose:u,onRequestClose:u,onCancel:u,onConfirm:l,children:e.jsx("p",{children:"Are you sure you want to delete this Tag Category? All record related to this tag category will be deleted as well. This action cannot be undone."})})};const Ke=q({categoryName:w().required("Category Name is required"),masterId:w().required("This field is required").test("is-valid-module","Invalid module selected",i=>!!D.find(g=>g.value==i)),tags:Me().of(q().shape({tagName:w().required("Name required"),colorName:w().required("Color required")}))}),ee=(i,g)=>{const n=Q(i.errors,g),u=Q(i.touched,g);return{errorMessage:n||"",invalid:typeof u>"u"?!1:n&&u}},We=()=>{const i=S(),{addForm:g,modulesList:n}=f(l=>l.crmTagCategories.data);N.useEffect(()=>{(async()=>{var c;const a=await i(ke());i(qe((c=a==null?void 0:a.payload)==null?void 0:c.data))})()},[]),D.length=0,n==null||n.forEach(l=>{D.push({value:l.id,label:l.moduleName})});const u=()=>{i(K(!1))};return e.jsx(U,{isOpen:g,onClose:u,children:e.jsx(G,{validationSchema:Ke,initialValues:{tags:[{tagName:"",colorName:""}],categoryName:"",masterId:""},onSubmit:async l=>{var o,d,j;let a="",c="",t="";const s=await i(Re(l));(o=s==null?void 0:s.payload)!=null&&o.success?(a="Successfully Added",c=(d=s==null?void 0:s.payload)==null?void 0:d.message,t="success"):(a="Something went wrong !!!",c=(j=s==null?void 0:s.error)==null?void 0:j.message,t="danger"),v.push(e.jsx(I,{title:a,type:t,duration:2500,children:c}),{placement:"top-end"}),i(K(!1)),await i(F())},children:({touched:l,errors:a,values:c,setFieldValue:t})=>{const s=c.tags;return e.jsx(J,{children:e.jsx(_,{layout:"inline",children:e.jsxs("div",{className:"w-full custom-scrollbar",style:{maxHeight:"75vh"},children:[e.jsxs("div",{className:"mb-10",children:[e.jsx("h5",{className:"mb-4",children:"Add Tag Category"}),e.jsx(M,{layout:"vertical",label:"Category Name",invalid:a.categoryName&&l.categoryName,errorMessage:a.categoryName,children:e.jsx(R,{placeholder:"Category Name",name:"categoryName",component:z})}),e.jsx(M,{layout:"vertical",label:"Module Name",invalid:a.masterId&&l.masterId,errorMessage:a.masterId,children:e.jsx(ne,{name:"masterId",placeholder:"Module Name",options:D,id:"masterId",value:D.find(o=>(o==null?void 0:o.value)==(c==null?void 0:c.masterId)),onChange:o=>{const d=o.value;t("masterId",d||"")}})})]}),e.jsx(Ie,{name:"tags",children:({form:o,remove:d,push:j})=>e.jsxs("div",{children:[s&&s.length>0?s.map((T,p)=>{const x=ee(o,`tags[${p}].tagName`),y=ee(o,`tags[${p}].colorName`);return e.jsxs("div",{children:[e.jsx(M,{label:"Name",invalid:x.invalid,errorMessage:x.errorMessage,children:e.jsx(R,{invalid:x.invalid,placeholder:"Tag Name",name:`tags[${p}].tagName`,type:"text",component:z})}),e.jsx(M,{invalid:y.invalid,children:e.jsx(R,{invalid:y.invalid,placeholder:"Color",name:`tags[${p}].colorName`,render:({field:C})=>e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:0,position:"relative"},children:[e.jsx(de,{field:C}),y.invalid&&e.jsx("div",{style:{marginTop:15,marginLeft:5,color:"red"},children:y.errorMessage})]})})}),e.jsx(A,{shape:"circle",size:"sm",icon:e.jsx(Ce,{}),onClick:()=>d(p)})]},p)}):null,e.jsxs("div",{children:[e.jsx(A,{type:"button",className:"ltr:mr-2 rtl:ml-2",onClick:()=>{j({tagName:"",colorName:""})},children:"Add tags"}),e.jsx(A,{type:"submit",variant:"solid",children:"Submit"})]})]})})]})})})}})})},Ue=q({tagName:w().required("Tag Name is required"),colorName:w().required("Color required")}),ge=()=>{const i=S(),g=f(t=>{var s,o;return(o=(s=t==null?void 0:t.crmTagCategories)==null?void 0:s.data)==null?void 0:o.modulesList});D.length=0,g==null||g.forEach(t=>{D.push({value:t.id,label:t.moduleName})});const n=f(t=>t.crmTagCategories.data.editForm),u=f(t=>{var s,o;return(o=(s=t==null?void 0:t.crmTagCategories)==null?void 0:s.data)==null?void 0:o.dialogMode}),l=f(t=>t.crmTagCategories.data.selectedTag),a=()=>{i($(!1))},c=f(t=>t.crmTagCategories.data.selectedTagCategory);return e.jsx("div",{children:e.jsx(U,{isOpen:n,onClose:a,children:e.jsx(G,{validationSchema:Ue,initialValues:{tagName:u==="Edit"?l==null?void 0:l.tagName:"",colorName:u==="Edit"?l==null?void 0:l.colorName:"",masterId:u==="Edit"?l==null?void 0:l.masterId:""},onSubmit:async t=>{var T,p,x,y,C,b;let s="",o="",d="";const j={...t};if(u==="Add"){const m=await i($e({masterId:c==null?void 0:c.masterId,tagName:t==null?void 0:t.tagName,colorName:t==null?void 0:t.colorName,tagCategoryId:c==null?void 0:c.id}));(T=m==null?void 0:m.payload)!=null&&T.success?(s="Successfully Added",o=(p=m==null?void 0:m.payload)==null?void 0:p.message,d="success"):(s="Something went wrong !!!",o=(x=m==null?void 0:m.error)==null?void 0:x.message,d="danger")}else{const m=await i(Be({tagId:(l==null?void 0:l.id)||"",data:j}));(y=m==null?void 0:m.payload)!=null&&y.success?(s="Successfully Added",o=(C=m==null?void 0:m.payload)==null?void 0:C.message,d="success"):(s="Something went wrong !!!",o=(b=m==null?void 0:m.error)==null?void 0:b.message,d="danger")}v.push(e.jsx(I,{title:s,type:d,duration:2500,children:o}),{placement:"top-end"}),i($(!1)),await i(F())},children:({touched:t,errors:s,values:o,setFieldValue:d})=>e.jsx(J,{children:e.jsx(_,{layout:"inline",children:e.jsxs("div",{className:"w-full custom-scrollbar",style:{maxHeight:"75vh"},children:[e.jsx("div",{className:"mb-10",children:e.jsx("h5",{className:"mb-4",children:u==="Edit"?"Edit Tag Category":"Add Tag Category"})}),e.jsx(M,{label:"Name",invalid:s.tagName&&t.tagName,errorMessage:s.tagName,children:e.jsx(R,{placeholder:"Tag Name",name:"tagName",type:"text",component:z})}),e.jsx(M,{invalid:s.colorName&&t.colorName,children:e.jsx(R,{invalid:s.colorName&&t.colorName,placeholder:"Color",name:"colorName",render:({field:j})=>e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:0},children:[e.jsx(de,{field:j}),s.colorName&&e.jsx("div",{style:{marginTop:15,marginLeft:5,color:"red"},children:s.colorName})]})})}),e.jsx("div",{children:e.jsx(A,{type:"submit",variant:"solid",children:"Submit"})})]})})})})})})},{Tr:P,Th:_e,Td:Ge,THead:Je,TBody:Qe}=B,Xe=({renderRowSubComponent:i,getRowCanExpand:g})=>{const n=S(),u=({row:r})=>{te();const h=()=>{n(V(!0)),n(H(r))},E=async()=>{await n(H(r)),n(L(!0))},xe=async()=>{n(le("Add")),n($(!0)),n(H(r))};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex text-base items-center",children:[e.jsx(Se,{title:"Add Tag",children:e.jsx("button",{className:" cursor-pointer circle items-center hover:text-green-500 mr-1",onClick:xe,children:e.jsx(ze,{})})}),e.jsx("button",{className:" cursor-pointer circle items-center hover:text-blue-500 ",onClick:h,children:e.jsx(se,{})}),e.jsx("span",{className:"cursor-pointer hover:text-red-500 mx-1 circle items-center",onClick:E,children:e.jsx(oe,{})})]})})},l=[10,25,50,100],a=f(r=>r.crmTagCategories.data.displayedTagCategoriesList),c=f(r=>r.crmTagCategories.data.loading),{pageIndex:t,pageSize:s,sort:o,query:d,total:j}=f(r=>r.crmTagCategories.data.tableData),T=N.useMemo(()=>({pageIndex:t,pageSize:s,sort:o,query:d,total:j}),[t,s,o,d,j]),p=N.useMemo(()=>[{header:()=>null,id:"expander",cell:({row:r})=>e.jsx(e.Fragment,{children:r.getCanExpand()?e.jsx("button",{className:"text-lg",onClick:r.getToggleExpandedHandler(),children:r.getIsExpanded()?e.jsx(Ne,{}):e.jsx(Te,{})}):null}),subCell:()=>null},{header:"Actions",id:"action",cell:r=>e.jsx(u,{row:r.row.original})},{header:"Category Name",accessorKey:"categoryName"},{header:"Module Name",accessorKey:"master.moduleName"},{header:"Created By",accessorKey:"createdBy",cell:r=>{var h,E;return`${(h=r.row.original.createdData)==null?void 0:h.firstName} ${(E=r.row.original.createdData)==null?void 0:E.lastName}`}}],[]),[x,y]=N.useState(a),C=N.useMemo(()=>l.map(r=>({value:r,label:`${r} / page`})),[l]);N.useEffect(()=>{const r=a==null?void 0:a.map(h=>({...h,subRows:h.tags}));y(r)},[a]);const b=re({data:x,columns:p,getRowCanExpand:g,getCoreRowModel:ie(),getExpandedRowModel:we(),manualPagination:!0,manualSorting:!0}),m=r=>{const h=Z(T);h.pageIndex=r,n(X(h))},O=r=>{const h=Z(T);h.pageSize=Number(r),h.pageIndex=1,n(X(h))},ue=r=>{c||O==null||O(Number(r))},he=r=>{c||m==null||m(r)};Pe("tagcategory","canCreate");const pe=()=>{n(K(!0))};return e.jsxs(e.Fragment,{children:[e.jsxs(je,{loading:c&&(x==null?void 0:x.length)!==0,type:"cover",children:[e.jsx("div",{className:"md:flex items-center justify-end",children:e.jsx("div",{className:"mb-4",children:e.jsx(A,{size:"sm",onClick:pe,children:"Add New"})})}),e.jsxs(B,{children:[e.jsx(Je,{children:b.getHeaderGroups().map(r=>e.jsx(P,{children:r.headers.map(h=>e.jsx(_e,{colSpan:h.colSpan,children:k(h.column.columnDef.header,h.getContext())},h.id))},r.id))}),c&&(x==null?void 0:x.length)===0?e.jsx(be,{columns:p==null?void 0:p.length,avatarInColumns:[0],avatarProps:{width:28,height:28}}):e.jsx(Qe,{children:b.getRowModel().rows.map(r=>e.jsxs(N.Fragment,{children:[e.jsx(P,{children:r.getVisibleCells().map(h=>e.jsx("td",{children:k(h.column.columnDef.cell,h.getContext())},h.id))}),r.getIsExpanded()&&e.jsx(P,{children:e.jsx(Ge,{colSpan:r.getVisibleCells().length,children:i({row:r})})})]},r.id))})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx(ve,{pageSize:s,currentPage:t,total:j,onChange:he}),e.jsx("div",{style:{minWidth:130},children:e.jsx(ne,{size:"sm",menuPlacement:"top",isSearchable:!1,value:C==null?void 0:C.filter(r=>r.value===s),options:C,onChange:r=>ue(r==null?void 0:r.value)})})]})]}),e.jsx(Le,{}),e.jsx(me,{}),e.jsx(We,{}),e.jsx(ge,{})]})},Ye=()=>{const i=S(),g=f(a=>a.crmTagCategories.data.deleteSubTagConfirmation),n=f(a=>a.crmTagCategories.data.selectedTag),u=()=>{i(W(!1))},l=async()=>{var c,t,s;i(W(!1));const a=await i(Oe(n.id));(c=a==null?void 0:a.payload)!=null&&c.success?v.push(e.jsx(I,{title:"Successfuly Deleted",type:"success",duration:2500,children:(t=a==null?void 0:a.payload)==null?void 0:t.message}),{placement:"top-end"}):v.push(e.jsx(I,{title:"Something Went Wrong !!!",type:"danger",duration:2500,children:(s=a==null?void 0:a.error)==null?void 0:s.message}),{placement:"top-end"}),await i(F())};return e.jsx(ce,{isOpen:g,type:"danger",title:"Delete Tag",confirmButtonColor:"red-600",onClose:u,onRequestClose:u,onCancel:u,onConfirm:l,children:e.jsx("p",{children:"Are you sure you want to delete this Tag? All record related to this tag will be deleted as well. This action cannot be undone."})})},{Tr:ae,Th:Ze,Td:ea,THead:aa,TBody:ta,Sorter:sa}=B,oa=({row:i})=>{te();const g=()=>{n(le("Edit")),n($(!0)),n(Y(i))},n=S(),u=async()=>{await n(Y(i)),await n(W(!0))};return e.jsxs("div",{className:"flex text-base items-center",children:[e.jsx("button",{className:"circle items-center hover:text-blue-500",onClick:g,children:e.jsx(se,{})}),e.jsx("span",{className:"cursor-pointer hover:text-red-500 mx-1 circle items-center",onClick:u,children:e.jsx(oe,{})})]})},ra=i=>{const{tableData:g}=i,[n,u]=N.useState([]),[l,a]=N.useState(g),c=[{header:"Actions",id:"action",cell:s=>e.jsx(oa,{row:s.row.original})},{header:"Tag Name",accessorKey:"tagName"},{header:"Color",accessorKey:"colorName",cell:s=>{const o=s.row.original;return e.jsxs("div",{className:"flex items-center",children:[e.jsx(ye,{style:{backgroundColor:`${o.colorName}`}}),e.jsx("span",{className:"ml-2 rtl:mr-2 capitalize",children:o.colorName})]})}}];N.useEffect(()=>{a(g)},[g]);const t=re({data:l,columns:c,state:{sorting:n},onSortingChange:u,getCoreRowModel:ie(),getSortedRowModel:De()});return e.jsxs(e.Fragment,{children:[e.jsxs(B,{children:[e.jsx(aa,{children:t.getHeaderGroups().map(s=>e.jsx(ae,{children:s.headers.map(o=>e.jsx(Ze,{colSpan:o.colSpan,children:o.isPlaceholder?null:e.jsxs("div",{className:o.column.getCanSort()?"cursor-pointer select-none":"",onClick:o.column.getToggleSortingHandler(),children:[k(o.column.columnDef.header,o.getContext()),e.jsx(sa,{sort:o.column.getIsSorted()})]})},o.id))},s.id))}),e.jsx(ta,{children:t.getRowModel().rows.slice(0,10).map(s=>e.jsx(ae,{children:s.getVisibleCells().map(o=>e.jsx(ea,{children:k(o.column.columnDef.cell,o.getContext())},o.id))},s.id))})]}),e.jsx(Ye,{}),e.jsx(ge,{})]})},ia=({row:i})=>e.jsx("pre",{style:{fontSize:"10px"},children:e.jsx(ra,{tableData:i.original.tags})});fe("crmTagCategories",He);const na=()=>{const i=S(),g=async()=>{await i(F())};return N.useEffect(()=>{g()},[i]),e.jsxs(e.Fragment,{children:[e.jsx("h5",{className:"mb-2",children:"Manage Tags"}),e.jsx(Xe,{renderRowSubComponent:ia,getRowCanExpand:()=>!0})]})},lt=na;export{lt as T};
