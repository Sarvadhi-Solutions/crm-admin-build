import{al as F,am as J,an as Q,ao as Z,a as T,r as v,j as s,ap as ee,aq as V,at as se,ah as te}from"./index-0ab2c514.js";import{C as oe,i as W}from"./Views-ba63249c.js";import{h as ie,i as re,j as ae,k as le}from"./CrmService-d077c852.js";import{A as B}from"./AdaptableCard-afe020d2.js";import"./Badge-edf0b9d8.js";import"./chart.constant-7e7be1ae.js";import"./GrowShrinkTag-480cf741.js";import"./index-713c1ac9.js";import{B as Y}from"./Button-968324b3.js";import{D as ne}from"./Dialog-6e6660ce.js";import{D as ce}from"./DataTable-a66c505f.js";import{D as de}from"./DoubleSidedImage-fb81f6a7.js";import{I as me}from"./Input-da780288.js";import"./Skeleton-139abafa.js";import"./react-tooltip.min-d3f02ea8.js";import"./RichTextEditor-4196a1be.js";import"./SegmentItemOption-9e30f3b9.js";import"./SvgIcon-67cf6073.js";import{T as pe}from"./Tooltip-f95f0645.js";import{L as ue,N as ge}from"./LeadActivity-bc6c8efe.js";import"./Alert-fd1c6434.js";import"./RangeCalendar-23cf777a.js";import{C as he}from"./Card-36fb08c8.js";import"./index-8466c23b.js";import"./index-665fd580.js";import"./Drawer-0d99631e.js";import"./index-bb763aff.js";import{F as xe,a as fe}from"./FormItem-e6ee784c.js";import"./toString-8ab117f8.js";import"./index-8e362e39.js";import"./index-ddf729b1.js";import"./index-da413dc5.js";import{t as S,N as A}from"./toast-f47eb111.js";import"./Pagination-f681e8ee.js";import"./Progress-8fed0827.js";import"./index-392b4f57.js";import"./ScrollBar-99e33cfa.js";import"./index-6d1daefb.js";import"./Select-022e394f.js";import"./index-e1984e61.js";import"./Switcher-278dbd82.js";import"./index-a4f8223f.js";import"./index-1e57f70f.js";import"./Tag-66d1e717.js";import"./index-ace76341.js";import"./index-d29598bc.js";import"./Upload-5e95a87c.js";import{a as je}from"./index.esm-26860cf2.js";import{I as ye}from"./index.esm-c3405e1c.js";import{F as De,a as Ne,b as we,c as ve}from"./formik.esm-8fede37e.js";import{c as Ce,a as Le}from"./index.esm-40264850.js";import{u as $,m as _}from"./TagCategoryDetailsForm-b5fb02dd.js";import{C as X}from"./ConfirmDialog-7f417840.js";import{S as P}from"./StatusCapsule-e7dab1be.js";import{T as be}from"./TagsList-ceef7f86.js";import{P as Se}from"./index.esm-42b7b20a.js";import{u as Ae,d as Te,a as K,k as ke,g as Ee}from"./index-5adc8487.js";import{T as z}from"./TextTruncate-2e17b1a5.js";import{c as O}from"./cloneDeep-1f1702a9.js";import{r as Ie,u as E,g as Me,a as I}from"./index-79d7868b.js";import{h as Fe}from"./moment-fbc5633a.js";import{u as q}from"./checkEditUpdate-672745ae.js";import"./useMergeRef-788c4cb0.js";import"./index-2544a6e9.js";import"./CloseButton-84582cc2.js";import"./index-a0ae6717.js";import"./isNil-bf67e220.js";import"./get-e3d59f81.js";import"./_MapCache-438327fc.js";import"./floating-ui.dom-4bc0055b.js";import"./_baseIsEqual-a16dae54.js";import"./useThemeClass-1f876eb2.js";import"./usePopper-0441deed.js";import"./index.esm-d6cc7dce.js";import"./index-1a5cdab8.js";import"./useTimeout-c2c175af.js";import"./StatusIcon-83ac331c.js";import"./useControllableState-e8851140.js";import"./useRootClose-f3a243e8.js";import"./TimeInput-c04de9a3.js";import"./useUniqueId-c68f5c73.js";import"./useDidUpdate-f978eb31.js";import"./useUncertainRef-5b5ab7e8.js";import"./chainedFunction-070f832c.js";import"./slicedToArray-0f5c9dec.js";import"./objectWithoutProperties-8809bfcf.js";import"./toConsumableArray-003b7048.js";import"./mapCloneElement-9cb2dda4.js";import"./index.esm-785e2bc5.js";import"./index.esm-e1d89ef7.js";/* empty css              */import"./_getPrototype-6bd7c339.js";import"./index-1b514f01.js";import"./index-ebde62fa.js";const k="crmLeadDetails",Be={total:0,pageIndex:1,pageSize:10,query:"",sort:{order:"",key:""}},$e={loading:!0,lead:{},addForm:!1,dialogMode:"",selectedNote:{},deleteConfirmation:!1,tableData:Be},C=F(`${k}/getLeadById`,async e=>{var t,a;try{return await ie(e)}catch(o){throw new Error((a=(t=o==null?void 0:o.response)==null?void 0:t.data)==null?void 0:a.message)}}),ze=F(`${k}/getNotes`,async e=>{var t,a;try{return(await re(e)).data}catch(o){throw new Error((a=(t=o==null?void 0:o.response)==null?void 0:t.data)==null?void 0:a.message)}}),Oe=F(`${k}/editNotes`,async({id:e,formData:t})=>{var a,o;try{return console.log("data",t),(await ae(e,t)).data}catch(p){throw new Error((o=(a=p==null?void 0:p.response)==null?void 0:a.data)==null?void 0:o.message)}}),qe=F(`${k}/deleteNote`,async e=>{var t,a;try{return(await le(e)).data}catch(o){throw new Error((a=(t=o==null?void 0:o.response)==null?void 0:t.data)==null?void 0:a.message)}}),U=J({name:`${k}/state`,initialState:$e,reducers:{toggleAddForm:(e,t)=>{e.addForm=t.payload},setSelectedNote:(e,t)=>{e.selectedNote=t.payload},setDialogMode:(e,t)=>{e.dialogMode=t.payload},toggleDeleteConfirmation:(e,t)=>{e.deleteConfirmation=t.payload}},extraReducers:e=>{e.addCase(C.fulfilled,(t,a)=>{var o,p,d,r;t.loading=!1,t.lead=a==null?void 0:a.payload.data,t.tableData.total=(r=(d=(p=(o=a.payload)==null?void 0:o.data)==null?void 0:p.data)==null?void 0:d.relatedTaskList)==null?void 0:r.length}).addCase(C.pending,t=>{t.loading=!0})}}),{toggleAddForm:M,setSelectedNote:H,setDialogMode:G,toggleDeleteConfirmation:R}=U.actions,Pe=U.reducer,Re=Q({data:Pe}),b=Z,Ye=Ce({notes:Le().required("Notes is required")}),We=()=>{var u;const e=T(),t=$(n=>{var i;return(i=n==null?void 0:n.crmLeadDetails)==null?void 0:i.data}),[a,o]=v.useState([]),p=$(n=>{var i,c,g;return(g=(c=(i=n.crmLeadDetails)==null?void 0:i.data)==null?void 0:c.lead)==null?void 0:g.data}),d=$(n=>n.crmLeadDetails.data.addForm);_.length=0,a==null||a.forEach(n=>{_.push({value:n.id,label:n.moduleName})});const r=()=>{e(M(!1))};return s.jsx("div",{children:s.jsx(ne,{isOpen:d,onClose:r,children:s.jsx(De,{validationSchema:Ye,initialValues:{notes:(t==null?void 0:t.dialogMode)==="Edit"?(u=t.selectedNote)==null?void 0:u.notes:""},onSubmit:async n=>{var f,w,x,l,m,j,L;let i="",c="",g="";const h={notes:n.notes,masterId:"4",modelDataId:p==null?void 0:p.id};if((t==null?void 0:t.dialogMode)==="Edit"&&t.selectedNote){const y=(f=t==null?void 0:t.selectedNote)==null?void 0:f.id,N=await e(Oe({id:y,formData:h}));(w=N==null?void 0:N.payload)!=null&&w.success?(i="Successfully Edited",c=(x=N==null?void 0:N.payload)==null?void 0:x.message,g="success"):(i="Something went wrong !!!",c=(l=N==null?void 0:N.error)==null?void 0:l.message,g="danger")}else{const y=await e(ze(h));(m=y==null?void 0:y.payload)!=null&&m.success?(i="Successfully Added",c=(j=y==null?void 0:y.payload)==null?void 0:j.message,g="success"):(i="Something went wrong !!!",c=(L=y==null?void 0:y.error)==null?void 0:L.message,g="danger")}S.push(s.jsx(A,{title:i,type:g,duration:2500,children:c}),{placement:"top-end"}),e(M(!1)),e(C(p==null?void 0:p.id))},children:({touched:n,errors:i,values:c,setFieldValue:g})=>s.jsx(Ne,{children:s.jsx(xe,{layout:"inline",children:s.jsxs("div",{className:"w-full custom-scrollbar",style:{maxHeight:"75vh",overflowY:"auto"},children:[s.jsxs("div",{className:"mb-10",children:[s.jsxs("h5",{className:"mb-4",children:[" ",(t==null?void 0:t.dialogMode)==="Add"?"Add Notes":"Edit Notes"]}),s.jsx(fe,{layout:"vertical",label:"Notes",invalid:i.notes&&n.notes,errorMessage:i.notes,children:s.jsx(we,{textArea:!0,placeholder:"Notes",name:"notes",component:me})})]}),s.jsx(ve,{name:"tags",children:({form:h,remove:f,push:w})=>s.jsx("div",{children:s.jsx("div",{children:s.jsx(Y,{type:"submit",variant:"solid",children:(t==null?void 0:t.dialogMode)==="Add"?"Add":"Edit"})})})})]})})})})})})},D=({title:e,value:t})=>{const o=(d,r)=>d.length>r?`${d.slice(0,r)}
${o(d.slice(r),r)}`:d,p=t.length>80?o(t,80):t;return s.jsxs("div",{children:[s.jsx("span",{children:e}),s.jsx("p",{className:"text-gray-700 dark:text-gray-200 font-semibold mb-4",style:{maxWidth:"500px",wordWrap:"break-word"},children:p})]})},_e=e=>{const t=T(),[a,o]=v.useState(!1),p=ee(),d=()=>{o(!1)},r=()=>{o(!0)},u=Ae(i=>{var c,g;return(g=(c=i.crmLeads)==null?void 0:c.data)==null?void 0:g.selectedLeads}),n=async()=>{var c,g,h;o(!1);const i=await t(Te(u.id));await t(K()),(c=i==null?void 0:i.payload)!=null&&c.success?(S.push(s.jsx(A,{title:"Successfuly Deleted",type:"success",duration:2500,children:(g=i==null?void 0:i.payload)==null?void 0:g.message}),{placement:"top-end"}),p("/app/crm/leads"),t(ke({}))):S.push(s.jsx(A,{title:"Something Went Wrong !!!",type:"danger",duration:2500,children:(h=i==null?void 0:i.error)==null?void 0:h.message}),{placement:"top-end"}),await t(K()),await t(Ee())};return s.jsxs(s.Fragment,{children:[s.jsx(Y,{size:"xs",onClick:r,block:!0,variant:"solid",children:s.jsx(Se,{className:"text-sm"})}),s.jsx(X,{isOpen:a,type:"danger",title:"Delete Lead",confirmButtonColor:"red-600",onClose:d,onRequestClose:d,onCancel:d,onConfirm:n,children:s.jsx("p",{children:"Are you sure you want to delete this Lead? All record related to this Lead will be deleted as well. This action cannot be undone."})})]})},Ke=e=>{var a,o;const t=[e.address,(a=e.cityData)==null?void 0:a.cityName,(o=e.stateData)==null?void 0:o.stateName,e.zipcode].filter(Boolean).join(", ");return t.length>0?t:"Location not provided"},He=({data:e={}})=>{var t,a,o,p,d,r,u,n,i;return s.jsx(he,{className:"h-full",children:s.jsxs("div",{className:"flex flex-col xl:flex-row ",children:[s.jsxs("div",{className:"grid grid-cols-3  wrap-data w-full",children:[(e==null?void 0:e.title)&&s.jsx("div",{children:s.jsx(D,{title:"Title",value:e==null?void 0:e.title})}),e.budget&&s.jsx("div",{children:s.jsx(D,{title:"Budget",value:e.budget})}),((t=e==null?void 0:e.contactData)==null?void 0:t.firstName)&&s.jsx("div",{children:s.jsx(D,{title:"Contact Name",value:(a=e==null?void 0:e.contactData)==null?void 0:a.firstName})}),(e==null?void 0:e.email)&&s.jsx("div",{children:s.jsx(D,{title:"Email",value:e==null?void 0:e.email})}),((o=e==null?void 0:e.contactData)==null?void 0:o.email)&&s.jsx("div",{children:s.jsx(D,{title:"Contact Email",value:e.contactData.email})}),(e==null?void 0:e.contactNumber)&&s.jsx("div",{children:s.jsx(D,{title:"Contact Number",value:e.contactNumber})}),(((p=e==null?void 0:e.contactData)==null?void 0:p.address)||((d=e==null?void 0:e.contactData)==null?void 0:d.cityData)||((r=e==null?void 0:e.contactData)==null?void 0:r.stateData)||((u=e==null?void 0:e.contactData)==null?void 0:u.zipcode))&&s.jsx("div",{children:s.jsx(D,{title:"Contact Address",value:Ke(e==null?void 0:e.contactData)})}),(e==null?void 0:e.status)&&s.jsx("div",{children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("span",{className:"font-semibold",children:"Status:"}),s.jsx("div",{className:"ml-2",children:s.jsx(P,{status:e==null?void 0:e.status})})]})}),(e==null?void 0:e.reason)&&s.jsx("div",{children:s.jsx(D,{title:"Reason",value:e==null?void 0:e.reason})}),((n=e==null?void 0:e.tags)==null?void 0:n.length)>0&&s.jsxs("div",{children:[s.jsx(D,{title:"Tags",value:""}),s.jsx(be,{fullDisplay:!0,tags:e==null?void 0:e.tags})]}),((i=e==null?void 0:e.leadFields)==null?void 0:i.length)>0&&e.leadFields.map((c,g)=>c.value?s.jsx("div",{children:s.jsx(D,{title:c==null?void 0:c.name,value:c.value})},g):null)]}),s.jsx("div",{className:"w-10",children:s.jsx(_e,{data:e})})]})})},Ge=()=>{const e=T(),t=b(r=>{var u,n,i;return(i=(n=(u=r.crmLeadDetails)==null?void 0:u.data)==null?void 0:n.lead)==null?void 0:i.data}),a=b(r=>{var u,n;return(n=(u=r.crmLeadDetails)==null?void 0:u.data)==null?void 0:n.deleteConfirmation}),o=b(r=>{var u;return(u=r==null?void 0:r.crmLeadDetails)==null?void 0:u.data}),p=()=>{e(R(!1))},d=async()=>{var u,n,i,c,g;e(R(!1)),console.log("jh===d",(u=o==null?void 0:o.selectedNote)==null?void 0:u.id);const r=await e(qe((n=o==null?void 0:o.selectedNote)==null?void 0:n.id));await e(C(t==null?void 0:t.id)),console.log("wdwd",r),(i=r==null?void 0:r.payload)!=null&&i.success?S.push(s.jsx(A,{title:"Successfuly Deleted",type:"success",duration:2500,children:(c=r==null?void 0:r.payload)==null?void 0:c.message}),{placement:"top-end"}):S.push(s.jsx(A,{title:"Something Went Wrong !!!",type:"danger",duration:2500,children:(g=r==null?void 0:r.error)==null?void 0:g.message}),{placement:"top-end"}),await e(C(t==null?void 0:t.id))};return s.jsx(X,{isOpen:a,type:"danger",title:"Delete Note",confirmButtonColor:"red-600",onClose:p,onRequestClose:p,onCancel:p,onConfirm:d,children:s.jsx("p",{children:"Are you sure you want to delete this Note? This action cannot be undone."})})};V("crmTasks",Ie);const Ve=()=>{const e=T(),t=E(x=>{var l,m,j,L;return(L=(j=(m=(l=x.crmLeadDetails)==null?void 0:l.data)==null?void 0:m.lead)==null?void 0:j.data)==null?void 0:L.relatedTaskList}),a=E(x=>{var l,m;return(m=(l=x.crmLeadDetails)==null?void 0:l.data)==null?void 0:m.loading}),o=E(x=>{var l,m;return(m=(l=x.crmLeadDetails)==null?void 0:l.data)==null?void 0:m.tableData}),{pageIndex:p,pageSize:d,sort:r,query:u,total:n}=E(x=>{var l,m;return(m=(l=x.crmLeadDetails)==null?void 0:l.data)==null?void 0:m.tableData}),i=v.useCallback(()=>{e(Me())},[e]);v.useEffect(()=>(i(),()=>{window.location.pathname.includes("lead")||e(I({...o,query:""}))}),[i]);const c=v.useMemo(()=>({pageIndex:p,pageSize:d,sort:r,query:u,total:n}),[p,d,r,u,n]),g=v.useMemo(()=>[{header:"Title",accessorKey:"title",cell:l=>{const m=l.row.original.title;return s.jsx(pe,{title:m,children:s.jsx(z,{text:m,maxLength:20})},m)}},{header:"Due Date",accessorKey:"dueDate",cell:l=>{var m;return Fe((m=l.row.original)==null?void 0:m.dueDate).format("DD MMMM YYYY")}},{header:"priority",accessorKey:"priority",cell:l=>{const m=l.row.original.priority;return s.jsx(P,{status:m})}},{header:"module",accessorKey:"module",cell:l=>{var j;const m=(j=l.row.original)==null?void 0:j.module;return m?s.jsx(z,{text:m,maxLength:20}):"-"}},{header:"type",accessorKey:"type",cell:l=>{var j;const m=(j=l.row.original)==null?void 0:j.type;return m?s.jsx(z,{text:m,maxLength:20}):"-"}},{header:"Status",accessorKey:"completionStatus",cell:l=>{const m=l.row.original.completionStatus;return s.jsx(P,{status:m})}}],[]),h=x=>{const l=O(c);l.pageIndex=x,e(I(l))},f=x=>{const l=O(c);l.pageSize=Number(x),l.pageIndex=1,e(I(l))},w=x=>{const l=O(c);l.sort=x,e(I(l))};return s.jsx("div",{children:s.jsx(ce,{columns:g,data:t,skeletonAvatarColumns:[0],skeletonAvatarProps:{width:28,height:28},loading:a,pagingData:{total:c.total,pageIndex:c.pageIndex,pageSize:c.pageSize},onPaginationChange:h,onSelectChange:f,onSort:w})})};V("crmLeadDetails",Re);const Bt=()=>{const e=T(),t=se(),{id:a}=t,o=b(h=>{var f,w;return(w=(f=h==null?void 0:h.crmLeadDetails)==null?void 0:f.data)==null?void 0:w.lead}),p=()=>{e(M(!0)),e(G("Add"))},d=o==null?void 0:o.data,r=b(h=>{var f;return(f=h==null?void 0:h.crmLeadDetails)==null?void 0:f.data.loading});v.useEffect(()=>{u()},[]);const u=async()=>{a&&e(C(a))},n=()=>{window.history.back()},i=q("leads","canModify");q("leads","canDelete"),q("leads","canCreate");const c=h=>{e(M(!0)),e(H(h)),e(G("Edit"))},g=h=>{e(H(h)),e(R(!0))};return console.log("leads data",{data:d}),s.jsxs(s.Fragment,{children:[s.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",marginBottom:"15px"},children:[s.jsx("span",{className:"cursor-pointer hover:text-indigo-500 items-center lg mr-2 mt-0",style:{fontSize:"2.5rem",fontWeight:"bold",color:"black"},onClick:n,children:s.jsx(ye,{})}),s.jsx("h3",{children:"Lead Details"})]}),s.jsxs(oe,{className:"h-full",children:[s.jsxs(te,{loading:r,children:[!W(d)&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"grid grid-cols-3 lg:grid-cols-4 gap-4 mt-2",children:[s.jsx("div",{className:"col-span-3",children:s.jsx(He,{data:d})}),s.jsxs(B,{className:"col-span-1",children:[s.jsx("h5",{children:"Lead Activity"}),s.jsx(ue,{activity:(d==null?void 0:d.leadsActivity)||[]})]})]}),s.jsxs("div",{className:"grid grid-cols-3 lg:grid-cols-3 gap-4 mt-2",children:[s.jsxs(B,{className:"col-span-1",children:[s.jsxs("div",{className:"flex justify-between mb-2",children:[s.jsx("h5",{children:"Notes"}),i&&s.jsx(Y,{size:"xs",type:"button",className:"!px-2 !text-lg",onClick:p,children:s.jsx(je,{})})]}),s.jsx(ge,{notes:(d==null?void 0:d.leadNotes)||[],canEdit:i,onEdit:c,onDelete:g})]}),s.jsxs(B,{className:"col-span-2",children:[s.jsx("h4",{className:"mb-3",children:"Connected Tasks"}),s.jsx(Ve,{})]})]})]}),s.jsx(We,{}),s.jsx(Ge,{})]}),!r&&W(d)&&s.jsxs("div",{className:"h-full flex flex-col items-center justify-center",children:[s.jsx(de,{src:"/img/others/img-2.png",darkModeSrc:"/img/others/img-2-dark.png",alt:"No user found!"}),s.jsx("h3",{className:"mt-8",children:"No user found!"})]})]})]})};export{Bt as default};
