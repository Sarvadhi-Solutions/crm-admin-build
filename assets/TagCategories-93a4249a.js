import{r as j,a as v,j as e,ah as ye,aq as Ce}from"./index-fbc41bca.js";import{u as te}from"./useThemeClass-5e964515.js";import"./Card-a984a9d2.js";import"./Views-74c35fff.js";import{B as fe}from"./Badge-c4738e93.js";import"./chart.constant-45b26ac6.js";import"./GrowShrinkTag-3901d0dd.js";import{aa as Ne,ab as Te,ac as be,O as se,P as oe}from"./index.esm-249f55e6.js";import"./index-93d69c00.js";import{B as E}from"./Button-b2784eff.js";import{D as L}from"./Dialog-698d3c27.js";import{T as Se}from"./DataTable-81da75d2.js";import{I as P}from"./Input-152b7d8e.js";import"./Skeleton-e4ab4cd4.js";import"./react-tooltip.min-7c63beba.js";import"./RichTextEditor-04904e71.js";import"./SegmentItemOption-0494f468.js";import"./SvgIcon-fc4d5dc0.js";import{T as ve}from"./Tooltip-3c083409.js";import{T as B}from"./index-0f02b5a2.js";import{u as re,f as R,g as ie,e as we,d as Fe}from"./index-14973a88.js";import"./Alert-dec0f5a9.js";import"./RangeCalendar-50b42c63.js";import"./index-d1bc18ac.js";import"./index-b851f1b1.js";import"./Drawer-2fab53f7.js";import{a as De}from"./index-07c5cb44.js";import{F as U,a as I}from"./FormItem-c1e0aacf.js";import"./toString-c87cf3c7.js";import"./index-51c649a4.js";import"./index-f693cd27.js";import"./index-ac4b27b3.js";import{t as D,N as M}from"./toast-6fd95cf6.js";import{P as Me}from"./Pagination-c4a67f5b.js";import"./Progress-6196de97.js";import"./index-5c598bd5.js";import"./ScrollBar-6e830de1.js";import"./index-4c96de49.js";import{S as ne}from"./Select-9a27bfb3.js";import"./index-9d9f773a.js";import"./Switcher-944850e3.js";import"./index-a48c7a7d.js";import"./Tag-9a7f4253.js";import"./index-1581cc49.js";import"./index-2e495e14.js";import"./Upload-993d0ac6.js";import{F as Y,a as _,b as A,c as Ie,g as J}from"./formik.esm-398239d1.js";import{c as q,a as w,e as ke}from"./index.esm-bb7c93ab.js";import{u as f,e as Ee,t as z,g as k,T as Ae,a as V,d as Re,m as F,c as qe,b as K,f as le,h as $e,i as Be,j as $,s as O,k as ce,l as Q,n as W,o as Oe,p as X,r as He}from"./TagCategoryDetailsForm-82253df6.js";import{C as de}from"./ConfirmDialog-f881e0b1.js";import{c as Z}from"./cloneDeep-f5c45100.js";import{u as Pe}from"./checkEditUpdate-cc27538c.js";import{d as ze}from"./index.esm-1e42ead4.js";const Ve=q().shape({categoryName:w().required("Field is required")}),me=j.forwardRef((r,d)=>{var c;const l=v(),m=f(o=>o.crmTagCategories.data.formToggle),h=()=>{l(z(!1))},a=f(o=>o.crmTagCategories.data.selectedTagCategory);return e.jsx(L,{isOpen:m,onClose:h,children:e.jsx(Y,{innerRef:d,initialValues:{categoryName:(a==null?void 0:a.categoryName)||"",master:((c=a==null?void 0:a.master)==null?void 0:c.id)||"",tags:(a==null?void 0:a.tags)||[]},validationSchema:Ve,onSubmit:async(o,{setSubmitting:s})=>{var p,T,C,b;s(!1);const t={...o,masterId:o==null?void 0:o.master,tagId:((p=o==null?void 0:o.tags)==null?void 0:p.map(S=>S==null?void 0:S.id))||[]};delete t.master,delete t.tags;const n=await l(Ee({tagCategoryId:(a==null?void 0:a.id)||"",updatedData:t}));let u="",y="",N="";(T=n==null?void 0:n.payload)!=null&&T.success?(u="Successfully Update",y=(C=n==null?void 0:n.payload)==null?void 0:C.message,N="success"):(u="Something went wrong !!!",y=(b=n==null?void 0:n.error)==null?void 0:b.message,N="danger"),D.push(e.jsx(M,{title:u,type:N,duration:2500,children:y}),{placement:"top-end"}),l(z(!1)),await l(k())},children:({touched:o,errors:s,values:t,setFieldValue:n})=>e.jsx(_,{children:e.jsx(U,{children:e.jsx(Ae,{touched:o,errors:s,values:t,setFieldValue:n})})})})})});me.displayName="TagCategoryForm";const Ke=()=>{const r=v(),d=f(a=>a.crmTagCategories.data.deleteConfirmation),l=f(a=>a.crmTagCategories.data.selectedTagCategory),m=()=>{r(V(!1))},h=async()=>{var c,o,s;r(V(!1));const a=await r(Re(l.id));(c=a==null?void 0:a.payload)!=null&&c.success?D.push(e.jsx(M,{title:"Successfuly Deleted",type:"success",duration:2500,children:(o=a==null?void 0:a.payload)==null?void 0:o.message}),{placement:"top-end"}):D.push(e.jsx(M,{title:"Something Went Wrong !!!",type:"danger",duration:2500,children:(s=a==null?void 0:a.error)==null?void 0:s.message}),{placement:"top-end"}),await r(k())};return e.jsx(de,{isOpen:d,type:"danger",title:"Delete Tag Category",confirmButtonColor:"red-600",onClose:m,onRequestClose:m,onCancel:m,onConfirm:h,children:e.jsx("p",{children:"Are you sure you want to delete this Tag Category? All record related to this tag category will be deleted as well. This action cannot be undone."})})},ge=({field:r})=>{const d=["#FF5733","#33FF57","#5733FF","#FFFF33","#33FFFF","#FF33FF","#FF3366","#FF6666","#6699FF"],[l,m]=j.useState(!1),h=()=>{m(!l)},a=c=>{const o={target:{name:r.name,value:c}};r.onChange(o),m(!1)};return e.jsxs("div",{style:{position:"relative",display:"inline-block",top:"9px"},children:[e.jsx("div",{style:{width:"30px",height:"30px",backgroundColor:r.value,border:"1px solid #000",borderRadius:"50%"},onClick:h}),l&&e.jsx("div",{className:"absolute",children:e.jsx(De,{className:"grid grid-cols-3 gap-1 hover mt-1 custom-scrollbar",children:d.map((c,o)=>e.jsx("div",{style:{width:"30px",height:"30px",backgroundColor:c,margin:"5px",cursor:"pointer",borderRadius:"50%",transition:"background 0.3s ease",border:r.value===c?"1px solid #000":"none"},onClick:()=>a(c)},o))})})]})};const We=q({categoryName:w().required("Category Name is required"),masterId:w().required("This field is required").test("is-valid-module","Invalid module selected",r=>!!F.find(d=>d.value==r)),tags:ke().of(q().shape({tagName:w().required("Name required"),colorName:w().required("Color required")}))}),ee=(r,d)=>{const l=J(r.errors,d),m=J(r.touched,d);return{errorMessage:l||"",invalid:typeof m>"u"?!1:l&&m}},Le=()=>{const r=v(),[d,l]=j.useState([]);j.useEffect(()=>{(async()=>{var o;const c=await r(le());l((o=c==null?void 0:c.payload)==null?void 0:o.data)})()},[r]),F.length=0,d==null||d.forEach(a=>{F.push({value:a.id,label:a.moduleName})});const m=f(a=>a.crmTagCategories.data.addForm),h=()=>{r(K(!1))};return e.jsx("div",{children:e.jsx(L,{isOpen:m,onClose:h,children:e.jsx(Y,{validationSchema:We,initialValues:{tags:[{tagName:"",colorName:""}],categoryName:"",masterId:""},onSubmit:async a=>{var n,u,y;let c="",o="",s="";const t=await r(qe(a));(n=t==null?void 0:t.payload)!=null&&n.success?(c="Successfully Added",o=(u=t==null?void 0:t.payload)==null?void 0:u.message,s="success"):(c="Something went wrong !!!",o=(y=t==null?void 0:t.error)==null?void 0:y.message,s="danger"),D.push(e.jsx(M,{title:c,type:s,duration:2500,children:o}),{placement:"top-end"}),r(K(!1)),await r(k())},children:({touched:a,errors:c,values:o,setFieldValue:s})=>{const t=o.tags;return e.jsx(_,{children:e.jsx(U,{layout:"inline",children:e.jsxs("div",{className:"w-full custom-scrollbar",style:{maxHeight:"75vh",overflowY:"auto"},children:[e.jsxs("div",{className:"mb-10",children:[e.jsx("h5",{className:"mb-4",children:"Add Tag Category"}),e.jsx(I,{layout:"vertical",label:"Category Name",invalid:c.categoryName&&a.categoryName,errorMessage:c.categoryName,children:e.jsx(A,{placeholder:"Category Name",name:"categoryName",component:P})}),e.jsx(I,{layout:"vertical",label:"Module Name",invalid:c.masterId&&a.masterId,errorMessage:c.masterId,children:e.jsx(ne,{name:"masterId",placeholder:"Module Name",options:F,id:"masterId",value:F.find(n=>(n==null?void 0:n.value)==(o==null?void 0:o.masterId)),onChange:n=>{const u=n.value;s("masterId",u||"")}})})]}),e.jsx(Ie,{name:"tags",children:({form:n,remove:u,push:y})=>e.jsxs("div",{children:[t&&t.length>0?t.map((N,p)=>{const T=ee(n,`tags[${p}].tagName`),C=ee(n,`tags[${p}].colorName`);return e.jsxs("div",{children:[e.jsx(I,{label:"Name",invalid:T.invalid,errorMessage:T.errorMessage,children:e.jsx(A,{invalid:T.invalid,placeholder:"Tag Name",name:`tags[${p}].tagName`,type:"text",component:P})}),e.jsx(I,{invalid:C.invalid,children:e.jsx(A,{invalid:C.invalid,placeholder:"Color",name:`tags[${p}].colorName`,render:({field:b})=>e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:0},children:[e.jsx(ge,{field:b}),C.invalid&&e.jsx("div",{style:{marginTop:15,marginLeft:5,color:"red"},children:C.errorMessage})]})})}),e.jsx(E,{shape:"circle",size:"sm",icon:e.jsx(Ne,{}),onClick:()=>u(p)})]},p)}):null,e.jsxs("div",{children:[e.jsx(E,{type:"button",className:"ltr:mr-2 rtl:ml-2",onClick:()=>{y({tagName:"",colorName:""})},children:"Add tags"}),e.jsx(E,{type:"submit",variant:"solid",children:"Submit"})]})]})})]})})})}})})})},Ue=q({tagName:w().required("Tag Name is required"),colorName:w().required("Color required")}),ue=()=>{const r=v(),[d,l]=j.useState([]);j.useEffect(()=>{(async()=>{var n;const t=await r(le());l((n=t==null?void 0:t.payload)==null?void 0:n.data)})()},[r]),F.length=0,d==null||d.forEach(s=>{F.push({value:s.id,label:s.moduleName})});const m=f(s=>s.crmTagCategories.data.editForm),h=f(s=>{var t,n;return(n=(t=s==null?void 0:s.crmTagCategories)==null?void 0:t.data)==null?void 0:n.dialogMode}),a=f(s=>s.crmTagCategories.data.selectedTag),c=()=>{r($(!1))},o=f(s=>s.crmTagCategories.data.selectedTagCategory);return e.jsx("div",{children:e.jsx(L,{isOpen:m,onClose:c,children:e.jsx(Y,{validationSchema:Ue,initialValues:{tagName:h==="Edit"?a==null?void 0:a.tagName:"",colorName:h==="Edit"?a==null?void 0:a.colorName:"",masterId:h==="Edit"?a==null?void 0:a.masterId:""},onSubmit:async s=>{var N,p,T,C,b,S;let t="",n="",u="";const y={...s};if(h==="Add"){const g=await r($e({masterId:o==null?void 0:o.masterId,tagName:s==null?void 0:s.tagName,colorName:s==null?void 0:s.colorName,tagCategoryId:o==null?void 0:o.id}));(N=g==null?void 0:g.payload)!=null&&N.success?(t="Successfully Added",n=(p=g==null?void 0:g.payload)==null?void 0:p.message,u="success"):(t="Something went wrong !!!",n=(T=g==null?void 0:g.error)==null?void 0:T.message,u="danger")}else{const g=await r(Be({tagId:(a==null?void 0:a.id)||"",data:y}));(C=g==null?void 0:g.payload)!=null&&C.success?(t="Successfully Added",n=(b=g==null?void 0:g.payload)==null?void 0:b.message,u="success"):(t="Something went wrong !!!",n=(S=g==null?void 0:g.error)==null?void 0:S.message,u="danger")}D.push(e.jsx(M,{title:t,type:u,duration:2500,children:n}),{placement:"top-end"}),r($(!1)),await r(k())},children:({touched:s,errors:t,values:n,setFieldValue:u})=>e.jsx(_,{children:e.jsx(U,{layout:"inline",children:e.jsxs("div",{className:"w-full custom-scrollbar",style:{maxHeight:"75vh",overflowY:"auto"},children:[e.jsx("div",{className:"mb-10",children:e.jsx("h5",{className:"mb-4",children:h==="Edit"?"Edit Tag Category":"Add Tag Category"})}),e.jsx(I,{label:"Name",invalid:t.tagName&&s.tagName,errorMessage:t.tagName,children:e.jsx(A,{placeholder:"Tag Name",name:"tagName",type:"text",component:P})}),e.jsx(I,{invalid:t.colorName&&s.colorName,children:e.jsx(A,{invalid:t.colorName&&s.colorName,placeholder:"Color",name:"colorName",render:({field:y})=>e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:0},children:[e.jsx(ge,{field:y}),t.colorName&&e.jsx("div",{style:{marginTop:15,marginLeft:5,color:"red"},children:t.colorName})]})})}),e.jsx("div",{children:e.jsx(E,{type:"submit",variant:"solid",children:"Submit"})})]})})})})})})},{Tr:H,Th:Ye,Td:_e,THead:Ge,TBody:Je}=B,Qe=({renderRowSubComponent:r,getRowCanExpand:d})=>{const l=v(),m=({row:i})=>{te();const x=()=>{l(z(!0)),l(O(i))},G=async()=>{await l(O(i)),l(V(!0))},je=async()=>{l(ce("Add")),l($(!0)),l(O(i))};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex text-base items-center",children:[e.jsx(ve,{title:"Add Tag",children:e.jsx("button",{className:" cursor-pointer circle items-center hover:text-green-500 mr-1",onClick:je,children:e.jsx(ze,{})})}),e.jsx("button",{className:" cursor-pointer circle items-center hover:text-blue-500 ",onClick:x,children:e.jsx(se,{})}),e.jsx("span",{className:"cursor-pointer hover:text-red-500 mx-1 circle items-center",onClick:G,children:e.jsx(oe,{})})]})})},h=[10,25,50,100],a=f(i=>i.crmTagCategories.data.displayedTagCategoriesList),c=f(i=>i.crmTagCategories.data.loading),{pageIndex:o,pageSize:s,sort:t,query:n,total:u}=f(i=>i.crmTagCategories.data.tableData),y=j.useMemo(()=>({pageIndex:o,pageSize:s,sort:t,query:n,total:u}),[o,s,t,n,u]),N=j.useMemo(()=>[{header:()=>null,id:"expander",cell:({row:i})=>e.jsx(e.Fragment,{children:i.getCanExpand()?e.jsx("button",{className:"text-lg",onClick:i.getToggleExpandedHandler(),children:i.getIsExpanded()?e.jsx(Te,{}):e.jsx(be,{})}):null}),subCell:()=>null},{header:"Actions",id:"action",cell:i=>e.jsx(m,{row:i.row.original})},{header:"Category Name",accessorKey:"categoryName"},{header:"Module Name",accessorKey:"master.moduleName"},{header:"Created By",accessorKey:"createdBy"}],[]),[p,T]=j.useState(a),C=j.useMemo(()=>h.map(i=>({value:i,label:`${i} / page`})),[h]);j.useEffect(()=>{const i=a==null?void 0:a.map(x=>({...x,subRows:x.tags}));T(i)},[a]);const b=re({data:p,columns:N,getRowCanExpand:d,getCoreRowModel:ie(),getExpandedRowModel:we(),manualPagination:!0,manualSorting:!0}),S=i=>{const x=Z(y);x.pageIndex=i,l(Q(x))},g=i=>{const x=Z(y);x.pageSize=Number(i),x.pageIndex=1,l(Q(x))},he=i=>{c||g==null||g(Number(i))},pe=i=>{c||S==null||S(i)};Pe("tagcategory","canCreate");const xe=()=>{l(K(!0))};return e.jsxs(e.Fragment,{children:[e.jsxs(ye,{loading:c&&(p==null?void 0:p.length)!==0,type:"cover",children:[e.jsx("div",{className:"md:flex items-center justify-end",children:e.jsx("div",{className:"mb-4",children:e.jsx(E,{size:"sm",onClick:xe,children:"Add New"})})}),e.jsxs(B,{children:[e.jsx(Ge,{children:b.getHeaderGroups().map(i=>e.jsx(H,{children:i.headers.map(x=>e.jsx(Ye,{colSpan:x.colSpan,children:R(x.column.columnDef.header,x.getContext())},x.id))},i.id))}),c&&(p==null?void 0:p.length)===0?e.jsx(Se,{columns:N==null?void 0:N.length,avatarInColumns:[0],avatarProps:{width:28,height:28}}):e.jsx(Je,{children:b.getRowModel().rows.map(i=>e.jsxs(j.Fragment,{children:[e.jsx(H,{children:i.getVisibleCells().map(x=>e.jsx("td",{children:R(x.column.columnDef.cell,x.getContext())},x.id))}),i.getIsExpanded()&&e.jsx(H,{children:e.jsx(_e,{colSpan:i.getVisibleCells().length,children:r({row:i})})})]},i.id))})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx(Me,{pageSize:s,currentPage:o,total:u,onChange:pe}),e.jsx("div",{style:{minWidth:130},children:e.jsx(ne,{size:"sm",menuPlacement:"top",isSearchable:!1,value:C==null?void 0:C.filter(i=>i.value===s),options:C,onChange:i=>he(i==null?void 0:i.value)})})]})]}),e.jsx(Ke,{}),e.jsx(me,{}),e.jsx(Le,{}),e.jsx(ue,{})]})},Xe=()=>{const r=v(),d=f(a=>a.crmTagCategories.data.deleteSubTagConfirmation),l=f(a=>a.crmTagCategories.data.selectedTag),m=()=>{r(W(!1))},h=async()=>{var c,o,s;r(W(!1));const a=await r(Oe(l.id));(c=a==null?void 0:a.payload)!=null&&c.success?D.push(e.jsx(M,{title:"Successfuly Deleted",type:"success",duration:2500,children:(o=a==null?void 0:a.payload)==null?void 0:o.message}),{placement:"top-end"}):D.push(e.jsx(M,{title:"Something Went Wrong !!!",type:"danger",duration:2500,children:(s=a==null?void 0:a.error)==null?void 0:s.message}),{placement:"top-end"}),await r(k())};return e.jsx(de,{isOpen:d,type:"danger",title:"Delete Tag",confirmButtonColor:"red-600",onClose:m,onRequestClose:m,onCancel:m,onConfirm:h,children:e.jsx("p",{children:"Are you sure you want to delete this Tag? All record related to this tag will be deleted as well. This action cannot be undone."})})},{Tr:ae,Th:Ze,Td:ea,THead:aa,TBody:ta,Sorter:sa}=B,oa=({row:r})=>{te();const d=()=>{l(ce("Edit")),l($(!0)),l(X(r))},l=v(),m=async()=>{await l(X(r)),await l(W(!0))};return e.jsxs("div",{className:"flex text-base items-center",children:[e.jsx("button",{className:"circle items-center hover:text-blue-500",onClick:d,children:e.jsx(se,{})}),e.jsx("span",{className:"cursor-pointer hover:text-red-500 mx-1 circle items-center",onClick:m,children:e.jsx(oe,{})})]})},ra=r=>{const{tableData:d}=r,[l,m]=j.useState([]),[h,a]=j.useState(d),c=[{header:"Actions",id:"action",cell:s=>e.jsx(oa,{row:s.row.original})},{header:"Tag Name",accessorKey:"tagName"},{header:"Color",accessorKey:"colorName",cell:s=>{const t=s.row.original;return e.jsxs("div",{className:"flex items-center",children:[e.jsx(fe,{style:{backgroundColor:`${t.colorName}`}}),e.jsx("span",{className:"ml-2 rtl:mr-2 capitalize",children:t.colorName})]})}}];j.useEffect(()=>{a(d)},[d]);const o=re({data:h,columns:c,state:{sorting:l},onSortingChange:m,getCoreRowModel:ie(),getSortedRowModel:Fe()});return e.jsxs(e.Fragment,{children:[e.jsxs(B,{children:[e.jsx(aa,{children:o.getHeaderGroups().map(s=>e.jsx(ae,{children:s.headers.map(t=>e.jsx(Ze,{colSpan:t.colSpan,children:t.isPlaceholder?null:e.jsxs("div",{className:t.column.getCanSort()?"cursor-pointer select-none":"",onClick:t.column.getToggleSortingHandler(),children:[R(t.column.columnDef.header,t.getContext()),e.jsx(sa,{sort:t.column.getIsSorted()})]})},t.id))},s.id))}),e.jsx(ta,{children:o.getRowModel().rows.slice(0,10).map(s=>e.jsx(ae,{children:s.getVisibleCells().map(t=>e.jsx(ea,{children:R(t.column.columnDef.cell,t.getContext())},t.id))},s.id))})]}),e.jsx(Xe,{}),e.jsx(ue,{})]})},ia=({row:r})=>e.jsx("pre",{style:{fontSize:"10px"},children:e.jsx(ra,{tableData:r.original.tags})});Ce("crmTagCategories",He);const na=()=>{const r=v(),d=async()=>{await r(k())};return j.useEffect(()=>{d()},[r]),e.jsxs(e.Fragment,{children:[e.jsx("h5",{className:"mb-2",children:"Manage Tags"}),e.jsx(Qe,{renderRowSubComponent:ia,getRowCanExpand:()=>!0})]})},nt=na;export{nt as T};
