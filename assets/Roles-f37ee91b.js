import{a as v,r as w,j as e,u as ce,B as Ie,ar as Me}from"./index-2a02f09f.js";import{A as ke}from"./AdaptableCard-260ffff4.js";import{D as Fe}from"./DataTable-76c04f2c.js";import{u as he}from"./useThemeClass-d3572517.js";import{c as F}from"./cloneDeep-f2fd7982.js";import{f as Te,u as R,p as xe,s as V,a as Ae,b as $,c as Ee,g as S,t as q,d as Pe,e as z,h as ge,i as je,j as Ce,r as Ve}from"./index-62e98478.js";import{B as O}from"./Button-3d6c325f.js";import{D as ze}from"./Drawer-aa907a2f.js";import{i as Oe}from"./Views-597fd265.js";import{a as ie,F as qe}from"./FormItem-c05bb264.js";import{T as ye}from"./index-bb34e564.js";import{u as Be,b as me,F as $e,a as Le}from"./formik.esm-dba0dfcc.js";import{c as be,a as we}from"./index.esm-d97e517c.js";import"./Alert-72ccf787.js";import"./index-5ca6dc5a.js";import{B as Re}from"./Badge-ed31d9ee.js";import"./Calendar-10f7bbb4.js";import"./Card-de52f0bd.js";import{C as Ue}from"./index-33716023.js";import"./index-cd684465.js";import"./Dialog-fa942d86.js";import"./index-7d1fc360.js";import"./toString-8660963f.js";import{I as Ne}from"./Input-4032ba6b.js";import"./index-09081188.js";import"./index-7060438e.js";import"./index-39ff14cb.js";import{t as de,N as pe}from"./toast-66eca971.js";import"./Pagination-45470020.js";import"./Progress-225a8f75.js";import"./index-9590e8bb.js";import"./RangeCalendar-f83aa7d5.js";import"./ScrollBar-5f7786c3.js";import"./index-9436b2c1.js";import{S as Ye,c as He}from"./Select-e6a28a89.js";import"./Skeleton-a1c6070d.js";import"./index-94a50ac5.js";import"./Switcher-b6d1bfff.js";import"./index-ff9062dc.js";import"./Tag-592deaaf.js";import"./index-292be09a.js";import"./index-da0bddc3.js";import"./Tooltip-7716d794.js";import"./Upload-21ca1a8f.js";/* empty css              */import{a6 as ue,B as We,z as Je}from"./index.esm-c61f0406.js";import{p as T,q as A}from"./index.esm-4f607dea.js";import{C as Ke}from"./ConfirmDialog-5e3e2ca4.js";import{u as B}from"./checkEditUpdate-064a00c7.js";import{d as _e}from"./debounce-58c5e337.js";import"./TableRowSkeleton-f01debf2.js";import"./index-be1c4c56.js";import"./_Uint8Array-49dd6612.js";import"./_MapCache-dabc1c97.js";import"./_getPrototype-63f10215.js";import"./CrmService-dd365f26.js";import"./context-ccc0a902.js";import"./index-02c6e7a7.js";import"./CloseButton-1ba6d0ce.js";import"./index-30fffd86.js";import"./useControllableState-1afbd3cb.js";import"./useTimeout-90c2003f.js";import"./StatusIcon-19ebbef4.js";import"./useMergeRef-788c4cb0.js";import"./_baseIsEqual-d37b49c3.js";import"./get-c92f924e.js";import"./useRootClose-245ef2ef.js";import"./usePopper-1bbb94fb.js";import"./TimeInput-5e6b4bd8.js";import"./useUniqueId-5771e452.js";import"./useDidUpdate-63a48c56.js";import"./useUncertainRef-cde3ec19.js";import"./isNil-68e69365.js";import"./chainedFunction-070f832c.js";import"./toConsumableArray-648e2274.js";import"./objectWithoutPropertiesLoose-df62547b.js";import"./floating-ui.dom-bef9cea3.js";import"./mapCloneElement-80af996d.js";import"./index.esm-c0bac851.js";import"./index.esm-62b86c40.js";const E=({value:s,onClick:r,greenIcon:t,grayIcon:a,canPermission:n})=>e.jsx("td",{className:"px-4 py-2 text-center",children:e.jsx("div",{className:`${n?" border-blue-600":" border-red-300"} rounded-full p-2 cursor-pointer flex justify-center items-center`,onClick:r,children:n?t:a})}),Ge=s=>{const{roles:r,drawerMode:t,errors:a,touched:n}=s,o=v(),[m,c]=w.useState([]),[u,j]=w.useState([]),d=Be();w.useEffect(()=>{async function f(){var l;try{const h=await o(Te()),x=(l=h==null?void 0:h.payload)==null?void 0:l.data.map(g=>({masterId:g.id,canCreate:!1,canModify:!1,canView:!1,canDelete:!1,canManage:!1}));t==="Edit"&&r&&Array.isArray(r.rolePermissions)&&[...r.rolePermissions].sort((i,p)=>i.masterId-p.masterId).forEach(i=>{const p=x.findIndex(I=>I.masterId===i.masterId);p!==-1&&(x[p]=i)}),d.setFieldValue("modules",x),j(x),c(h.payload.data)}catch(h){console.error("Error fetching modules:",h)}}f()},[o]),be().shape({rolename:we().required("Role Name is required")});const N=(f,l,h,x)=>{const g=JSON.parse(JSON.stringify(d.values.modules));if(l!=="canManage")g[x][l]=h,g[x].canManage=g[x].canCreate&&g[x].canModify&&g[x].canView&&g[x].canDelete;else{const i={canManage:h,canCreate:h,canModify:h,canView:h,canDelete:h,masterId:f};g[x]=i}d.setFieldValue("modules",g)};return e.jsxs(e.Fragment,{children:[e.jsx(ie,{label:"Role Name",invalid:a.roleName&&n.roleName,errorMessage:a.roleName,children:e.jsx(me,{type:"text",autoComplete:"off",name:"roleName",placeholder:"Role Name",component:Ne,prefix:e.jsx(ue,{className:"text-xl"})})}),e.jsx(ie,{label:"System",children:e.jsx(me,{autoComplete:"off",name:"isSystem",placeholder:"System",component:Ue,checked:d.values.isSystem,prefix:e.jsx(ue,{className:"text-xl"})})}),e.jsxs("table",{className:"w-full border-collapse ",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-200",children:[e.jsx("th",{className:"px-4 py-2 text-center",children:"Module"}),e.jsx("th",{className:"px-4 py-2 w-1/6 text-center",children:"All"}),e.jsx("th",{className:"px-4 py-2 w-1/6 text-center",children:"Read"}),e.jsx("th",{className:"px-4 py-2 w-1/6 text-center",children:"Write"}),e.jsx("th",{className:"px-4 py-2 w-1/6 text-center",children:"Update"}),e.jsx("th",{className:"px-4 py-2 w-1/6 text-center",children:"Delete"})]})}),e.jsx("tbody",{children:m==null?void 0:m.map((f,l)=>{var h,x,g,i,p,I,P,M,k,D,L,U,Y,H,W,J,K,_,G,Q,X,Z,ee,se,te,ae,oe,re,le,ne;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2 text-center",children:f==null?void 0:f.moduleName.toUpperCase()}),e.jsx(E,{value:(g=(x=(h=d.values)==null?void 0:h.modules)==null?void 0:x[l])==null?void 0:g.canManage,greenIcon:e.jsx(T,{className:"text-blue-600"}),grayIcon:e.jsx(A,{className:"text-red-500"}),canPermission:(I=(p=(i=d.values)==null?void 0:i.modules)==null?void 0:p[l])==null?void 0:I.canManage,onClick:()=>{var C,y,b;return N(f.id,"canManage",!((b=(y=(C=d.values)==null?void 0:C.modules)==null?void 0:y[l])!=null&&b.canManage),l)}}),e.jsx(E,{value:(k=(M=(P=d.values)==null?void 0:P.modules)==null?void 0:M[l])==null?void 0:k.canView,greenIcon:e.jsx(T,{className:"text-blue-600"}),grayIcon:e.jsx(A,{className:"text-red-500"}),canPermission:(U=(L=(D=d.values)==null?void 0:D.modules)==null?void 0:L[l])==null?void 0:U.canView,onClick:()=>{var C,y,b;return N(f.id,"canView",!((b=(y=(C=d.values)==null?void 0:C.modules)==null?void 0:y[l])!=null&&b.canView),l)}}),e.jsx(E,{value:(W=(H=(Y=d.values)==null?void 0:Y.modules)==null?void 0:H[l])==null?void 0:W.canCreate,greenIcon:e.jsx(T,{className:"text-blue-600"}),grayIcon:e.jsx(A,{className:"text-red-500"}),canPermission:(_=(K=(J=d.values)==null?void 0:J.modules)==null?void 0:K[l])==null?void 0:_.canCreate,onClick:()=>{var C,y,b;return N(f.id,"canCreate",!((b=(y=(C=d.values)==null?void 0:C.modules)==null?void 0:y[l])!=null&&b.canCreate),l)}}),e.jsx(E,{value:(X=(Q=(G=d.values)==null?void 0:G.modules)==null?void 0:Q[l])==null?void 0:X.canModify,greenIcon:e.jsx(T,{className:"text-blue-600"}),grayIcon:e.jsx(A,{className:"text-red-500"}),canPermission:(se=(ee=(Z=d.values)==null?void 0:Z.modules)==null?void 0:ee[l])==null?void 0:se.canModify,onClick:()=>{var C,y,b;return N(f.id,"canModify",!((b=(y=(C=d.values)==null?void 0:C.modules)==null?void 0:y[l])!=null&&b.canModify),l)}}),e.jsx(E,{value:(oe=(ae=(te=d.values)==null?void 0:te.modules)==null?void 0:ae[l])==null?void 0:oe.canDelete,greenIcon:e.jsx(T,{className:"text-blue-600"}),grayIcon:e.jsx(A,{className:"text-red-500"}),canPermission:(ne=(le=(re=d.values)==null?void 0:re.modules)==null?void 0:le[l])==null?void 0:ne.canDelete,onClick:()=>{var C,y,b;return N(f.id,"canDelete",!((b=(y=(C=d.values)==null?void 0:C.modules)==null?void 0:y[l])!=null&&b.canDelete),l)}})]},l)})})]})]})},Qe=be().shape({rolename:we().required("Role Name is required")}),{TabNav:Xe,TabList:Ze,TabContent:es}=ye,De=w.forwardRef((s,r)=>{const[t,a]=w.useState([]);v();const n=ce(m=>m.crmRoles.data.selectedRole),o=ce(m=>m.crmRoles.data.drawerMode);return e.jsx($e,{innerRef:r,initialValues:{roleName:o==="Edit"&&(n==null?void 0:n.roleName)||"",isSystem:o==="Edit"&&(n==null?void 0:n.isSystem)||!1,isDefault:(n==null?void 0:n.isDefault)||!1,modules:t},validationSchema:Qe,onSubmit:(m,{setSubmitting:c})=>{console.log("on submit called "),c(!1)},children:({touched:m,errors:c})=>e.jsx(Le,{children:e.jsx(qe,{children:e.jsxs(ye,{defaultValue:"roles",children:[e.jsx(Ze,{children:e.jsx(Xe,{value:"roles",children:"Role Form"})}),e.jsx("div",{className:"p-6",children:e.jsx(es,{value:"roles",children:e.jsx(Ge,{touched:m,errors:c,roles:n,drawerMode:o})})})]})})})})});De.displayName="RolesForm";const ve=w.forwardRef((s,r)=>{const t=v(),a=R(c=>c.crmRoles.data.selectedRole),n=R(c=>c.crmRoles.data.rolesList),{id:o}=a,m=c=>{const{name:u,birthday:j,email:d,img:N,location:f,title:l,phoneNumber:h,facebook:x,twitter:g,pinterest:i,linkedIn:p}=c,I={name:u,email:d,img:N},P={location:f,title:l,birthday:Ie(j).format("DD/MM/YYYY"),phoneNumber:h,facebook:x,twitter:g,pinterest:i,linkedIn:p};let M=F(n),k={};M=M.map(D=>(D.id===o&&(D={...D,...I},D.personalInfo={...D.personalInfo,...P},k=D),D)),Oe(k)||t(xe(k)),t(V()),t(Ae(M))};return e.jsx(De,{ref:r,roles:a,onFormSubmit:m})});ve.displayName="RolesEditContent";const ss=({onSaveClick:s,onCancel:r})=>e.jsxs("div",{className:"text-right w-full",children:[e.jsx(O,{size:"sm",className:"mr-2",onClick:r,children:"Cancel"}),e.jsx(O,{size:"sm",variant:"solid",onClick:s,children:"Save"})]}),ts=()=>{const s=v(),r=R(c=>c.crmRoles.data.drawerOpen),t=R(c=>c.crmRoles.data.drawerMode),a=R(c=>c.crmRoles.data.selectedRole),n=()=>{s(V()),s($({}))},o=w.useRef(null),m=async()=>{var u,j;const c=(u=o.current)==null?void 0:u.values;if(t==="ADD"){const d=await s(Ee(c));console.log(d,"response"),await s(V()),await s(S())}else{const d=a.id,N=await s(xe({id:d,data:c}));console.log(N,"response"),await s(V()),await s(S())}(j=o.current)==null||j.submitForm()};return e.jsx(ze,{isOpen:r,closable:!1,bodyClass:"p-0",footer:e.jsx(ss,{onCancel:n,onSaveClick:m}),onClose:n,onRequestClose:n,width:600,children:e.jsx(ve,{ref:o})})},as=()=>{const s=v(),r=R(o=>o.crmRoles.data.deleteConfirmation),t=R(o=>o.crmRoles.data.selectedRole),a=()=>{s(q(!1))},n=async()=>{var m,c,u;s(q(!1)),console.log(t,"selectedRole");const o=await s(Pe(t.id));await s(S()),(m=o==null?void 0:o.payload)!=null&&m.success?(de.push(e.jsx(pe,{title:"Successfuly Deleted",type:"success",duration:2500,children:(c=o==null?void 0:o.payload)==null?void 0:c.message}),{placement:"top-center"}),await s(S())):(de.push(e.jsx(pe,{title:"Something Went Wrong !!!",type:"danger",duration:2500,children:(u=o==null?void 0:o.payload)==null?void 0:u.message}),{placement:"top-center"}),await s(S()))};return e.jsx(Ke,{isOpen:r,type:"danger",title:"Delete Role",confirmButtonColor:"red-600",onClose:a,onRequestClose:a,onCancel:a,onConfirm:n,children:e.jsx("p",{children:"Are you sure you want to delete this role? All record related to this role will be deleted as well. This action cannot be undone."})})},os=({row:s})=>{const{textTheme:r}=he(),t=v(),a=()=>{t(ge()),t($(s)),t(je("Edit"))};return e.jsx("div",{className:`${r} cursor-pointer select-none font-semibold`,onClick:a,children:"Edit"})},rs=({row:s})=>{const{textTheme:r}=he(),t=v(),a=async()=>{await t($(s)),t(q(!0))};return e.jsx("div",{className:`${r} cursor-pointer select-none font-semibold text-red-500`,onClick:a,children:"Delete"})},ls=()=>{const s=v(),r=R(i=>i.crmRoles.data.rolesList),t=R(i=>i.crmRoles.data.loading),a=R(i=>i.crmRoles.data.filterData),n=B("roles","canModify"),o=B("roles","canDelete"),{pageIndex:m,pageSize:c,sort:u,query:j,total:d}=R(i=>i.crmRoles.data.tableData),N=w.useCallback(()=>{s(S())},[m,c,u,j,a,s]);w.useEffect(()=>{N()},[N,m,c,u,a]);const f=w.useMemo(()=>({pageIndex:m,pageSize:c,sort:u,query:j,total:d}),[m,c,u,j,d]),l=w.useMemo(()=>{const i=[{header:"Role Name",accessorKey:"roleName",cell:p=>p.row.original.roleName},{header:"System",accessorKey:"isSystem",cell:p=>p.row.original.isSystem.toString()}];return o&&i.unshift({header:"Delete",id:"delete",cell:p=>e.jsx(rs,{row:p.row.original})}),n&&i.unshift({header:"Edit",id:"action",cell:p=>e.jsx(os,{row:p.row.original})}),i},[n,o]),h=i=>{const p=F(f);p.pageIndex=i,s(z(p))},x=i=>{const p=F(f);p.pageSize=Number(i),p.pageIndex=1,s(z(p))},g=i=>{const p=F(f);p.sort=i,s(z(p))};return e.jsxs("div",{children:[e.jsx(Fe,{columns:l,data:r,skeletonAvatarColumns:[0],skeletonAvatarProps:{width:28,height:28},loading:t,pagingData:{total:f.total,pageIndex:f.pageIndex,pageSize:f.pageSize},onPaginationChange:h,onSelectChange:x,onSort:g}),e.jsx(ts,{}),e.jsx(as,{})]})},{Control:ns}=He,fe=[{value:"",label:"All",color:"bg-gray-500"},{value:"active",label:"Active",color:"bg-emerald-500"},{value:"blocked",label:"Blocked",color:"bg-red-500"}],cs=({innerProps:s,label:r,data:t,isSelected:a})=>e.jsxs("div",{className:`flex items-center justify-between p-2 cursor-pointer ${a?"bg-gray-100 dark:bg-gray-500":"hover:bg-gray-50 dark:hover:bg-gray-600"}`,...s,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{innerClass:t.color}),e.jsx("span",{children:r})]}),a&&e.jsx(We,{className:"text-emerald-500 text-xl"})]}),is=({children:s,...r})=>{const t=r.getValue()[0];return e.jsxs(ns,{...r,children:[t&&e.jsx(Re,{className:"ltr:ml-4 rtl:mr-4",innerClass:t.color}),s]})},ms=()=>{const s=v(),{status:r}=R(a=>a.crmRoles.data.filterData),t=a=>{s(Ce({status:a==null?void 0:a.value}))};return e.jsx(Ye,{options:fe,size:"sm",className:"mb-4 min-w-[130px]",components:{Option:cs,Control:is},value:fe.filter(a=>a.value===r),onChange:t})},Se=w.forwardRef((s,r)=>{const{onInputChange:t}=s,a=_e(n,500);function n(m){t==null||t(m)}const o=m=>{a(m.target.value)};return e.jsx(Ne,{ref:r,className:"max-w-md md:w-52 mb-4",size:"sm",placeholder:"Search",prefix:e.jsx(Je,{className:"text-lg"}),onChange:o})});Se.displayName="RolesTableSearch";const ds=()=>{const s=v(),r=w.useRef(null),t=R(u=>u.crmRoles.data.tableData),a=B("roles","canCreate"),n=u=>{const j=F(t);j.query=u,j.pageIndex=1,typeof u=="string"&&u.length>1&&o(j),typeof u=="string"&&u.length===0&&o(j)},o=u=>{s(z(u)),s(S())},m=()=>{const u=F(t);u.query="",r.current&&(r.current.value=""),s(Ce({status:""})),o(u)},c=()=>{s(ge()),s(je("ADD"))};return e.jsxs("div",{className:"md:flex items-center justify-between",children:[e.jsxs("div",{className:"md:flex items-center gap-4",children:[e.jsx(Se,{ref:r,onInputChange:n}),e.jsx(ms,{})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx(O,{size:"sm",className:"me-2",onClick:m,children:"Clear All"}),a&&e.jsx(O,{size:"sm",onClick:c,children:"Add New"})]})]})};Me("crmRoles",Ve);const Ot=()=>e.jsx(e.Fragment,{children:e.jsxs(ke,{bodyClass:"h-full",children:[e.jsx(ds,{}),e.jsx(ls,{})]})});export{Ot as default};
